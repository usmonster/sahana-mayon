<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: apps/frontend/modules/admin/actions/actions.class.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>apps/frontend/modules/admin/actions/actions.class.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00015"></a><a class="code" href="classadminActions.html">00015</a> <span class="keyword">class </span><a class="code" href="classadminActions.html" title="extends agActions for the administration module">adminActions</a> <span class="keyword">extends</span> <a class="code" href="classagActions.html" title="extends sfActions for common functionality">agActions</a>
<a name="l00016"></a>00016 {
<a name="l00017"></a>00017   <span class="keyword">protected</span> $_searchedModels = array(<span class="stringliteral">&#39;agScenario&#39;</span>, <span class="stringliteral">&#39;agStaff&#39;</span>, <span class="stringliteral">&#39;agFacility&#39;</span>,
<a name="l00018"></a>00018     <span class="stringliteral">&#39;agScenarioFacilityGroup&#39;</span>, <span class="stringliteral">&#39;agOrganization&#39;</span>);
<a name="l00019"></a>00019 
<a name="l00024"></a><a class="code" href="classadminActions.html#a2bd3c3e8954ba9006cb1ac88764e83dd">00024</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a2bd3c3e8954ba9006cb1ac88764e83dd" title="necessary function which triggers rendering of the indexSuccess template">executeIndex</a>(sfWebRequest $request)
<a name="l00025"></a>00025   {
<a name="l00026"></a>00026     $this-&gt;enable_cache_clear = <a class="code" href="classagGlobal.html#a3860c5e7f0dcd22c1da77879b51b696a" title="Static method to return the requested parameter.">agGlobal::getParam</a>(<span class="stringliteral">&#39;enable_clear_cache&#39;</span>);
<a name="l00027"></a>00027   }
<a name="l00028"></a>00028 
<a name="l00033"></a><a class="code" href="classadminActions.html#a2221060398ec1aac88f8097e4aae2cfa">00033</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a2221060398ec1aac88f8097e4aae2cfa" title="Method provided to disable staff.">executeDisablestaff</a>(sfWebRequest $request)
<a name="l00034"></a>00034   {
<a name="l00035"></a>00035     $foo = <a class="code" href="classPluginagStaffResource.html#a8f587864be87d1d991a7dacd474991ba" title="Method to set all active staff in the system to a disabled status.">agStaffResource::disableAllStaff</a>();
<a name="l00036"></a>00036     $this-&gt;redirect(<span class="stringliteral">&#39;admin/index&#39;</span>);
<a name="l00037"></a>00037   }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039   <span class="keyword">public</span> function executeClearcache(sfWebRequest $request)
<a name="l00040"></a>00040   {
<a name="l00041"></a>00041     <span class="keywordflow">if</span> (<a class="code" href="classagGlobal.html#a3860c5e7f0dcd22c1da77879b51b696a" title="Static method to return the requested parameter.">agGlobal::getParam</a>(<span class="stringliteral">&#39;enable_clear_cache&#39;</span>) == 1) {
<a name="l00042"></a>00042       apc_clear_cache();
<a name="l00043"></a>00043       apc_clear_cache(<span class="stringliteral">&#39;user&#39;</span>);
<a name="l00044"></a>00044       apc_clear_cache(<span class="stringliteral">&#39;opcode&#39;</span>);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046       $oldDir = getcwd();
<a name="l00047"></a>00047       <span class="keywordflow">try</span> {
<a name="l00048"></a>00048         chdir(sfConfig::get(<span class="stringliteral">&#39;sf_root_dir&#39;</span>));
<a name="l00049"></a>00049         $task = <span class="keyword">new</span> <a class="code" href="classsfCacheClearTask.html">sfCacheClearTask</a>($this-&gt;context-&gt;getEventDispatcher(), <span class="keyword">new</span> <a class="code" href="classsfFormatter.html">sfFormatter</a>());
<a name="l00050"></a>00050         $task-&gt;run();
<a name="l00051"></a>00051       } <span class="keywordflow">catch</span>(Exception $e) {
<a name="l00052"></a>00052         $this-&gt;<a class="code" href="classsfContext.html">sfContext</a>-&gt;getLogger()-&gt;warning(<span class="stringliteral">&quot;Failed to clear the symfony cache: \n&quot;</span> . $e-&gt;getMessage());
<a name="l00053"></a>00053       }
<a name="l00054"></a>00054       chdir($oldDir);
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056     $this-&gt;redirect(<span class="stringliteral">&#39;admin/index&#39;</span>);
<a name="l00057"></a>00057   }
<a name="l00058"></a>00058 
<a name="l00063"></a><a class="code" href="classadminActions.html#a3f994acd588b9a8083431de21b2d4337">00063</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a3f994acd588b9a8083431de21b2d4337" title="Pacman is the basic shell for package management, it is currently NOT STABLE.">executePacman</a>(sfWebRequest $request)
<a name="l00064"></a>00064   {
<a name="l00065"></a>00065     $this-&gt;packages_available = agPluginManager::getPackages();
<a name="l00066"></a>00066     <span class="keywordflow">if</span> ($request-&gt;getParameter(<span class="stringliteral">&#39;enable&#39;</span>)) {
<a name="l00067"></a>00067       $enable_array = json_decode($request-&gt;getParameter(<span class="stringliteral">&#39;enable&#39;</span>));
<a name="l00068"></a>00068       $this-&gt;getContext()-&gt;getConfiguration()-&gt;enablePackages($enable_array);
<a name="l00069"></a>00069       <span class="comment">//sfSymfonyPluginManager::enablePlugin(&#39;agGisPlugin&#39; , sfConfig::get(&#39;sf_config_dir&#39;));</span>
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071     <span class="keywordflow">if</span> ($request-&gt;getParameter(<span class="stringliteral">&#39;disable&#39;</span>)) {
<a name="l00072"></a>00072       $disable_array = json_decode($request-&gt;getParameter(<span class="stringliteral">&#39;disable&#39;</span>));
<a name="l00073"></a>00073       $this-&gt;getContext()-&gt;getConfiguration()-&gt;disablePackages($disable_array);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075       <span class="comment">//sfSymfonyPluginManager::disablePlugin(&#39;agGisPlugin&#39; , sfConfig::get(&#39;sf_config_dir&#39;));</span>
<a name="l00076"></a>00076       <span class="comment">//disabling the plugin/module turns it off, we should remove any menu items associated with this</span>
<a name="l00077"></a>00077       <span class="comment">//module/plugin, but this mapping needs to be stored somewhere.  maybe routing should exist in the plugin?</span>
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079   }
<a name="l00080"></a>00080 
<a name="l00085"></a><a class="code" href="classadminActions.html#a8594dfb55f9cf93aa38a77449d377c7e">00085</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a8594dfb55f9cf93aa38a77449d377c7e" title="Globals is the portal for management of global parameters.">executeGlobals</a>(sfWebRequest $request)
<a name="l00086"></a>00086   {
<a name="l00087"></a>00087     $ag_global_param = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine_Core::getTable</a>(<span class="stringliteral">&#39;agGlobalParam&#39;</span>)
<a name="l00088"></a>00088             -&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;param&#39;</span>)));
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (isset($ag_global_param)) {
<a name="l00090"></a>00090       $this-&gt;paramform = <span class="keyword">new</span> <a class="code" href="classagGlobalParamForm.html" title="Global parameter form.">agGlobalParamForm</a>($ag_global_param);
<a name="l00091"></a>00091     } <span class="keywordflow">else</span> {
<a name="l00092"></a>00092       $this-&gt;paramform = <span class="keyword">new</span> <a class="code" href="classagGlobalParamForm.html" title="Global parameter form.">agGlobalParamForm</a>();
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094     $this-&gt;ag_global_params = <a class="code" href="classDoctrine__Query.html#a7420e7e1f1224c195cc56419fd733d14" title="create returns a new Doctrine_Query object">agDoctrineQuery::create</a>()
<a name="l00095"></a>00095             -&gt;select(<span class="stringliteral">&#39;gp.*&#39;</span>)
<a name="l00096"></a>00096             -&gt;from(<span class="stringliteral">&#39;agGlobalParam gp&#39;</span>)
<a name="l00097"></a>00097             -&gt;orderBy(<span class="stringliteral">&#39;gp.datapoint ASC&#39;</span>)
<a name="l00098"></a>00098             -&gt;execute();
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="keywordflow">if</span> ($request-&gt;hasParameter(<span class="stringliteral">&#39;update&#39;</span>) <span class="comment">/* &amp;&amp; $request-&gt;hasParameter(&#39;ag_global_param&#39;) */</span>) {
<a name="l00101"></a>00101       $this-&gt;forward404Unless($request-&gt;isMethod(sfRequest::POST) || $request-&gt;isMethod(sfRequest::PUT));
<a name="l00102"></a>00102       <span class="comment">//$this-&gt;forward404Unless($ag_global_param = Doctrine::getTable(&#39;agGlobalParam&#39;)-&gt;findAll()-&gt;getFirst(), sprintf(&#39;Object ag_account does not exist (%s).&#39;, $request-&gt;getParameter(&#39;id&#39;)));</span>
<a name="l00103"></a>00103       <span class="comment">//are we editing or creating a new param</span>
<a name="l00104"></a>00104       $this-&gt;<a class="code" href="classadminActions.html#a644e8d49f65617190a2b5ac5877b78cf" title="the processParam function only processes a paramform for modifying global params">processParam</a>($request, $this-&gt;paramform);
<a name="l00105"></a>00105       agGlobal::clearParams();
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108 
<a name="l00114"></a><a class="code" href="classadminActions.html#a53032b1a926a5ecd2896e139a2c40cae">00114</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a53032b1a926a5ecd2896e139a2c40cae" title="Display is the stub for managing display options in select lists, it is NOT STABLE...">executeDisplay</a>(sfWebRequest $request)
<a name="l00115"></a>00115   {
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     $this-&gt;form = <span class="keyword">new</span> <a class="code" href="classsfForm.html">sfForm</a>();
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     $this-&gt;form-&gt;getWidgetSchema()-&gt;setNameFormat(<span class="stringliteral">&#39;display[%s]&#39;</span>);
<a name="l00120"></a>00120     $this-&gt;form-&gt;setWidget(
<a name="l00121"></a>00121         <span class="stringliteral">&#39;agProfession&#39;</span>,
<a name="l00122"></a>00122         <span class="keyword">new</span> <a class="code" href="classsfWidgetFormDoctrineChoice.html">sfWidgetFormDoctrineChoice</a>(
<a name="l00123"></a>00123             array(<span class="stringliteral">&#39;multiple&#39;</span> =&gt; <span class="keyword">true</span>, <span class="stringliteral">&#39;expanded&#39;</span> =&gt; <span class="keyword">true</span>, <span class="stringliteral">&#39;model&#39;</span> =&gt; <span class="stringliteral">&#39;agProfession&#39;</span>)
<a name="l00124"></a>00124         )
<a name="l00125"></a>00125     );
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">//$this-&gt;form-&gt;setValidator(array(new sfValidatorDoctrineChoice(array(&#39;model&#39; =&gt; $this-&gt;form-&gt;getModelName(), &#39;column&#39; =&gt; &#39;app_display&#39;))));</span>
<a name="l00128"></a>00128     <span class="comment">//if submitted</span>
<a name="l00129"></a>00129     <span class="keywordflow">if</span> ($request-&gt;isMethod(sfRequest::POST)) {
<a name="l00130"></a>00130 
<a name="l00131"></a>00131       <span class="comment">//$this-&gt;form-&gt;bind($request-&gt;getParameter($this-&gt;form-&gt;getName()));</span>
<a name="l00132"></a>00132 <span class="comment">//      if ($this-&gt;form-&gt;isValid()) {</span>
<a name="l00133"></a>00133       <span class="keywordflow">foreach</span> ($request-&gt;getParameter(<span class="stringliteral">&#39;display&#39;</span>) as $process_display) {
<a name="l00134"></a>00134         <span class="comment">//$array_of_all = get</span>
<a name="l00135"></a>00135         $profession = <span class="keyword">new</span> <a class="code" href="classagProfession.html" title="Extends baseAgProfession.">agProfession</a>;
<a name="l00136"></a>00136         $profession-&gt;setAppDisplay(1);
<a name="l00137"></a>00137         $profession-&gt;save();
<a name="l00138"></a>00138         <span class="comment">//$process_display =</span>
<a name="l00139"></a>00139       }
<a name="l00140"></a>00140 <span class="comment">//      }</span>
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142   }
<a name="l00143"></a>00143 
<a name="l00148"></a><a class="code" href="classadminActions.html#a95a1106aa969105b57008582598a58ec">00148</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a95a1106aa969105b57008582598a58ec" title="provides a list of sfguardusers to the listSuccess template">executeList</a>(sfWebRequest $request)
<a name="l00149"></a>00149   {
<a name="l00150"></a>00150     $this-&gt;ag_accounts = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;sfGuardUser&#39;</span>)
<a name="l00151"></a>00151             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00152"></a>00152             -&gt;execute();
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154 
<a name="l00159"></a><a class="code" href="classadminActions.html#a0aa92d11ba843c39bc9cb68e60811c33">00159</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a0aa92d11ba843c39bc9cb68e60811c33" title="provides sfguarduser information to display on the showSuccess template">executeShow</a>(sfWebRequest $request)
<a name="l00160"></a>00160   {
<a name="l00161"></a>00161     $this-&gt;ag_account = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;sfGuardUser&#39;</span>)-&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>)));
<a name="l00162"></a>00162     $this-&gt;forward404Unless($this-&gt;ag_account);
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164 
<a name="l00169"></a><a class="code" href="classadminActions.html#a497c467213a396f88ed873ad46759ccb">00169</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a497c467213a396f88ed873ad46759ccb" title="provides the newSuccess template with an agAccountForm for creating a user account...">executeNew</a>(sfWebRequest $request)
<a name="l00170"></a>00170   {
<a name="l00171"></a>00171     $this-&gt;form = <span class="keyword">new</span> <a class="code" href="classagAccountForm.html" title="extends BaseagAccountForm by allowing binding of &amp;#39;user&amp;#39; data to an &amp;#39;account&amp;#39;...">agAccountForm</a>();
<a name="l00172"></a>00172   }
<a name="l00173"></a>00173 
<a name="l00180"></a><a class="code" href="classadminActions.html#a780fd22ced379f6b935de9088bd52bb4">00180</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a780fd22ced379f6b935de9088bd52bb4" title="provides the credSuccess template with credential management information and forms...">executeCred</a>(sfWebRequest $request)
<a name="l00181"></a>00181   {
<a name="l00182"></a>00182     <span class="comment">//get data needed for the list on credSuccess page</span>
<a name="l00183"></a>00183     $this-&gt;sf_guard_permissions = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine_Core::getTable</a>(<span class="stringliteral">&#39;sfGuardUserPermission&#39;</span>)
<a name="l00184"></a>00184             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00185"></a>00185             -&gt;execute();
<a name="l00186"></a>00186     $this-&gt;sf_guard_group_permissions = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine_Core::getTable</a>(<span class="stringliteral">&#39;sfGuardGroupPermission&#39;</span>)
<a name="l00187"></a>00187             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00188"></a>00188             -&gt;execute();
<a name="l00189"></a>00189     $credObject = null;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="comment">//get our post parameters</span>
<a name="l00192"></a>00192     $cred_id = $request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>);
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (isset($cred_id)) {
<a name="l00194"></a>00194       $credObject = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;sfGuardPermission&#39;</span>)-&gt;find(array($cred_id));
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     $this-&gt;form = <span class="keyword">new</span> <a class="code" href="classagCredForm.html" title="extends BaseagAccountForm by allowing binding of &amp;#39;user&amp;#39; data to an &amp;#39;account&amp;#39;...">agCredForm</a>($credObject);
<a name="l00198"></a>00198 <span class="comment">//CREATE/UPDATE</span>
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">if</span> ($request-&gt;isMethod(sfRequest::POST) || $request-&gt;isMethod(sfRequest::PUT)) {
<a name="l00201"></a>00201       $this-&gt;form-&gt;bind($request-&gt;getParameter($this-&gt;form-&gt;getName()), $request-&gt;getFiles($this-&gt;form-&gt;getName()));
<a name="l00202"></a>00202       <span class="keywordflow">if</span> ($this-&gt;form-&gt;isValid()) {
<a name="l00203"></a>00203         $cred_result = $this-&gt;form-&gt;save();
<a name="l00204"></a>00204         <span class="comment">//do i really need to set a variable?</span>
<a name="l00205"></a>00205         $this-&gt;redirect(<span class="stringliteral">&#39;admin/cred?id=&#39;</span> . $cred_result-&gt;getId());
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">//      $this-&gt;setTemplate(&#39;cred&#39;);</span>
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210   }
<a name="l00211"></a>00211 
<a name="l00217"></a><a class="code" href="classadminActions.html#a1d7a3de88ebf7914896759af9dde3b64">00217</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a1d7a3de88ebf7914896759af9dde3b64" title="provides the editSuccess template with an agAccountForm bound to the requested user...">executeCreate</a>(sfWebRequest $request)
<a name="l00218"></a>00218   {
<a name="l00219"></a>00219     $this-&gt;forward404Unless($request-&gt;isMethod(sfRequest::POST));
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     $this-&gt;form = <span class="keyword">new</span> <a class="code" href="classagAccountForm.html" title="extends BaseagAccountForm by allowing binding of &amp;#39;user&amp;#39; data to an &amp;#39;account&amp;#39;...">agAccountForm</a>(); <span class="comment">//, $options, $CSRFSecret)agAccountForm();</span>
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     $this-&gt;<a class="code" href="classadminActions.html#af4dd178186384c1d7af791cccc2a8b7b" title="the processform function only processes a form">processForm</a>($request, $this-&gt;form);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     $this-&gt;setTemplate(<span class="stringliteral">&#39;new&#39;</span>);
<a name="l00226"></a>00226   }
<a name="l00227"></a>00227 
<a name="l00233"></a><a class="code" href="classadminActions.html#a2cd8951d810b029580da8bfbbe6e338d">00233</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a2cd8951d810b029580da8bfbbe6e338d" title="provides the editSuccess template with an agAccountForm bound to the requested user...">executeEdit</a>(sfWebRequest $request)
<a name="l00234"></a>00234   {
<a name="l00235"></a>00235     $this-&gt;forward404Unless($ag_account = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;sfGuardUser&#39;</span>)-&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>))), sprintf(<span class="stringliteral">&#39;Object ag_account does not exist (%s).&#39;</span>, $request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>)));
<a name="l00236"></a>00236     $this-&gt;form = <span class="keyword">new</span> <a class="code" href="classagAccountForm.html" title="extends BaseagAccountForm by allowing binding of &amp;#39;user&amp;#39; data to an &amp;#39;account&amp;#39;...">agAccountForm</a>($ag_account);
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238 
<a name="l00244"></a><a class="code" href="classadminActions.html#a3f66ef494050ff5ca70b1a6d0a6062e8">00244</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#a3f66ef494050ff5ca70b1a6d0a6062e8" title="this function is only used to perform updates to a user account">executeUpdate</a>(sfWebRequest $request)
<a name="l00245"></a>00245   {
<a name="l00246"></a>00246     $this-&gt;forward404Unless($request-&gt;isMethod(sfRequest::POST) || $request-&gt;isMethod(sfRequest::PUT));
<a name="l00247"></a>00247     $this-&gt;forward404Unless($ag_account = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;sfGuardUser&#39;</span>)-&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>))), sprintf(<span class="stringliteral">&#39;Object sf_guard_user does not exist (%s).&#39;</span>, $request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>)));
<a name="l00248"></a>00248     $this-&gt;form = <span class="keyword">new</span> <a class="code" href="classagAccountForm.html" title="extends BaseagAccountForm by allowing binding of &amp;#39;user&amp;#39; data to an &amp;#39;account&amp;#39;...">agAccountForm</a>($ag_account);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     $this-&gt;<a class="code" href="classadminActions.html#af4dd178186384c1d7af791cccc2a8b7b" title="the processform function only processes a form">processForm</a>($request, $this-&gt;form);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     $this-&gt;setTemplate(<span class="stringliteral">&#39;edit&#39;</span>);
<a name="l00253"></a>00253   }
<a name="l00254"></a>00254 
<a name="l00260"></a><a class="code" href="classadminActions.html#abdcb714f833105e8ad1f0ddd0be97d0d">00260</a>   <span class="keyword">public</span> function <a class="code" href="classadminActions.html#abdcb714f833105e8ad1f0ddd0be97d0d" title="this function is used only to delete a user account">executeDelete</a>(sfWebRequest $request)
<a name="l00261"></a>00261   {
<a name="l00262"></a>00262     $request-&gt;checkCSRFProtection();
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     $this-&gt;forward404Unless($ag_account = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;sfGuardUser&#39;</span>)-&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>))), sprintf(<span class="stringliteral">&#39;Object ag_account does not exist (%s).&#39;</span>, $request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>)));
<a name="l00265"></a>00265 <span class="comment">//    $mj = $ag_account-&gt;getAgAccountMjSfGuardUser()-&gt;getFirst();</span>
<a name="l00266"></a>00266 <span class="comment">//    $sf = $mj-&gt;getSfGuardUser();</span>
<a name="l00267"></a>00267 <span class="comment">//    $sf_user = Doctrine::getTable(&#39;sfGuardUser&#39;)-&gt;find(array($sf-&gt;id));</span>
<a name="l00268"></a>00268 <span class="comment">//    $mj-&gt;delete();</span>
<a name="l00269"></a>00269 <span class="comment">//    $sf-&gt;delete();</span>
<a name="l00270"></a>00270     $ag_account-&gt;delete();
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     $this-&gt;redirect(<span class="stringliteral">&#39;admin/list&#39;</span>);
<a name="l00273"></a>00273   }
<a name="l00274"></a>00274 
<a name="l00282"></a><a class="code" href="classadminActions.html#af4dd178186384c1d7af791cccc2a8b7b">00282</a>   <span class="keyword">protected</span> function <a class="code" href="classadminActions.html#af4dd178186384c1d7af791cccc2a8b7b" title="the processform function only processes a form">processForm</a>(sfWebRequest $request, <a class="code" href="classsfForm.html">sfForm</a> $form)
<a name="l00283"></a>00283   {
<a name="l00284"></a>00284     $form-&gt;<a class="code" href="classsfForm.html#aa2f933561b7d73c96dae34e7e750151f" title="Binds the form with input values.">bind</a>($request-&gt;getParameter($form-&gt;<a class="code" href="classsfForm.html#ae2e0f2776affc971966229ce8ef37734" title="Returns the array name under which user data can retrieved.">getName</a>()), $request-&gt;getFiles($form-&gt;<a class="code" href="classsfForm.html#ae2e0f2776affc971966229ce8ef37734" title="Returns the array name under which user data can retrieved.">getName</a>()));
<a name="l00285"></a>00285     <span class="keywordflow">if</span> ($form-&gt;<a class="code" href="classsfForm.html#a3ce24db3ab577be065df5f5f370de6bb" title="Returns true if the form is valid.">isValid</a>()) {
<a name="l00286"></a>00286       $ag_account = $form-&gt;save();
<a name="l00287"></a>00287       <span class="keywordflow">if</span> ($request-&gt;hasParameter(<span class="stringliteral">&#39;Continue&#39;</span>)) {
<a name="l00289"></a>00289         $this-&gt;redirect(<span class="stringliteral">&#39;admin/new&#39;</span>);
<a name="l00290"></a>00290       } <span class="keywordflow">else</span> {
<a name="l00291"></a>00291         $this-&gt;redirect(<span class="stringliteral">&#39;admin/list&#39;</span>); <span class="comment">//edit?id=&#39; . $ag_account-&gt;getId());</span>
<a name="l00292"></a>00292       }
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295 
<a name="l00303"></a><a class="code" href="classadminActions.html#a644e8d49f65617190a2b5ac5877b78cf">00303</a>   <span class="keyword">protected</span> function <a class="code" href="classadminActions.html#a644e8d49f65617190a2b5ac5877b78cf" title="the processParam function only processes a paramform for modifying global params">processParam</a>(sfWebRequest $request, <a class="code" href="classsfForm.html">sfForm</a> $paramform)
<a name="l00304"></a>00304   {
<a name="l00305"></a>00305     $values = $request-&gt;getParameter(<span class="stringliteral">&#39;ag_global_param&#39;</span>);
<a name="l00306"></a>00306     <span class="keywordflow">if</span> (empty($values[<span class="stringliteral">&#39;id&#39;</span>])) {
<a name="l00307"></a>00307 
<a name="l00308"></a>00308       <span class="keywordflow">if</span> (!is_null($values[<span class="stringliteral">&#39;id&#39;</span>]))
<a name="l00309"></a>00309       { $values[<span class="stringliteral">&#39;id&#39;</span>] = NULL; }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311       $param = <span class="keyword">new</span> <a class="code" href="classagGlobalParam.html" title="Extends agGlobalParam.">agGlobalParam</a>();
<a name="l00312"></a>00312     } <span class="keywordflow">else</span> {
<a name="l00313"></a>00313       $param = <a class="code" href="classDoctrine__Query.html#a7420e7e1f1224c195cc56419fd733d14" title="create returns a new Doctrine_Query object">agDoctrineQuery::create</a>()
<a name="l00314"></a>00314               -&gt;select()
<a name="l00315"></a>00315               -&gt;from(<span class="stringliteral">&#39;agGlobalParam&#39;</span>)
<a name="l00316"></a>00316               -&gt;where(<span class="stringliteral">&#39;id = ?&#39;</span>, $values[<span class="stringliteral">&#39;id&#39;</span>])
<a name="l00317"></a>00317               -&gt;fetchOne();
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319     $param-&gt;synchronizeWithArray($values);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     $param-&gt;save();
<a name="l00322"></a>00322     $this-&gt;redirect(<span class="stringliteral">&#39;admin/globals&#39;</span>);
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
