<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: apps/frontend/modules/client/actions/actions.class.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>apps/frontend/modules/client/actions/actions.class.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00018"></a><a class="code" href="classclientActions.html">00018</a> <span class="keyword">class </span><a class="code" href="classclientActions.html" title="Client Actions extends sfActions.">clientActions</a> <span class="keyword">extends</span> sfActions
<a name="l00019"></a>00019 {
<a name="l00020"></a>00020 
<a name="l00036"></a><a class="code" href="classclientActions.html#a8dab36a9f70f523700f25d66bd4706f3">00036</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#a8dab36a9f70f523700f25d66bd4706f3">executeSearch</a>(sfWebRequest $request)
<a name="l00037"></a>00037   {
<a name="l00038"></a>00038     ProjectConfiguration::registerZend();
<a name="l00039"></a>00039     $query = $request-&gt;getParameter(<span class="stringliteral">&#39;query&#39;</span>);
<a name="l00040"></a>00040 
<a name="l00041"></a>00041     $originalQuery = $query;
<a name="l00042"></a>00042     <span class="keywordflow">if</span> (isset($request[<span class="stringliteral">&#39;nationality&#39;</span>]) ||
<a name="l00043"></a>00043         isset($request[<span class="stringliteral">&#39;ethnicity&#39;</span>]) ||
<a name="l00044"></a>00044         isset($request[<span class="stringliteral">&#39;religion&#39;</span>])) {
<a name="l00045"></a>00045       $query = Zend_Search_Lucene_Search_QueryParser::parse($query);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047       <span class="keywordflow">if</span> ($query instanceof Zend_Search_Lucene_Search_Query_Insignificant) {
<a name="l00048"></a>00048         $query = <span class="keyword">new</span> Zend_Search_Lucene_Search_Query_Boolean;
<a name="l00049"></a>00049       }
<a name="l00050"></a>00050       <span class="keywordflow">if</span> (isset($request[<span class="stringliteral">&#39;nationality&#39;</span>])) {
<a name="l00051"></a>00051         <span class="keywordflow">foreach</span> ($request[<span class="stringliteral">&#39;nationality&#39;</span>] as $val) {
<a name="l00052"></a>00052           $nationalities = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agNationality&#39;</span>)
<a name="l00053"></a>00053                   -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00054"></a>00054                   -&gt;select(<span class="stringliteral">&#39;p.nationality&#39;</span>)
<a name="l00055"></a>00055                   -&gt;from(<span class="stringliteral">&#39;agNationality p&#39;</span>)
<a name="l00056"></a>00056                   -&gt;where(<span class="stringliteral">&#39;p.id = ?&#39;</span>, $val)
<a name="l00057"></a>00057                   -&gt;execute();
<a name="l00058"></a>00058           <span class="keywordflow">foreach</span> ($nationalities as $ret) {
<a name="l00059"></a>00059             $natSub = <span class="keyword">new</span> Zend_Search_Lucene_Search_Query_Preprocessing_Term(
<a name="l00060"></a>00060                     $ret-&gt;nationality, null, <span class="stringliteral">&#39;nationality&#39;</span>
<a name="l00061"></a>00061             );
<a name="l00062"></a>00062             $query-&gt;addSubquery($natSub, <span class="keyword">true</span>);
<a name="l00063"></a>00063           }
<a name="l00064"></a>00064         }
<a name="l00065"></a>00065       }
<a name="l00066"></a>00066       <span class="keywordflow">if</span> (isset($request[<span class="stringliteral">&#39;ethnicity&#39;</span>])) {
<a name="l00067"></a>00067         <span class="keywordflow">foreach</span> ($request[<span class="stringliteral">&#39;ethnicity&#39;</span>] as $val) {
<a name="l00068"></a>00068           $ethnicities = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agEthnicity&#39;</span>)
<a name="l00069"></a>00069                   -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00070"></a>00070                   -&gt;select(<span class="stringliteral">&#39;p.ethnicity&#39;</span>)
<a name="l00071"></a>00071                   -&gt;from(<span class="stringliteral">&#39;agEthnicity p&#39;</span>)
<a name="l00072"></a>00072                   -&gt;where(<span class="stringliteral">&#39;p.id = ?&#39;</span>, $val)
<a name="l00073"></a>00073                   -&gt;execute();
<a name="l00074"></a>00074           <span class="keywordflow">foreach</span> ($ethnicities as $ret) {
<a name="l00075"></a>00075             $ethSub = <span class="keyword">new</span> Zend_Search_Lucene_Search_Query_Preprocessing_Term(
<a name="l00076"></a>00076                     $ret-&gt;ethnicity, null, <span class="stringliteral">&#39;ethnicity&#39;</span>
<a name="l00077"></a>00077             );
<a name="l00078"></a>00078             $query-&gt;addSubquery($ethSub, <span class="keyword">true</span>);
<a name="l00079"></a>00079           }
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081       }
<a name="l00082"></a>00082       <span class="keywordflow">if</span> (isset($request[<span class="stringliteral">&#39;religion&#39;</span>])) {
<a name="l00083"></a>00083         <span class="keywordflow">foreach</span> ($request[<span class="stringliteral">&#39;religion&#39;</span>] as $val) {
<a name="l00084"></a>00084           $religions = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agReligion&#39;</span>)
<a name="l00085"></a>00085                   -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00086"></a>00086                   -&gt;select(<span class="stringliteral">&#39;p.religion&#39;</span>)
<a name="l00087"></a>00087                   -&gt;from(<span class="stringliteral">&#39;agReligion p&#39;</span>)
<a name="l00088"></a>00088                   -&gt;where(<span class="stringliteral">&#39;p.id = ?&#39;</span>, $val)
<a name="l00089"></a>00089                   -&gt;execute();
<a name="l00090"></a>00090           <span class="keywordflow">foreach</span> ($religions as $ret) {
<a name="l00091"></a>00091             $relSub = <span class="keyword">new</span> Zend_Search_Lucene_Search_Query_Preprocessing_Term(
<a name="l00092"></a>00092                     $ret-&gt;religion, null, <span class="stringliteral">&#39;religion&#39;</span>
<a name="l00093"></a>00093             );
<a name="l00094"></a>00094             $query-&gt;addSubquery($relSub, <span class="keyword">true</span>);
<a name="l00095"></a>00095           }
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097       }
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     $lqResults = Doctrine_core::getTable(<span class="stringliteral">&#39;agPerson&#39;</span>)-&gt;getForLuceneQuery($query);
<a name="l00100"></a>00100     $this-&gt;pager = <span class="keyword">new</span> <a class="code" href="classsfDoctrinePager.html">sfDoctrinePager</a>(<span class="stringliteral">&#39;agPerson&#39;</span>, 20);
<a name="l00101"></a>00101     <span class="keywordflow">foreach</span> ($lqResults as $lqResult) {
<a name="l00102"></a>00102       $lqIds[] = $lqResult-&gt;getId();
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (isset($lqIds) &amp;&amp; count($lqIds) &gt; 0) {
<a name="l00105"></a>00105       $q = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPerson&#39;</span>)
<a name="l00106"></a>00106               -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00107"></a>00107               -&gt;select(<span class="stringliteral">&#39;p.*, ps.*, s.*, pn.*, n.*, e.*, lang.*, religion.*, namejoin.*, name.*,</span>
<a name="l00108"></a>00108 <span class="stringliteral">                nametype.*&#39;</span>)
<a name="l00109"></a>00109               -&gt;from(
<a name="l00110"></a>00110                   <span class="stringliteral">&#39;agPerson p, p.agPersonSex ps, ps.agSex s, p.agPersonMjAgNationality pn,</span>
<a name="l00111"></a>00111 <span class="stringliteral">                pn.agNationality n, p.agEthnicity e, p.agLanguage lang, p.agReligion religion,</span>
<a name="l00112"></a>00112 <span class="stringliteral">                p.agPersonMjAgPersonName namejoin, namejoin.agPersonName name,</span>
<a name="l00113"></a>00113 <span class="stringliteral">                name.agPersonNameType nametype&#39;</span>
<a name="l00114"></a>00114               )
<a name="l00115"></a>00115               -&gt;where(<span class="stringliteral">&#39;p.id IN (&#39;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $lqIds) . <span class="charliteral">&#39;)&#39;</span>);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       <span class="keywordflow">if</span> ($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>)) {
<a name="l00121"></a>00121         $this-&gt;pager-&gt;setQuery(
<a name="l00122"></a>00122             $q-&gt;orderBy(
<a name="l00123"></a>00123                 $request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>, <span class="stringliteral">&#39;person_name&#39;</span>)
<a name="l00124"></a>00124                 . <span class="charliteral">&#39; &#39;</span> . $request-&gt;getParameter(<span class="stringliteral">&#39;order&#39;</span>, <span class="stringliteral">&#39;DESC&#39;</span>)));
<a name="l00125"></a>00125       } <span class="keywordflow">else</span> {
<a name="l00126"></a>00126         $this-&gt;pager-&gt;setQuery($q);
<a name="l00127"></a>00127       }
<a name="l00128"></a>00128       $this-&gt;pager-&gt;setPage($request-&gt;getParameter(<span class="stringliteral">&#39;page&#39;</span>, 1));
<a name="l00129"></a>00129       $this-&gt;pager-&gt;init();
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     $this-&gt;query = $originalQuery;
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133 
<a name="l00142"></a><a class="code" href="classclientActions.html#af9fe323f67cae05f7ed744a8a55401d0">00142</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#af9fe323f67cae05f7ed744a8a55401d0" title="executeIndex is currently used to execute the index action for the staff person module...">executeIndex</a>(sfWebRequest $request)
<a name="l00143"></a>00143   {
<a name="l00144"></a>00144     <span class="comment">//do some index stuff here.</span>
<a name="l00145"></a>00145   }
<a name="l00146"></a>00146 
<a name="l00151"></a><a class="code" href="classclientActions.html#a5432aebe9b15355a15dd62849dd0c6c8">00151</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#a5432aebe9b15355a15dd62849dd0c6c8">executeList</a>(sfWebRequest $request)
<a name="l00152"></a>00152   {
<a name="l00153"></a>00153     $query = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPerson&#39;</span>)
<a name="l00154"></a>00154             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00155"></a>00155             -&gt;select(<span class="stringliteral">&#39;p.*, ps.*, s.*, pn.*, n.*, e.*, lang.*, religion.*, namejoin.*, name.*,</span>
<a name="l00156"></a>00156 <span class="stringliteral">              nametype.*&#39;</span>)
<a name="l00157"></a>00157             -&gt;from(
<a name="l00158"></a>00158                 <span class="stringliteral">&#39;agPerson p, p.agPersonSex ps, ps.agSex s, p.agPersonMjAgNationality pn,</span>
<a name="l00159"></a>00159 <span class="stringliteral">              pn.agNationality n, p.agEthnicity e, p.agLanguage lang, p.agReligion religion,</span>
<a name="l00160"></a>00160 <span class="stringliteral">              p.agPersonMjAgPersonName namejoin, namejoin.agPersonName name,</span>
<a name="l00161"></a>00161 <span class="stringliteral">              name.agPersonNameType nametype&#39;</span>
<a name="l00162"></a>00162     );
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     $this-&gt;pager = <span class="keyword">new</span> <a class="code" href="classsfDoctrinePager.html">sfDoctrinePager</a>(<span class="stringliteral">&#39;agPerson&#39;</span>, 20);
<a name="l00168"></a>00168     <span class="keywordflow">if</span> ($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>)) {
<a name="l00169"></a>00169       <span class="keywordflow">if</span> (substr($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>), 0, 11) == <span class="stringliteral">&#39;person_name&#39;</span>) {
<a name="l00170"></a>00170         $nameId = substr($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>), 12);
<a name="l00171"></a>00171         $sortOrder = $request-&gt;getParameter(<span class="stringliteral">&#39;order&#39;</span>, <span class="stringliteral">&#39;DESC&#39;</span>);
<a name="l00172"></a>00172         $this-&gt;pager-&gt;setQuery(
<a name="l00173"></a>00173             $query-&gt;orderBy(<span class="stringliteral">&#39;namejoin.person_name_type_id = &#39;</span> . $nameId .
<a name="l00174"></a>00174                 <span class="charliteral">&#39; &#39;</span> . $sortOrder . <span class="stringliteral">&#39;, person_name &#39;</span> . $sortOrder));
<a name="l00175"></a>00175       } <span class="keywordflow">else</span> {
<a name="l00176"></a>00176         $this-&gt;pager-&gt;setQuery(
<a name="l00177"></a>00177             $query-&gt;orderBy($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>, <span class="stringliteral">&#39;person_name&#39;</span>) .
<a name="l00178"></a>00178                 <span class="charliteral">&#39; &#39;</span> . $request-&gt;getParameter(<span class="stringliteral">&#39;order&#39;</span>, <span class="stringliteral">&#39;DESC&#39;</span>)));
<a name="l00179"></a>00179       }
<a name="l00180"></a>00180     } <span class="keywordflow">else</span> {
<a name="l00181"></a>00181       $this-&gt;pager-&gt;setQuery($query);
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="comment">//$sqloutput = $query-&gt;getSqlQuery();</span>
<a name="l00185"></a>00185     $this-&gt;pager-&gt;setPage($request-&gt;getParameter(<span class="stringliteral">&#39;page&#39;</span>, 1));
<a name="l00186"></a>00186     $this-&gt;pager-&gt;init();
<a name="l00187"></a>00187   }
<a name="l00188"></a>00188 
<a name="l00208"></a><a class="code" href="classclientActions.html#a8dd0c4aed2faa4992da4699f8c71af43">00208</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#a8dd0c4aed2faa4992da4699f8c71af43" title="executeShow displays an individual agPerson/staff-member entry.">executeShow</a>(sfWebRequest $request)
<a name="l00209"></a>00209   {
<a name="l00210"></a>00210     $query = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPerson&#39;</span>)
<a name="l00211"></a>00211             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00212"></a>00212             -&gt;select(
<a name="l00213"></a>00213                 <span class="stringliteral">&#39;p.*, ps.*, s.*, pn.*, n.*, e.*, lang.*, religion.*, namejoin.*, name.*, nametype.*&#39;</span>
<a name="l00214"></a>00214             )
<a name="l00215"></a>00215             -&gt;from(
<a name="l00216"></a>00216                 <span class="stringliteral">&#39;agPerson p, p.agPersonSex ps, ps.agSex s, p.agPersonMjAgNationality pn,</span>
<a name="l00217"></a>00217 <span class="stringliteral">                  pn.agNationality n, p.agEthnicity e, p.agLanguage lang, p.agReligion religion,</span>
<a name="l00218"></a>00218 <span class="stringliteral">                  p.agPersonMjAgPersonName namejoin, namejoin.agPersonName name,</span>
<a name="l00219"></a>00219 <span class="stringliteral">                  name.agPersonNameType nametype&#39;</span>
<a name="l00220"></a>00220     );
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     $this-&gt;pager = <span class="keyword">new</span> <a class="code" href="classsfDoctrinePager.html">sfDoctrinePager</a>(<span class="stringliteral">&#39;agPerson&#39;</span>, 1);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordflow">if</span> ($request[<span class="stringliteral">&#39;query&#39;</span>]) {
<a name="l00225"></a>00225       $lqResults = Doctrine_core::getTable(<span class="stringliteral">&#39;agPerson&#39;</span>)-&gt;getForLuceneQuery($request[<span class="stringliteral">&#39;query&#39;</span>]);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227       $i = 0;
<a name="l00228"></a>00228       $lqIds = array();
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       <span class="keywordflow">foreach</span> ($lqResults as $lqResult) {
<a name="l00231"></a>00231         $lqIds[$i] = $lqResult-&gt;getId();
<a name="l00232"></a>00232         $i++;
<a name="l00233"></a>00233       }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235       <span class="keywordflow">if</span> (count($lqIds) &gt; 0) {
<a name="l00236"></a>00236         $q = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPerson&#39;</span>)
<a name="l00237"></a>00237                 -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00238"></a>00238                 -&gt;select(<span class="stringliteral">&#39;p.*&#39;</span>)
<a name="l00239"></a>00239                 -&gt;from(<span class="stringliteral">&#39;agPerson p&#39;</span>)
<a name="l00240"></a>00240                 -&gt;where(<span class="stringliteral">&#39;p.id IN (&#39;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $lqIds) . <span class="charliteral">&#39;)&#39;</span>);
<a name="l00241"></a>00241         $this-&gt;pager-&gt;setQuery($q);
<a name="l00242"></a>00242         $this-&gt;pager-&gt;setPage($request-&gt;getParameter(<span class="stringliteral">&#39;page&#39;</span>, 1));
<a name="l00243"></a>00243         $this-&gt;pager-&gt;init();
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         $this-&gt;query = $request[<span class="stringliteral">&#39;query&#39;</span>];
<a name="l00246"></a>00246       }
<a name="l00247"></a>00247     } <span class="keywordflow">else</span> {
<a name="l00248"></a>00248       <span class="keywordflow">if</span> ($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>)) {
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (substr($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>), 0, 11) == <span class="stringliteral">&#39;person_name&#39;</span>) {
<a name="l00250"></a>00250           $nameId = substr($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>), 12);
<a name="l00251"></a>00251           $sortOrder = $request-&gt;getParameter(<span class="stringliteral">&#39;order&#39;</span>, <span class="stringliteral">&#39;DESC&#39;</span>);
<a name="l00252"></a>00252           $this-&gt;pager-&gt;setQuery(
<a name="l00253"></a>00253               $query-&gt;orderBy(<span class="stringliteral">&#39;namejoin.person_name_type_id = &#39;</span> . $nameId .
<a name="l00254"></a>00254                   <span class="charliteral">&#39; &#39;</span> . $sortOrder . <span class="stringliteral">&#39;, person_name &#39;</span> . $sortOrder));
<a name="l00255"></a>00255         } <span class="keywordflow">else</span> {
<a name="l00256"></a>00256           $this-&gt;pager-&gt;setQuery(
<a name="l00257"></a>00257               $query-&gt;orderBy($request-&gt;getParameter(<span class="stringliteral">&#39;sort&#39;</span>, <span class="stringliteral">&#39;person_name&#39;</span>) .
<a name="l00258"></a>00258                   <span class="charliteral">&#39; &#39;</span> . $request-&gt;getParameter(<span class="stringliteral">&#39;order&#39;</span>, <span class="stringliteral">&#39;DESC&#39;</span>)));
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260         <span class="comment">//$this-&gt;sortAppend = $sortOrder;</span>
<a name="l00261"></a>00261       } <span class="keywordflow">else</span> {
<a name="l00262"></a>00262         <span class="comment">//$this-&gt;pager-&gt;setQuery(Doctrine::getTable(&#39;agPerson&#39;)-&gt;createQuery(&#39;a&#39;));</span>
<a name="l00263"></a>00263         $this-&gt;pager-&gt;setQuery($query);
<a name="l00264"></a>00264       }
<a name="l00265"></a>00265       $this-&gt;pager-&gt;setPage($request-&gt;getParameter(<span class="stringliteral">&#39;page&#39;</span>, 1));
<a name="l00266"></a>00266       $this-&gt;pager-&gt;init();
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     $this-&gt;ag_person_name_types = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPersonNameType&#39;</span>)
<a name="l00270"></a>00270             -&gt;createQuery(<span class="charliteral">&#39;b&#39;</span>)
<a name="l00271"></a>00271             -&gt;execute();
<a name="l00272"></a>00272     $this-&gt;ag_phone_contact_types = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPhoneContactType&#39;</span>)
<a name="l00273"></a>00273             -&gt;createQuery(<span class="charliteral">&#39;c&#39;</span>)
<a name="l00274"></a>00274             -&gt;execute();
<a name="l00275"></a>00275     $this-&gt;ag_email_contact_types = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agEmailContactType&#39;</span>)
<a name="l00276"></a>00276             -&gt;createQuery(<span class="charliteral">&#39;d&#39;</span>)
<a name="l00277"></a>00277             -&gt;execute();
<a name="l00278"></a>00278     $this-&gt;ag_language_formats = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agLanguageFormat&#39;</span>)
<a name="l00279"></a>00279             -&gt;createQuery(<span class="charliteral">&#39;e&#39;</span>)
<a name="l00280"></a>00280             -&gt;execute();
<a name="l00281"></a>00281     $this-&gt;ag_address_contact_types = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agAddressContactType&#39;</span>)
<a name="l00282"></a>00282             -&gt;createQuery(<span class="charliteral">&#39;f&#39;</span>)
<a name="l00283"></a>00283             -&gt;execute();
<a name="l00284"></a>00284   }
<a name="l00285"></a>00285 
<a name="l00291"></a><a class="code" href="classclientActions.html#a141b91eeb112bee4eaef7d97248c53c1">00291</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#a141b91eeb112bee4eaef7d97248c53c1" title="Creates a blank agPerson form to create and save a new agPerson/staff-member.">executeNew</a>(sfWebRequest $request)
<a name="l00292"></a>00292   {
<a name="l00293"></a>00293     $this-&gt;form = <span class="keyword">new</span> AgPersonForm();
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295 
<a name="l00304"></a><a class="code" href="classclientActions.html#abed71ad755ebdc15b67994d830fd93f7">00304</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#abed71ad755ebdc15b67994d830fd93f7" title="Saves the new agPerson from data entered into the form generated by executeNew.">executeCreate</a>(sfWebRequest $request)
<a name="l00305"></a>00305   {
<a name="l00306"></a>00306     $this-&gt;forward404Unless($request-&gt;isMethod(sfRequest::POST));
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     $this-&gt;form = <span class="keyword">new</span> AgPersonForm();
<a name="l00309"></a>00309     $ent = <span class="keyword">new</span> <a class="code" href="classagEntity.html" title="Extends BaseagEntity and returns entity information.">agEntity</a>();
<a name="l00310"></a>00310     $ent-&gt;save();
<a name="l00311"></a>00311     $this-&gt;form-&gt;getObject()-&gt;setAgEntity($ent);
<a name="l00312"></a>00312     $this-&gt;<a class="code" href="classclientActions.html#a7c2822d9fc5c82785b92ff97dace5266" title="Processes one of the forms generated in the above actions.">processForm</a>($request, $this-&gt;form);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     $this-&gt;setTemplate(<span class="stringliteral">&#39;new&#39;</span>);
<a name="l00315"></a>00315   }
<a name="l00316"></a>00316 
<a name="l00323"></a><a class="code" href="classclientActions.html#af22cc600fc181e5042356e5c77514114">00323</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#af22cc600fc181e5042356e5c77514114" title="Creates a form prepopulated with the current information of the staff member to be...">executeEdit</a>(sfWebRequest $request)
<a name="l00324"></a>00324   {
<a name="l00325"></a>00325     $this-&gt;forward404Unless(
<a name="l00326"></a>00326         $ag_person = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;AgPerson&#39;</span>)-&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>))),
<a name="l00327"></a>00327         sprintf(<span class="stringliteral">&#39;Object ag_person does not exist (%s).&#39;</span>, $request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>)));
<a name="l00328"></a>00328     $this-&gt;form = <span class="keyword">new</span> AgPersonForm($ag_person);
<a name="l00329"></a>00329   }
<a name="l00330"></a>00330 
<a name="l00336"></a><a class="code" href="classclientActions.html#a55425e298eef95cacb7cef53df39af33">00336</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#a55425e298eef95cacb7cef53df39af33" title="Processes the form created by executeEdit to update the agPerson/staff-member being...">executeUpdate</a>(sfWebRequest $request)
<a name="l00337"></a>00337   {
<a name="l00338"></a>00338     $this-&gt;forward404Unless(
<a name="l00339"></a>00339         $request-&gt;isMethod(sfRequest::POST) || $request-&gt;isMethod(sfRequest::PUT));
<a name="l00340"></a>00340     $this-&gt;forward404Unless(
<a name="l00341"></a>00341         $ag_person = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;AgPerson&#39;</span>)-&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>))),
<a name="l00342"></a>00342         sprintf(<span class="stringliteral">&#39;Object ag_person does not exist (%s).&#39;</span>, $request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>)));
<a name="l00343"></a>00343     $this-&gt;form = <span class="keyword">new</span> AgPersonForm($ag_person);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     $this-&gt;<a class="code" href="classclientActions.html#a7c2822d9fc5c82785b92ff97dace5266" title="Processes one of the forms generated in the above actions.">processForm</a>($request, $this-&gt;form);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     $this-&gt;setTemplate(<span class="stringliteral">&#39;edit&#39;</span>);
<a name="l00348"></a>00348   }
<a name="l00349"></a>00349 
<a name="l00366"></a><a class="code" href="classclientActions.html#a8a9dcab655d6294f8fdc1d87cee87cf5">00366</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#a8a9dcab655d6294f8fdc1d87cee87cf5" title="Deletes the selected agPerson/staff-member.">executeDelete</a>(sfWebRequest $request)
<a name="l00367"></a>00367   {
<a name="l00368"></a>00368     $request-&gt;checkCSRFProtection();
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     $this-&gt;forward404Unless(
<a name="l00371"></a>00371         $ag_person = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;AgPerson&#39;</span>)-&gt;find(array($request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>))),
<a name="l00372"></a>00372         sprintf(<span class="stringliteral">&#39;Object ag_person does not exist (%s).&#39;</span>, $request-&gt;getParameter(<span class="stringliteral">&#39;id&#39;</span>)));
<a name="l00373"></a>00373     $ag_person-&gt;getAgPersonMjAgNationality()-&gt;delete();
<a name="l00374"></a>00374     $ag_person-&gt;getAgPersonDateOfBirth()-&gt;delete();
<a name="l00375"></a>00375     $ag_person-&gt;getAgPersonEthnicity()-&gt;delete();
<a name="l00376"></a>00376     $ag_person-&gt;getAgPersonMaritalStatus()-&gt;delete();
<a name="l00377"></a>00377     <span class="keywordflow">foreach</span> ($ag_person-&gt;getAgPersonMjAgLanguage() as $lang) {
<a name="l00378"></a>00378       $lang-&gt;getAgPersonLanguageCompetency()-&gt;delete();
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     <span class="keywordflow">foreach</span> ($ag_person-&gt;getAgEntity()-&gt;getAgEntityEmailContact() as $email) {
<a name="l00381"></a>00381       $email-&gt;delete();
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     <span class="keywordflow">foreach</span> ($ag_person-&gt;getAgEntity()-&gt;getAgEntityPhoneContact() as $phone) {
<a name="l00384"></a>00384       $phone-&gt;delete();
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386     $ag_person-&gt;getAgEntity()-&gt;getAgEntityEmailContact()-&gt;delete();
<a name="l00387"></a>00387     $ag_person-&gt;getAgPersonMjAgLanguage()-&gt;delete();
<a name="l00388"></a>00388     $ag_person-&gt;getAgPersonMjAgPersonName()-&gt;delete();
<a name="l00389"></a>00389     <span class="comment">//$ag_person-&gt;getAgPersonMjAgPhoneContact()-&gt;delete(); This and email below are disabled until we update the deletes to go through entity.</span>
<a name="l00390"></a>00390     $ag_person-&gt;getAgPersonMjAgProfession()-&gt;delete();
<a name="l00391"></a>00391     $ag_person-&gt;getAgPersonResidentialStatus()-&gt;delete();
<a name="l00392"></a>00392     $ag_person-&gt;getAgPersonSex()-&gt;delete();
<a name="l00393"></a>00393     <span class="comment">//$ag_person-&gt;getAgScenarioStaff()-&gt;delete();</span>
<a name="l00394"></a>00394     <span class="comment">//$ag_person-&gt;getAgPersonMjAgEmailContact()-&gt;delete();</span>
<a name="l00395"></a>00395     $ag_person-&gt;getAgPersonMjAgReligion()-&gt;delete();
<a name="l00396"></a>00396     <span class="comment">//$ag_person-&gt;getAgPersonMjAgSiteContact()-&gt;delete();</span>
<a name="l00397"></a>00397     <span class="keywordflow">foreach</span> ($ag_person-&gt;getAgEntity()-&gt;getAgEntityAddressContact() as $contact) {
<a name="l00398"></a>00398 <span class="comment">//      foreach($contact-&gt;getAgAddress()-&gt;getAgAddressMjAgAddressValue() as $addressJoin)</span>
<a name="l00399"></a>00399 <span class="comment">//      {</span>
<a name="l00400"></a>00400 <span class="comment">//        $addressJoin-&gt;delete();</span>
<a name="l00401"></a>00401 <span class="comment">//      }</span>
<a name="l00402"></a>00402       <span class="comment">//$address = $contact-&gt;getAgAddress();</span>
<a name="l00403"></a>00403       $contact-&gt;delete();
<a name="l00404"></a>00404       <span class="comment">//$address-&gt;delete();</span>
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406     $ent = $ag_person-&gt;getAgEntity();
<a name="l00407"></a>00407     $ag_person-&gt;delete();
<a name="l00408"></a>00408     $ent-&gt;delete();
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     $this-&gt;redirect(<span class="stringliteral">&#39;client/list&#39;</span>);
<a name="l00411"></a>00411   }
<a name="l00412"></a>00412 
<a name="l00420"></a><a class="code" href="classclientActions.html#a7c2822d9fc5c82785b92ff97dace5266">00420</a>   <span class="keyword">protected</span> function <a class="code" href="classclientActions.html#a7c2822d9fc5c82785b92ff97dace5266" title="Processes one of the forms generated in the above actions.">processForm</a>(sfWebRequest $request, <a class="code" href="classsfForm.html">sfForm</a> $form)
<a name="l00421"></a>00421   {
<a name="l00422"></a>00422     $form-&gt;<a class="code" href="classsfForm.html#aa2f933561b7d73c96dae34e7e750151f" title="Binds the form with input values.">bind</a>($request-&gt;getParameter($form-&gt;<a class="code" href="classsfForm.html#ae2e0f2776affc971966229ce8ef37734" title="Returns the array name under which user data can retrieved.">getName</a>()), $request-&gt;getFiles($form-&gt;<a class="code" href="classsfForm.html#ae2e0f2776affc971966229ce8ef37734" title="Returns the array name under which user data can retrieved.">getName</a>()));
<a name="l00423"></a>00423     $c = $form-&gt;<a class="code" href="classsfForm.html#ae2e0f2776affc971966229ce8ef37734" title="Returns the array name under which user data can retrieved.">getName</a>();
<a name="l00424"></a>00424     $d = $request-&gt;getParameter($form-&gt;<a class="code" href="classsfForm.html#ae2e0f2776affc971966229ce8ef37734" title="Returns the array name under which user data can retrieved.">getName</a>());
<a name="l00425"></a>00425     $e = $request-&gt;getFiles($form-&gt;<a class="code" href="classsfForm.html#ae2e0f2776affc971966229ce8ef37734" title="Returns the array name under which user data can retrieved.">getName</a>());
<a name="l00426"></a>00426     <span class="keywordflow">if</span> ($form-&gt;<a class="code" href="classsfForm.html#a3ce24db3ab577be065df5f5f370de6bb" title="Returns true if the form is valid.">isValid</a>()) {
<a name="l00427"></a>00427       $ag_person = $form-&gt;save();
<a name="l00428"></a>00428 
<a name="l00429"></a>00429       $this-&gt;redirect(<span class="stringliteral">&#39;client/edit?id=&#39;</span> . $ag_person-&gt;getId());
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431   }
<a name="l00432"></a>00432 
<a name="l00439"></a><a class="code" href="classclientActions.html#a61660f6fed70c68c9ec68a39d57f1ac7">00439</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#a61660f6fed70c68c9ec68a39d57f1ac7" title="Export the entire staff list of an Agasti installation as an XLS and offer the option...">executeExport</a>()
<a name="l00440"></a>00440   {
<a name="l00441"></a>00441     $clientMembers = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPerson&#39;</span>)
<a name="l00442"></a>00442             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00443"></a>00443             -&gt;execute();
<a name="l00444"></a>00444     $nameTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPersonNameType&#39;</span>)
<a name="l00445"></a>00445             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00446"></a>00446             -&gt;execute();
<a name="l00447"></a>00447     $phoneTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPhoneContactType&#39;</span>)
<a name="l00448"></a>00448             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00449"></a>00449             -&gt;execute();
<a name="l00450"></a>00450     $emailTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agEmailContactType&#39;</span>)
<a name="l00451"></a>00451             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00452"></a>00452             -&gt;execute();
<a name="l00453"></a>00453     $addressTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agAddressContactType&#39;</span>)
<a name="l00454"></a>00454             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00455"></a>00455             -&gt;execute();
<a name="l00456"></a>00456     $languageFormats = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agLanguageFormat&#39;</span>)
<a name="l00457"></a>00457             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00458"></a>00458             -&gt;execute();
<a name="l00459"></a>00459     require_once <span class="stringliteral">&#39;PHPExcel/Cell/AdvancedValueBinder.php&#39;</span>;
<a name="l00460"></a>00460     <a class="code" href="classPHPExcel__Cell.html#abc775f3583e6b01f31f8688c1ca15266" title="Set value binder to use.">PHPExcel_Cell::setValueBinder</a>(<span class="keyword">new</span> <a class="code" href="classPHPExcel__Cell__AdvancedValueBinder.html">PHPExcel_Cell_AdvancedValueBinder</a>());
<a name="l00461"></a>00461     $objPHPExcel = <span class="keyword">new</span> <a class="code" href="classsfPhpExcel.html">sfPhpExcel</a>();
<a name="l00462"></a>00462     <span class="comment">// Set active sheet index to the first sheet, so Excel opens this as the first sheet</span>
<a name="l00463"></a>00463     $objPHPExcel-&gt;setActiveSheetIndex(0);
<a name="l00464"></a>00464     <span class="comment">// Set properties</span>
<a name="l00465"></a>00465     $objPHPExcel-&gt;getProperties()-&gt;setCreator(<span class="stringliteral">&quot;Agasti 2.0&quot;</span>);
<a name="l00466"></a>00466     $objPHPExcel-&gt;getProperties()-&gt;setLastModifiedBy(<span class="stringliteral">&quot;Agasti 2.0&quot;</span>);
<a name="l00467"></a>00467     $objPHPExcel-&gt;getProperties()-&gt;setTitle(<span class="stringliteral">&quot;Staff List&quot;</span>);
<a name="l00468"></a>00468     <span class="comment">// Set default font</span>
<a name="l00469"></a>00469     $objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName(<span class="stringliteral">&#39;Times&#39;</span>);
<a name="l00470"></a>00470     $objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(12);
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     $row = 2;
<a name="l00473"></a>00473     <span class="keywordflow">foreach</span> ($staffMembers as $staffMember) {
<a name="l00474"></a>00474       $headings = array(<span class="stringliteral">&#39;ID&#39;</span>);
<a name="l00475"></a>00475       $content = array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $staffMember-&gt;id);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477       <span class="keywordflow">foreach</span> ($nameTypes as $nameType) {
<a name="l00478"></a>00478         $headings[] = ucwords($nameType-&gt;person_name_type) . <span class="stringliteral">&#39; Name&#39;</span>;
<a name="l00479"></a>00479         $j = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(
<a name="l00480"></a>00480                 <span class="stringliteral">&#39;AgPersonMjAgPersonName&#39;</span>)-&gt;findByDql(<span class="stringliteral">&#39;person_id = ? AND person_name_type_id = ?&#39;</span>,
<a name="l00481"></a>00481                 array($staffMember-&gt;id, $nameType-&gt;id))-&gt;getFirst();
<a name="l00482"></a>00482         $content[ucwords($nameType-&gt;person_name_type) . <span class="stringliteral">&#39; Name&#39;</span>]
<a name="l00483"></a>00483             = ($j ? $j-&gt;getAgPersonName()-&gt;person_name : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00484"></a>00484       }
<a name="l00485"></a>00485       $h = array(<span class="stringliteral">&#39;Sex&#39;</span>, <span class="stringliteral">&#39;Date of Birth&#39;</span>, <span class="stringliteral">&#39;Profession&#39;</span>, <span class="stringliteral">&#39;Nationality&#39;</span>,
<a name="l00486"></a>00486         <span class="stringliteral">&#39;Ethnicity&#39;</span>, <span class="stringliteral">&#39;Religion&#39;</span>, <span class="stringliteral">&#39;Marital Status&#39;</span>);
<a name="l00487"></a>00487       $headings = array_merge($headings, $h);
<a name="l00488"></a>00488       <span class="keywordflow">foreach</span> ($h as $head) {
<a name="l00489"></a>00489         <span class="comment">//if($head == &#39;Date of Birth&#39;) $head = &#39;Person Date Of Birth&#39;;</span>
<a name="l00490"></a>00490         $table = ($head == <span class="stringliteral">&#39;Date of Birth&#39;</span>) ?
<a name="l00491"></a>00491             <span class="stringliteral">&#39;agPersonDateOfBirth&#39;</span> : <span class="stringliteral">&#39;ag&#39;</span> . str_replace(<span class="charliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $head);
<a name="l00492"></a>00492         <span class="comment">//$table = &#39;ag&#39; . str_replace(&#39; &#39;, &#39;&#39;, $head);</span>
<a name="l00493"></a>00493         $fetcher = <span class="stringliteral">&#39;get&#39;</span> . ucwords($table);
<a name="l00494"></a>00494         $column = <a class="code" href="classsfInflector.html#a1d799a0c71dbc6a73d8c36455fa7202b" title="Returns an underscore-syntaxed version or the CamelCased string.">sfInflector::underscore</a>(str_replace(<span class="charliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;&#39;</span>, ucwords($head)));
<a name="l00495"></a>00495         $objects = $staffMember-&gt;$fetcher();
<a name="l00496"></a>00496         $i = 1;
<a name="l00497"></a>00497         $c = count($objects);
<a name="l00498"></a>00498         $results = null;
<a name="l00499"></a>00499         <span class="keywordflow">if</span> ($objects instanceof <a class="code" href="classDoctrine__Collection.html">Doctrine_Collection</a>) {
<a name="l00500"></a>00500           <span class="keywordflow">foreach</span> ($objects as $object) {
<a name="l00501"></a>00501             <span class="keywordflow">if</span> ($i &lt;&gt; $c) {
<a name="l00502"></a>00502               $results = $results . $object-&gt;$column . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00503"></a>00503             } <span class="keywordflow">else</span> {
<a name="l00504"></a>00504               $results = $results . $object-&gt;$column;
<a name="l00505"></a>00505             }
<a name="l00506"></a>00506             $i++;
<a name="l00507"></a>00507           }
<a name="l00508"></a>00508         } <span class="keywordflow">else</span> {
<a name="l00509"></a>00509           $results = $results . $objects-&gt;$column;
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511         $values[$head] = ucwords($results);
<a name="l00512"></a>00512       }
<a name="l00513"></a>00513       $content = array_merge($content, $values);
<a name="l00514"></a>00514       <span class="keywordflow">foreach</span> ($phoneTypes as $phoneType) {
<a name="l00515"></a>00515         $headings[] = ucwords($phoneType-&gt;phone_contact_type) . <span class="stringliteral">&#39; Phone&#39;</span>;
<a name="l00516"></a>00516         $j = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;AgEntityPhoneContact&#39;</span>)
<a name="l00517"></a>00517                 -&gt;findByDql(
<a name="l00518"></a>00518                     <span class="stringliteral">&#39;entity_id = ? AND phone_contact_type_id = ?&#39;</span>,
<a name="l00519"></a>00519                     array($staffMember-&gt;entity_id, $phoneType-&gt;id)
<a name="l00520"></a>00520                 )-&gt;getFirst();
<a name="l00521"></a>00521         $content[ucwords($phoneType-&gt;phone_contact_type) . <span class="stringliteral">&#39; Phone&#39;</span>] =
<a name="l00522"></a>00522             ($j ?
<a name="l00523"></a>00523                 preg_replace(
<a name="l00524"></a>00524                         $j
<a name="l00525"></a>00525                         -&gt;getAgPhoneContact()
<a name="l00526"></a>00526                         -&gt;getAgPhoneFormat()
<a name="l00527"></a>00527                         -&gt;getAgPhoneFormatType()-&gt;match_pattern,
<a name="l00528"></a>00528                         $j
<a name="l00529"></a>00529                         -&gt;getAgPhoneContact()
<a name="l00530"></a>00530                         -&gt;getAgPhoneFormat()
<a name="l00531"></a>00531                         -&gt;getAgPhoneFormatType()-&gt;replacement_pattern,
<a name="l00532"></a>00532                         $j
<a name="l00533"></a>00533                         -&gt;getAgPhoneContact()-&gt;phone_contact) :
<a name="l00534"></a>00534                 <span class="stringliteral">&#39;&#39;</span>
<a name="l00535"></a>00535             );
<a name="l00536"></a>00536       }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       <span class="keywordflow">foreach</span> ($emailTypes as $emailType) {
<a name="l00539"></a>00539         $headings[] = ucwords($emailType-&gt;email_contact_type) . <span class="stringliteral">&#39; Email&#39;</span>;
<a name="l00540"></a>00540         $j = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;AgEntityEmailContact&#39;</span>)
<a name="l00541"></a>00541                 -&gt;findByDql(
<a name="l00542"></a>00542                     <span class="stringliteral">&#39;entity_id = ? AND email_contact_type_id = ?&#39;</span>,
<a name="l00543"></a>00543                     array($staffMember-&gt;entity_id, $emailType-&gt;id)
<a name="l00544"></a>00544                 )
<a name="l00545"></a>00545                 -&gt;getFirst();
<a name="l00546"></a>00546         $content[ucwords($emailType-&gt;email_contact_type) . <span class="stringliteral">&#39; Email&#39;</span>] =
<a name="l00547"></a>00547             ($j ? $j-&gt;getAgEmailContact()-&gt;email_contact : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00548"></a>00548       }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550       <span class="keywordflow">foreach</span> ($addressTypes as $addressType) {
<a name="l00551"></a>00551         $headings[] = ucwords($addressType-&gt;address_contact_type) . <span class="stringliteral">&#39; Address&#39;</span>;
<a name="l00552"></a>00552         $j = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;AgEntityAddressContact&#39;</span>)
<a name="l00553"></a>00553                 -&gt;findByDql(
<a name="l00554"></a>00554                     <span class="stringliteral">&#39;entity_id = ? AND address_contact_type_id = ?&#39;</span>,
<a name="l00555"></a>00555                     array($staffMember-&gt;entity_id, $addressType-&gt;id)
<a name="l00556"></a>00556                 )
<a name="l00557"></a>00557                 -&gt;getFirst();
<a name="l00558"></a>00558         $tempContainer = array();
<a name="l00559"></a>00559         <span class="keywordflow">if</span> ($j) {
<a name="l00560"></a>00560           <span class="keywordflow">foreach</span> ($j-&gt;getAgAddress()-&gt;getAgAddressStandard()-&gt;getAgAddressFormat()
<a name="l00561"></a>00561           as $addressFormat) {
<a name="l00562"></a>00562             <span class="keywordflow">foreach</span> ($j-&gt;getAgAddress()-&gt;getAgAddressMjAgAddressValue() as $mj) {
<a name="l00563"></a>00563               <span class="keywordflow">if</span> ($addressFormat-&gt;getAgAddressElement()-&gt;id ==
<a name="l00564"></a>00564                   $mj-&gt;getAgAddressValue()-&gt;address_element_id) {
<a name="l00565"></a>00565                 $i = 1;
<a name="l00566"></a>00566                 $c = count($j);
<a name="l00567"></a>00567                 <span class="keywordflow">if</span> (isset($tempContainer[<span class="stringliteral">&#39;Line &#39;</span> . $addressFormat-&gt;line_sequence])) {
<a name="l00568"></a>00568                   $tempContainer[<span class="stringliteral">&#39;Line &#39;</span> . $addressFormat-&gt;line_sequence] =
<a name="l00569"></a>00569                       $tempContainer[<span class="stringliteral">&#39;Line &#39;</span> . $addressFormat-&gt;line_sequence] .
<a name="l00570"></a>00570                       $addressFormat-&gt;pre_delimiter . $mj-&gt;getAgAddressValue()-&gt;value .
<a name="l00571"></a>00571                       $addressFormat-&gt;post_delimiter;
<a name="l00572"></a>00572                 } <span class="keywordflow">else</span> {
<a name="l00573"></a>00573                   $tempContainer[<span class="stringliteral">&#39;Line &#39;</span> . $addressFormat-&gt;line_sequence] =
<a name="l00574"></a>00574                       $addressFormat-&gt;pre_delimiter .
<a name="l00575"></a>00575                       $mj-&gt;getAgAddressValue()-&gt;value .
<a name="l00576"></a>00576                       $addressFormat-&gt;post_delimiter;
<a name="l00577"></a>00577                 }
<a name="l00578"></a>00578               }
<a name="l00579"></a>00579             }
<a name="l00580"></a>00580           }
<a name="l00581"></a>00581         } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582           $tempContainer[ucwords($addressType-&gt;address_contact_type) . <span class="stringliteral">&#39; Address&#39;</span>] = null;
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584         $content[ucwords($addressType-&gt;address_contact_type) . <span class="stringliteral">&#39; Address&#39;</span>] =
<a name="l00585"></a>00585             implode(<span class="stringliteral">&quot;\n&quot;</span>, $tempContainer);
<a name="l00586"></a>00586       }
<a name="l00587"></a>00587       $headings[] = <span class="stringliteral">&#39;Language&#39;</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589       <span class="keywordflow">foreach</span> ($languageFormats as $languageFormat) {
<a name="l00590"></a>00590         $headings[] = ucwords($languageFormat-&gt;language_format);
<a name="l00591"></a>00591         $competencies = null;
<a name="l00592"></a>00592         $languages = null;
<a name="l00593"></a>00593         $c = count($staffMember-&gt;getAgPersonMjAgLanguage());
<a name="l00594"></a>00594         $i = 1;
<a name="l00595"></a>00595         <span class="keywordflow">foreach</span> ($staffMember-&gt;getAgPersonMjAgLanguage() as $languageJoin) {
<a name="l00596"></a>00596           $compQuery = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPersonLanguageCompetency&#39;</span>)-&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00597"></a>00597                   -&gt;select(<span class="stringliteral">&#39;a.*&#39;</span>)
<a name="l00598"></a>00598                   -&gt;from(<span class="stringliteral">&#39;agPersonLanguageCompetency a&#39;</span>)
<a name="l00599"></a>00599                   -&gt;where(<span class="stringliteral">&#39;a.person_language_id = ?&#39;</span>, $languageJoin-&gt;id)
<a name="l00600"></a>00600                   -&gt;andWhere(<span class="stringliteral">&#39;a.language_format_id = ?&#39;</span>, $languageFormat-&gt;id);
<a name="l00601"></a>00601           <span class="keywordflow">if</span> ($i &lt;&gt; $c) {
<a name="l00602"></a>00602             $languages = $languages . $languageJoin-&gt;getAgLanguage()-&gt;language . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00603"></a>00603           } <span class="keywordflow">else</span> {
<a name="l00604"></a>00604             $languages = $languages . $languageJoin-&gt;getAgLanguage()-&gt;language;
<a name="l00605"></a>00605           }
<a name="l00606"></a>00606           <span class="keywordflow">if</span> ($compEx = $compQuery-&gt;fetchOne()) {
<a name="l00607"></a>00607             <span class="keywordflow">if</span> ($i &lt;&gt; $c) {
<a name="l00608"></a>00608               $competencies =
<a name="l00609"></a>00609                   $competencies . $compEx-&gt;getAgLanguageCompetency()-&gt;language_competency . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00610"></a>00610             } <span class="keywordflow">else</span> {
<a name="l00611"></a>00611               $competencies =
<a name="l00612"></a>00612                   $competencies . $compEx-&gt;getAgLanguageCompetency()-&gt;language_competency;
<a name="l00613"></a>00613             }
<a name="l00614"></a>00614           } <span class="keywordflow">else</span> {
<a name="l00615"></a>00615             $competencies = $competencies . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00616"></a>00616           }
<a name="l00617"></a>00617           $i++;
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619         $content[<span class="stringliteral">&#39;Language&#39;</span>] = $languages;
<a name="l00620"></a>00620         $content[ucwords($languageFormat-&gt;language_format)] = $competencies;
<a name="l00621"></a>00621       }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       $content[<span class="stringliteral">&#39;Created&#39;</span>] = $staffMember-&gt;created_at;
<a name="l00624"></a>00624       $content[<span class="stringliteral">&#39;Updated&#39;</span>] = $staffMember-&gt;updated_at;
<a name="l00625"></a>00625       array_push($headings, <span class="stringliteral">&#39;Created&#39;</span>, <span class="stringliteral">&#39;Updated&#39;</span>);
<a name="l00626"></a>00626       <span class="keywordflow">foreach</span> ($headings as $hKey =&gt; $heading) {
<a name="l00627"></a>00627         $objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($hKey, 1)-&gt;setValue($heading);
<a name="l00628"></a>00628         <span class="keywordflow">foreach</span> ($content as $eKey =&gt; $entry) {
<a name="l00629"></a>00629           <span class="keywordflow">if</span> ($eKey == $heading) {
<a name="l00630"></a>00630             $objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($hKey, $row)-&gt;setValue($entry);
<a name="l00631"></a>00631           }
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633       }
<a name="l00634"></a>00634       $row++;
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636     <span class="comment">//This should be assigning an auto-width to each column that will fit the largest data in it. For some reason, it&#39;s not working.</span>
<a name="l00637"></a>00637     $highestColumn = $objPHPExcel-&gt;getActiveSheet()-&gt;getHighestColumn();
<a name="l00638"></a>00638     $highestColumnIndex = <a class="code" href="classPHPExcel__Cell.html#a00c53970381f72743472103476da3ec5" title="Column index from string.">PHPExcel_Cell::columnIndexFromString</a>($highestColumn);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <span class="keywordflow">for</span> ($i = $highestColumnIndex; $i &gt;= 0; $i--) {
<a name="l00641"></a>00641       $objPHPExcel
<a name="l00642"></a>00642           -&gt;getActiveSheet()
<a name="l00643"></a>00643           -&gt;getColumnDimension(<a class="code" href="classPHPExcel__Cell.html#a5fee1754278132b9e33c1698e0d79453" title="String from columnindex.">PHPExcel_Cell::stringFromColumnIndex</a>($i))
<a name="l00644"></a>00644           -&gt;setAutoSize(<span class="keyword">true</span>);
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646     <span class="comment">// Save Excel 2007 file</span>
<a name="l00647"></a>00647     
<a name="l00648"></a>00648     $objWriter = <span class="keyword">new</span> <a class="code" href="classPHPExcel__Writer__Excel5.html">PHPExcel_Writer_Excel5</a>($objPHPExcel);
<a name="l00649"></a>00649     $todaydate = date(<span class="stringliteral">&quot;d-m-y&quot;</span>);
<a name="l00650"></a>00650     $todaydate = $todaydate . <span class="charliteral">&#39;-&#39;</span> . date(<span class="stringliteral">&quot;H-i-s&quot;</span>);
<a name="l00651"></a>00651     $filename = <span class="stringliteral">&#39;Staff&#39;</span>;
<a name="l00652"></a>00652     $filename = $filename . <span class="charliteral">&#39;-&#39;</span> . $todaydate;
<a name="l00653"></a>00653     $filename = $filename . <span class="stringliteral">&#39;.xls&#39;</span>;
<a name="l00654"></a>00654     $filePath = realpath(sys_get_temp_dir()) . <span class="charliteral">&#39;/&#39;</span> . $filename;
<a name="l00655"></a>00655     $objWriter-&gt;save($filePath);
<a name="l00656"></a>00656     $foo = <span class="keyword">new</span> finfo();
<a name="l00657"></a>00657     $bar = $foo-&gt;file($filePath, FILEINFO_MIME_TYPE);
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     $this-&gt;getResponse()-&gt;setHttpHeader(<span class="stringliteral">&#39;Content-Type&#39;</span>, <span class="stringliteral">&#39;application/vnd.ms-excel&#39;</span>);
<a name="l00660"></a>00660     $this-&gt;getResponse()-&gt;setHttpHeader(
<a name="l00661"></a>00661         <span class="stringliteral">&#39;Content-Disposition&#39;</span>, <span class="stringliteral">&#39;attachment;filename=&quot;&#39;</span> . $filename . <span class="charliteral">&#39;&quot;&#39;</span>
<a name="l00662"></a>00662     );
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     $exportFile = file_get_contents($filePath);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <span class="comment">//$this-&gt;getResponse()-&gt;setContent($objWriter);</span>
<a name="l00667"></a>00667     <span class="comment">//$this-&gt;getResponse()-&gt;setContent($exportFile);</span>
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     $this-&gt;getResponse()-&gt;setHeaderOnly(<span class="keyword">true</span>);
<a name="l00670"></a>00670     $this-&gt;getResponse()-&gt;send();
<a name="l00671"></a>00671     $objWriter-&gt;save(<span class="stringliteral">&#39;php://output&#39;</span>);
<a name="l00672"></a>00672     unlink($filePath);
<a name="l00673"></a>00673   }
<a name="l00674"></a>00674 
<a name="l00681"></a><a class="code" href="classclientActions.html#acaca90307c4a78b33bad9b0669972c01">00681</a>   <span class="keyword">public</span> function <a class="code" href="classclientActions.html#acaca90307c4a78b33bad9b0669972c01" title="Imports staff records from a properly formatted XLS file.">executeImport</a>()
<a name="l00682"></a>00682   {
<a name="l00683"></a>00683     $staffMembers = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPerson&#39;</span>)
<a name="l00684"></a>00684             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00685"></a>00685             -&gt;execute();
<a name="l00686"></a>00686     $nameTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPersonNameType&#39;</span>)
<a name="l00687"></a>00687             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00688"></a>00688             -&gt;execute();
<a name="l00689"></a>00689     $phoneTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agPhoneContactType&#39;</span>)
<a name="l00690"></a>00690             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00691"></a>00691             -&gt;execute();
<a name="l00692"></a>00692     $emailTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agEmailContactType&#39;</span>)
<a name="l00693"></a>00693             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00694"></a>00694             -&gt;execute();
<a name="l00695"></a>00695     $addressTypes = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agAddressContactType&#39;</span>)
<a name="l00696"></a>00696             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00697"></a>00697             -&gt;execute();
<a name="l00698"></a>00698     $languageFormats = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine::getTable</a>(<span class="stringliteral">&#39;agLanguageFormat&#39;</span>)
<a name="l00699"></a>00699             -&gt;createQuery(<span class="charliteral">&#39;a&#39;</span>)
<a name="l00700"></a>00700             -&gt;execute();
<a name="l00701"></a>00701     <span class="comment">// Right now this is not as robust as possible, only XLS files will be handled. Functionality can be added later for CSV and a few other formats</span>
<a name="l00702"></a>00702     <span class="comment">// that are supported by PHPExcel. PHPExcel_IOFactory::createReaderForFile is not the issue, it will set the right reader for whatever filetype is imported,</span>
<a name="l00703"></a>00703     <span class="comment">// it&#39;s just set in the if statement below.</span>
<a name="l00704"></a>00704     <span class="comment">// Set some properties to the imported file&#39;s path and file.</span>
<a name="l00705"></a>00705     $this-&gt;importFile = $_FILES[<span class="stringliteral">&#39;import&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00706"></a>00706     $this-&gt;importPath = sfConfig::get(<span class="stringliteral">&#39;sf_upload_dir&#39;</span>) . <span class="charliteral">&#39;/&#39;</span> . $this-&gt;importFile;
<a name="l00707"></a>00707     $filePath = pathinfo($this-&gt;importFile);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     $passPath = $_FILES[<span class="stringliteral">&#39;import&#39;</span>][<span class="stringliteral">&#39;tmp_name&#39;</span>];
<a name="l00710"></a>00710     $extension = strtolower($filePath[<span class="stringliteral">&#39;extension&#39;</span>]);
<a name="l00711"></a>00711     <span class="keywordflow">if</span> ($extension &lt;&gt; <span class="stringliteral">&#39;xls&#39;</span>) {
<a name="l00712"></a>00712       $this-&gt;uploadHeading = <span class="stringliteral">&#39;Import Failure&#39;</span>;
<a name="l00713"></a>00713       $this-&gt;uploadMessage = $this-&gt;importFile . <span class="stringliteral">&#39; is not an XLS file and could not be read. No data was imported to Agasti.&#39;</span>;
<a name="l00714"></a>00714     } <span class="keywordflow">else</span> {
<a name="l00715"></a>00715       $returned = shell_exec(<span class="stringliteral">&#39;php -r &quot;include (\&#39;../apps/frontend/lib/util/import.php\&#39;); echo processStaffImport(\&#39;&#39;</span> . htmlspecialchars($passPath) . <span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&#39;);</span>
<a name="l00716"></a>00716 <span class="stringliteral">//      $returned = shell_exec(&#39;php -r &quot;</span>include (\<span class="stringliteral">&#39;../apps/frontend/lib/util/import.php\&#39;); echo processStaffImport(\&#39;&#39;</span> . htmlspecialchars($passPath) . <span class="charliteral">&#39;\&#39;</span>, \<span class="stringliteral">&#39;&#39;</span> . htmlspecialchars($tyr) . <span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&#39;);</span>
<a name="l00717"></a>00717 <span class="stringliteral">//      $toImport = unserialize($toImport);</span>
<a name="l00718"></a>00718 <span class="stringliteral">      //include &#39;../apps/frontend/lib/util/import.php&#39;;</span>
<a name="l00719"></a>00719 <span class="stringliteral">      $returned = unserialize($returned);</span>
<a name="l00720"></a>00720 <span class="stringliteral">      while ($returned[&#39;Current Iteration&#39; ] &lt; $returned[&#39;Max Iteration&#39;]) {</span>
<a name="l00721"></a>00721 <span class="stringliteral">        $this-&gt;message = $returned;</span>
<a name="l00722"></a>00722 <span class="stringliteral">        //$this-&gt;redirect(&#39;staff/import&#39;);</span>
<a name="l00723"></a>00723 <span class="stringliteral">        $returned = shell_exec(&#39;php -r &quot;</span>include (\<span class="stringliteral">&#39;../apps/frontend/lib/util/import.php\&#39;); echo buildAndSave(\&#39;&#39;</span> . addslashes(serialize($returned[<span class="stringliteral">&#39;Staff&#39;</span>])) . <span class="charliteral">&#39;\&#39;</span>, \<span class="stringliteral">&#39;&#39;</span> . ($returned[<span class="stringliteral">&#39;Current Iteration&#39;</span>] + 1) . <span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&#39;);</span>
<a name="l00724"></a>00724 <span class="stringliteral">        //$returned = buildAndSave($returned[&#39;Staff&#39;],$returned[&#39;Current Iteration&#39;] + 1);</span>
<a name="l00725"></a>00725 <span class="stringliteral">        $returned = unserialize($returned);</span>
<a name="l00726"></a>00726 <span class="stringliteral">      }</span>
<a name="l00727"></a>00727 <span class="stringliteral">      $this-&gt;message = $returned;</span>
<a name="l00728"></a>00728 <span class="stringliteral">    }</span>
<a name="l00729"></a>00729 <span class="stringliteral">  }</span>
<a name="l00730"></a>00730 <span class="stringliteral"></span>
<a name="l00731"></a>00731 <span class="stringliteral">}</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
