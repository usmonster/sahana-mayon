<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: web/wiki/inc/JSON.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>web/wiki/inc/JSON.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */</span>
<a name="l00003"></a>00003 
<a name="l00060"></a>00060 <span class="comment">// for DokuWiki</span>
<a name="l00061"></a>00061 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;DOKU_INC&#39;</span>)) die(<span class="stringliteral">&#39;meh.&#39;</span>);
<a name="l00062"></a>00062 
<a name="l00066"></a>00066 define(<span class="stringliteral">&#39;JSON_SLICE&#39;</span>,   1);
<a name="l00067"></a>00067 
<a name="l00071"></a>00071 define(<span class="stringliteral">&#39;JSON_IN_STR&#39;</span>,  2);
<a name="l00072"></a>00072 
<a name="l00076"></a>00076 define(<span class="stringliteral">&#39;JSON_IN_ARR&#39;</span>,  4);
<a name="l00077"></a>00077 
<a name="l00081"></a>00081 define(<span class="stringliteral">&#39;JSON_IN_OBJ&#39;</span>,  8);
<a name="l00082"></a>00082 
<a name="l00086"></a>00086 define(<span class="stringliteral">&#39;JSON_IN_CMT&#39;</span>, 16);
<a name="l00087"></a>00087 
<a name="l00091"></a>00091 define(<span class="stringliteral">&#39;JSON_LOOSE_TYPE&#39;</span>, 10);
<a name="l00092"></a>00092 
<a name="l00096"></a>00096 define(<span class="stringliteral">&#39;JSON_STRICT_TYPE&#39;</span>, 11);
<a name="l00097"></a>00097 
<a name="l00114"></a><a class="code" href="classJSON.html">00114</a> <span class="keyword">class </span><a class="code" href="classJSON.html">JSON</a> {
<a name="l00115"></a>00115 
<a name="l00123"></a><a class="code" href="classJSON.html#a717bfc2ca62a9904c0ff2a6e8b19be0d">00123</a>     <span class="keyword">public</span> <a class="code" href="classJSON.html#a717bfc2ca62a9904c0ff2a6e8b19be0d" title="Disables the use of PHP5&amp;#39;s native json_decode().">$skipnative</a> = <span class="keyword">false</span>;
<a name="l00124"></a>00124 
<a name="l00137"></a><a class="code" href="classJSON.html#a66de4f75576384b26dda370487034581">00137</a>     function <a class="code" href="classJSON.html#a66de4f75576384b26dda370487034581" title="constructs a new JSON instance">JSON</a>($use=JSON_STRICT_TYPE) {
<a name="l00138"></a>00138         $this-&gt;use = $use;
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140 
<a name="l00153"></a><a class="code" href="classJSON.html#a7f16dad724c8a72f8f0806043a33c5d6">00153</a>     function <a class="code" href="classJSON.html#a7f16dad724c8a72f8f0806043a33c5d6" title="encodes an arbitrary variable into JSON format If available the native PHP JSON implementation...">encode</a>($var) {
<a name="l00154"></a>00154         <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;json_encode&#39;</span>)) <span class="keywordflow">return</span> json_encode($var);
<a name="l00155"></a>00155         <span class="keywordflow">switch</span> (gettype($var)) {
<a name="l00156"></a>00156             <span class="keywordflow">case</span> <span class="stringliteral">&#39;boolean&#39;</span>:
<a name="l00157"></a>00157                 <span class="keywordflow">return</span> $var ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span>;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159             <span class="keywordflow">case</span> <span class="stringliteral">&#39;NULL&#39;</span>:
<a name="l00160"></a>00160                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;null&#39;</span>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162             <span class="keywordflow">case</span> <span class="stringliteral">&#39;integer&#39;</span>:
<a name="l00163"></a>00163                 <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&#39;%d&#39;</span>, $var);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165             <span class="keywordflow">case</span> <span class="stringliteral">&#39;double&#39;</span>:
<a name="l00166"></a>00166             <span class="keywordflow">case</span> <span class="stringliteral">&#39;float&#39;</span>:
<a name="l00167"></a>00167                 <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&#39;%f&#39;</span>, $var);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169             <span class="keywordflow">case</span> <span class="stringliteral">&#39;string&#39;</span>:
<a name="l00170"></a>00170                 <span class="comment">// STRINGS ARE EXPECTED TO BE IN ASCII OR UTF-8 FORMAT</span>
<a name="l00171"></a>00171                 $ascii = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00172"></a>00172                 $strlen_var = strlen($var);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174                 <span class="comment">/*</span>
<a name="l00175"></a>00175 <span class="comment">                 * Iterate over every character in the string,</span>
<a name="l00176"></a>00176 <span class="comment">                 * escaping with a slash or encoding to UTF-8 where necessary</span>
<a name="l00177"></a>00177 <span class="comment">                 */</span>
<a name="l00178"></a>00178                 <span class="keywordflow">for</span> ($c = 0; $c &lt; $strlen_var; ++$c) {
<a name="l00179"></a>00179 
<a name="l00180"></a>00180                     $ord_var_c = ord($var{$c});
<a name="l00181"></a>00181 
<a name="l00182"></a>00182                     <span class="keywordflow">switch</span> ($ord_var_c) {
<a name="l00183"></a>00183                         <span class="keywordflow">case</span> 0x08:
<a name="l00184"></a>00184                             $ascii .= <span class="charliteral">&#39;\b&#39;</span>;
<a name="l00185"></a>00185                             <span class="keywordflow">break</span>;
<a name="l00186"></a>00186                         <span class="keywordflow">case</span> 0x09:
<a name="l00187"></a>00187                             $ascii .= <span class="charliteral">&#39;\t&#39;</span>;
<a name="l00188"></a>00188                             <span class="keywordflow">break</span>;
<a name="l00189"></a>00189                         <span class="keywordflow">case</span> 0x0A:
<a name="l00190"></a>00190                             $ascii .= <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00191"></a>00191                             <span class="keywordflow">break</span>;
<a name="l00192"></a>00192                         <span class="keywordflow">case</span> 0x0C:
<a name="l00193"></a>00193                             $ascii .= <span class="charliteral">&#39;\f&#39;</span>;
<a name="l00194"></a>00194                             <span class="keywordflow">break</span>;
<a name="l00195"></a>00195                         <span class="keywordflow">case</span> 0x0D:
<a name="l00196"></a>00196                             $ascii .= <span class="charliteral">&#39;\r&#39;</span>;
<a name="l00197"></a>00197                             <span class="keywordflow">break</span>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199                         <span class="keywordflow">case</span> 0x22:
<a name="l00200"></a>00200                         <span class="keywordflow">case</span> 0x2F:
<a name="l00201"></a>00201                         <span class="keywordflow">case</span> 0x5C:
<a name="l00202"></a>00202                             <span class="comment">// double quote, slash, slosh</span>
<a name="l00203"></a>00203                             $ascii .= <span class="charliteral">&#39;\\&#39;</span>.$var{$c};
<a name="l00204"></a>00204                             <span class="keywordflow">break</span>;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206                         <span class="keywordflow">case</span> (($ord_var_c &gt;= 0x20) &amp;&amp; ($ord_var_c &lt;= 0x7F)):
<a name="l00207"></a>00207                             <span class="comment">// characters U-00000000 - U-0000007F (same as ASCII)</span>
<a name="l00208"></a>00208                             $ascii .= $var{$c};
<a name="l00209"></a>00209                             <span class="keywordflow">break</span>;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                         <span class="keywordflow">case</span> (($ord_var_c &amp; 0xE0) == 0xC0):
<a name="l00212"></a>00212                             <span class="comment">// characters U-00000080 - U-000007FF, mask 110XXXXX</span>
<a name="l00213"></a>00213                             <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00214"></a>00214                             $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c, ord($var{$c+1}));
<a name="l00215"></a>00215                             $c+=1;
<a name="l00216"></a>00216                             <span class="comment">//$utf16 = mb_convert_encoding($char, &#39;UTF-16&#39;, &#39;UTF-8&#39;);</span>
<a name="l00217"></a>00217                             $utf16 = utf8_to_utf16be($char);
<a name="l00218"></a>00218                             $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
<a name="l00219"></a>00219                             <span class="keywordflow">break</span>;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221                         <span class="keywordflow">case</span> (($ord_var_c &amp; 0xF0) == 0xE0):
<a name="l00222"></a>00222                             <span class="comment">// characters U-00000800 - U-0000FFFF, mask 1110XXXX</span>
<a name="l00223"></a>00223                             <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00224"></a>00224                             $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
<a name="l00225"></a>00225                                          ord($var{$c+1}),
<a name="l00226"></a>00226                                          ord($var{$c+2}));
<a name="l00227"></a>00227                             $c+=2;
<a name="l00228"></a>00228                             <span class="comment">//$utf16 = mb_convert_encoding($char, &#39;UTF-16&#39;, &#39;UTF-8&#39;);</span>
<a name="l00229"></a>00229                             $utf16 = utf8_to_utf16be($char);
<a name="l00230"></a>00230                             $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
<a name="l00231"></a>00231                             <span class="keywordflow">break</span>;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233                         <span class="keywordflow">case</span> (($ord_var_c &amp; 0xF8) == 0xF0):
<a name="l00234"></a>00234                             <span class="comment">// characters U-00010000 - U-001FFFFF, mask 11110XXX</span>
<a name="l00235"></a>00235                             <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00236"></a>00236                             $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
<a name="l00237"></a>00237                                          ord($var{$c+1}),
<a name="l00238"></a>00238                                          ord($var{$c+2}),
<a name="l00239"></a>00239                                          ord($var{$c+3}));
<a name="l00240"></a>00240                             $c+=3;
<a name="l00241"></a>00241                             <span class="comment">//$utf16 = mb_convert_encoding($char, &#39;UTF-16&#39;, &#39;UTF-8&#39;);</span>
<a name="l00242"></a>00242                             $utf16 = utf8_to_utf16be($char);
<a name="l00243"></a>00243                             $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
<a name="l00244"></a>00244                             <span class="keywordflow">break</span>;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246                         <span class="keywordflow">case</span> (($ord_var_c &amp; 0xFC) == 0xF8):
<a name="l00247"></a>00247                             <span class="comment">// characters U-00200000 - U-03FFFFFF, mask 111110XX</span>
<a name="l00248"></a>00248                             <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00249"></a>00249                             $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
<a name="l00250"></a>00250                                          ord($var{$c+1}),
<a name="l00251"></a>00251                                          ord($var{$c+2}),
<a name="l00252"></a>00252                                          ord($var{$c+3}),
<a name="l00253"></a>00253                                          ord($var{$c+4}));
<a name="l00254"></a>00254                             $c+=4;
<a name="l00255"></a>00255                             <span class="comment">//$utf16 = mb_convert_encoding($char, &#39;UTF-16&#39;, &#39;UTF-8&#39;);</span>
<a name="l00256"></a>00256                             $utf16 = utf8_to_utf16be($char);
<a name="l00257"></a>00257                             $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
<a name="l00258"></a>00258                             <span class="keywordflow">break</span>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260                         <span class="keywordflow">case</span> (($ord_var_c &amp; 0xFE) == 0xFC):
<a name="l00261"></a>00261                             <span class="comment">// characters U-04000000 - U-7FFFFFFF, mask 1111110X</span>
<a name="l00262"></a>00262                             <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00263"></a>00263                             $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
<a name="l00264"></a>00264                                          ord($var{$c+1}),
<a name="l00265"></a>00265                                          ord($var{$c+2}),
<a name="l00266"></a>00266                                          ord($var{$c+3}),
<a name="l00267"></a>00267                                          ord($var{$c+4}),
<a name="l00268"></a>00268                                          ord($var{$c+5}));
<a name="l00269"></a>00269                             $c+=5;
<a name="l00270"></a>00270                             <span class="comment">//$utf16 = mb_convert_encoding($char, &#39;UTF-16&#39;, &#39;UTF-8&#39;);</span>
<a name="l00271"></a>00271                             $utf16 = utf8_to_utf16be($char);
<a name="l00272"></a>00272                             $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
<a name="l00273"></a>00273                             <span class="keywordflow">break</span>;
<a name="l00274"></a>00274                     }
<a name="l00275"></a>00275                 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277                 <span class="keywordflow">return</span> <span class="charliteral">&#39;&quot;&#39;</span>.$ascii.<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279             <span class="keywordflow">case</span> <span class="stringliteral">&#39;array&#39;</span>:
<a name="l00280"></a>00280                 <span class="comment">/*</span>
<a name="l00281"></a>00281 <span class="comment">                 * As per JSON spec if any array key is not an integer</span>
<a name="l00282"></a>00282 <span class="comment">                 * we must treat the the whole array as an object. We</span>
<a name="l00283"></a>00283 <span class="comment">                 * also try to catch a sparsely populated associative</span>
<a name="l00284"></a>00284 <span class="comment">                 * array with numeric keys here because some JS engines</span>
<a name="l00285"></a>00285 <span class="comment">                 * will create an array with empty indexes up to</span>
<a name="l00286"></a>00286 <span class="comment">                 * max_index which can cause memory issues and because</span>
<a name="l00287"></a>00287 <span class="comment">                 * the keys, which may be relevant, will be remapped</span>
<a name="l00288"></a>00288 <span class="comment">                 * otherwise.</span>
<a name="l00289"></a>00289 <span class="comment">                 *</span>
<a name="l00290"></a>00290 <span class="comment">                 * As per the ECMA and JSON specification an object may</span>
<a name="l00291"></a>00291 <span class="comment">                 * have any string as a property. Unfortunately due to</span>
<a name="l00292"></a>00292 <span class="comment">                 * a hole in the ECMA specification if the key is a</span>
<a name="l00293"></a>00293 <span class="comment">                 * ECMA reserved word or starts with a digit the</span>
<a name="l00294"></a>00294 <span class="comment">                 * parameter is only accessible using ECMAScript&#39;s</span>
<a name="l00295"></a>00295 <span class="comment">                 * bracket notation.</span>
<a name="l00296"></a>00296 <span class="comment">                 */</span>
<a name="l00297"></a>00297 
<a name="l00298"></a>00298                 <span class="comment">// treat as a JSON object</span>
<a name="l00299"></a>00299                 <span class="keywordflow">if</span> (is_array($var) &amp;&amp; count($var) &amp;&amp; (array_keys($var) !== range(0, count($var) - 1))) {
<a name="l00300"></a>00300                     <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&#39;{%s}&#39;</span>, join(<span class="charliteral">&#39;,&#39;</span>, array_map(array($this, <span class="stringliteral">&#39;name_value&#39;</span>),
<a name="l00301"></a>00301                                                                array_keys($var),
<a name="l00302"></a>00302                                                                array_values($var))));
<a name="l00303"></a>00303                 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305                 <span class="comment">// treat it like a regular array</span>
<a name="l00306"></a>00306                 <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&#39;[%s]&#39;</span>, join(<span class="charliteral">&#39;,&#39;</span>, array_map(array($this, <span class="stringliteral">&#39;encode&#39;</span>), $var)));
<a name="l00307"></a>00307 
<a name="l00308"></a>00308             <span class="keywordflow">case</span> <span class="stringliteral">&#39;object&#39;</span>:
<a name="l00309"></a>00309                 $vars = get_object_vars($var);
<a name="l00310"></a>00310                 <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&#39;{%s}&#39;</span>, join(<span class="charliteral">&#39;,&#39;</span>, array_map(array($this, <span class="stringliteral">&#39;name_value&#39;</span>),
<a name="l00311"></a>00311                                                            array_keys($vars),
<a name="l00312"></a>00312                                                            array_values($vars))));
<a name="l00313"></a>00313 
<a name="l00314"></a>00314             <span class="keywordflow">default</span>:
<a name="l00315"></a>00315                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318 
<a name="l00322"></a><a class="code" href="classJSON.html#a20d3d5ab9cd465c3ed60cf3070c6d6fe">00322</a>     function <a class="code" href="classJSON.html#a20d3d5ab9cd465c3ed60cf3070c6d6fe" title="encodes an arbitrary variable into JSON format, alias for encode()">enc</a>($var) {
<a name="l00323"></a>00323         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classJSON.html#a7f16dad724c8a72f8f0806043a33c5d6" title="encodes an arbitrary variable into JSON format If available the native PHP JSON implementation...">encode</a>($var);
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 
<a name="l00335"></a><a class="code" href="classJSON.html#a86a55e212796aaf6422bd75b4537a927">00335</a>     function <a class="code" href="classJSON.html#a86a55e212796aaf6422bd75b4537a927" title="function name_value array-walking function for use in generating JSON-formatted name-value...">name_value</a>($name, $value) {
<a name="l00336"></a>00336         <span class="keywordflow">return</span> (sprintf(<span class="stringliteral">&quot;%s:%s&quot;</span>, $this-&gt;<a class="code" href="classJSON.html#a7f16dad724c8a72f8f0806043a33c5d6" title="encodes an arbitrary variable into JSON format If available the native PHP JSON implementation...">encode</a>(strval($name)), $this-&gt;<a class="code" href="classJSON.html#a7f16dad724c8a72f8f0806043a33c5d6" title="encodes an arbitrary variable into JSON format If available the native PHP JSON implementation...">encode</a>($value)));
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338 
<a name="l00347"></a><a class="code" href="classJSON.html#adc11760dcde73a5cf9f00a67fd0ff61f">00347</a>     function <a class="code" href="classJSON.html#adc11760dcde73a5cf9f00a67fd0ff61f" title="reduce a string by removing leading and trailing comments and whitespace">reduce_string</a>($str) {
<a name="l00348"></a>00348         $str = preg_replace(array(
<a name="l00349"></a>00349 
<a name="l00350"></a>00350                 <span class="comment">// eliminate single line comments in &#39;// ...&#39; form</span>
<a name="l00351"></a>00351                 <span class="stringliteral">&#39;#^\s*//(.+)$#m&#39;</span>,
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                 <span class="comment">// eliminate multi-line comments in &#39;/* ... */&#39; form, at start of string</span>
<a name="l00354"></a>00354                 <span class="stringliteral">&#39;#^\s*/\*(.+)\*/#Us&#39;</span>,
<a name="l00355"></a>00355 
<a name="l00356"></a>00356                 <span class="comment">// eliminate multi-line comments in &#39;/* ... */&#39; form, at end of string</span>
<a name="l00357"></a>00357                 <span class="stringliteral">&#39;#/\*(.+)\*/\s*$#Us&#39;</span>
<a name="l00358"></a>00358 
<a name="l00359"></a>00359             ), <span class="stringliteral">&#39;&#39;</span>, $str);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361         <span class="comment">// eliminate extraneous space</span>
<a name="l00362"></a>00362         <span class="keywordflow">return</span> trim($str);
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364 
<a name="l00378"></a><a class="code" href="classJSON.html#afd721c51dcfa67be7f87aab49fa9df9c">00378</a>     function <a class="code" href="classJSON.html#afd721c51dcfa67be7f87aab49fa9df9c" title="decodes a JSON string into appropriate variable If available the native PHP JSON...">decode</a>($str) {
<a name="l00379"></a>00379         <span class="keywordflow">if</span> (!$this-&gt;skipnative &amp;&amp; function_exists(<span class="stringliteral">&#39;json_decode&#39;</span>)){
<a name="l00380"></a>00380             <span class="keywordflow">return</span> json_decode($str,($this-&gt;use == JSON_LOOSE_TYPE));
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         $str = $this-&gt;<a class="code" href="classJSON.html#adc11760dcde73a5cf9f00a67fd0ff61f" title="reduce a string by removing leading and trailing comments and whitespace">reduce_string</a>($str);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385         <span class="keywordflow">switch</span> (strtolower($str)) {
<a name="l00386"></a>00386             <span class="keywordflow">case</span> <span class="stringliteral">&#39;true&#39;</span>:
<a name="l00387"></a>00387                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389             <span class="keywordflow">case</span> <span class="stringliteral">&#39;false&#39;</span>:
<a name="l00390"></a>00390                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392             <span class="keywordflow">case</span> <span class="stringliteral">&#39;null&#39;</span>:
<a name="l00393"></a>00393                 <span class="keywordflow">return</span> null;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395             <span class="keywordflow">default</span>:
<a name="l00396"></a>00396                 <span class="keywordflow">if</span> (is_numeric($str)) {
<a name="l00397"></a>00397                     <span class="comment">// Lookie-loo, it&#39;s a number</span>
<a name="l00398"></a>00398 
<a name="l00399"></a>00399                     <span class="comment">// This would work on its own, but I&#39;m trying to be</span>
<a name="l00400"></a>00400                     <span class="comment">// good about returning integers where appropriate:</span>
<a name="l00401"></a>00401                     <span class="comment">// return (float)$str;</span>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403                     <span class="comment">// Return float or int, as appropriate</span>
<a name="l00404"></a>00404                     <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>)$str == (integer)$str)
<a name="l00405"></a>00405                         ? (integer)$str
<a name="l00406"></a>00406                         : (<span class="keywordtype">float</span>)$str;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408                 } elseif (preg_match(<span class="stringliteral">&#39;/^(&quot;|\&#39;).+(&quot;|\&#39;)$/s&#39;</span>, $str, $m) &amp;&amp; $m[1] == $m[2]) {
<a name="l00409"></a>00409                     <span class="comment">// STRINGS RETURNED IN UTF-8 FORMAT</span>
<a name="l00410"></a>00410                     $delim = substr($str, 0, 1);
<a name="l00411"></a>00411                     $chrs = substr($str, 1, -1);
<a name="l00412"></a>00412                     $utf8 = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00413"></a>00413                     $strlen_chrs = strlen($chrs);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415                     <span class="keywordflow">for</span> ($c = 0; $c &lt; $strlen_chrs; ++$c) {
<a name="l00416"></a>00416 
<a name="l00417"></a>00417                         $substr_chrs_c_2 = substr($chrs, $c, 2);
<a name="l00418"></a>00418                         $ord_chrs_c = ord($chrs{$c});
<a name="l00419"></a>00419 
<a name="l00420"></a>00420                         <span class="keywordflow">switch</span> ($substr_chrs_c_2) {
<a name="l00421"></a>00421                             <span class="keywordflow">case</span> <span class="charliteral">&#39;\b&#39;</span>:
<a name="l00422"></a>00422                                 $utf8 .= chr(0x08);
<a name="l00423"></a>00423                                 $c+=1;
<a name="l00424"></a>00424                                 <span class="keywordflow">break</span>;
<a name="l00425"></a>00425                             <span class="keywordflow">case</span> <span class="charliteral">&#39;\t&#39;</span>:
<a name="l00426"></a>00426                                 $utf8 .= chr(0x09);
<a name="l00427"></a>00427                                 $c+=1;
<a name="l00428"></a>00428                                 <span class="keywordflow">break</span>;
<a name="l00429"></a>00429                             <span class="keywordflow">case</span> <span class="charliteral">&#39;\n&#39;</span>:
<a name="l00430"></a>00430                                 $utf8 .= chr(0x0A);
<a name="l00431"></a>00431                                 $c+=1;
<a name="l00432"></a>00432                                 <span class="keywordflow">break</span>;
<a name="l00433"></a>00433                             <span class="keywordflow">case</span> <span class="charliteral">&#39;\f&#39;</span>:
<a name="l00434"></a>00434                                 $utf8 .= chr(0x0C);
<a name="l00435"></a>00435                                 $c+=1;
<a name="l00436"></a>00436                                 <span class="keywordflow">break</span>;
<a name="l00437"></a>00437                             <span class="keywordflow">case</span> <span class="charliteral">&#39;\r&#39;</span>:
<a name="l00438"></a>00438                                 $utf8 .= chr(0x0D);
<a name="l00439"></a>00439                                 $c+=1;
<a name="l00440"></a>00440                                 <span class="keywordflow">break</span>;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;\\&quot;&#39;</span>:
<a name="l00443"></a>00443                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;\\\&#39;&#39;</span>:
<a name="l00444"></a>00444                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;\\\\&#39;</span>:
<a name="l00445"></a>00445                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;\\/&#39;</span>:
<a name="l00446"></a>00446                                 <span class="keywordflow">if</span> (($delim == <span class="charliteral">&#39;&quot;&#39;</span> &amp;&amp; $substr_chrs_c_2 != <span class="stringliteral">&#39;\\\&#39;&#39;</span>) ||
<a name="l00447"></a>00447                                    ($delim == <span class="stringliteral">&quot;&#39;&quot;</span> &amp;&amp; $substr_chrs_c_2 != <span class="stringliteral">&#39;\\&quot;&#39;</span>)) {
<a name="l00448"></a>00448                                     $utf8 .= $chrs{++$c};
<a name="l00449"></a>00449                                 }
<a name="l00450"></a>00450                                 <span class="keywordflow">break</span>;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452                             <span class="keywordflow">default</span>:
<a name="l00453"></a>00453                                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\\\u[0-9A-F]{4}/i&#39;</span>, substr($chrs, $c, 6))) {
<a name="l00454"></a>00454                                     <span class="comment">// single, escaped unicode character</span>
<a name="l00455"></a>00455                                     $utf16 = chr(hexdec(substr($chrs, ($c+2), 2)))
<a name="l00456"></a>00456                                            . chr(hexdec(substr($chrs, ($c+4), 2)));
<a name="l00457"></a>00457                                     <span class="comment">//$utf8 .= mb_convert_encoding($utf16, &#39;UTF-8&#39;, &#39;UTF-16&#39;);</span>
<a name="l00458"></a>00458                                     $utf8 .= utf16be_to_utf8($utf16);
<a name="l00459"></a>00459                                     $c+=5;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461                                 } elseif(($ord_chrs_c &gt;= 0x20) &amp;&amp; ($ord_chrs_c &lt;= 0x7F)) {
<a name="l00462"></a>00462                                     $utf8 .= $chrs{$c};
<a name="l00463"></a>00463 
<a name="l00464"></a>00464                                 } elseif(($ord_chrs_c &amp; 0xE0) == 0xC0) {
<a name="l00465"></a>00465                                     <span class="comment">// characters U-00000080 - U-000007FF, mask 110XXXXX</span>
<a name="l00466"></a>00466                                     <span class="comment">//see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00467"></a>00467                                     $utf8 .= substr($chrs, $c, 2);
<a name="l00468"></a>00468                                     $c += 1;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                                 } elseif(($ord_chrs_c &amp; 0xF0) == 0xE0) {
<a name="l00471"></a>00471                                     <span class="comment">// characters U-00000800 - U-0000FFFF, mask 1110XXXX</span>
<a name="l00472"></a>00472                                     <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00473"></a>00473                                     $utf8 .= substr($chrs, $c, 3);
<a name="l00474"></a>00474                                     $c += 2;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476                                 } elseif(($ord_chrs_c &amp; 0xF8) == 0xF0) {
<a name="l00477"></a>00477                                     <span class="comment">// characters U-00010000 - U-001FFFFF, mask 11110XXX</span>
<a name="l00478"></a>00478                                     <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00479"></a>00479                                     $utf8 .= substr($chrs, $c, 4);
<a name="l00480"></a>00480                                     $c += 3;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482                                 } elseif(($ord_chrs_c &amp; 0xFC) == 0xF8) {
<a name="l00483"></a>00483                                     <span class="comment">// characters U-00200000 - U-03FFFFFF, mask 111110XX</span>
<a name="l00484"></a>00484                                     <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00485"></a>00485                                     $utf8 .= substr($chrs, $c, 5);
<a name="l00486"></a>00486                                     $c += 4;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488                                 } elseif(($ord_chrs_c &amp; 0xFE) == 0xFC) {
<a name="l00489"></a>00489                                     <span class="comment">// characters U-04000000 - U-7FFFFFFF, mask 1111110X</span>
<a name="l00490"></a>00490                                     <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
<a name="l00491"></a>00491                                     $utf8 .= substr($chrs, $c, 6);
<a name="l00492"></a>00492                                     $c += 5;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494                                 }
<a name="l00495"></a>00495                                 <span class="keywordflow">break</span>;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497                         }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499                     }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501                     <span class="keywordflow">return</span> $utf8;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503                 } elseif (preg_match(<span class="stringliteral">&#39;/^\[.*\]$/s&#39;</span>, $str) || preg_match(<span class="stringliteral">&#39;/^\{.*\}$/s&#39;</span>, $str)) {
<a name="l00504"></a>00504                     <span class="comment">// array, or object notation</span>
<a name="l00505"></a>00505 
<a name="l00506"></a>00506                     <span class="keywordflow">if</span> ($str{0} == <span class="charliteral">&#39;[&#39;</span>) {
<a name="l00507"></a>00507                         $stk = array(JSON_IN_ARR);
<a name="l00508"></a>00508                         $arr = array();
<a name="l00509"></a>00509                     } <span class="keywordflow">else</span> {
<a name="l00510"></a>00510                         <span class="keywordflow">if</span> ($this-&gt;use == JSON_LOOSE_TYPE) {
<a name="l00511"></a>00511                             $stk = array(JSON_IN_OBJ);
<a name="l00512"></a>00512                             $obj = array();
<a name="l00513"></a>00513                         } <span class="keywordflow">else</span> {
<a name="l00514"></a>00514                             $stk = array(JSON_IN_OBJ);
<a name="l00515"></a>00515                             $obj = <span class="keyword">new</span> stdClass();
<a name="l00516"></a>00516                         }
<a name="l00517"></a>00517                     }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519                     array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span>  =&gt; JSON_SLICE,
<a name="l00520"></a>00520                                            <span class="stringliteral">&#39;where&#39;</span> =&gt; 0,
<a name="l00521"></a>00521                                            <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
<a name="l00522"></a>00522 
<a name="l00523"></a>00523                     $chrs = substr($str, 1, -1);
<a name="l00524"></a>00524                     $chrs = $this-&gt;<a class="code" href="classJSON.html#adc11760dcde73a5cf9f00a67fd0ff61f" title="reduce a string by removing leading and trailing comments and whitespace">reduce_string</a>($chrs);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526                     <span class="keywordflow">if</span> ($chrs == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00527"></a>00527                         <span class="keywordflow">if</span> (reset($stk) == JSON_IN_ARR) {
<a name="l00528"></a>00528                             <span class="keywordflow">return</span> $arr;
<a name="l00529"></a>00529 
<a name="l00530"></a>00530                         } <span class="keywordflow">else</span> {
<a name="l00531"></a>00531                             <span class="keywordflow">return</span> $obj;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533                         }
<a name="l00534"></a>00534                     }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536                     <span class="comment">//print(&quot;\nparsing {$chrs}\n&quot;);</span>
<a name="l00537"></a>00537 
<a name="l00538"></a>00538                     $strlen_chrs = strlen($chrs);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540                     <span class="keywordflow">for</span> ($c = 0; $c &lt;= $strlen_chrs; ++$c) {
<a name="l00541"></a>00541 
<a name="l00542"></a>00542                         $top = end($stk);
<a name="l00543"></a>00543                         $substr_chrs_c_2 = substr($chrs, $c, 2);
<a name="l00544"></a>00544 
<a name="l00545"></a>00545                         <span class="keywordflow">if</span> (($c == $strlen_chrs) || (($chrs{$c} == <span class="charliteral">&#39;,&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == JSON_SLICE))) {
<a name="l00546"></a>00546                             <span class="comment">// found a comma that is not inside a string, array, etc.,</span>
<a name="l00547"></a>00547                             <span class="comment">// OR we&#39;ve reached the end of the character list</span>
<a name="l00548"></a>00548                             $slice = substr($chrs, $top[<span class="stringliteral">&#39;where&#39;</span>], ($c - $top[<span class="stringliteral">&#39;where&#39;</span>]));
<a name="l00549"></a>00549                             array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; JSON_SLICE, <span class="stringliteral">&#39;where&#39;</span> =&gt; ($c + 1), <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
<a name="l00550"></a>00550                             <span class="comment">//print(&quot;Found split at {$c}: &quot;.substr($chrs, $top[&#39;where&#39;], (1 + $c - $top[&#39;where&#39;])).&quot;\n&quot;);</span>
<a name="l00551"></a>00551 
<a name="l00552"></a>00552                             <span class="keywordflow">if</span> (reset($stk) == JSON_IN_ARR) {
<a name="l00553"></a>00553                                 <span class="comment">// we are in an array, so just push an element onto the stack</span>
<a name="l00554"></a>00554                                 array_push($arr, $this-&gt;<a class="code" href="classJSON.html#afd721c51dcfa67be7f87aab49fa9df9c" title="decodes a JSON string into appropriate variable If available the native PHP JSON...">decode</a>($slice));
<a name="l00555"></a>00555 
<a name="l00556"></a>00556                             } elseif (reset($stk) == JSON_IN_OBJ) {
<a name="l00557"></a>00557                                 <span class="comment">// we are in an object, so figure</span>
<a name="l00558"></a>00558                                 <span class="comment">// out the property name and set an</span>
<a name="l00559"></a>00559                                 <span class="comment">// element in an associative array,</span>
<a name="l00560"></a>00560                                 <span class="comment">// for now</span>
<a name="l00561"></a>00561                                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^\s*([&quot;\&#39;].*[^\\\][&quot;\&#39;])\s*:\s*(\S.*),?$/Uis&#39;</span>, $slice, $parts)) {
<a name="l00562"></a>00562                                     <span class="comment">// &quot;name&quot;:value pair</span>
<a name="l00563"></a>00563                                     $key = $this-&gt;<a class="code" href="classJSON.html#afd721c51dcfa67be7f87aab49fa9df9c" title="decodes a JSON string into appropriate variable If available the native PHP JSON...">decode</a>($parts[1]);
<a name="l00564"></a>00564                                     $val = $this-&gt;<a class="code" href="classJSON.html#afd721c51dcfa67be7f87aab49fa9df9c" title="decodes a JSON string into appropriate variable If available the native PHP JSON...">decode</a>($parts[2]);
<a name="l00565"></a>00565 
<a name="l00566"></a>00566                                     <span class="keywordflow">if</span> ($this-&gt;use == JSON_LOOSE_TYPE) {
<a name="l00567"></a>00567                                         $obj[$key] = $val;
<a name="l00568"></a>00568                                     } <span class="keywordflow">else</span> {
<a name="l00569"></a>00569                                         $obj-&gt;$key = $val;
<a name="l00570"></a>00570                                     }
<a name="l00571"></a>00571                                 } elseif (preg_match(<span class="stringliteral">&#39;/^\s*(\w+)\s*:\s*(\S.*),?$/Uis&#39;</span>, $slice, $parts)) {
<a name="l00572"></a>00572                                     <span class="comment">// name:value pair, where name is unquoted</span>
<a name="l00573"></a>00573                                     $key = $parts[1];
<a name="l00574"></a>00574                                     $val = $this-&gt;<a class="code" href="classJSON.html#afd721c51dcfa67be7f87aab49fa9df9c" title="decodes a JSON string into appropriate variable If available the native PHP JSON...">decode</a>($parts[2]);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576                                     <span class="keywordflow">if</span> ($this-&gt;use == JSON_LOOSE_TYPE) {
<a name="l00577"></a>00577                                         $obj[$key] = $val;
<a name="l00578"></a>00578                                     } <span class="keywordflow">else</span> {
<a name="l00579"></a>00579                                         $obj-&gt;$key = $val;
<a name="l00580"></a>00580                                     }
<a name="l00581"></a>00581                                 }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583                             }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585                         } elseif ((($chrs{$c} == <span class="charliteral">&#39;&quot;&#39;</span>) || ($chrs{$c} == <span class="stringliteral">&quot;&#39;&quot;</span>)) &amp;&amp;
<a name="l00586"></a>00586                                  in_array($top[<span class="stringliteral">&#39;what&#39;</span>], array(JSON_SLICE, JSON_IN_ARR, JSON_IN_OBJ))) {
<a name="l00587"></a>00587                             <span class="comment">// found a quote, and we are not inside a string</span>
<a name="l00588"></a>00588                             array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; JSON_IN_STR, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; $chrs{$c}));
<a name="l00589"></a>00589                             <span class="comment">//print(&quot;Found start of string at {$c}\n&quot;);</span>
<a name="l00590"></a>00590 
<a name="l00591"></a>00591                         } elseif (($chrs{$c} == $top[<span class="stringliteral">&#39;delim&#39;</span>]) &amp;&amp;
<a name="l00592"></a>00592                                  ($top[<span class="stringliteral">&#39;what&#39;</span>] == JSON_IN_STR) &amp;&amp;
<a name="l00593"></a>00593                                  (($chrs{$c - 1} != <span class="stringliteral">&quot;\\&quot;</span>) ||
<a name="l00594"></a>00594                                  ($chrs{$c - 1} == <span class="stringliteral">&quot;\\&quot;</span> &amp;&amp; $chrs{$c - 2} == <span class="stringliteral">&quot;\\&quot;</span>))) {
<a name="l00595"></a>00595                             <span class="comment">// found a quote, we&#39;re in a string, and it&#39;s not escaped</span>
<a name="l00596"></a>00596                             array_pop($stk);
<a name="l00597"></a>00597                             <span class="comment">//print(&quot;Found end of string at {$c}: &quot;.substr($chrs, $top[&#39;where&#39;], (1 + 1 + $c - $top[&#39;where&#39;])).&quot;\n&quot;);</span>
<a name="l00598"></a>00598 
<a name="l00599"></a>00599                         } elseif (($chrs{$c} == <span class="charliteral">&#39;[&#39;</span>) &amp;&amp;
<a name="l00600"></a>00600                                  in_array($top[<span class="stringliteral">&#39;what&#39;</span>], array(JSON_SLICE, JSON_IN_ARR, JSON_IN_OBJ))) {
<a name="l00601"></a>00601                             <span class="comment">// found a left-bracket, and we are in an array, object, or slice</span>
<a name="l00602"></a>00602                             array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; JSON_IN_ARR, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
<a name="l00603"></a>00603                             <span class="comment">//print(&quot;Found start of array at {$c}\n&quot;);</span>
<a name="l00604"></a>00604 
<a name="l00605"></a>00605                         } elseif (($chrs{$c} == <span class="charliteral">&#39;]&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == JSON_IN_ARR)) {
<a name="l00606"></a>00606                             <span class="comment">// found a right-bracket, and we&#39;re in an array</span>
<a name="l00607"></a>00607                             array_pop($stk);
<a name="l00608"></a>00608                             <span class="comment">//print(&quot;Found end of array at {$c}: &quot;.substr($chrs, $top[&#39;where&#39;], (1 + $c - $top[&#39;where&#39;])).&quot;\n&quot;);</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610                         } elseif (($chrs{$c} == <span class="charliteral">&#39;{&#39;</span>) &amp;&amp;
<a name="l00611"></a>00611                                  in_array($top[<span class="stringliteral">&#39;what&#39;</span>], array(JSON_SLICE, JSON_IN_ARR, JSON_IN_OBJ))) {
<a name="l00612"></a>00612                             <span class="comment">// found a left-brace, and we are in an array, object, or slice</span>
<a name="l00613"></a>00613                             array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; JSON_IN_OBJ, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
<a name="l00614"></a>00614                             <span class="comment">//print(&quot;Found start of object at {$c}\n&quot;);</span>
<a name="l00615"></a>00615 
<a name="l00616"></a>00616                         } elseif (($chrs{$c} == <span class="charliteral">&#39;}&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == JSON_IN_OBJ)) {
<a name="l00617"></a>00617                             <span class="comment">// found a right-brace, and we&#39;re in an object</span>
<a name="l00618"></a>00618                             array_pop($stk);
<a name="l00619"></a>00619                             <span class="comment">//print(&quot;Found end of object at {$c}: &quot;.substr($chrs, $top[&#39;where&#39;], (1 + $c - $top[&#39;where&#39;])).&quot;\n&quot;);</span>
<a name="l00620"></a>00620 
<a name="l00621"></a>00621                         } elseif (($substr_chrs_c_2 == <span class="stringliteral">&#39;/*&#39;</span>) &amp;&amp;
<a name="l00622"></a>00622                                  in_array($top[<span class="stringliteral">&#39;what&#39;</span>], array(JSON_SLICE, JSON_IN_ARR, JSON_IN_OBJ))) {
<a name="l00623"></a>00623                             <span class="comment">// found a comment start, and we are in an array, object, or slice</span>
<a name="l00624"></a>00624                             array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; JSON_IN_CMT, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
<a name="l00625"></a>00625                             $c++;
<a name="l00626"></a>00626                             <span class="comment">//print(&quot;Found start of comment at {$c}\n&quot;);</span>
<a name="l00627"></a>00627 
<a name="l00628"></a>00628                         } elseif (($substr_chrs_c_2 == <span class="stringliteral">&#39;*/&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == JSON_IN_CMT)) {
<a name="l00629"></a>00629                             <span class="comment">// found a comment end, and we&#39;re in one now</span>
<a name="l00630"></a>00630                             array_pop($stk);
<a name="l00631"></a>00631                             $c++;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633                             <span class="keywordflow">for</span> ($i = $top[<span class="stringliteral">&#39;where&#39;</span>]; $i &lt;= $c; ++$i)
<a name="l00634"></a>00634                                 $chrs = substr_replace($chrs, <span class="charliteral">&#39; &#39;</span>, $i, 1);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636                             <span class="comment">//print(&quot;Found end of comment at {$c}: &quot;.substr($chrs, $top[&#39;where&#39;], (1 + $c - $top[&#39;where&#39;])).&quot;\n&quot;);</span>
<a name="l00637"></a>00637 
<a name="l00638"></a>00638                         }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640                     }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642                     <span class="keywordflow">if</span> (reset($stk) == JSON_IN_ARR) {
<a name="l00643"></a>00643                         <span class="keywordflow">return</span> $arr;
<a name="l00644"></a>00644 
<a name="l00645"></a>00645                     } elseif (reset($stk) == JSON_IN_OBJ) {
<a name="l00646"></a>00646                         <span class="keywordflow">return</span> $obj;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648                     }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650                 }
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653 
<a name="l00657"></a><a class="code" href="classJSON.html#a4dfa299a2a117f52dc9b43f757d633bb">00657</a>     function <a class="code" href="classJSON.html#a4dfa299a2a117f52dc9b43f757d633bb" title="decodes a JSON string into appropriate variable; alias for decode()">dec</a>($var) {
<a name="l00658"></a>00658         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classJSON.html#afd721c51dcfa67be7f87aab49fa9df9c" title="decodes a JSON string into appropriate variable If available the native PHP JSON...">decode</a>($var);
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660 }
<a name="l00661"></a>00661 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
