<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Migration/Builder.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Migration/Builder.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> *  $Id: Builder.php 2939 2007-10-19 14:23:42Z Jonathan.Wage $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information, see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://www.doctrine-project.org&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00034"></a><a class="code" href="classDoctrine__Migration__Builder.html">00034</a> <span class="keyword">class </span><a class="code" href="classDoctrine__Migration__Builder.html">Doctrine_Migration_Builder</a> <span class="keyword">extends</span> <a class="code" href="classDoctrine__Builder.html">Doctrine_Builder</a>
<a name="l00035"></a>00035 {
<a name="l00041"></a>00041     <span class="keyword">private</span> $migrationsPath = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00042"></a>00042 
<a name="l00048"></a>00048     <span class="keyword">private</span> $suffix = <span class="stringliteral">&#39;.php&#39;</span>;
<a name="l00049"></a>00049 
<a name="l00055"></a>00055     <span class="keyword">private</span> $migration;
<a name="l00056"></a>00056 
<a name="l00062"></a>00062     <span class="keyword">private</span> <span class="keyword">static</span> $tpl;
<a name="l00063"></a>00063 
<a name="l00073"></a><a class="code" href="classDoctrine__Migration__Builder.html#ab240101f3cdeeb79b2ce5556ca5a66b8">00073</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#ab240101f3cdeeb79b2ce5556ca5a66b8" title="Instantiate new instance of the Doctrine_Migration_Builder class.">__construct</a>($migrationsPath = null)
<a name="l00074"></a>00074     {
<a name="l00075"></a>00075         <span class="keywordflow">if</span> ($migrationsPath instanceof <a class="code" href="classDoctrine__Migration.html">Doctrine_Migration</a>) {
<a name="l00076"></a>00076             $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#afd2eda2c7c4db9264589eebf46037400" title="Set the path to write the generated migration classes.">setMigrationsPath</a>($migrationsPath-&gt;getMigrationClassesDirectory());
<a name="l00077"></a>00077             $this-&gt;migration = $migrationsPath;
<a name="l00078"></a>00078         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_dir($migrationsPath)) {
<a name="l00079"></a>00079             $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#afd2eda2c7c4db9264589eebf46037400" title="Set the path to write the generated migration classes.">setMigrationsPath</a>($migrationsPath);
<a name="l00080"></a>00080             $this-&gt;migration = <span class="keyword">new</span> Doctrine_Migration($migrationsPath);
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a05d305b66544f1ccc97bfe3aebd59043" title="Loads the class template used for generating classes.">loadTemplate</a>();
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085 
<a name="l00092"></a><a class="code" href="classDoctrine__Migration__Builder.html#afd2eda2c7c4db9264589eebf46037400">00092</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#afd2eda2c7c4db9264589eebf46037400" title="Set the path to write the generated migration classes.">setMigrationsPath</a>($path)
<a name="l00093"></a>00093     {
<a name="l00094"></a>00094         <a class="code" href="classDoctrine__Lib.html#a729befc3ea7f026e24cc45304c2d25f2" title="Makes the directories for a path recursively.">Doctrine_Lib::makeDirectories</a>($path);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         $this-&gt;migrationsPath = $path;
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098 
<a name="l00104"></a><a class="code" href="classDoctrine__Migration__Builder.html#a0a078b6e0b4f34350b576b4841aab1ca">00104</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a0a078b6e0b4f34350b576b4841aab1ca" title="Get the path where generated migration classes are written to.">getMigrationsPath</a>()
<a name="l00105"></a>00105     {
<a name="l00106"></a>00106         <span class="keywordflow">return</span> $this-&gt;migrationsPath;
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 
<a name="l00114"></a><a class="code" href="classDoctrine__Migration__Builder.html#a05d305b66544f1ccc97bfe3aebd59043">00114</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a05d305b66544f1ccc97bfe3aebd59043" title="Loads the class template used for generating classes.">loadTemplate</a>()
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116         <span class="keywordflow">if</span> (isset(self::$tpl)) {
<a name="l00117"></a>00117             <span class="keywordflow">return</span>;
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         self::$tpl =&lt;&lt;&lt;END
<a name="l00124"></a>00124 <span class="keyword">class </span>%s extends %s
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <span class="keyword">public</span> function up()
<a name="l00127"></a>00127     {
<a name="l00128"></a>00128 %s
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="keyword">public</span> function down()
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133 %s
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 END;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 
<a name="l00145"></a><a class="code" href="classDoctrine__Migration__Builder.html#a0e70d8083182bcf9dbca8965f454f128">00145</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a0e70d8083182bcf9dbca8965f454f128" title="Generate migrations from a Doctrine_Migration_Diff instance.">generateMigrationsFromDiff</a>(<a class="code" href="classDoctrine__Migration__Diff.html">Doctrine_Migration_Diff</a> $diff)
<a name="l00146"></a>00146     {
<a name="l00147"></a>00147         $changes = $diff-&gt;<a class="code" href="classDoctrine__Migration__Diff.html#a05ca0c9857c36d8f70ad14c44ef9fd88" title="Generate an array of changes found between the from and to schema information.">generateChanges</a>();
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         $up = array();
<a name="l00150"></a>00150         $down = array();
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>])) {
<a name="l00153"></a>00153             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>] as $tableName =&gt; $table) {
<a name="l00154"></a>00154                 $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#ab27ac414b38d8cfdbbce8f38c0224a83" title="Build the code for dropping tables.">buildDropTable</a>($table);
<a name="l00155"></a>00155                 $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a1779185681966b26d363328046c2039f" title="Build the code for creating tables.">buildCreateTable</a>($table);
<a name="l00156"></a>00156             }
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;created_tables&#39;</span>])) {
<a name="l00160"></a>00160             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;created_tables&#39;</span>] as $tableName =&gt; $table) {
<a name="l00161"></a>00161                 $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a1779185681966b26d363328046c2039f" title="Build the code for creating tables.">buildCreateTable</a>($table);
<a name="l00162"></a>00162                 $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#ab27ac414b38d8cfdbbce8f38c0224a83" title="Build the code for dropping tables.">buildDropTable</a>($table);
<a name="l00163"></a>00163             }
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_columns&#39;</span>])) {
<a name="l00167"></a>00167             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;dropped_columns&#39;</span>] as $tableName =&gt; $removedColumns) {
<a name="l00168"></a>00168                 <span class="keywordflow">foreach</span> ($removedColumns as $name =&gt; $column) {
<a name="l00169"></a>00169                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#ab53d134edcf9d3a924ab19991140d90b" title="Build the code for removing columns.">buildRemoveColumn</a>($tableName, $name, $column);
<a name="l00170"></a>00170                     $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a89ea7edcf0b1efb9e84e86ca32f004aa" title="Build the code for adding columns.">buildAddColumn</a>($tableName, $name, $column);
<a name="l00171"></a>00171                 }
<a name="l00172"></a>00172             }
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;created_columns&#39;</span>])) {
<a name="l00176"></a>00176             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;created_columns&#39;</span>] as $tableName =&gt; $addedColumns) {
<a name="l00177"></a>00177                 <span class="keywordflow">foreach</span> ($addedColumns as $name =&gt; $column) {
<a name="l00178"></a>00178                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a89ea7edcf0b1efb9e84e86ca32f004aa" title="Build the code for adding columns.">buildAddColumn</a>($tableName, $name, $column);
<a name="l00179"></a>00179                     $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#ab53d134edcf9d3a924ab19991140d90b" title="Build the code for removing columns.">buildRemoveColumn</a>($tableName, $name, $column);
<a name="l00180"></a>00180                 }
<a name="l00181"></a>00181             }
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;changed_columns&#39;</span>])) {
<a name="l00185"></a>00185             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;changed_columns&#39;</span>] as $tableName =&gt; $changedColumns) {
<a name="l00186"></a>00186                 <span class="keywordflow">foreach</span> ($changedColumns as $name =&gt; $column) {
<a name="l00187"></a>00187                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a776d38ccb2ea6d94b309fb7a328425af" title="Build the code for changing columns.">buildChangeColumn</a>($tableName, $name, $column);
<a name="l00188"></a>00188                 }
<a name="l00189"></a>00189             }
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <span class="keywordflow">if</span> ( ! empty($up) || ! empty($down)) {
<a name="l00193"></a>00193             $up = implode(<span class="stringliteral">&quot;\n&quot;</span>, $up);
<a name="l00194"></a>00194             $down = implode(<span class="stringliteral">&quot;\n&quot;</span>, $down);
<a name="l00195"></a>00195             $className = <span class="stringliteral">&#39;Version&#39;</span> . $this-&gt;migration-&gt;getNextMigrationClassVersion();
<a name="l00196"></a>00196             $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a7b59c36bd151595505b666e79269de38" title="Generate a migration class.">generateMigrationClass</a>($className, array(), $up, $down);
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         $up = array();
<a name="l00200"></a>00200         $down = array();
<a name="l00201"></a>00201         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_foreign_keys&#39;</span>])) {
<a name="l00202"></a>00202             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;dropped_foreign_keys&#39;</span>] as $tableName =&gt; $droppedFks) {
<a name="l00203"></a>00203                 <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>]) &amp;&amp; isset($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>][$tableName])) { 
<a name="l00204"></a>00204                     <span class="keywordflow">continue</span>; 
<a name="l00205"></a>00205                 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207                 <span class="keywordflow">foreach</span> ($droppedFks as $name =&gt; $foreignKey) {
<a name="l00208"></a>00208                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a5aa06777f4af044c31cce5fe2875e680" title="Build the code for dropping foreign keys.">buildDropForeignKey</a>($tableName, $foreignKey);
<a name="l00209"></a>00209                     $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a6a3ccdf298b36024066c46de30111b6c" title="Build the code for creating foreign keys.">buildCreateForeignKey</a>($tableName, $foreignKey);
<a name="l00210"></a>00210                 }
<a name="l00211"></a>00211             }
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_indexes&#39;</span>])) {
<a name="l00215"></a>00215             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;dropped_indexes&#39;</span>] as $tableName =&gt; $removedIndexes) {
<a name="l00216"></a>00216                 <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>]) &amp;&amp; isset($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>][$tableName])) { 
<a name="l00217"></a>00217                     <span class="keywordflow">continue</span>; 
<a name="l00218"></a>00218                 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                 <span class="keywordflow">foreach</span> ($removedIndexes as $name =&gt; $index) {
<a name="l00221"></a>00221                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#acec190473bee2021f0deccf123077dc8" title="Build the code for removing indexes.">buildRemoveIndex</a>($tableName, $name, $index);
<a name="l00222"></a>00222                     $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#aa5e2cc40affba90d4538a8bb31e427c2" title="Build the code for adding indexes.">buildAddIndex</a>($tableName, $name, $index);
<a name="l00223"></a>00223                 }
<a name="l00224"></a>00224             }
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;created_foreign_keys&#39;</span>])) {
<a name="l00228"></a>00228             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;created_foreign_keys&#39;</span>] as $tableName =&gt; $createdFks) {
<a name="l00229"></a>00229                 <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>]) &amp;&amp; isset($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>][$tableName])) { 
<a name="l00230"></a>00230                     <span class="keywordflow">continue</span>; 
<a name="l00231"></a>00231                 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233                 <span class="keywordflow">foreach</span> ($createdFks as $name =&gt; $foreignKey) {
<a name="l00234"></a>00234                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a6a3ccdf298b36024066c46de30111b6c" title="Build the code for creating foreign keys.">buildCreateForeignKey</a>($tableName, $foreignKey);
<a name="l00235"></a>00235                     $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a5aa06777f4af044c31cce5fe2875e680" title="Build the code for dropping foreign keys.">buildDropForeignKey</a>($tableName, $foreignKey);
<a name="l00236"></a>00236                 }
<a name="l00237"></a>00237             }
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;created_indexes&#39;</span>])) {
<a name="l00241"></a>00241             <span class="keywordflow">foreach</span> ($changes[<span class="stringliteral">&#39;created_indexes&#39;</span>] as $tableName =&gt; $addedIndexes) {
<a name="l00242"></a>00242                 <span class="keywordflow">if</span> ( ! empty($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>]) &amp;&amp; isset($changes[<span class="stringliteral">&#39;dropped_tables&#39;</span>][$tableName])) { 
<a name="l00243"></a>00243                     <span class="keywordflow">continue</span>; 
<a name="l00244"></a>00244                 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246                 <span class="keywordflow">foreach</span> ($addedIndexes as $name =&gt; $index) {
<a name="l00247"></a>00247                     <span class="keywordflow">if</span> (isset($changes[<span class="stringliteral">&#39;created_tables&#39;</span>][$tableName][<span class="stringliteral">&#39;options&#39;</span>][<span class="stringliteral">&#39;indexes&#39;</span>][$name])) {
<a name="l00248"></a>00248                         <span class="keywordflow">continue</span>;
<a name="l00249"></a>00249                     }
<a name="l00250"></a>00250                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#aa5e2cc40affba90d4538a8bb31e427c2" title="Build the code for adding indexes.">buildAddIndex</a>($tableName, $name, $index);
<a name="l00251"></a>00251                     $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#acec190473bee2021f0deccf123077dc8" title="Build the code for removing indexes.">buildRemoveIndex</a>($tableName, $name, $index);
<a name="l00252"></a>00252                 }
<a name="l00253"></a>00253             }
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">if</span> ( ! empty($up) || ! empty($down)) {
<a name="l00257"></a>00257             $up = implode(<span class="stringliteral">&quot;\n&quot;</span>, $up);
<a name="l00258"></a>00258             $down = implode(<span class="stringliteral">&quot;\n&quot;</span>, $down);
<a name="l00259"></a>00259             $className = <span class="stringliteral">&#39;Version&#39;</span> . $this-&gt;migration-&gt;getNextMigrationClassVersion();
<a name="l00260"></a>00260             $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a7b59c36bd151595505b666e79269de38" title="Generate a migration class.">generateMigrationClass</a>($className, array(), $up, $down);
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         <span class="keywordflow">return</span> $changes;
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264 
<a name="l00270"></a><a class="code" href="classDoctrine__Migration__Builder.html#ab8a9cc1f6a6adeec9861dd1ae2bf61bf">00270</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#ab8a9cc1f6a6adeec9861dd1ae2bf61bf" title="Generate a set of migration classes from the existing databases.">generateMigrationsFromDb</a>()
<a name="l00271"></a>00271     {
<a name="l00272"></a>00272         $directory = sys_get_temp_dir() . DIRECTORY_SEPARATOR . <span class="stringliteral">&#39;tmp_doctrine_models&#39;</span>;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <a class="code" href="classDoctrine__Core.html#afdba9d9b40d4d62135b2796850354ba1" title="Method for importing existing schema to Doctrine_Record classes.">Doctrine_Core::generateModelsFromDb</a>($directory);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         $result = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#aeaf00aae93a51caeaf36322fe159b769" title="Generate a set of migrations from a set of models.">generateMigrationsFromModels</a>($directory, <a class="code" href="classDoctrine__Core.html#a84b23ca0e9cc72f44b6c98161420bb82" title="MODEL_LOADING_CONSERVATIVE.">Doctrine_Core::MODEL_LOADING_CONSERVATIVE</a>);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278         <a class="code" href="classDoctrine__Lib.html#a001abd9d0a54934572f97e74ebd14658" title="Removes a non empty directory.">Doctrine_Lib::removeDirectories</a>($directory);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="keywordflow">return</span> $result;
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 
<a name="l00290"></a><a class="code" href="classDoctrine__Migration__Builder.html#aeaf00aae93a51caeaf36322fe159b769">00290</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#aeaf00aae93a51caeaf36322fe159b769" title="Generate a set of migrations from a set of models.">generateMigrationsFromModels</a>($modelsPath = null, $modelLoading = null)
<a name="l00291"></a>00291     {
<a name="l00292"></a>00292         <span class="keywordflow">if</span> ($modelsPath !== null) {
<a name="l00293"></a>00293             $models = <a class="code" href="classDoctrine__Core.html#aadc15890078718c3d8c50d88e1c7aaa5" title="Filter through an array of classes and return all the classes that are valid models...">Doctrine_Core::filterInvalidModels</a>(<a class="code" href="classDoctrine__Core.html#a7174ed140b37bd24242286d97824f86a" title="Recursively load all models from a directory or array of directories.">Doctrine_Core::loadModels</a>($modelsPath, $modelLoading));
<a name="l00294"></a>00294         } <span class="keywordflow">else</span> {
<a name="l00295"></a>00295             $models = <a class="code" href="classDoctrine__Core.html#ac5c6386d8802fb87b068a126521a5457" title="Get all the loaded models, you can provide an array of classes or it will use get_declared_classes()...">Doctrine_Core::getLoadedModels</a>();
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         $models = <a class="code" href="classDoctrine__Core.html#a18c18e6233217974095e3be37e63c5ea" title="Initialize all models so everything is present and loaded in to memory This will...">Doctrine_Core::initializeModels</a>($models);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         $foreignKeys = array();
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <span class="keywordflow">foreach</span> ($models as $model) {
<a name="l00303"></a>00303             $table = <a class="code" href="classDoctrine__Core.html#a2b20202aaba378351e7915e75b4b7e27" title="Get the Doctrine_Table object for the passed model.">Doctrine_Core::getTable</a>($model);
<a name="l00304"></a>00304             <span class="keywordflow">if</span> ($table-&gt;getTableName() !== $this-&gt;migration-&gt;getTableName()) {
<a name="l00305"></a>00305                 $export = $table-&gt;getExportableFormat();
<a name="l00306"></a>00306 
<a name="l00307"></a>00307                 $foreignKeys[$export[<span class="stringliteral">&#39;tableName&#39;</span>]] = $export[<span class="stringliteral">&#39;options&#39;</span>][<span class="stringliteral">&#39;foreignKeys&#39;</span>];
<a name="l00308"></a>00308 
<a name="l00309"></a>00309                 $up = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a1779185681966b26d363328046c2039f" title="Build the code for creating tables.">buildCreateTable</a>($export);
<a name="l00310"></a>00310                 $down = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#ab27ac414b38d8cfdbbce8f38c0224a83" title="Build the code for dropping tables.">buildDropTable</a>($export);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312                 $className = <span class="stringliteral">&#39;Add&#39;</span> . <a class="code" href="classDoctrine__Inflector.html#a6de81894754d68756b8e413cf6ee35fb" title="Convert a word in to the format for a Doctrine class name.">Doctrine_Inflector::classify</a>($export[<span class="stringliteral">&#39;tableName&#39;</span>]);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314                 $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a7b59c36bd151595505b666e79269de38" title="Generate a migration class.">generateMigrationClass</a>($className, array(), $up, $down);
<a name="l00315"></a>00315             }
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <span class="keywordflow">if</span> ( ! empty($foreignKeys)) {
<a name="l00319"></a>00319             $className = <span class="stringliteral">&#39;AddFks&#39;</span>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321             $up = array();
<a name="l00322"></a>00322             $down = array();
<a name="l00323"></a>00323             <span class="keywordflow">foreach</span> ($foreignKeys as $tableName =&gt; $definitions)    {
<a name="l00324"></a>00324                 $tableForeignKeyNames[$tableName] = array();
<a name="l00325"></a>00325 
<a name="l00326"></a>00326                 <span class="keywordflow">foreach</span> ($definitions as $definition) {
<a name="l00327"></a>00327                     $up[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a6a3ccdf298b36024066c46de30111b6c" title="Build the code for creating foreign keys.">buildCreateForeignKey</a>($tableName, $definition);
<a name="l00328"></a>00328                     $down[] = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a5aa06777f4af044c31cce5fe2875e680" title="Build the code for dropping foreign keys.">buildDropForeignKey</a>($tableName, $definition);
<a name="l00329"></a>00329                 }
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332             $up = implode(<span class="stringliteral">&quot;\n&quot;</span>, $up);
<a name="l00333"></a>00333             $down = implode(<span class="stringliteral">&quot;\n&quot;</span>, $down);
<a name="l00334"></a>00334             <span class="keywordflow">if</span> ($up || $down) {
<a name="l00335"></a>00335                 $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a7b59c36bd151595505b666e79269de38" title="Generate a migration class.">generateMigrationClass</a>($className, array(), $up, $down);
<a name="l00336"></a>00336             }
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341 
<a name="l00349"></a><a class="code" href="classDoctrine__Migration__Builder.html#a6a3ccdf298b36024066c46de30111b6c">00349</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a6a3ccdf298b36024066c46de30111b6c" title="Build the code for creating foreign keys.">buildCreateForeignKey</a>($tableName, $definition)
<a name="l00350"></a>00350     {
<a name="l00351"></a>00351         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;createForeignKey(&#39;&quot;</span> . $tableName . <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $definition[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&quot;&#39;, &quot;</span> . $this-&gt;<a class="code" href="classDoctrine__Builder.html#af0642905fb7bfe59214c3e697aa11625" title="Special function for var_export() The normal code which is returned is malformed...">varExport</a>($definition, <span class="keyword">true</span>) . <span class="stringliteral">&quot;);&quot;</span>;
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353 
<a name="l00361"></a><a class="code" href="classDoctrine__Migration__Builder.html#a5aa06777f4af044c31cce5fe2875e680">00361</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a5aa06777f4af044c31cce5fe2875e680" title="Build the code for dropping foreign keys.">buildDropForeignKey</a>($tableName, $definition)
<a name="l00362"></a>00362     {
<a name="l00363"></a>00363         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;dropForeignKey(&#39;&quot;</span> . $tableName . <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $definition[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&quot;&#39;);&quot;</span>;
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365 
<a name="l00372"></a><a class="code" href="classDoctrine__Migration__Builder.html#a1779185681966b26d363328046c2039f">00372</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a1779185681966b26d363328046c2039f" title="Build the code for creating tables.">buildCreateTable</a>($tableData)
<a name="l00373"></a>00373     {
<a name="l00374"></a>00374         $code  = <span class="stringliteral">&quot;        \$this-&gt;createTable(&#39;&quot;</span> . $tableData[<span class="stringliteral">&#39;tableName&#39;</span>] . <span class="stringliteral">&quot;&#39;, &quot;</span>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         $code .= $this-&gt;<a class="code" href="classDoctrine__Builder.html#af0642905fb7bfe59214c3e697aa11625" title="Special function for var_export() The normal code which is returned is malformed...">varExport</a>($tableData[<span class="stringliteral">&#39;columns&#39;</span>], <span class="keyword">true</span>) . <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         $optionsWeNeed = array(<span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;indexes&#39;</span>, <span class="stringliteral">&#39;primary&#39;</span>, <span class="stringliteral">&#39;collate&#39;</span>, <span class="stringliteral">&#39;charset&#39;</span>);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         $options = array();
<a name="l00381"></a>00381         <span class="keywordflow">foreach</span> ($optionsWeNeed as $option) {
<a name="l00382"></a>00382             <span class="keywordflow">if</span> (isset($tableData[<span class="stringliteral">&#39;options&#39;</span>][$option])) {
<a name="l00383"></a>00383                 $options[$option] = $tableData[<span class="stringliteral">&#39;options&#39;</span>][$option];
<a name="l00384"></a>00384             }
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         $code .= $this-&gt;<a class="code" href="classDoctrine__Builder.html#af0642905fb7bfe59214c3e697aa11625" title="Special function for var_export() The normal code which is returned is malformed...">varExport</a>($options, <span class="keyword">true</span>);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         $code .= <span class="stringliteral">&quot;);&quot;</span>;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="keywordflow">return</span> $code;
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393 
<a name="l00400"></a><a class="code" href="classDoctrine__Migration__Builder.html#ab27ac414b38d8cfdbbce8f38c0224a83">00400</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#ab27ac414b38d8cfdbbce8f38c0224a83" title="Build the code for dropping tables.">buildDropTable</a>($tableData)
<a name="l00401"></a>00401     {
<a name="l00402"></a>00402         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;dropTable(&#39;&quot;</span> . $tableData[<span class="stringliteral">&#39;tableName&#39;</span>] . <span class="stringliteral">&quot;&#39;);&quot;</span>;
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404 
<a name="l00413"></a><a class="code" href="classDoctrine__Migration__Builder.html#a89ea7edcf0b1efb9e84e86ca32f004aa">00413</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a89ea7edcf0b1efb9e84e86ca32f004aa" title="Build the code for adding columns.">buildAddColumn</a>($tableName, $columnName, $column)
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415         $length = $column[<span class="stringliteral">&#39;length&#39;</span>];
<a name="l00416"></a>00416         $type = $column[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l00417"></a>00417         unset($column[<span class="stringliteral">&#39;length&#39;</span>], $column[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l00418"></a>00418         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;addColumn(&#39;&quot;</span> . $tableName . <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $columnName. <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $type . <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $length . <span class="stringliteral">&quot;&#39;, &quot;</span> . $this-&gt;<a class="code" href="classDoctrine__Builder.html#af0642905fb7bfe59214c3e697aa11625" title="Special function for var_export() The normal code which is returned is malformed...">varExport</a>($column) . <span class="stringliteral">&quot;);&quot;</span>;
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420 
<a name="l00429"></a><a class="code" href="classDoctrine__Migration__Builder.html#ab53d134edcf9d3a924ab19991140d90b">00429</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#ab53d134edcf9d3a924ab19991140d90b" title="Build the code for removing columns.">buildRemoveColumn</a>($tableName, $columnName, $column)
<a name="l00430"></a>00430     {
<a name="l00431"></a>00431         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;removeColumn(&#39;&quot;</span> . $tableName . <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $columnName. <span class="stringliteral">&quot;&#39;);&quot;</span>;
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433 
<a name="l00442"></a><a class="code" href="classDoctrine__Migration__Builder.html#a776d38ccb2ea6d94b309fb7a328425af">00442</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a776d38ccb2ea6d94b309fb7a328425af" title="Build the code for changing columns.">buildChangeColumn</a>($tableName, $columnName, $column)
<a name="l00443"></a>00443     {
<a name="l00444"></a>00444         $length = $column[<span class="stringliteral">&#39;length&#39;</span>];
<a name="l00445"></a>00445         $type = $column[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l00446"></a>00446         unset($column[<span class="stringliteral">&#39;length&#39;</span>], $column[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l00447"></a>00447         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;changeColumn(&#39;&quot;</span> . $tableName . <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $columnName. <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $type . <span class="stringliteral">&quot;&#39;, &#39;&quot;</span> . $length . <span class="stringliteral">&quot;&#39;, &quot;</span> . $this-&gt;<a class="code" href="classDoctrine__Builder.html#af0642905fb7bfe59214c3e697aa11625" title="Special function for var_export() The normal code which is returned is malformed...">varExport</a>($column) . <span class="stringliteral">&quot;);&quot;</span>;
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449 
<a name="l00458"></a><a class="code" href="classDoctrine__Migration__Builder.html#aa5e2cc40affba90d4538a8bb31e427c2">00458</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#aa5e2cc40affba90d4538a8bb31e427c2" title="Build the code for adding indexes.">buildAddIndex</a>($tableName, $indexName, $index)
<a name="l00459"></a>00459     {
<a name="l00460"></a>00460         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;addIndex(&#39;$tableName&#39;, &#39;$indexName&#39;, &quot;</span> . $this-&gt;<a class="code" href="classDoctrine__Builder.html#af0642905fb7bfe59214c3e697aa11625" title="Special function for var_export() The normal code which is returned is malformed...">varExport</a>($index) . <span class="stringliteral">&quot;);&quot;</span>;
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462 
<a name="l00471"></a><a class="code" href="classDoctrine__Migration__Builder.html#acec190473bee2021f0deccf123077dc8">00471</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#acec190473bee2021f0deccf123077dc8" title="Build the code for removing indexes.">buildRemoveIndex</a>($tableName, $indexName, $index)
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473         <span class="keywordflow">return</span> <span class="stringliteral">&quot;        \$this-&gt;removeIndex(&#39;$tableName&#39;, &#39;$indexName&#39;, &quot;</span> . $this-&gt;<a class="code" href="classDoctrine__Builder.html#af0642905fb7bfe59214c3e697aa11625" title="Special function for var_export() The normal code which is returned is malformed...">varExport</a>($index) . <span class="stringliteral">&quot;);&quot;</span>;
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475 
<a name="l00487"></a><a class="code" href="classDoctrine__Migration__Builder.html#a7b59c36bd151595505b666e79269de38">00487</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a7b59c36bd151595505b666e79269de38" title="Generate a migration class.">generateMigrationClass</a>($className, $options = array(), $up = null, $down = null, $return = <span class="keyword">false</span>)
<a name="l00488"></a>00488     {
<a name="l00489"></a>00489         $className = <a class="code" href="classDoctrine__Inflector.html#a414c33c98c1f2adc30994c38fa5359eb" title="Convert any passed string to a url friendly string.">Doctrine_Inflector::urlize</a>($className);
<a name="l00490"></a>00490         $className = str_replace(<span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $className);
<a name="l00491"></a>00491         $className = <a class="code" href="classDoctrine__Inflector.html#a6de81894754d68756b8e413cf6ee35fb" title="Convert a word in to the format for a Doctrine class name.">Doctrine_Inflector::classify</a>($className);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         <span class="keywordflow">if</span> ($return || ! $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a0a078b6e0b4f34350b576b4841aab1ca" title="Get the path where generated migration classes are written to.">getMigrationsPath</a>()) {
<a name="l00494"></a>00494             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a7d8a5a7ebbb169dcd7d6d869b95502ae" title="Build the code for a migration class.">buildMigrationClass</a>($className, null, $options, $up, $down);
<a name="l00495"></a>00495         } <span class="keywordflow">else</span> {
<a name="l00496"></a>00496             <span class="keywordflow">if</span> ( ! $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a0a078b6e0b4f34350b576b4841aab1ca" title="Get the path where generated migration classes are written to.">getMigrationsPath</a>()) {
<a name="l00497"></a>00497                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Migration__Exception.html">Doctrine_Migration_Exception</a>(<span class="stringliteral">&#39;You must specify the path to your migrations.&#39;</span>);
<a name="l00498"></a>00498             }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500             $next = time() + $this-&gt;migration-&gt;getNextMigrationClassVersion();
<a name="l00501"></a>00501             $fileName = $next . <span class="charliteral">&#39;_&#39;</span> . <a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($className) . $this-&gt;suffix;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503             $class = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a7d8a5a7ebbb169dcd7d6d869b95502ae" title="Build the code for a migration class.">buildMigrationClass</a>($className, $fileName, $options, $up, $down);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505             $path = $this-&gt;<a class="code" href="classDoctrine__Migration__Builder.html#a0a078b6e0b4f34350b576b4841aab1ca" title="Get the path where generated migration classes are written to.">getMigrationsPath</a>() . DIRECTORY_SEPARATOR . $fileName;
<a name="l00506"></a>00506             <span class="keywordflow">if</span> (class_exists($className) || file_exists($path)) {
<a name="l00507"></a>00507                 $this-&gt;migration-&gt;loadMigrationClass($className);
<a name="l00508"></a>00508                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00509"></a>00509             }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511             file_put_contents($path, $class);
<a name="l00512"></a>00512             require_once($path);
<a name="l00513"></a>00513             $this-&gt;migration-&gt;loadMigrationClass($className);
<a name="l00514"></a>00514 
<a name="l00515"></a>00515             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00516"></a>00516         }
<a name="l00517"></a>00517     }
<a name="l00518"></a>00518 
<a name="l00529"></a><a class="code" href="classDoctrine__Migration__Builder.html#a7d8a5a7ebbb169dcd7d6d869b95502ae">00529</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Migration__Builder.html#a7d8a5a7ebbb169dcd7d6d869b95502ae" title="Build the code for a migration class.">buildMigrationClass</a>($className, $fileName = null, $options = array(), $up = null, $down = null)
<a name="l00530"></a>00530     {
<a name="l00531"></a>00531         $extends = isset($options[<span class="stringliteral">&#39;extends&#39;</span>]) ? $options[<span class="stringliteral">&#39;extends&#39;</span>]:<span class="stringliteral">&#39;Doctrine_Migration_Base&#39;</span>;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         $content  = <span class="stringliteral">&#39;&lt;?php&#39;</span> . PHP_EOL;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         $content .= sprintf(self::$tpl, $className,
<a name="l00536"></a>00536                                        $extends,
<a name="l00537"></a>00537                                        $up,
<a name="l00538"></a>00538                                        $down);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540         <span class="keywordflow">return</span> $content;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
