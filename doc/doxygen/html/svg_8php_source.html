<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: web/wiki/lib/plugins/dw2pdf/mpdf/classes/svg.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>web/wiki/lib/plugins/dw2pdf/mpdf/classes/svg.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">//  svg class modified for mPDF by Ian Back: based on -</span>
<a name="l00003"></a>00003 <span class="comment">//  svg2pdf fpdf class</span>
<a name="l00004"></a>00004 <span class="comment">//  sylvain briand (syb@godisaduck.com), modified by rick trevino (rtrevino1@yahoo.com)</span>
<a name="l00005"></a>00005 <span class="comment">//  http://www.godisaduck.com/svg2pdf_with_fpdf</span>
<a name="l00006"></a>00006 <span class="comment">//  http://rhodopsin.blogspot.com</span>
<a name="l00007"></a>00007 <span class="comment">//  </span>
<a name="l00008"></a>00008 <span class="comment">//  cette class etendue est open source, toute modification devra cependant etre repertoriée~</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="classSVG.html">00012</a> <span class="keyword">class </span><a class="code" href="classSVG.html">SVG</a> {
<a name="l00013"></a>00013 
<a name="l00014"></a>00014   var $svg_gradient;  <span class="comment">//  array - contient les infos sur les gradient fill du svg classé par id du svg</span>
<a name="l00015"></a>00015   var $svg_shadinglist; <span class="comment">//  array - contient les ids des objet shading</span>
<a name="l00016"></a>00016   var $svg_info;    <span class="comment">//  array contenant les infos du svg voulue par l&#39;utilisateur</span>
<a name="l00017"></a>00017   var $svg_attribs;   <span class="comment">//  array - holds all attributes of root &lt;svg&gt; tag</span>
<a name="l00018"></a>00018   var $svg_style;   <span class="comment">//  array contenant les style de groupes du svg</span>
<a name="l00019"></a>00019   var $svg_string;    <span class="comment">//  String contenant le tracage du svg en lui même.</span>
<a name="l00020"></a>00020   var $txt_data;    <span class="comment">//    array - holds string info to write txt to image</span>
<a name="l00021"></a>00021   var $txt_style;   <span class="comment">//  array - current text style</span>
<a name="l00022"></a>00022   var $mpdf_ref;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024   function <a class="code" href="classSVG.html">SVG</a>(&amp;$mpdf){
<a name="l00025"></a>00025     $this-&gt;svg_gradient = array();
<a name="l00026"></a>00026     $this-&gt;svg_shadinglist = array();
<a name="l00027"></a>00027     $this-&gt;txt_data = array();
<a name="l00028"></a>00028     $this-&gt;svg_string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00029"></a>00029     $this-&gt;svg_info = array();
<a name="l00030"></a>00030     $this-&gt;svg_attribs = array();
<a name="l00031"></a>00031 
<a name="l00032"></a>00032     $this-&gt;mpdf_ref =&amp; $mpdf;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034     $this-&gt;svg_style = array(
<a name="l00035"></a>00035       array(
<a name="l00036"></a>00036       <span class="stringliteral">&#39;fill&#39;</span>    =&gt; <span class="stringliteral">&#39;none&#39;</span>,      <span class="comment">//  pas de remplissage par defaut</span>
<a name="l00037"></a>00037       <span class="stringliteral">&#39;fill-opacity&#39;</span>  =&gt; 1,       <span class="comment">//  remplissage opaque par defaut</span>
<a name="l00038"></a>00038       <span class="stringliteral">&#39;fill-rule&#39;</span>   =&gt; <span class="stringliteral">&#39;nonzero&#39;</span>,   <span class="comment">//  mode de remplissage par defaut</span>
<a name="l00039"></a>00039       <span class="stringliteral">&#39;stroke&#39;</span>    =&gt; <span class="stringliteral">&#39;none&#39;</span>,      <span class="comment">//  pas de trait par defaut</span>
<a name="l00040"></a>00040       <span class="stringliteral">&#39;stroke-linecap&#39;</span>  =&gt; <span class="stringliteral">&#39;butt&#39;</span>,      <span class="comment">//  style de langle par defaut</span>
<a name="l00041"></a>00041       <span class="stringliteral">&#39;stroke-linejoin&#39;</span> =&gt; <span class="stringliteral">&#39;miter&#39;</span>,     <span class="comment">//</span>
<a name="l00042"></a>00042       <span class="stringliteral">&#39;stroke-miterlimit&#39;</span> =&gt; 4,     <span class="comment">//  limite de langle par defaut</span>
<a name="l00043"></a>00043       <span class="stringliteral">&#39;stroke-opacity&#39;</span>  =&gt; 1,       <span class="comment">//  trait opaque par defaut</span>
<a name="l00044"></a>00044       <span class="stringliteral">&#39;stroke-width&#39;</span>  =&gt; 0        <span class="comment">//  epaisseur du trait par defaut</span>
<a name="l00045"></a>00045       )
<a name="l00046"></a>00046     );
<a name="l00047"></a>00047 
<a name="l00048"></a>00048     $this-&gt;txt_style = array(
<a name="l00049"></a>00049       array(
<a name="l00050"></a>00050       <span class="stringliteral">&#39;fill&#39;</span>    =&gt; <span class="stringliteral">&#39;black&#39;</span>,   <span class="comment">//  pas de remplissage par defaut</span>
<a name="l00051"></a>00051       <span class="stringliteral">&#39;font-family&#39;</span>   =&gt; $mpdf-&gt;default_font,
<a name="l00052"></a>00052       <span class="stringliteral">&#39;font-size&#39;</span>   =&gt; $mpdf-&gt;default_font_size,    <span class="comment">//  ****** this is pts</span>
<a name="l00053"></a>00053       <span class="stringliteral">&#39;font-weight&#39;</span> =&gt; <span class="stringliteral">&#39;normal&#39;</span>,  <span class="comment">//  normal | bold</span>
<a name="l00054"></a>00054       <span class="stringliteral">&#39;font-style&#39;</span>  =&gt; <span class="stringliteral">&#39;normal&#39;</span>,  <span class="comment">//  italic | normal</span>
<a name="l00055"></a>00055       <span class="stringliteral">&#39;text-anchor&#39;</span> =&gt; <span class="stringliteral">&#39;start&#39;</span>    <span class="comment">// alignment: start, middle, end</span>
<a name="l00056"></a>00056       )
<a name="l00057"></a>00057     );
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063   function svgGradient($gradient_info, $attribs, $element){
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     $n = count($this-&gt;mpdf_ref-&gt;gradients)+1;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="comment">// Get bounding dimensions of element</span>
<a name="l00068"></a>00068     $w = 100;
<a name="l00069"></a>00069     $h = 100;
<a name="l00070"></a>00070     $x_offset = 0;
<a name="l00071"></a>00071     $y_offset = 0;
<a name="l00072"></a>00072     <span class="keywordflow">if</span> ($element==<span class="stringliteral">&#39;rect&#39;</span>) {
<a name="l00073"></a>00073       $w = $attribs[<span class="stringliteral">&#39;width&#39;</span>];
<a name="l00074"></a>00074       $h = $attribs[<span class="stringliteral">&#39;height&#39;</span>];
<a name="l00075"></a>00075       $x_offset = $attribs[<span class="charliteral">&#39;x&#39;</span>];
<a name="l00076"></a>00076       $y_offset = $attribs[<span class="charliteral">&#39;y&#39;</span>];
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($element==<span class="stringliteral">&#39;ellipse&#39;</span>) {
<a name="l00079"></a>00079       $w = $attribs[<span class="stringliteral">&#39;rx&#39;</span>]*2;
<a name="l00080"></a>00080       $h = $attribs[<span class="stringliteral">&#39;ry&#39;</span>]*2;
<a name="l00081"></a>00081       $x_offset = $attribs[<span class="stringliteral">&#39;cx&#39;</span>]-$attribs[<span class="stringliteral">&#39;rx&#39;</span>];
<a name="l00082"></a>00082       $y_offset = $attribs[<span class="stringliteral">&#39;cy&#39;</span>]-$attribs[<span class="stringliteral">&#39;ry&#39;</span>];
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($element==<span class="stringliteral">&#39;circle&#39;</span>) {
<a name="l00085"></a>00085       $w = $attribs[<span class="charliteral">&#39;r&#39;</span>]*2;
<a name="l00086"></a>00086       $h = $attribs[<span class="charliteral">&#39;r&#39;</span>]*2;
<a name="l00087"></a>00087       $x_offset = $attribs[<span class="stringliteral">&#39;cx&#39;</span>]-$attribs[<span class="charliteral">&#39;r&#39;</span>];
<a name="l00088"></a>00088       $y_offset = $attribs[<span class="stringliteral">&#39;cy&#39;</span>]-$attribs[<span class="charliteral">&#39;r&#39;</span>];
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($element==<span class="stringliteral">&#39;polygon&#39;</span>) {
<a name="l00091"></a>00091       $pts = preg_split(<span class="stringliteral">&#39;/[ ,]+/&#39;</span>, trim($attribs[<span class="stringliteral">&#39;points&#39;</span>]));
<a name="l00092"></a>00092       $maxr=$maxb=0;
<a name="l00093"></a>00093       $minl=$mint=999999;
<a name="l00094"></a>00094       <span class="keywordflow">for</span> ($i=0;$i&lt;count($pts); $i++) {
<a name="l00095"></a>00095         <span class="keywordflow">if</span> ($i % 2 == 0) {  <span class="comment">// x values</span>
<a name="l00096"></a>00096           $minl = min($minl,$pts[$i]);
<a name="l00097"></a>00097           $maxr = max($maxr,$pts[$i]);
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099         <span class="keywordflow">else</span> {  <span class="comment">// y values</span>
<a name="l00100"></a>00100           $mint = min($mint,$pts[$i]);
<a name="l00101"></a>00101           $maxb = max($maxb,$pts[$i]);
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103       }
<a name="l00104"></a>00104       $w = $maxr-$minl;
<a name="l00105"></a>00105       $h = $maxb-$mint;
<a name="l00106"></a>00106       $x_offset = $minl;
<a name="l00107"></a>00107       $y_offset = $mint;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($element==<span class="stringliteral">&#39;path&#39;</span>) {
<a name="l00110"></a>00110       preg_match_all(<span class="stringliteral">&#39;/([a-z]|[A-Z])([ ,\-.\d]+)*/&#39;</span>, $attribs[<span class="charliteral">&#39;d&#39;</span>], $commands, PREG_SET_ORDER);
<a name="l00111"></a>00111       $maxr=$maxb=0;
<a name="l00112"></a>00112       $minl=$mint=999999;
<a name="l00113"></a>00113       <span class="keywordflow">foreach</span>($commands as $c){
<a name="l00114"></a>00114         <span class="keywordflow">if</span>(count($c)==3){
<a name="l00115"></a>00115           list($tmp, $cmd, $arg) = $c;
<a name="l00116"></a>00116           <span class="keywordflow">if</span> ($cmd==<span class="charliteral">&#39;M&#39;</span> || $cmd==<span class="charliteral">&#39;L&#39;</span> || $cmd==<span class="charliteral">&#39;C&#39;</span> || $cmd==<span class="charliteral">&#39;S&#39;</span> || $cmd==<span class="charliteral">&#39;Q&#39;</span> || $cmd==<span class="charliteral">&#39;T&#39;</span>) {
<a name="l00117"></a>00117             $pts = preg_split(<span class="stringliteral">&#39;/[ ,]+/&#39;</span>, trim($arg));
<a name="l00118"></a>00118             <span class="keywordflow">for</span> ($i=0;$i&lt;count($pts); $i++) {
<a name="l00119"></a>00119               <span class="keywordflow">if</span> ($i % 2 == 0) {  <span class="comment">// x values</span>
<a name="l00120"></a>00120                 $minl = min($minl,$pts[$i]);
<a name="l00121"></a>00121                 $maxr = max($maxr,$pts[$i]);
<a name="l00122"></a>00122               }
<a name="l00123"></a>00123               <span class="keywordflow">else</span> {  <span class="comment">// y values</span>
<a name="l00124"></a>00124                 $mint = min($mint,$pts[$i]);
<a name="l00125"></a>00125                 $maxb = max($maxb,$pts[$i]);
<a name="l00126"></a>00126               }
<a name="l00127"></a>00127             }
<a name="l00128"></a>00128           }
<a name="l00129"></a>00129           <span class="keywordflow">if</span> ($cmd==<span class="charliteral">&#39;H&#39;</span>) { <span class="comment">// sets new x</span>
<a name="l00130"></a>00130             $minl = min($minl,$arg);
<a name="l00131"></a>00131             $maxr = max($maxr,$arg);
<a name="l00132"></a>00132           }
<a name="l00133"></a>00133           <span class="keywordflow">if</span> ($cmd==<span class="charliteral">&#39;V&#39;</span>) { <span class="comment">// sets new y</span>
<a name="l00134"></a>00134             $mint = min($mint,$arg);
<a name="l00135"></a>00135             $maxb = max($maxb,$arg);
<a name="l00136"></a>00136           }
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138       }
<a name="l00139"></a>00139       $w = $maxr-$minl;
<a name="l00140"></a>00140       $h = $maxb-$mint;
<a name="l00141"></a>00141       $x_offset = $minl;
<a name="l00142"></a>00142       $y_offset = $mint;
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (!$w) { $w = 100; }
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (!$h) { $h = 100; }
<a name="l00146"></a>00146     <span class="keywordflow">if</span> ($x_offset==999999) { $x_offset = 0; }
<a name="l00147"></a>00147     <span class="keywordflow">if</span> ($y_offset==999999) { $y_offset = 0; }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     $return = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00151"></a>00151     <span class="keywordflow">if</span> ($gradient_info[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;linear&#39;</span>){
<a name="l00152"></a>00152       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;type&#39;</span>] = 2;
<a name="l00153"></a>00153       <span class="keywordflow">if</span> (isset($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x1&#39;</span>])) { $x1 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x1&#39;</span>]; }
<a name="l00154"></a>00154       <span class="keywordflow">else</span> { $x1 = 0; }
<a name="l00155"></a>00155       <span class="keywordflow">if</span> (isset($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y1&#39;</span>])) { $y1 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y1&#39;</span>]; }
<a name="l00156"></a>00156       <span class="keywordflow">else</span> { $y1 = 0; }
<a name="l00157"></a>00157       <span class="keywordflow">if</span> (isset($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x2&#39;</span>])) { $x2 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x2&#39;</span>]; }
<a name="l00158"></a>00158       <span class="keywordflow">else</span> { $x2 = 1; }
<a name="l00159"></a>00159       <span class="keywordflow">if</span> (isset($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y2&#39;</span>])) { $y2 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y2&#39;</span>]; }
<a name="l00160"></a>00160       <span class="keywordflow">else</span> { $y2 = 0; }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162       <span class="keywordflow">if</span> (stristr($x1, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $x1 = ($x1+0)/100; }
<a name="l00163"></a>00163       <span class="keywordflow">if</span> (stristr($x2, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $x2 = ($x2+0)/100; }
<a name="l00164"></a>00164       <span class="keywordflow">if</span> (stristr($y1, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $y1 = ($y1+0)/100; }
<a name="l00165"></a>00165       <span class="keywordflow">if</span> (stristr($y2, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $y2 = ($y2+0)/100; }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;coords&#39;</span>]=array($x1, $y1, $x2, $y2);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169       $a = $w;  <span class="comment">// width</span>
<a name="l00170"></a>00170       $b = 0;
<a name="l00171"></a>00171       $c = 0;
<a name="l00172"></a>00172       $d = -$h; <span class="comment">// height</span>
<a name="l00173"></a>00173       $e = $x_offset; <span class="comment">// x- offset</span>
<a name="l00174"></a>00174       $f = -$y_offset;  <span class="comment">// -y-offset</span>
<a name="l00175"></a>00175 
<a name="l00176"></a>00176       $return .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f cm &#39;</span>, $a, $b, $c, $d, $e, $f);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;col1&#39;</span>] = $gradient_info[<span class="stringliteral">&#39;color&#39;</span>][0][<span class="stringliteral">&#39;color&#39;</span>];
<a name="l00179"></a>00179       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;col2&#39;</span>] = $gradient_info[<span class="stringliteral">&#39;color&#39;</span>][(count($gradient_info[<span class="stringliteral">&#39;color&#39;</span>])-1)][<span class="stringliteral">&#39;color&#39;</span>];
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($gradient_info[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;radial&#39;</span>){
<a name="l00183"></a>00183 
<a name="l00184"></a>00184       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;type&#39;</span>] = 3;
<a name="l00185"></a>00185       $a = $w;  <span class="comment">// width</span>
<a name="l00186"></a>00186       $b = 0;
<a name="l00187"></a>00187       $c = 0;
<a name="l00188"></a>00188       $d = -$h;   <span class="comment">// -height</span>
<a name="l00189"></a>00189       $e = $x_offset; <span class="comment">// x- offset</span>
<a name="l00190"></a>00190       $f = -$y_offset;  <span class="comment">// -y-offset</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192       $return .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f cm &#39;</span>, $a, $b, $c, $d, $e, $f);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194       <span class="keywordflow">if</span> ($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x0&#39;</span>] || $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x0&#39;</span>]===0) { $x0 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x0&#39;</span>]; }
<a name="l00195"></a>00195       <span class="keywordflow">else</span> { $x0 = 0.5; }
<a name="l00196"></a>00196       <span class="keywordflow">if</span> ($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y0&#39;</span>] || $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y0&#39;</span>]===0) { $y0 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y0&#39;</span>]; }
<a name="l00197"></a>00197       <span class="keywordflow">else</span> { $y0 = 0.5; }
<a name="l00198"></a>00198       <span class="keywordflow">if</span> ($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;r&#39;</span>] || $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;r&#39;</span>]===0) { $r = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;r&#39;</span>]; }
<a name="l00199"></a>00199       <span class="keywordflow">else</span> { $r = 0.5; }
<a name="l00200"></a>00200       <span class="keywordflow">if</span> ($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x1&#39;</span>] || $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x1&#39;</span>]===0) { $x1 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;x1&#39;</span>]; }
<a name="l00201"></a>00201       <span class="keywordflow">else</span> { $x1 = $x0; }
<a name="l00202"></a>00202       <span class="keywordflow">if</span> ($gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y1&#39;</span>] || $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y1&#39;</span>]===0) { $y1 = $gradient_info[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;y1&#39;</span>]; }
<a name="l00203"></a>00203       <span class="keywordflow">else</span> { $y1 = $y0; }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205       <span class="keywordflow">if</span> (stristr($x1, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $x1 = ($x1+0)/100; }
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (stristr($x0, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $x0 = ($x0+0)/100; }
<a name="l00207"></a>00207       <span class="keywordflow">if</span> (stristr($y1, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $y1 = ($y1+0)/100; }
<a name="l00208"></a>00208       <span class="keywordflow">if</span> (stristr($y0, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $y0 = ($y0+0)/100; }
<a name="l00209"></a>00209       <span class="keywordflow">if</span> (stristr($r, <span class="charliteral">&#39;%&#39;</span>)!== <span class="keyword">false</span>) { $r = ($r+0)/100; }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211       <span class="comment">// x1 and y1 (fx, fy) should be inside the circle defined by x0 y0 and r else error in mPDF</span>
<a name="l00212"></a>00212       <span class="keywordflow">while</span> (pow(($x1-$x0),2) + pow(($y1 - $y0),2) &gt;= pow($r,2)) { $r += 0.05; }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;coords&#39;</span>]=array( $x1, $y1, $x0, $y0, abs($r) );
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;col1&#39;</span>] = $gradient_info[<span class="stringliteral">&#39;color&#39;</span>][0][<span class="stringliteral">&#39;color&#39;</span>];
<a name="l00218"></a>00218       $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;col2&#39;</span>] = $gradient_info[<span class="stringliteral">&#39;color&#39;</span>][(count($gradient_info[<span class="stringliteral">&#39;color&#39;</span>])-1)][<span class="stringliteral">&#39;color&#39;</span>];
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     $this-&gt;mpdf_ref-&gt;gradients[$n][<span class="stringliteral">&#39;extend&#39;</span>]=array(<span class="stringliteral">&#39;true&#39;</span>,<span class="stringliteral">&#39;true&#39;</span>);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="comment">/* Only uses 2 colours for mPDF</span>
<a name="l00225"></a>00225 <span class="comment">    $this-&gt;mpdf_ref-&gt;gradients[$n][&#39;color&#39;] = array();</span>
<a name="l00226"></a>00226 <span class="comment">    $n_color = count($gradient_info[&#39;color&#39;]);</span>
<a name="l00227"></a>00227 <span class="comment">    for ($i = 0;$i&lt;$n_color;$i++){</span>
<a name="l00228"></a>00228 <span class="comment">      $color = array (</span>
<a name="l00229"></a>00229 <span class="comment">        &#39;color&#39; =&gt; $gradient_info[&#39;color&#39;][$i][&#39;color&#39;],</span>
<a name="l00230"></a>00230 <span class="comment">        &#39;offset&#39; =&gt; $gradient_info[&#39;color&#39;][$i][&#39;offset&#39;],</span>
<a name="l00231"></a>00231 <span class="comment">        &#39;opacity&#39; =&gt; $gradient_info[&#39;color&#39;][$i][&#39;opacity&#39;]</span>
<a name="l00232"></a>00232 <span class="comment">      );</span>
<a name="l00233"></a>00233 <span class="comment">      array_push($this-&gt;mpdf_ref-&gt;gradients[$n][&#39;color&#39;],$color);</span>
<a name="l00234"></a>00234 <span class="comment">    }</span>
<a name="l00235"></a>00235 <span class="comment">*/</span>
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     $return .= <span class="stringliteral">&#39;/Sh&#39;</span>.count($this-&gt;mpdf_ref-&gt;gradients).<span class="stringliteral">&#39; sh Q &#39;</span>;
<a name="l00238"></a>00238     <span class="keywordflow">return</span> $return;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   function svgOffset ($attribs){
<a name="l00243"></a>00243     <span class="comment">// save all &lt;svg&gt; tag attributes</span>
<a name="l00244"></a>00244     $this-&gt;svg_attribs = $attribs;
<a name="l00245"></a>00245     <span class="keywordflow">if</span>(isset($this-&gt;svg_attribs[<span class="stringliteral">&#39;viewBox&#39;</span>])) {
<a name="l00246"></a>00246       $vb = preg_split(<span class="stringliteral">&#39;/\s+/is&#39;</span>, trim($this-&gt;svg_attribs[<span class="stringliteral">&#39;viewBox&#39;</span>]));
<a name="l00247"></a>00247       <span class="keywordflow">if</span> (count($vb)==4) {
<a name="l00248"></a>00248         $this-&gt;svg_info[<span class="charliteral">&#39;x&#39;</span>] = $vb[0];
<a name="l00249"></a>00249         $this-&gt;svg_info[<span class="charliteral">&#39;y&#39;</span>] = $vb[1];
<a name="l00250"></a>00250         $this-&gt;svg_info[<span class="charliteral">&#39;w&#39;</span>] = $vb[2];
<a name="l00251"></a>00251         $this-&gt;svg_info[<span class="charliteral">&#39;h&#39;</span>] = $vb[3];
<a name="l00252"></a>00252         <span class="keywordflow">return</span>;
<a name="l00253"></a>00253       }
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     $svg_w = $this-&gt;mpdf_ref-&gt;ConvertSize($attribs[<span class="stringliteral">&#39;width&#39;</span>]); <span class="comment">// mm (interprets numbers as pixels)</span>
<a name="l00257"></a>00257     $svg_h = $this-&gt;mpdf_ref-&gt;ConvertSize($attribs[<span class="stringliteral">&#39;height&#39;</span>]);  <span class="comment">// mm</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="comment">// Added to handle file without height or width specified</span>
<a name="l00260"></a>00260     <span class="keywordflow">if</span> (!$svg_w &amp;&amp; !$svg_h) { $svg_w = $svg_h = $this-&gt;mpdf_ref-&gt;blk[$this-&gt;mpdf_ref-&gt;blklvl][<span class="stringliteral">&#39;inner_width&#39;</span>] ; }  <span class="comment">// DEFAULT</span>
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (!$svg_w) { $svg_w = $svg_h; }
<a name="l00262"></a>00262     <span class="keywordflow">if</span> (!$svg_h) { $svg_h = $svg_w; }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     $this-&gt;svg_info[<span class="charliteral">&#39;x&#39;</span>] = 0;
<a name="l00265"></a>00265     $this-&gt;svg_info[<span class="charliteral">&#39;y&#39;</span>] = 0;
<a name="l00266"></a>00266     $this-&gt;svg_info[<span class="charliteral">&#39;w&#39;</span>] = $svg_w/0.2645; <span class="comment">// mm-&gt;pixels</span>
<a name="l00267"></a>00267     $this-&gt;svg_info[<span class="charliteral">&#39;h&#39;</span>] = $svg_h/0.2645; <span class="comment">// mm-&gt;pixels</span>
<a name="l00268"></a>00268   }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="comment">//</span>
<a name="l00272"></a>00272   <span class="comment">// check if points are within svg, if not, set to max</span>
<a name="l00273"></a>00273   function svg_overflow($x,$y)
<a name="l00274"></a>00274   {
<a name="l00275"></a>00275     $x2 = $x;
<a name="l00276"></a>00276     $y2 = $y;
<a name="l00277"></a>00277     <span class="keywordflow">if</span>(isset($this-&gt;svg_attribs[<span class="stringliteral">&#39;overflow&#39;</span>]))
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279       <span class="keywordflow">if</span>($this-&gt;svg_attribs[<span class="stringliteral">&#39;overflow&#39;</span>] == <span class="stringliteral">&#39;hidden&#39;</span>)
<a name="l00280"></a>00280       {
<a name="l00281"></a>00281         <span class="comment">// Not sure if this is supposed to strip off units, but since I dont use any I will omlt this step</span>
<a name="l00282"></a>00282         $svg_w = preg_replace(<span class="stringliteral">&quot;/([0-9\.]*)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$1&quot;</span>,$this-&gt;svg_attribs[<span class="stringliteral">&#39;width&#39;</span>]);
<a name="l00283"></a>00283         $svg_h = preg_replace(<span class="stringliteral">&quot;/([0-9\.]*)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$1&quot;</span>,$this-&gt;svg_attribs[<span class="stringliteral">&#39;height&#39;</span>]);
<a name="l00284"></a>00284         
<a name="l00285"></a>00285         <span class="comment">// $xmax = floor($this-&gt;svg_attribs[&#39;width&#39;]);</span>
<a name="l00286"></a>00286         $xmax = floor($svg_w);
<a name="l00287"></a>00287         $xmin = 0;
<a name="l00288"></a>00288         <span class="comment">// $ymax = floor(($this-&gt;svg_attribs[&#39;height&#39;] * -1));</span>
<a name="l00289"></a>00289         $ymax = floor(($svg_h * -1));
<a name="l00290"></a>00290         $ymin = 0;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292         <span class="keywordflow">if</span>($x &gt; $xmax) $x2 = $xmax; <span class="comment">// right edge</span>
<a name="l00293"></a>00293         <span class="keywordflow">if</span>($x &lt; $xmin) $x2 = $xmin; <span class="comment">// left edge</span>
<a name="l00294"></a>00294         <span class="keywordflow">if</span>($y &lt; $ymax) $y2 = $ymax; <span class="comment">// bottom </span>
<a name="l00295"></a>00295         <span class="keywordflow">if</span>($y &gt; $ymin) $y2 = $ymin; <span class="comment">// top </span>
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       }
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keywordflow">return</span> array( <span class="charliteral">&#39;x&#39;</span> =&gt; $x2, <span class="charliteral">&#39;y&#39;</span> =&gt; $y2);
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   function svgDefineStyle($critere_style){
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     $tmp = count($this-&gt;svg_style)-1;
<a name="l00309"></a>00309     $current_style = $this-&gt;svg_style[$tmp];
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     unset($current_style[<span class="stringliteral">&#39;transformations&#39;</span>]);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">// TRANSFORM SCALE</span>
<a name="l00314"></a>00314     $transformations = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00315"></a>00315     <span class="keywordflow">if</span> (isset($critere_style[<span class="stringliteral">&#39;transform&#39;</span>])){
<a name="l00316"></a>00316       preg_match_all(<span class="stringliteral">&#39;/(matrix|translate|scale|rotate|skewX|skewY)\((.*?)\)/is&#39;</span>,$critere_style[<span class="stringliteral">&#39;transform&#39;</span>],$m);
<a name="l00317"></a>00317       <span class="keywordflow">if</span> (count($m[0])) {
<a name="l00318"></a>00318         <span class="keywordflow">for</span>($i=0; $i&lt;count($m[0]); $i++) {
<a name="l00319"></a>00319           $c = strtolower($m[1][$i]);
<a name="l00320"></a>00320           $v = trim($m[2][$i]);
<a name="l00321"></a>00321           $vv = preg_split(<span class="stringliteral">&#39;/[ ,]+/&#39;</span>,$v);
<a name="l00322"></a>00322           <span class="keywordflow">if</span> ($c==<span class="stringliteral">&#39;matrix&#39;</span> &amp;&amp; count($vv)==6) {
<a name="l00323"></a>00323             $transformations .= sprintf(<span class="stringliteral">&#39; %.3f %.3f %.3f %.3f %.3f %.3f cm &#39;</span>, $vv[0], $vv[1], $vv[2], $vv[3], $vv[4], $vv[5]);
<a name="l00324"></a>00324           }
<a name="l00325"></a>00325           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($c==<span class="stringliteral">&#39;translate&#39;</span> &amp;&amp; count($vv)) {
<a name="l00326"></a>00326             $tm[4] = $vv[0];
<a name="l00327"></a>00327             <span class="keywordflow">if</span> (count($vv)==2) { $t_y = -$vv[1]; }
<a name="l00328"></a>00328             <span class="keywordflow">else</span> { $t_y = 0; }
<a name="l00329"></a>00329             $tm[5] = $t_y;
<a name="l00330"></a>00330             $transformations .= sprintf(<span class="stringliteral">&#39; 1 0 0 1 %.3f %.3f cm &#39;</span>, $tm[4], $tm[5]);
<a name="l00331"></a>00331           }
<a name="l00332"></a>00332           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($c==<span class="stringliteral">&#39;scale&#39;</span> &amp;&amp; count($vv)) {
<a name="l00333"></a>00333             <span class="keywordflow">if</span> (count($vv)==2) { $s_y = $vv[1]; }
<a name="l00334"></a>00334             <span class="keywordflow">else</span> { $s_y = $vv[0]; }
<a name="l00335"></a>00335             $tm[0] = $vv[0];
<a name="l00336"></a>00336             $tm[3] = $s_y;
<a name="l00337"></a>00337             $transformations .= sprintf(<span class="stringliteral">&#39; %.3f 0 0 %.3f 0 0 cm &#39;</span>, $tm[0], $tm[3]);
<a name="l00338"></a>00338           }
<a name="l00339"></a>00339           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($c==<span class="stringliteral">&#39;rotate&#39;</span> &amp;&amp; count($vv)) {
<a name="l00340"></a>00340             $tm[0] = cos(deg2rad(-$vv[0]));
<a name="l00341"></a>00341             $tm[1] = sin(deg2rad(-$vv[0]));
<a name="l00342"></a>00342             $tm[2] = -$tm[1];
<a name="l00343"></a>00343             $tm[3] = $tm[0];
<a name="l00344"></a>00344             <span class="keywordflow">if</span> (count($vv)==3) {
<a name="l00345"></a>00345               $transformations .= sprintf(<span class="stringliteral">&#39; 1 0 0 1 %.3f %.3f cm &#39;</span>, $vv[1], -$vv[2]);
<a name="l00346"></a>00346             }
<a name="l00347"></a>00347             $transformations .= sprintf(<span class="stringliteral">&#39; %.3f %.3f %.3f %.3f 0 0 cm &#39;</span>, $tm[0], $tm[1], $tm[2], $tm[3]);
<a name="l00348"></a>00348             <span class="keywordflow">if</span> (count($vv)==3) {
<a name="l00349"></a>00349               $transformations .= sprintf(<span class="stringliteral">&#39; 1 0 0 1 %.3f %.3f cm &#39;</span>, -$vv[1], $vv[2]);
<a name="l00350"></a>00350             }
<a name="l00351"></a>00351           }
<a name="l00352"></a>00352           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($c==<span class="stringliteral">&#39;skewx&#39;</span> &amp;&amp; count($vv)) {
<a name="l00353"></a>00353             $tm[2] = tan(deg2rad(-$vv[0]));
<a name="l00354"></a>00354             $transformations .= sprintf(<span class="stringliteral">&#39; 1 0 %.3f 1 0 0 cm &#39;</span>, $tm[2]);
<a name="l00355"></a>00355           }
<a name="l00356"></a>00356           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($c==<span class="stringliteral">&#39;skewy&#39;</span> &amp;&amp; count($vv)) {
<a name="l00357"></a>00357             $tm[1] = tan(deg2rad(-$vv[0]));
<a name="l00358"></a>00358             $transformations .= sprintf(<span class="stringliteral">&#39; 1 %.3f 0 1 0 0 cm &#39;</span>, $tm[1]);
<a name="l00359"></a>00359           }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362       }
<a name="l00363"></a>00363       $current_style[<span class="stringliteral">&#39;transformations&#39;</span>] = $transformations;
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="keywordflow">if</span> (isset($critere_style[<span class="stringliteral">&#39;style&#39;</span>])){
<a name="l00367"></a>00367       <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/fill:\s*rgb\((\d+),\s*(\d+),\s*(\d+)\)/&#39;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>], $m)) {
<a name="l00368"></a>00368         $current_style[<span class="stringliteral">&#39;fill&#39;</span>] = <span class="charliteral">&#39;#&#39;</span>.str_pad(dechex($m[1]), 2, <span class="stringliteral">&quot;0&quot;</span>, STR_PAD_LEFT).str_pad(dechex($m[2]), 2, <span class="stringliteral">&quot;0&quot;</span>, STR_PAD_LEFT).str_pad(dechex($m[3]), 2, <span class="stringliteral">&quot;0&quot;</span>, STR_PAD_LEFT);
<a name="l00369"></a>00369       }
<a name="l00370"></a>00370       <span class="keywordflow">else</span> { $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)fill:\s*([a-z0-9#]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00371"></a>00371         <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;fill&#39;</span>] = $tmp; }
<a name="l00372"></a>00372       }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)fill-opacity:\s*([a-z0-9.]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00375"></a>00375       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;fill-opacity&#39;</span>] = $tmp;}
<a name="l00376"></a>00376 
<a name="l00377"></a>00377       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)fill-rule:\s*([a-z0-9#]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00378"></a>00378       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;fill-rule&#39;</span>] = $tmp;}
<a name="l00379"></a>00379 
<a name="l00380"></a>00380       <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/stroke:\s*rgb\((\d+),\s*(\d+),\s*(\d+)\)/&#39;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>], $m)) {
<a name="l00381"></a>00381         $current_style[<span class="stringliteral">&#39;stroke&#39;</span>] = <span class="charliteral">&#39;#&#39;</span>.str_pad(dechex($m[1]), 2, <span class="stringliteral">&quot;0&quot;</span>, STR_PAD_LEFT).str_pad(dechex($m[2]), 2, <span class="stringliteral">&quot;0&quot;</span>, STR_PAD_LEFT).str_pad(dechex($m[3]), 2, <span class="stringliteral">&quot;0&quot;</span>, STR_PAD_LEFT);
<a name="l00382"></a>00382       }
<a name="l00383"></a>00383       <span class="keywordflow">else</span> { $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)stroke:\s*([a-z0-9#]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00384"></a>00384         <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;stroke&#39;</span>] = $tmp; }
<a name="l00385"></a>00385       }
<a name="l00386"></a>00386       
<a name="l00387"></a>00387       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)stroke-linecap:\s*([a-z0-9#]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00388"></a>00388       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;stroke-linecap&#39;</span>] = $tmp;}
<a name="l00389"></a>00389 
<a name="l00390"></a>00390       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)stroke-linejoin:\s*([a-z0-9#]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00391"></a>00391       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;stroke-linejoin&#39;</span>] = $tmp;}
<a name="l00392"></a>00392       
<a name="l00393"></a>00393       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)stroke-miterlimit:\s*([a-z0-9#]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00394"></a>00394       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;stroke-miterlimit&#39;</span>] = $tmp;}
<a name="l00395"></a>00395       
<a name="l00396"></a>00396       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)stroke-opacity:\s*([a-z0-9.]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00397"></a>00397       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;stroke-opacity&#39;</span>] = $tmp; }
<a name="l00398"></a>00398       
<a name="l00399"></a>00399       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)stroke-width:\s*([a-z0-9.]*|none)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l00400"></a>00400       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;style&#39;</span>]){ $current_style[<span class="stringliteral">&#39;stroke-width&#39;</span>] = $tmp;}
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;fill&#39;</span>])){
<a name="l00405"></a>00405       $current_style[<span class="stringliteral">&#39;fill&#39;</span>] = $critere_style[<span class="stringliteral">&#39;fill&#39;</span>];
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;fill-opacity&#39;</span>])){
<a name="l00409"></a>00409       $current_style[<span class="stringliteral">&#39;fill-opacity&#39;</span>] = $critere_style[<span class="stringliteral">&#39;fill-opacity&#39;</span>];
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;fill-rule&#39;</span>])){
<a name="l00413"></a>00413       $current_style[<span class="stringliteral">&#39;fill-rule&#39;</span>] = $critere_style[<span class="stringliteral">&#39;fill-rule&#39;</span>];
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;stroke&#39;</span>])){
<a name="l00417"></a>00417       $current_style[<span class="stringliteral">&#39;stroke&#39;</span>] = $critere_style[<span class="stringliteral">&#39;stroke&#39;</span>];
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;stroke-linecap&#39;</span>])){
<a name="l00421"></a>00421       $current_style[<span class="stringliteral">&#39;stroke-linecap&#39;</span>] = $critere_style[<span class="stringliteral">&#39;stroke-linecap&#39;</span>];
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;stroke-linejoin&#39;</span>])){
<a name="l00425"></a>00425       $current_style[<span class="stringliteral">&#39;stroke-linejoin&#39;</span>] = $critere_style[<span class="stringliteral">&#39;stroke-linejoin&#39;</span>];
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;stroke-miterlimit&#39;</span>])){
<a name="l00429"></a>00429       $current_style[<span class="stringliteral">&#39;stroke-miterlimit&#39;</span>] = $critere_style[<span class="stringliteral">&#39;stroke-miterlimit&#39;</span>];
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;stroke-opacity&#39;</span>])){
<a name="l00433"></a>00433       $current_style[<span class="stringliteral">&#39;stroke-opacity&#39;</span>] = $critere_style[<span class="stringliteral">&#39;stroke-opacity&#39;</span>];
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;stroke-width&#39;</span>])){
<a name="l00437"></a>00437       $current_style[<span class="stringliteral">&#39;stroke-width&#39;</span>] = $critere_style[<span class="stringliteral">&#39;stroke-width&#39;</span>];
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="keywordflow">return</span> $current_style;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442   }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="comment">//</span>
<a name="l00445"></a>00445   <span class="comment">//  Cette fonction ecrit le style dans le stream svg.</span>
<a name="l00446"></a>00446   function svgStyle($critere_style, $attribs, $element){
<a name="l00447"></a>00447     $path_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="keywordflow">if</span> (substr_count($critere_style[<span class="stringliteral">&#39;fill&#39;</span>],<span class="stringliteral">&#39;url&#39;</span>)&gt;0){
<a name="l00450"></a>00450       <span class="comment">//</span>
<a name="l00451"></a>00451       <span class="comment">// couleur degradé</span>
<a name="l00452"></a>00452       $id_gradient = preg_replace(<span class="stringliteral">&quot;/url\(#([\w_]*)\)/i&quot;</span>,<span class="stringliteral">&quot;$1&quot;</span>,$critere_style[<span class="stringliteral">&#39;fill&#39;</span>]);
<a name="l00453"></a>00453       <span class="keywordflow">if</span> ($id_gradient != $critere_style[<span class="stringliteral">&#39;fill&#39;</span>]) {
<a name="l00454"></a>00454         $fill_gradient = $this-&gt;svgGradient($this-&gt;svg_gradient[$id_gradient], $attribs, $element);
<a name="l00455"></a>00455 
<a name="l00456"></a>00456         $path_style = <span class="stringliteral">&quot;q &quot;</span>;
<a name="l00457"></a>00457         $w = <span class="stringliteral">&quot;W&quot;</span>;
<a name="l00458"></a>00458         $style .= <span class="charliteral">&#39;N&#39;</span>;
<a name="l00459"></a>00459       }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;fill&#39;</span>] != <span class="stringliteral">&#39;none&#39;</span>){
<a name="l00463"></a>00463       <span class="comment">//  fill couleur pleine</span>
<a name="l00464"></a>00464       $col = $this-&gt;mpdf_ref-&gt;ConvertColor($critere_style[<span class="stringliteral">&#39;fill&#39;</span>]);
<a name="l00465"></a>00465       <span class="keywordflow">if</span> ($col) {
<a name="l00466"></a>00466         $path_style .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f rg &#39;</span>,$col[<span class="charliteral">&#39;R&#39;</span>]/255,$col[<span class="charliteral">&#39;G&#39;</span>]/255,$col[<span class="charliteral">&#39;B&#39;</span>]/255);
<a name="l00467"></a>00467         $style .= <span class="charliteral">&#39;F&#39;</span>;
<a name="l00468"></a>00468       }
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke&#39;</span>] != <span class="stringliteral">&#39;none&#39;</span>){
<a name="l00472"></a>00472       $col = $this-&gt;mpdf_ref-&gt;ConvertColor($critere_style[<span class="stringliteral">&#39;stroke&#39;</span>]);
<a name="l00473"></a>00473       <span class="keywordflow">if</span> ($col) {
<a name="l00474"></a>00474         $path_style .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f RG &#39;</span>,$col[<span class="charliteral">&#39;R&#39;</span>]/255,$col[<span class="charliteral">&#39;G&#39;</span>]/255,$col[<span class="charliteral">&#39;B&#39;</span>]/255);
<a name="l00475"></a>00475         $style .= <span class="charliteral">&#39;D&#39;</span>;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         $path_style .= sprintf(<span class="stringliteral">&#39;%.3f w &#39;</span>,$critere_style[<span class="stringliteral">&#39;stroke-width&#39;</span>]);
<a name="l00478"></a>00478       }
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 
<a name="l00482"></a>00482   <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke&#39;</span>] != <span class="stringliteral">&#39;none&#39;</span>){
<a name="l00483"></a>00483     <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke-linejoin&#39;</span>] == <span class="stringliteral">&#39;miter&#39;</span>){
<a name="l00484"></a>00484       $path_style .= <span class="stringliteral">&#39; 0 j &#39;</span>;
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke-linejoin&#39;</span>] == <span class="stringliteral">&#39;round&#39;</span>){
<a name="l00487"></a>00487       $path_style .= <span class="stringliteral">&#39; 1 j &#39;</span>;
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke-linejoin&#39;</span>] == <span class="stringliteral">&#39;bevel&#39;</span>){
<a name="l00490"></a>00490       $path_style .= <span class="stringliteral">&#39; 2 j &#39;</span>;
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke-linecap&#39;</span>] == <span class="stringliteral">&#39;butt&#39;</span>){
<a name="l00494"></a>00494       $path_style .= <span class="stringliteral">&#39; 0 J &#39;</span>;
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke-linecap&#39;</span>] == <span class="stringliteral">&#39;round&#39;</span>){
<a name="l00497"></a>00497       $path_style .= <span class="stringliteral">&#39; 1 J &#39;</span>;
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke-linecap&#39;</span>] == <span class="stringliteral">&#39;square&#39;</span>){
<a name="l00500"></a>00500       $path_style .= <span class="stringliteral">&#39; 2 J &#39;</span>;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="keywordflow">if</span> (isset($critere_style[<span class="stringliteral">&#39;stroke-miterlimit&#39;</span>])){
<a name="l00504"></a>00504       $path_style .= sprintf(<span class="stringliteral">&#39;%.2f M &#39;</span>,$critere_style[<span class="stringliteral">&#39;stroke-miterlimit&#39;</span>]);
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506   }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;fill-opacity&#39;</span>] &gt; 0 &amp;&amp; $critere_style[<span class="stringliteral">&#39;fill-opacity&#39;</span>] &lt;= 1){
<a name="l00510"></a>00510       $gs = $this-&gt;mpdf_ref-&gt;AddExtGState(array(<span class="stringliteral">&#39;ca&#39;</span>=&gt;$critere_style[<span class="stringliteral">&#39;fill-opacity&#39;</span>], <span class="stringliteral">&#39;BM&#39;</span>=&gt;<span class="stringliteral">&#39;/Normal&#39;</span>));
<a name="l00511"></a>00511       $path_style .= sprintf(<span class="stringliteral">&#39; /GS%d gs &#39;</span>, $gs);
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="keywordflow">if</span> ($critere_style[<span class="stringliteral">&#39;stroke-opacity&#39;</span>] &gt; 0 &amp;&amp; $critere_style[<span class="stringliteral">&#39;stroke-opacity&#39;</span>] &lt;= 1){ 
<a name="l00515"></a>00515       $gs = $this-&gt;mpdf_ref-&gt;AddExtGState(array(<span class="stringliteral">&#39;CA&#39;</span>=&gt;$critere_style[<span class="stringliteral">&#39;stroke-opacity&#39;</span>], <span class="stringliteral">&#39;BM&#39;</span>=&gt;<span class="stringliteral">&#39;/Normal&#39;</span>));
<a name="l00516"></a>00516       $path_style .= sprintf(<span class="stringliteral">&#39; /GS%d gs &#39;</span>, $gs);
<a name="l00517"></a>00517     }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">switch</span> ($style){
<a name="l00520"></a>00520       <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>:
<a name="l00521"></a>00521         $op = <span class="charliteral">&#39;f&#39;</span>;
<a name="l00522"></a>00522       <span class="keywordflow">break</span>;
<a name="l00523"></a>00523       <span class="keywordflow">case</span> <span class="stringliteral">&#39;FD&#39;</span>:
<a name="l00524"></a>00524         $op = <span class="charliteral">&#39;B&#39;</span>;
<a name="l00525"></a>00525       <span class="keywordflow">break</span>;
<a name="l00526"></a>00526       <span class="keywordflow">case</span> <span class="stringliteral">&#39;ND&#39;</span>:
<a name="l00527"></a>00527         $op = <span class="charliteral">&#39;S&#39;</span>;
<a name="l00528"></a>00528       <span class="keywordflow">break</span>;
<a name="l00529"></a>00529       <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:
<a name="l00530"></a>00530         $op = <span class="charliteral">&#39;S&#39;</span>;
<a name="l00531"></a>00531       <span class="keywordflow">break</span>;
<a name="l00532"></a>00532       <span class="keywordflow">default</span>:
<a name="l00533"></a>00533         $op = <span class="charliteral">&#39;n&#39;</span>;
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     $final_style = <span class="stringliteral">&quot;$path_style $w $op $fill_gradient \n&quot;</span>;
<a name="l00537"></a>00537     <span class="comment">// echo &#39;svgStyle: &#39;. $final_style .&#39;&lt;br&gt;&lt;br&gt;&#39;;</span>
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="keywordflow">return</span> $final_style;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541   }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   <span class="comment">//</span>
<a name="l00544"></a>00544   <span class="comment">//  fonction retracant les &lt;path /&gt;</span>
<a name="l00545"></a>00545   function svgPath($command, $arguments){
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     global $xbase, $ybase;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     $path_cmd = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     preg_match_all(<span class="stringliteral">&#39;/[\-^]?[\d.]+/&#39;</span>, $arguments, $a, PREG_SET_ORDER);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     <span class="comment">//  if the command is a capital letter, the coords go absolute, otherwise relative</span>
<a name="l00556"></a>00556     <span class="keywordflow">if</span>(strtolower($command) == $command) $relative = <span class="keyword">true</span>;
<a name="l00557"></a>00557     <span class="keywordflow">else</span> $relative = <span class="keyword">false</span>;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     $ile_argumentow = count($a);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="comment">//  each command may have different needs for arguments [1 to 8]</span>
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="keywordflow">switch</span>(strtolower($command)){
<a name="l00565"></a>00565       <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>: <span class="comment">// move</span>
<a name="l00566"></a>00566         <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i+=2){
<a name="l00567"></a>00567           $x = $a[$i][0]; 
<a name="l00568"></a>00568           $y = $a[$i+1][0]; 
<a name="l00569"></a>00569           <span class="keywordflow">if</span>($relative){
<a name="l00570"></a>00570             $pdfx = ($xbase + $x);
<a name="l00571"></a>00571             $pdfy = ($ybase - $y);
<a name="l00572"></a>00572             $xbase += $x;
<a name="l00573"></a>00573             $ybase += -$y;
<a name="l00574"></a>00574           }
<a name="l00575"></a>00575           <span class="keywordflow">else</span>{
<a name="l00576"></a>00576             $pdfx = $x;
<a name="l00577"></a>00577             $pdfy =  -$y ;
<a name="l00578"></a>00578             $xbase = $x;
<a name="l00579"></a>00579             $ybase = -$y;
<a name="l00580"></a>00580           }
<a name="l00581"></a>00581           $pdf_pt = $this-&gt;svg_overflow($pdfx,$pdfy);
<a name="l00582"></a>00582           <span class="keywordflow">if</span>($i == 0) $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f m &#39;</span>, $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00583"></a>00583           <span class="keywordflow">else</span> $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>,  $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585       <span class="keywordflow">break</span>;
<a name="l00586"></a>00586       <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>: <span class="comment">// a simple line</span>
<a name="l00587"></a>00587         <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i+=2){
<a name="l00588"></a>00588           $x = ($a[$i][0]); 
<a name="l00589"></a>00589           $y = ($a[$i+1][0]); 
<a name="l00590"></a>00590           <span class="keywordflow">if</span>($relative){
<a name="l00591"></a>00591             $pdfx = ($xbase + $x);
<a name="l00592"></a>00592             $pdfy = ($ybase - $y);
<a name="l00593"></a>00593             $xbase += $x;
<a name="l00594"></a>00594             $ybase += -$y;
<a name="l00595"></a>00595           }
<a name="l00596"></a>00596           <span class="keywordflow">else</span>{
<a name="l00597"></a>00597             $pdfx = $x ;
<a name="l00598"></a>00598             $pdfy =  -$y ;
<a name="l00599"></a>00599             $xbase = $x;
<a name="l00600"></a>00600             $ybase = -$y;
<a name="l00601"></a>00601           }
<a name="l00602"></a>00602           $pdf_pt = $this-&gt;svg_overflow($pdfx,$pdfy);
<a name="l00603"></a>00603           $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>,  $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605       <span class="keywordflow">break</span>;
<a name="l00606"></a>00606       <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>: <span class="comment">// a very simple horizontal line</span>
<a name="l00607"></a>00607         <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i++){
<a name="l00608"></a>00608           $x = ($a[$i][0]); 
<a name="l00609"></a>00609           <span class="keywordflow">if</span>($relative){
<a name="l00610"></a>00610             $y = 0;
<a name="l00611"></a>00611             $pdfx = ($xbase + $x) ;
<a name="l00612"></a>00612             $pdfy = ($ybase - $y) ;
<a name="l00613"></a>00613             $xbase += $x;
<a name="l00614"></a>00614             $ybase += -$y;
<a name="l00615"></a>00615           }
<a name="l00616"></a>00616           <span class="keywordflow">else</span>{
<a name="l00617"></a>00617             $y = -$ybase;
<a name="l00618"></a>00618             $pdfx = $x;
<a name="l00619"></a>00619             $pdfy =  -$y;
<a name="l00620"></a>00620             $xbase = $x;
<a name="l00621"></a>00621             $ybase = -$y;
<a name="l00622"></a>00622           }
<a name="l00623"></a>00623           $pdf_pt = $this-&gt;svg_overflow($pdfx,$pdfy);
<a name="l00624"></a>00624           $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626       <span class="keywordflow">break</span>;
<a name="l00627"></a>00627       <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: <span class="comment">// the simplest line, vertical</span>
<a name="l00628"></a>00628         <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i++){
<a name="l00629"></a>00629           $y = ($a[$i][0]); 
<a name="l00630"></a>00630           <span class="keywordflow">if</span>($relative){
<a name="l00631"></a>00631             $x = 0;
<a name="l00632"></a>00632             $pdfx = ($xbase + $x);
<a name="l00633"></a>00633             $pdfy = ($ybase - $y);
<a name="l00634"></a>00634             $xbase += $x;
<a name="l00635"></a>00635             $ybase += -$y;
<a name="l00636"></a>00636           }
<a name="l00637"></a>00637           <span class="keywordflow">else</span>{
<a name="l00638"></a>00638             $x = $xbase;
<a name="l00639"></a>00639             $pdfx = $x;
<a name="l00640"></a>00640             $pdfy =  -$y;
<a name="l00641"></a>00641             $xbase = $x;
<a name="l00642"></a>00642             $ybase = -$y;
<a name="l00643"></a>00643           }
<a name="l00644"></a>00644           $pdf_pt = $this-&gt;svg_overflow($pdfx,$pdfy);
<a name="l00645"></a>00645           $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647       <span class="keywordflow">break</span>;
<a name="l00648"></a>00648       <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: <span class="comment">// bezier with first vertex equal first control</span>
<a name="l00649"></a>00649          <span class="keywordflow">if</span> ($this-&gt;lastcommand == <span class="charliteral">&#39;C&#39;</span> || $this-&gt;lastcommand == <span class="charliteral">&#39;c&#39;</span>) {
<a name="l00650"></a>00650 
<a name="l00651"></a>00651         <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i += 4){
<a name="l00652"></a>00652           $x1 = $this-&gt;lastcontrolpoints[0];
<a name="l00653"></a>00653           $y1 = $this-&gt;lastcontrolpoints[1];
<a name="l00654"></a>00654           $x2 = ($a[$i][0]); 
<a name="l00655"></a>00655           $y2 = ($a[$i+1][0]); 
<a name="l00656"></a>00656           $x = ($a[$i+2][0]); 
<a name="l00657"></a>00657           $y = ($a[$i+3][0]); 
<a name="l00658"></a>00658           <span class="keywordflow">if</span>($relative){
<a name="l00659"></a>00659             $pdfx1 = ($xbase + $x1);
<a name="l00660"></a>00660             $pdfy1 = ($ybase - $y1);
<a name="l00661"></a>00661             $pdfx2 = ($xbase + $x2);
<a name="l00662"></a>00662             $pdfy2 = ($ybase - $y2);
<a name="l00663"></a>00663             $pdfx = ($xbase + $x);
<a name="l00664"></a>00664             $pdfy = ($ybase - $y);
<a name="l00665"></a>00665             $xbase += $x;
<a name="l00666"></a>00666             $ybase += -$y;
<a name="l00667"></a>00667           }
<a name="l00668"></a>00668           <span class="keywordflow">else</span>{
<a name="l00669"></a>00669             $pdfx1 = $xbase + $x1;
<a name="l00670"></a>00670             $pdfy1 = $ybase -$y1;
<a name="l00671"></a>00671             $pdfx2 = $x2;
<a name="l00672"></a>00672             $pdfy2 = -$y2;
<a name="l00673"></a>00673             $pdfx = $x;
<a name="l00674"></a>00674             $pdfy =  -$y;
<a name="l00675"></a>00675             $xbase = $x;
<a name="l00676"></a>00676             $ybase = -$y;
<a name="l00677"></a>00677           }
<a name="l00678"></a>00678           $this-&gt;lastcontrolpoints = array(($x-$x1),($y-$y1));
<a name="l00679"></a>00679           <span class="comment">// $pdf_pt2 = $this-&gt;svg_overflow($pdfx2,$pdfy2);</span>
<a name="l00680"></a>00680           <span class="comment">// $pdf_pt1 = $this-&gt;svg_overflow($pdfx1,$pdfy1);</span>
<a name="l00681"></a>00681           $pdf_pt = $this-&gt;svg_overflow($pdfx,$pdfy);
<a name="l00682"></a>00682           <span class="keywordflow">if</span>( ($pdf_pt[<span class="charliteral">&#39;x&#39;</span>] != $pdfx) || ($pdf_pt[<span class="charliteral">&#39;y&#39;</span>] != $pdfy) )
<a name="l00683"></a>00683           {
<a name="l00684"></a>00684             $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>,  $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00685"></a>00685           }
<a name="l00686"></a>00686           <span class="keywordflow">else</span>
<a name="l00687"></a>00687           {
<a name="l00688"></a>00688             $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $pdfx1, $pdfy1, $pdfx2, $pdfy2, $pdfx, $pdfy);
<a name="l00689"></a>00689           }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692          }
<a name="l00693"></a>00693       <span class="keywordflow">break</span>;
<a name="l00694"></a>00694       <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: <span class="comment">// bezier with second vertex equal second control</span>
<a name="l00695"></a>00695       <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i += 6){
<a name="l00696"></a>00696           $x1 = ($a[$i][0]); 
<a name="l00697"></a>00697           $y1 = ($a[$i+1][0]); 
<a name="l00698"></a>00698           $x2 = ($a[$i+2][0]); 
<a name="l00699"></a>00699           $y2 = ($a[$i+3][0]); 
<a name="l00700"></a>00700           $x = ($a[$i+4][0]); 
<a name="l00701"></a>00701           $y = ($a[$i+5][0]); 
<a name="l00702"></a>00702           <span class="keywordflow">if</span>($relative){
<a name="l00703"></a>00703             $pdfx1 = ($xbase + $x1);
<a name="l00704"></a>00704             $pdfy1 = ($ybase - $y1);
<a name="l00705"></a>00705             $pdfx2 = ($xbase + $x2);
<a name="l00706"></a>00706             $pdfy2 = ($ybase - $y2);
<a name="l00707"></a>00707             $pdfx = ($xbase + $x);
<a name="l00708"></a>00708             $pdfy = ($ybase - $y);
<a name="l00709"></a>00709             $xbase += $x;
<a name="l00710"></a>00710             $ybase += -$y;
<a name="l00711"></a>00711           }
<a name="l00712"></a>00712           <span class="keywordflow">else</span>{
<a name="l00713"></a>00713             $pdfx1 = $x1;
<a name="l00714"></a>00714             $pdfy1 = -$y1;
<a name="l00715"></a>00715             $pdfx2 = $x2;
<a name="l00716"></a>00716             $pdfy2 = -$y2;
<a name="l00717"></a>00717             $pdfx = $x;
<a name="l00718"></a>00718             $pdfy =  -$y;
<a name="l00719"></a>00719             $xbase = $x;
<a name="l00720"></a>00720             $ybase = -$y;
<a name="l00721"></a>00721           }
<a name="l00722"></a>00722           $this-&gt;lastcontrolpoints = array(($x-$x2),($y-$y2));
<a name="l00723"></a>00723           <span class="comment">// $pdf_pt2 = $this-&gt;svg_overflow($pdfx2,$pdfy2);</span>
<a name="l00724"></a>00724           <span class="comment">// $pdf_pt1 = $this-&gt;svg_overflow($pdfx1,$pdfy1);</span>
<a name="l00725"></a>00725           $pdf_pt = $this-&gt;svg_overflow($pdfx,$pdfy);
<a name="l00726"></a>00726           <span class="keywordflow">if</span>( ($pdf_pt[<span class="charliteral">&#39;x&#39;</span>] != $pdfx) || ($pdf_pt[<span class="charliteral">&#39;y&#39;</span>] != $pdfy) )
<a name="l00727"></a>00727           {
<a name="l00728"></a>00728             $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>,  $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00729"></a>00729           }
<a name="l00730"></a>00730           <span class="keywordflow">else</span>
<a name="l00731"></a>00731           {
<a name="l00732"></a>00732             $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $pdfx1, $pdfy1, $pdfx2, $pdfy2, $pdfx, $pdfy);
<a name="l00733"></a>00733           }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735         }
<a name="l00736"></a>00736       <span class="keywordflow">break</span>;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738       <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>: <span class="comment">// bezier quadratic avec point de control</span>
<a name="l00739"></a>00739         <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i += 4){
<a name="l00740"></a>00740           $x1 = ($a[$i][0]); 
<a name="l00741"></a>00741           $y1 = ($a[$i+1][0]); 
<a name="l00742"></a>00742           $x = ($a[$i+2][0]); 
<a name="l00743"></a>00743           $y = ($a[$i+3][0]); 
<a name="l00744"></a>00744           <span class="keywordflow">if</span>($relative){
<a name="l00745"></a>00745 
<a name="l00746"></a>00746             $pdfx1 = ($xbase + ($x1*2/3));
<a name="l00747"></a>00747             $pdfy1 = ($ybase - ($y1*2/3));
<a name="l00748"></a>00748 
<a name="l00749"></a>00749             $pdfx2 = ($xbase + $x - ($x1*2/3));
<a name="l00750"></a>00750             $pdfy2 = ($ybase - $y - ($y1*2/3));
<a name="l00751"></a>00751 
<a name="l00752"></a>00752             $pdfx = ($xbase + $x);
<a name="l00753"></a>00753             $pdfy = ($ybase - $y);
<a name="l00754"></a>00754             $xbase += $x;
<a name="l00755"></a>00755             $ybase += -$y;
<a name="l00756"></a>00756           }
<a name="l00757"></a>00757           <span class="keywordflow">else</span>{
<a name="l00758"></a>00758             $pdfx1 = ($xbase+(($x1-$xbase)*2/3));
<a name="l00759"></a>00759             $pdfy1 = ($ybase-(($y1+$ybase)*2/3));
<a name="l00760"></a>00760 
<a name="l00761"></a>00761             $pdfx2 = ($x+(($x1-$x)*2/3));
<a name="l00762"></a>00762             $pdfy2 = (-$y-(($y1-$y)*2/3));
<a name="l00763"></a>00763 
<a name="l00764"></a>00764             $pdfx = $x;
<a name="l00765"></a>00765             $pdfy =  -$y;
<a name="l00766"></a>00766             $xbase = $x;
<a name="l00767"></a>00767             $ybase = -$y;
<a name="l00768"></a>00768           }
<a name="l00769"></a>00769           $this-&gt;lastcontrolpoints = array(($x-$x1),($y-$y1));
<a name="l00770"></a>00770 
<a name="l00771"></a>00771           <span class="comment">// $pdf_pt2 = $this-&gt;svg_overflow($pdfx2,$pdfy2);</span>
<a name="l00772"></a>00772           <span class="comment">// $pdf_pt1 = $this-&gt;svg_overflow($pdfx1,$pdfy1);</span>
<a name="l00773"></a>00773           $pdf_pt = $this-&gt;svg_overflow($pdfx,$pdfy);
<a name="l00774"></a>00774           <span class="keywordflow">if</span>( ($pdf_pt[<span class="charliteral">&#39;x&#39;</span>] != $pdfx) || ($pdf_pt[<span class="charliteral">&#39;y&#39;</span>] != $pdfy) )
<a name="l00775"></a>00775           {
<a name="l00776"></a>00776             $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>,  $pdf_pt[<span class="charliteral">&#39;x&#39;</span>], $pdf_pt[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l00777"></a>00777           }
<a name="l00778"></a>00778           <span class="keywordflow">else</span>
<a name="l00779"></a>00779           {
<a name="l00780"></a>00780             $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $pdfx1, $pdfy1, $pdfx2, $pdfy2, $pdfx, $pdfy);
<a name="l00781"></a>00781           }
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783       <span class="keywordflow">break</span>;
<a name="l00784"></a>00784       <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>: <span class="comment">// bezier quadratic avec point de control simetrique a lancien point de control</span>
<a name="l00785"></a>00785         <span class="keywordflow">if</span> ($this-&gt;lastcommand == <span class="charliteral">&#39;Q&#39;</span> || $this-&gt;lastcommand == <span class="charliteral">&#39;q&#39;</span> || $this-&gt;lastcommand == <span class="charliteral">&#39;T&#39;</span> || $this-&gt;lastcommand == <span class="charliteral">&#39;t&#39;</span>) {
<a name="l00786"></a>00786           $x = ($a[0][0]); 
<a name="l00787"></a>00787           $y = ($a[1][0]); 
<a name="l00788"></a>00788 
<a name="l00789"></a>00789           $x1 = $this-&gt;lastcontrolpoints[0];
<a name="l00790"></a>00790           $y1 = $this-&gt;lastcontrolpoints[1];
<a name="l00791"></a>00791 
<a name="l00792"></a>00792           <span class="keywordflow">if</span>($relative){
<a name="l00793"></a>00793             $pdfx = ($xbase + $x);
<a name="l00794"></a>00794             $pdfy = ($ybase - $y);
<a name="l00795"></a>00795 
<a name="l00796"></a>00796             $pdfx1 = ($xbase + ($x1*2/3));
<a name="l00797"></a>00797             $pdfy1 = ($ybase - ($y1*2/3));
<a name="l00798"></a>00798             $pdfx2 = ($xbase + $x - ($x1*2/3));
<a name="l00799"></a>00799             $pdfy2 = ($ybase -$y - ($y1*2/3));
<a name="l00800"></a>00800 
<a name="l00801"></a>00801             $xbase += $x;
<a name="l00802"></a>00802             $ybase += -$y;
<a name="l00803"></a>00803           }
<a name="l00804"></a>00804           <span class="keywordflow">else</span>{
<a name="l00805"></a>00805             $pdfx = $x;
<a name="l00806"></a>00806             $pdfy =  -$y;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808             $pdfx1 = ($xbase + ($x1*2/3));
<a name="l00809"></a>00809             $pdfy1 = ($ybase - ($y1*2/3));
<a name="l00810"></a>00810             $pdfx2 = ($x - ($x1*2/3));
<a name="l00811"></a>00811             $pdfy2 = (-$y - ($y1*2/3));
<a name="l00812"></a>00812 
<a name="l00813"></a>00813             $xbase = $x;
<a name="l00814"></a>00814             $ybase = -$y;
<a name="l00815"></a>00815           }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 
<a name="l00819"></a>00819 
<a name="l00820"></a>00820           $this-&gt;lastcontrolpoints = array(($x-$pdfx2),($y-$pdfy2));
<a name="l00821"></a>00821           $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $pdfx1, $pdfy1, $pdfx2, $pdfy2, $pdfx, $pdfy);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 
<a name="l00824"></a>00824         }
<a name="l00825"></a>00825         $this-&gt;lastcontrolpoints = array();
<a name="l00826"></a>00826       <span class="keywordflow">break</span>;
<a name="l00827"></a>00827       <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>: <span class="comment">// Elliptical arc</span>
<a name="l00828"></a>00828         <span class="keywordflow">for</span>($i = 0; $i&lt;$ile_argumentow; $i += 7){
<a name="l00829"></a>00829           $rx = ($a[$i][0]); 
<a name="l00830"></a>00830           $ry = ($a[$i+1][0]); 
<a name="l00831"></a>00831           $angle = ($a[$i+2][0]); <span class="comment">//x-axis-rotation </span>
<a name="l00832"></a>00832           $largeArcFlag = ($a[$i+3][0]); 
<a name="l00833"></a>00833           $sweepFlag = ($a[$i+4][0]); 
<a name="l00834"></a>00834           $x2 = ($a[$i+5][0]); 
<a name="l00835"></a>00835           $y2 = ($a[$i+6][0]); 
<a name="l00836"></a>00836           $x1 = $xbase;
<a name="l00837"></a>00837           $y1 = -$ybase;
<a name="l00838"></a>00838           <span class="keywordflow">if</span>($relative){
<a name="l00839"></a>00839             $x2 = $xbase + $x2;
<a name="l00840"></a>00840             $y2 = -$ybase + $y2;
<a name="l00841"></a>00841             $xbase += ($a[$i+5][0]); 
<a name="l00842"></a>00842             $ybase += -($a[$i+6][0]); 
<a name="l00843"></a>00843           }
<a name="l00844"></a>00844           <span class="keywordflow">else</span>{
<a name="l00845"></a>00845             $xbase = $x2;
<a name="l00846"></a>00846             $ybase = -$y2;
<a name="l00847"></a>00847           }
<a name="l00848"></a>00848           $path_cmd .= $this-&gt;Arcto($x1, $y1, $x2, $y2, $rx, $ry, $angle, $largeArcFlag, $sweepFlag);
<a name="l00849"></a>00849 
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851       <span class="keywordflow">break</span>;
<a name="l00852"></a>00852       <span class="keywordflow">case</span><span class="charliteral">&#39;z&#39;</span>:
<a name="l00853"></a>00853         $path_cmd .= <span class="stringliteral">&#39;h &#39;</span>;
<a name="l00854"></a>00854       <span class="keywordflow">break</span>;
<a name="l00855"></a>00855       <span class="keywordflow">default</span>:
<a name="l00856"></a>00856       <span class="keywordflow">break</span>;
<a name="l00857"></a>00857       }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     $this-&gt;lastcommand = $command;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="keywordflow">return</span> $path_cmd;
<a name="l00862"></a>00862 
<a name="l00863"></a>00863   }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 function Arcto($x1, $y1, $x2, $y2, $rx, $ry, $angle, $largeArcFlag, $sweepFlag) {
<a name="l00866"></a>00866 
<a name="l00867"></a>00867   <span class="comment">// 1. Treat out-of-range parameters as described in</span>
<a name="l00868"></a>00868   <span class="comment">// http://www.w3.org/TR/SVG/implnote.html#ArcImplementationNotes</span>
<a name="l00869"></a>00869   <span class="comment">// If the endpoints (x1, y1) and (x2, y2) are identical, then this</span>
<a name="l00870"></a>00870   <span class="comment">// is equivalent to omitting the elliptical arc segment entirely</span>
<a name="l00871"></a>00871   <span class="keywordflow">if</span> ($x1 == $x2 &amp;&amp; $y1 == $y2) <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873   <span class="comment">// If rX = 0 or rY = 0 then this arc is treated as a straight line</span>
<a name="l00874"></a>00874   <span class="comment">// segment (a &quot;lineto&quot;) joining the endpoints.</span>
<a name="l00875"></a>00875   <span class="keywordflow">if</span> ($rx == 0.0 || $ry == 0.0) {
<a name="l00876"></a>00876   <span class="comment">//   return Lineto(x2, y2); // ****</span>
<a name="l00877"></a>00877   }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879   <span class="comment">// If rX or rY have negative signs, these are dropped; the absolute</span>
<a name="l00880"></a>00880   <span class="comment">// value is used instead.</span>
<a name="l00881"></a>00881   <span class="keywordflow">if</span> ($rx&lt;0.0) $rx = -$rx;
<a name="l00882"></a>00882   <span class="keywordflow">if</span> ($ry&lt;0.0) $ry = -$ry;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   <span class="comment">// 2. convert to center parameterization as shown in</span>
<a name="l00885"></a>00885   <span class="comment">// http://www.w3.org/TR/SVG/implnote.html</span>
<a name="l00886"></a>00886   $sinPhi = sin(deg2rad($angle));
<a name="l00887"></a>00887   $cosPhi = cos(deg2rad($angle));
<a name="l00888"></a>00888 
<a name="l00889"></a>00889   $x1dash =  $cosPhi * ($x1-$x2)/2.0 + $sinPhi * ($y1-$y2)/2.0;
<a name="l00890"></a>00890   $y1dash = -$sinPhi * ($x1-$x2)/2.0 + $cosPhi * ($y1-$y2)/2.0;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 
<a name="l00893"></a>00893   $numerator = $rx*$rx*$ry*$ry - $rx*$rx*$y1dash*$y1dash - $ry*$ry*$x1dash*$x1dash;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895   <span class="keywordflow">if</span> ($numerator &lt; 0.0) { 
<a name="l00896"></a>00896     <span class="comment">//  If rX , rY and are such that there is no solution (basically,</span>
<a name="l00897"></a>00897     <span class="comment">//  the ellipse is not big enough to reach from (x1, y1) to (x2,</span>
<a name="l00898"></a>00898     <span class="comment">//  y2)) then the ellipse is scaled up uniformly until there is</span>
<a name="l00899"></a>00899     <span class="comment">//  exactly one solution (until the ellipse is just big enough).</span>
<a name="l00900"></a>00900 
<a name="l00901"></a>00901     <span class="comment">// -&gt; find factor s, such that numerator&#39; with rx&#39;=s*rx and</span>
<a name="l00902"></a>00902     <span class="comment">//    ry&#39;=s*ry becomes 0 :</span>
<a name="l00903"></a>00903     $s = sqrt(1.0 - $numerator/($rx*$rx*$ry*$ry));
<a name="l00904"></a>00904 
<a name="l00905"></a>00905     $rx *= $s;
<a name="l00906"></a>00906     $ry *= $s;
<a name="l00907"></a>00907     $root = 0.0;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   }
<a name="l00910"></a>00910   <span class="keywordflow">else</span> {
<a name="l00911"></a>00911     $root = ($largeArcFlag == $sweepFlag ? -1.0 : 1.0) * sqrt( $numerator/($rx*$rx*$y1dash*$y1dash+$ry*$ry*$x1dash*$x1dash) );
<a name="l00912"></a>00912   }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   $cxdash = $root*$rx*$y1dash/$ry;
<a name="l00915"></a>00915   $cydash = -$root*$ry*$x1dash/$rx;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   $cx = $cosPhi * $cxdash - $sinPhi * $cydash + ($x1+$x2)/2.0;
<a name="l00918"></a>00918   $cy = $sinPhi * $cxdash + $cosPhi * $cydash + ($y1+$y2)/2.0;
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 
<a name="l00921"></a>00921   $theta1 = $this-&gt;CalcVectorAngle(1.0, 0.0, ($x1dash-$cxdash)/$rx, ($y1dash-$cydash)/$ry);
<a name="l00922"></a>00922   $dtheta = $this-&gt;CalcVectorAngle(($x1dash-$cxdash)/$rx, ($y1dash-$cydash)/$ry, (-$x1dash-$cxdash)/$rx, (-$y1dash-$cydash)/$ry);
<a name="l00923"></a>00923   <span class="keywordflow">if</span> (!$sweepFlag &amp;&amp; $dtheta&gt;0)
<a name="l00924"></a>00924     $dtheta -= 2.0*M_PI;
<a name="l00925"></a>00925   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($sweepFlag &amp;&amp; $dtheta&lt;0)
<a name="l00926"></a>00926     $dtheta += 2.0*M_PI;
<a name="l00927"></a>00927 
<a name="l00928"></a>00928   <span class="comment">// 3. convert into cubic bezier segments &lt;= 90deg</span>
<a name="l00929"></a>00929   $segments = ceil(abs($dtheta/(M_PI/2.0)));
<a name="l00930"></a>00930   $delta = $dtheta/$segments;
<a name="l00931"></a>00931   $t = 8.0/3.0 * sin($delta/4.0) * sin($delta/4.0) / sin($delta/2.0);
<a name="l00932"></a>00932   $coords = array();
<a name="l00933"></a>00933   <span class="keywordflow">for</span> ($i = 0; $i &lt; $segments; $i++) {
<a name="l00934"></a>00934     $cosTheta1 = cos($theta1);
<a name="l00935"></a>00935     $sinTheta1 = sin($theta1);
<a name="l00936"></a>00936     $theta2 = $theta1 + $delta;
<a name="l00937"></a>00937     $cosTheta2 = cos($theta2);
<a name="l00938"></a>00938     $sinTheta2 = sin($theta2);
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <span class="comment">// a) calculate endpoint of the segment:</span>
<a name="l00941"></a>00941     $xe = $cosPhi * $rx*$cosTheta2 - $sinPhi * $ry*$sinTheta2 + $cx;
<a name="l00942"></a>00942     $ye = $sinPhi * $rx*$cosTheta2 + $cosPhi * $ry*$sinTheta2 + $cy;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944     <span class="comment">// b) calculate gradients at start/end points of segment:</span>
<a name="l00945"></a>00945     $dx1 = $t * ( - $cosPhi * $rx*$sinTheta1 - $sinPhi * $ry*$cosTheta1);
<a name="l00946"></a>00946     $dy1 = $t * ( - $sinPhi * $rx*$sinTheta1 + $cosPhi * $ry*$cosTheta1);
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     $dxe = $t * ( $cosPhi * $rx*$sinTheta2 + $sinPhi * $ry*$cosTheta2);
<a name="l00949"></a>00949     $dye = $t * ( $sinPhi * $rx*$sinTheta2 - $cosPhi * $ry*$cosTheta2);
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     <span class="comment">// c) draw the cubic bezier:</span>
<a name="l00952"></a>00952     $coords[$i] = array(($x1+$dx1), ($y1+$dy1), ($xe+$dxe), ($ye+$dye), $xe, $ye);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="comment">// do next segment</span>
<a name="l00955"></a>00955     $theta1 = $theta2;
<a name="l00956"></a>00956     $x1 = $xe;
<a name="l00957"></a>00957     $y1 = $ye;
<a name="l00958"></a>00958   }
<a name="l00959"></a>00959   $path = <span class="charliteral">&#39; &#39;</span>;
<a name="l00960"></a>00960   <span class="keywordflow">foreach</span>($coords AS $c) {
<a name="l00961"></a>00961     $cpx1 = $c[0];
<a name="l00962"></a>00962     $cpy1 = $c[1];
<a name="l00963"></a>00963     $cpx2 = $c[2];
<a name="l00964"></a>00964     $cpy2 = $c[3];
<a name="l00965"></a>00965     $x2 = $c[4];
<a name="l00966"></a>00966     $y2 = $c[5];
<a name="l00967"></a>00967     $path .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $cpx1, -$cpy1, $cpx2, -$cpy2, $x2, -$y2)  .<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00968"></a>00968   }
<a name="l00969"></a>00969   <span class="keywordflow">return</span> $path ;
<a name="l00970"></a>00970 }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 
<a name="l00973"></a>00973   function CalcVectorAngle($ux, $uy, $vx, $vy) {
<a name="l00974"></a>00974     $ta = atan2($uy, $ux);
<a name="l00975"></a>00975     $tb = atan2($vy, $vx);
<a name="l00976"></a>00976     <span class="keywordflow">if</span> ($tb &gt;= $ta)
<a name="l00977"></a>00977       <span class="keywordflow">return</span> ($tb-$ta);
<a name="l00978"></a>00978     <span class="keywordflow">return</span> (6.28318530718 - ($ta-$tb));
<a name="l00979"></a>00979   }
<a name="l00980"></a>00980 
<a name="l00981"></a>00981   <span class="comment">//</span>
<a name="l00982"></a>00982   <span class="comment">//  fonction retracant les &lt;rect /&gt;</span>
<a name="l00983"></a>00983   function svgRect($arguments){
<a name="l00984"></a>00984 
<a name="l00985"></a>00985     $x = $arguments[<span class="charliteral">&#39;x&#39;</span>]; 
<a name="l00986"></a>00986     $y = $arguments[<span class="charliteral">&#39;y&#39;</span>]; 
<a name="l00987"></a>00987     $h = $arguments[<span class="charliteral">&#39;h&#39;</span>]; 
<a name="l00988"></a>00988     $w = $arguments[<span class="charliteral">&#39;w&#39;</span>]; 
<a name="l00989"></a>00989     $rx = ($arguments[<span class="stringliteral">&#39;rx&#39;</span>]/2); 
<a name="l00990"></a>00990     $ry = ($arguments[<span class="stringliteral">&#39;ry&#39;</span>]/2); 
<a name="l00991"></a>00991 
<a name="l00992"></a>00992     <span class="keywordflow">if</span> ($rx&gt;0 and $ry == 0){$ry = $rx;}
<a name="l00993"></a>00993     <span class="keywordflow">if</span> ($ry&gt;0 and $rx == 0){$rx = $ry;}
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <span class="keywordflow">if</span> ($rx == 0 and $ry == 0){
<a name="l00996"></a>00996       <span class="comment">//  trace un rectangle sans angle arrondit</span>
<a name="l00997"></a>00997       $path_cmd = sprintf(<span class="stringliteral">&#39;%.3f %.3f m &#39;</span>, ($x), -($y));
<a name="l00998"></a>00998       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, (($x+$w)), -($y));
<a name="l00999"></a>00999       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, (($x+$w)), -(($y+$h)));
<a name="l01000"></a>01000       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, ($x), -(($y+$h)));
<a name="l01001"></a>01001       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l h &#39;</span>, ($x), -($y));
<a name="l01002"></a>01002 
<a name="l01003"></a>01003       
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005     <span class="keywordflow">else</span> {
<a name="l01006"></a>01006       <span class="comment">//  trace un rectangle avec les arrondit</span>
<a name="l01007"></a>01007       <span class="comment">//  les points de controle du bezier sont deduis grace a la constante kappa</span>
<a name="l01008"></a>01008       $kappa = 4*(sqrt(2)-1)/3;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010       $kx = $kappa*$rx;
<a name="l01011"></a>01011       $ky = $kappa*$ry;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013       $path_cmd = sprintf(<span class="stringliteral">&#39;%.3f %.3f m &#39;</span>, $x+($rx), -$y);
<a name="l01014"></a>01014       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $x+(($w-$rx)), -$y);
<a name="l01015"></a>01015       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $x+(($w-$rx+$kx)), -$y, $x+($w), -$y+((-$ry+$ky)), $x+($w), -$y+(-$ry) );
<a name="l01016"></a>01016       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $x+($w), -$y+((-$h+$ry)));
<a name="l01017"></a>01017       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $x+($w), -$y+((-$h-$ky+$ry)), $x+(($w-$rx+$kx)), -$y+(-$h), $x+(($w-$rx)), -$y+(-$h) );
<a name="l01018"></a>01018 
<a name="l01019"></a>01019       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $x+($rx), -$y+(-$h));
<a name="l01020"></a>01020       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $x+(($rx-$kx)), -$y+(-$h), $x, -$y+((-$h-$ky+$ry)), $x, -$y+((-$h+$ry)) );
<a name="l01021"></a>01021       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $x, -$y+(-$ry));
<a name="l01022"></a>01022       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c h &#39;</span>, $x, -$y+((-$ry+$ky)), $x+(($rx-$kx)), -$y, $x+($rx), -$y );
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     }
<a name="l01026"></a>01026     <span class="keywordflow">return</span> $path_cmd;
<a name="l01027"></a>01027   }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029   <span class="comment">//</span>
<a name="l01030"></a>01030   <span class="comment">//  fonction retracant les &lt;ellipse /&gt; et &lt;circle /&gt;</span>
<a name="l01031"></a>01031   <span class="comment">//   le cercle est tracé grave a 4 bezier cubic, les poitn de controles</span>
<a name="l01032"></a>01032   <span class="comment">//  sont deduis grace a la constante kappa * rayon</span>
<a name="l01033"></a>01033   function svgEllipse($arguments){
<a name="l01034"></a>01034     $kappa = 4*(sqrt(2)-1)/3;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036     $cx = $arguments[<span class="stringliteral">&#39;cx&#39;</span>] ;
<a name="l01037"></a>01037     $cy = $arguments[<span class="stringliteral">&#39;cy&#39;</span>] ;
<a name="l01038"></a>01038     $rx = $arguments[<span class="stringliteral">&#39;rx&#39;</span>] ;
<a name="l01039"></a>01039     $ry = $arguments[<span class="stringliteral">&#39;ry&#39;</span>] ;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     $x1 = $cx;
<a name="l01042"></a>01042     $y1 = -$cy+$ry;
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     $x2 = $cx+$rx;
<a name="l01045"></a>01045     $y2 = -$cy;
<a name="l01046"></a>01046 
<a name="l01047"></a>01047     $x3 = $cx;
<a name="l01048"></a>01048     $y3 = -$cy-$ry;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     $x4 = $cx-$rx;
<a name="l01051"></a>01051     $y4 = -$cy;
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     $path_cmd = sprintf(<span class="stringliteral">&#39;%.3f %.3f m &#39;</span>, $x1, $y1);
<a name="l01054"></a>01054     $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $x1+($rx*$kappa), $y1, $x2, $y2+($ry*$kappa), $x2, $y2);
<a name="l01055"></a>01055     $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $x2, $y2-($ry*$kappa), $x3+($rx*$kappa), $y3, $x3, $y3);
<a name="l01056"></a>01056     $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $x3-($rx*$kappa), $y3, $x4, $y4-($ry*$kappa), $x4, $y4);
<a name="l01057"></a>01057     $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f %.3f %.3f %.3f c &#39;</span>, $x4, $y4+($ry*$kappa), $x1-($rx*$kappa), $y1, $x1, $y1);
<a name="l01058"></a>01058     $path_cmd .= <span class="stringliteral">&#39;h &#39;</span>;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="keywordflow">return</span> $path_cmd;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062   }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064   <span class="comment">//</span>
<a name="l01065"></a>01065   <span class="comment">//  fonction retracant les &lt;polyline /&gt; et les &lt;line /&gt;</span>
<a name="l01066"></a>01066   function svgPolyline($arguments){
<a name="l01067"></a>01067     $xbase = $arguments[0] ;
<a name="l01068"></a>01068     $ybase = - $arguments[1] ;
<a name="l01069"></a>01069     $path_cmd = sprintf(<span class="stringliteral">&#39;%.3f %.3f m &#39;</span>, $xbase, $ybase);
<a name="l01070"></a>01070     <span class="keywordflow">for</span> ($i = 2; $i&lt;count($arguments);$i += 2) {
<a name="l01071"></a>01071 
<a name="l01072"></a>01072       $tmp_x = $arguments[$i] ;
<a name="l01073"></a>01073       $tmp_y = - $arguments[($i+1)] ;
<a name="l01074"></a>01074       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $tmp_x, $tmp_y);
<a name="l01075"></a>01075     }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   <span class="comment">//  $path_cmd .= &#39;h &#39;; // ?? In error - don&#39;t close subpath here</span>
<a name="l01078"></a>01078     <span class="keywordflow">return</span> $path_cmd;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082   <span class="comment">//</span>
<a name="l01083"></a>01083   <span class="comment">//  fonction retracant les &lt;polygone /&gt;</span>
<a name="l01084"></a>01084   function svgPolygon($arguments){
<a name="l01085"></a>01085     $xbase = $arguments[0] ;
<a name="l01086"></a>01086     $ybase = - $arguments[1] ;
<a name="l01087"></a>01087     $path_cmd = sprintf(<span class="stringliteral">&#39;%.3f %.3f m &#39;</span>, $xbase, $ybase);
<a name="l01088"></a>01088     <span class="keywordflow">for</span> ($i = 2; $i&lt;count($arguments);$i += 2) {
<a name="l01089"></a>01089       $tmp_x = $arguments[$i] ;
<a name="l01090"></a>01090       $tmp_y = - $arguments[($i+1)] ;
<a name="l01091"></a>01091 
<a name="l01092"></a>01092       $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $tmp_x, $tmp_y);
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     }
<a name="l01095"></a>01095     $path_cmd .= sprintf(<span class="stringliteral">&#39;%.3f %.3f l &#39;</span>, $xbase, $ybase);
<a name="l01096"></a>01096     $path_cmd .= <span class="stringliteral">&#39;h &#39;</span>;
<a name="l01097"></a>01097     <span class="keywordflow">return</span> $path_cmd;
<a name="l01098"></a>01098 
<a name="l01099"></a>01099   }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101   <span class="comment">//</span>
<a name="l01102"></a>01102   <span class="comment">//  write string to image</span>
<a name="l01103"></a>01103   function svgText(){
<a name="l01104"></a>01104     <span class="comment">// $tmp = count($this-&gt;txt_style)-1;</span>
<a name="l01105"></a>01105     $current_style = array_pop($this-&gt;txt_style);
<a name="l01106"></a>01106     $style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01107"></a>01107     <span class="keywordflow">if</span>(isset($this-&gt;txt_data[2]))
<a name="l01108"></a>01108     {
<a name="l01109"></a>01109       <span class="comment">// select font</span>
<a name="l01110"></a>01110       $style .= ($current_style[<span class="stringliteral">&#39;font-weight&#39;</span>] == <span class="stringliteral">&#39;bold&#39;</span>)?<span class="charliteral">&#39;B&#39;</span>:<span class="stringliteral">&#39;&#39;</span>;
<a name="l01111"></a>01111       $style .= ($current_style[<span class="stringliteral">&#39;font-style&#39;</span>] == <span class="stringliteral">&#39;italic&#39;</span>)?<span class="charliteral">&#39;I&#39;</span>:<span class="stringliteral">&#39;&#39;</span>;
<a name="l01112"></a>01112       $size = $current_style[<span class="stringliteral">&#39;font-size&#39;</span>];
<a name="l01113"></a>01113       $current_style[<span class="stringliteral">&#39;font-family&#39;</span>] = $this-&gt;mpdf_ref-&gt;SetFont($current_style[<span class="stringliteral">&#39;font-family&#39;</span>],$style,$current_style[<span class="stringliteral">&#39;font-size&#39;</span>],<span class="keyword">false</span>);
<a name="l01114"></a>01114 
<a name="l01115"></a>01115       $col = $this-&gt;mpdf_ref-&gt;ConvertColor($current_style[<span class="stringliteral">&#39;fill&#39;</span>]);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117       $x = $this-&gt;txt_data[0];
<a name="l01118"></a>01118       $y = $this-&gt;txt_data[1];
<a name="l01119"></a>01119       $txt = $this-&gt;txt_data[2];
<a name="l01120"></a>01120       $txt = trim($txt);
<a name="l01121"></a>01121 
<a name="l01122"></a>01122       $txt = $this-&gt;mpdf_ref-&gt;purify_utf8_text($txt);
<a name="l01123"></a>01123       <span class="keywordflow">if</span> ($this-&gt;mpdf_ref-&gt;text_input_as_HTML) {
<a name="l01124"></a>01124         $txt = $this-&gt;mpdf_ref-&gt;all_entities_to_utf8($txt);
<a name="l01125"></a>01125       }
<a name="l01126"></a>01126       <span class="keywordflow">if</span> (!$this-&gt;mpdf_ref-&gt;is_MB) { $txt = mb_convert_encoding($txt,$this-&gt;mpdf_ref-&gt;mb_enc,<span class="stringliteral">&#39;UTF-8&#39;</span>); }
<a name="l01127"></a>01127       $this-&gt;mpdf_ref-&gt;magic_reverse_dir($txt); 
<a name="l01128"></a>01128       $this-&gt;mpdf_ref-&gt;ConvertIndic($txt);
<a name="l01129"></a>01129 
<a name="l01130"></a>01130       <span class="keywordflow">if</span> ($current_style[<span class="stringliteral">&#39;text-anchor&#39;</span>]==<span class="stringliteral">&#39;middle&#39;</span>) {
<a name="l01131"></a>01131         $tw = $this-&gt;mpdf_ref-&gt;GetStringWidth($txt)*2.835/2;
<a name="l01132"></a>01132       }
<a name="l01133"></a>01133       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($current_style[<span class="stringliteral">&#39;text-anchor&#39;</span>]==<span class="stringliteral">&#39;end&#39;</span>) {
<a name="l01134"></a>01134         $tw = $this-&gt;mpdf_ref-&gt;GetStringWidth($txt)*2.835;
<a name="l01135"></a>01135       }
<a name="l01136"></a>01136       <span class="keywordflow">else</span> $tw = 0;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138       <span class="keywordflow">if</span> ($this-&gt;mpdf_ref-&gt;useSubsets &amp;&amp; $this-&gt;mpdf_ref-&gt;CurrentFont[<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&#39;Type1subset&#39;</span> &amp;&amp; !$this-&gt;mpdf_ref-&gt;isCJK &amp;&amp; !$this-&gt;mpdf_ref-&gt;usingCoreFont) {
<a name="l01139"></a>01139         $txt = $this-&gt;mpdf_ref-&gt;UTF8toSubset($txt);
<a name="l01140"></a>01140       }
<a name="l01141"></a>01141       <span class="keywordflow">else</span> {
<a name="l01142"></a>01142         <span class="keywordflow">if</span> ($this-&gt;mpdf_ref-&gt;is_MB &amp;&amp; !$this-&gt;mpdf_ref-&gt;usingCoreFont) {
<a name="l01143"></a>01143           $txt= $this-&gt;mpdf_ref-&gt;UTF8ToUTF16BE($txt, <span class="keyword">false</span>);
<a name="l01144"></a>01144         }
<a name="l01145"></a>01145         $txt=<span class="charliteral">&#39;(&#39;</span>.$this-&gt;mpdf_ref-&gt;_escape($txt).<span class="charliteral">&#39;)&#39;</span>; 
<a name="l01146"></a>01146       }
<a name="l01147"></a>01147       $this-&gt;mpdf_ref-&gt;CurrentFont[<span class="stringliteral">&#39;used&#39;</span>]= <span class="keyword">true</span>;
<a name="l01148"></a>01148 
<a name="l01149"></a>01149       $pdfx = ($x - $tw);
<a name="l01150"></a>01150       $pdfy =  -$y  ;
<a name="l01151"></a>01151       $xbase = $x;
<a name="l01152"></a>01152       $ybase = -$y;
<a name="l01153"></a>01153 
<a name="l01154"></a>01154       $path_cmd =  sprintf(<span class="stringliteral">&#39;q BT /F%d %.3f Tf %.3f %.3f Td 0 Tr %.3f %.3f %.3f rg %s Tj ET Q &#39;</span>,$this-&gt;mpdf_ref-&gt;CurrentFont[<span class="charliteral">&#39;i&#39;</span>],$this-&gt;mpdf_ref-&gt;FontSizePt,$pdfx,$pdfy,$col[<span class="charliteral">&#39;R&#39;</span>]/255,$col[<span class="charliteral">&#39;G&#39;</span>]/255,$col[<span class="charliteral">&#39;B&#39;</span>]/255,$txt);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156       unset($this-&gt;txt_data[0], $this-&gt;txt_data[1],$this-&gt;txt_data[2]);
<a name="l01157"></a>01157     }
<a name="l01158"></a>01158     <span class="keywordflow">else</span>
<a name="l01159"></a>01159     {
<a name="l01160"></a>01160       die(<span class="stringliteral">&quot;No string to write!&quot;</span>);
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162     $path_cmd .= <span class="stringliteral">&#39;h &#39;</span>;
<a name="l01163"></a>01163     <span class="keywordflow">return</span> $path_cmd;
<a name="l01164"></a>01164   }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 
<a name="l01167"></a>01167 function svgDefineTxtStyle($critere_style)
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169     <span class="comment">// get copy of current/default txt style, and modify it with supplied attributes</span>
<a name="l01170"></a>01170     $tmp = count($this-&gt;txt_style)-1;
<a name="l01171"></a>01171     $current_style = $this-&gt;txt_style[$tmp];
<a name="l01172"></a>01172 
<a name="l01173"></a>01173     <span class="keywordflow">if</span> (isset($critere_style[<span class="stringliteral">&#39;font&#39;</span>])){
<a name="l01174"></a>01174 
<a name="l01175"></a>01175       <span class="comment">// [ [ &lt;&#39;font-style&#39;&gt; || &lt;&#39;font-variant&#39;&gt; || &lt;&#39;font-weight&#39;&gt; ]?&lt;&#39;font-size&#39;&gt; [ / &lt;&#39;line-height&#39;&gt; ]? &lt;&#39;font-family&#39;&gt; ]</span>
<a name="l01176"></a>01176 
<a name="l01177"></a>01177       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)(italic|oblique)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;font&#39;</span>]);
<a name="l01178"></a>01178       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;font&#39;</span>]){ 
<a name="l01179"></a>01179         <span class="keywordflow">if</span>($tmp == <span class="stringliteral">&#39;oblique&#39;</span>){
<a name="l01180"></a>01180           $tmp = <span class="stringliteral">&#39;italic&#39;</span>;
<a name="l01181"></a>01181         }
<a name="l01182"></a>01182         $current_style[<span class="stringliteral">&#39;font-style&#39;</span>] = $tmp;
<a name="l01183"></a>01183       }
<a name="l01184"></a>01184       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)(bold|bolder)(.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;font&#39;</span>]);
<a name="l01185"></a>01185       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;font&#39;</span>]){ 
<a name="l01186"></a>01186         <span class="keywordflow">if</span>($tmp == <span class="stringliteral">&#39;bolder&#39;</span>){
<a name="l01187"></a>01187           $tmp = <span class="stringliteral">&#39;bold&#39;</span>;
<a name="l01188"></a>01188         }
<a name="l01189"></a>01189         $current_style[<span class="stringliteral">&#39;font-weight&#39;</span>] = $tmp;
<a name="l01190"></a>01190       }
<a name="l01191"></a>01191       
<a name="l01192"></a>01192       <span class="comment">// select digits not followed by percent sign nor preceeded by forward slash</span>
<a name="l01193"></a>01193       $tmp = preg_replace(<span class="stringliteral">&quot;/(.*)\b(\d+)[\b|\/](.*)/i&quot;</span>,<span class="stringliteral">&quot;$2&quot;</span>,$critere_style[<span class="stringliteral">&#39;font&#39;</span>]);
<a name="l01194"></a>01194       <span class="keywordflow">if</span> ($tmp != $critere_style[<span class="stringliteral">&#39;font&#39;</span>]){ $current_style[<span class="stringliteral">&#39;font-size&#39;</span>] = $tmp; }
<a name="l01195"></a>01195       
<a name="l01196"></a>01196     }
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;fill&#39;</span>])){
<a name="l01199"></a>01199       $current_style[<span class="stringliteral">&#39;fill&#39;</span>] = $critere_style[<span class="stringliteral">&#39;fill&#39;</span>];
<a name="l01200"></a>01200     }
<a name="l01201"></a>01201     
<a name="l01202"></a>01202     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;font-style&#39;</span>])){
<a name="l01203"></a>01203       <span class="keywordflow">if</span>(strtolower($critere_style[<span class="stringliteral">&#39;font-style&#39;</span>]) == <span class="stringliteral">&#39;oblique&#39;</span>) 
<a name="l01204"></a>01204       {
<a name="l01205"></a>01205         $critere_style[<span class="stringliteral">&#39;font-style&#39;</span>] = <span class="stringliteral">&#39;italic&#39;</span>;
<a name="l01206"></a>01206       }
<a name="l01207"></a>01207       $current_style[<span class="stringliteral">&#39;font-style&#39;</span>] = $critere_style[<span class="stringliteral">&#39;font-style&#39;</span>];
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209     
<a name="l01210"></a>01210     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;font-weight&#39;</span>])){
<a name="l01211"></a>01211       <span class="keywordflow">if</span>(strtolower($critere_style[<span class="stringliteral">&#39;font-weight&#39;</span>]) == <span class="stringliteral">&#39;bolder&#39;</span>)
<a name="l01212"></a>01212       {
<a name="l01213"></a>01213         $critere_style[<span class="stringliteral">&#39;font-weight&#39;</span>] = <span class="stringliteral">&#39;bold&#39;</span>;
<a name="l01214"></a>01214       }
<a name="l01215"></a>01215       $current_style[<span class="stringliteral">&#39;font-weight&#39;</span>] = $critere_style[<span class="stringliteral">&#39;font-weight&#39;</span>];
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217     
<a name="l01218"></a>01218     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;font-size&#39;</span>])){
<a name="l01219"></a>01219       $current_style[<span class="stringliteral">&#39;font-size&#39;</span>] = $this-&gt;mpdf_ref-&gt;ConvertSize($critere_style[<span class="stringliteral">&#39;font-size&#39;</span>])* 2.835;
<a name="l01220"></a>01220     }
<a name="l01221"></a>01221     
<a name="l01222"></a>01222     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;font-family&#39;</span>])){
<a name="l01223"></a>01223       $current_style[<span class="stringliteral">&#39;font-family&#39;</span>] = $critere_style[<span class="stringliteral">&#39;font-family&#39;</span>];
<a name="l01224"></a>01224     }
<a name="l01225"></a>01225   
<a name="l01226"></a>01226     <span class="keywordflow">if</span>(isset($critere_style[<span class="stringliteral">&#39;text-anchor&#39;</span>])){
<a name="l01227"></a>01227       $current_style[<span class="stringliteral">&#39;text-anchor&#39;</span>] = $critere_style[<span class="stringliteral">&#39;text-anchor&#39;</span>];
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229   
<a name="l01230"></a>01230   <span class="comment">// add current style to text style array (will remove it later after writing text to svg_string)</span>
<a name="l01231"></a>01231   array_push($this-&gt;txt_style,$current_style);
<a name="l01232"></a>01232 }
<a name="l01233"></a>01233 
<a name="l01234"></a>01234 
<a name="l01235"></a>01235 
<a name="l01236"></a>01236   <span class="comment">//</span>
<a name="l01237"></a>01237   <span class="comment">//  fonction ajoutant un gradient</span>
<a name="l01238"></a>01238   function svgAddGradient($id,$array_gradient){
<a name="l01239"></a>01239 
<a name="l01240"></a>01240     $this-&gt;svg_gradient[$id] = $array_gradient;
<a name="l01241"></a>01241 
<a name="l01242"></a>01242   }
<a name="l01243"></a>01243   <span class="comment">//</span>
<a name="l01244"></a>01244   <span class="comment">//  Ajoute une couleur dans le gradient correspondant</span>
<a name="l01245"></a>01245 
<a name="l01246"></a>01246   <span class="comment">//</span>
<a name="l01247"></a>01247   <span class="comment">//  function ecrivant dans le svgstring</span>
<a name="l01248"></a>01248   function svgWriteString($content){
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     $this-&gt;svg_string .= $content;
<a name="l01251"></a>01251 
<a name="l01252"></a>01252   }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254 
<a name="l01255"></a>01255 
<a name="l01256"></a>01256   <span class="comment">//  analise le svg et renvoie aux fonctions precedente our le traitement</span>
<a name="l01257"></a>01257   function ImageSVG($data){
<a name="l01258"></a>01258     $this-&gt;svg_info = array();
<a name="l01259"></a>01259     $this-&gt;svg_info[<span class="stringliteral">&#39;data&#39;</span>] = $data;
<a name="l01260"></a>01260 
<a name="l01261"></a>01261     $this-&gt;svg_string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01262"></a>01262     
<a name="l01263"></a>01263     <span class="comment">//</span>
<a name="l01264"></a>01264     <span class="comment">//  chargement unique des fonctions</span>
<a name="l01265"></a>01265     <span class="keywordflow">if</span>(!function_exists(xml_svg2pdf_start)){
<a name="l01266"></a>01266 
<a name="l01267"></a>01267       function xml_svg2pdf_start($parser, $name, $attribs){
<a name="l01268"></a>01268         <span class="comment">//</span>
<a name="l01269"></a>01269         <span class="comment">//  definition</span>
<a name="l01270"></a>01270         global $svg_class, $last_gradid;
<a name="l01271"></a>01271         <span class="keywordflow">switch</span> (strtolower($name)){
<a name="l01272"></a>01272 
<a name="l01273"></a>01273         <span class="keywordflow">case</span> <span class="stringliteral">&#39;svg&#39;</span>:
<a name="l01274"></a>01274           $svg_class-&gt;svgOffset($attribs);
<a name="l01275"></a>01275           <span class="keywordflow">break</span>;
<a name="l01276"></a>01276 
<a name="l01277"></a>01277         <span class="keywordflow">case</span> <span class="stringliteral">&#39;path&#39;</span>:
<a name="l01278"></a>01278           $path = $attribs[<span class="charliteral">&#39;d&#39;</span>];
<a name="l01279"></a>01279           preg_match_all(<span class="stringliteral">&#39;/([a-z]|[A-Z])([ ,\-.\d]+)*/&#39;</span>, $path, $commands, PREG_SET_ORDER);
<a name="l01280"></a>01280           $path_cmd = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01281"></a>01281           <span class="keywordflow">foreach</span>($commands as $c){
<a name="l01282"></a>01282             <span class="keywordflow">if</span>(count($c)==3){
<a name="l01283"></a>01283               list($tmp, $command, $arguments) = $c;
<a name="l01284"></a>01284             }
<a name="l01285"></a>01285             <span class="keywordflow">else</span>{
<a name="l01286"></a>01286               list($tmp, $command) = $c;
<a name="l01287"></a>01287               $arguments = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01288"></a>01288             }
<a name="l01289"></a>01289 
<a name="l01290"></a>01290             $path_cmd .= $svg_class-&gt;svgPath($command, $arguments);
<a name="l01291"></a>01291           }
<a name="l01292"></a>01292           $critere_style = $attribs;
<a name="l01293"></a>01293           unset($critere_style[<span class="charliteral">&#39;d&#39;</span>]);
<a name="l01294"></a>01294           $path_style = $svg_class-&gt;svgDefineStyle($critere_style);
<a name="l01295"></a>01295           <span class="keywordflow">break</span>;
<a name="l01296"></a>01296 
<a name="l01297"></a>01297         <span class="keywordflow">case</span> <span class="stringliteral">&#39;rect&#39;</span>:
<a name="l01298"></a>01298           <span class="keywordflow">if</span> (!isset($attribs[<span class="charliteral">&#39;x&#39;</span>])) {$attribs[<span class="charliteral">&#39;x&#39;</span>] = 0;}
<a name="l01299"></a>01299           <span class="keywordflow">if</span> (!isset($attribs[<span class="charliteral">&#39;y&#39;</span>])) {$attribs[<span class="charliteral">&#39;y&#39;</span>] = 0;}
<a name="l01300"></a>01300           <span class="keywordflow">if</span> (!isset($attribs[<span class="stringliteral">&#39;rx&#39;</span>])) {$attribs[<span class="stringliteral">&#39;rx&#39;</span>] = 0;}
<a name="l01301"></a>01301           <span class="keywordflow">if</span> (!isset($attribs[<span class="stringliteral">&#39;ry&#39;</span>])) {$attribs[<span class="stringliteral">&#39;ry&#39;</span>] = 0;}
<a name="l01302"></a>01302           $arguments = array(
<a name="l01303"></a>01303             <span class="charliteral">&#39;x&#39;</span> =&gt; $attribs[<span class="charliteral">&#39;x&#39;</span>],
<a name="l01304"></a>01304             <span class="charliteral">&#39;y&#39;</span> =&gt; $attribs[<span class="charliteral">&#39;y&#39;</span>],
<a name="l01305"></a>01305             <span class="charliteral">&#39;w&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;width&#39;</span>],
<a name="l01306"></a>01306             <span class="charliteral">&#39;h&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;height&#39;</span>],
<a name="l01307"></a>01307             <span class="stringliteral">&#39;rx&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;rx&#39;</span>],
<a name="l01308"></a>01308             <span class="stringliteral">&#39;ry&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;ry&#39;</span>]
<a name="l01309"></a>01309           );
<a name="l01310"></a>01310           $path_cmd =  $svg_class-&gt;svgRect($arguments);
<a name="l01311"></a>01311           $critere_style = $attribs;
<a name="l01312"></a>01312           unset($critere_style[<span class="charliteral">&#39;x&#39;</span>],$critere_style[<span class="charliteral">&#39;y&#39;</span>],$critere_style[<span class="stringliteral">&#39;rx&#39;</span>],$critere_style[<span class="stringliteral">&#39;ry&#39;</span>],$critere_style[<span class="stringliteral">&#39;height&#39;</span>],$critere_style[<span class="stringliteral">&#39;width&#39;</span>]);
<a name="l01313"></a>01313           $path_style = $svg_class-&gt;svgDefineStyle($critere_style);
<a name="l01314"></a>01314           <span class="keywordflow">break</span>;
<a name="l01315"></a>01315 
<a name="l01316"></a>01316         <span class="keywordflow">case</span> <span class="stringliteral">&#39;circle&#39;</span>:
<a name="l01317"></a>01317           <span class="keywordflow">if</span> (!isset($attribs[<span class="stringliteral">&#39;cx&#39;</span>])) {$attribs[<span class="stringliteral">&#39;cx&#39;</span>] = 0;}
<a name="l01318"></a>01318           <span class="keywordflow">if</span> (!isset($attribs[<span class="stringliteral">&#39;cy&#39;</span>])) {$attribs[<span class="stringliteral">&#39;cy&#39;</span>] = 0;}
<a name="l01319"></a>01319           $arguments = array(
<a name="l01320"></a>01320             <span class="stringliteral">&#39;cx&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;cx&#39;</span>],
<a name="l01321"></a>01321             <span class="stringliteral">&#39;cy&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;cy&#39;</span>],
<a name="l01322"></a>01322             <span class="stringliteral">&#39;rx&#39;</span> =&gt; $attribs[<span class="charliteral">&#39;r&#39;</span>],
<a name="l01323"></a>01323             <span class="stringliteral">&#39;ry&#39;</span> =&gt; $attribs[<span class="charliteral">&#39;r&#39;</span>]
<a name="l01324"></a>01324           );
<a name="l01325"></a>01325           $path_cmd =  $svg_class-&gt;svgEllipse($arguments);
<a name="l01326"></a>01326           $critere_style = $attribs;
<a name="l01327"></a>01327           unset($critere_style[<span class="stringliteral">&#39;cx&#39;</span>],$critere_style[<span class="stringliteral">&#39;cy&#39;</span>],$critere_style[<span class="charliteral">&#39;r&#39;</span>]);
<a name="l01328"></a>01328           $path_style = $svg_class-&gt;svgDefineStyle($critere_style);
<a name="l01329"></a>01329           <span class="keywordflow">break</span>;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ellipse&#39;</span>:
<a name="l01332"></a>01332           <span class="keywordflow">if</span> (!isset($attribs[<span class="stringliteral">&#39;cx&#39;</span>])) {$attribs[<span class="stringliteral">&#39;cx&#39;</span>] = 0;}
<a name="l01333"></a>01333           <span class="keywordflow">if</span> (!isset($attribs[<span class="stringliteral">&#39;cy&#39;</span>])) {$attribs[<span class="stringliteral">&#39;cy&#39;</span>] = 0;}
<a name="l01334"></a>01334           $arguments = array(
<a name="l01335"></a>01335             <span class="stringliteral">&#39;cx&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;cx&#39;</span>],
<a name="l01336"></a>01336             <span class="stringliteral">&#39;cy&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;cy&#39;</span>],
<a name="l01337"></a>01337             <span class="stringliteral">&#39;rx&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;rx&#39;</span>],
<a name="l01338"></a>01338             <span class="stringliteral">&#39;ry&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;ry&#39;</span>]
<a name="l01339"></a>01339           );
<a name="l01340"></a>01340           $path_cmd =  $svg_class-&gt;svgEllipse($arguments);
<a name="l01341"></a>01341           $critere_style = $attribs;
<a name="l01342"></a>01342           unset($critere_style[<span class="stringliteral">&#39;cx&#39;</span>],$critere_style[<span class="stringliteral">&#39;cy&#39;</span>],$critere_style[<span class="stringliteral">&#39;rx&#39;</span>],$critere_style[<span class="stringliteral">&#39;ry&#39;</span>]);
<a name="l01343"></a>01343           $path_style = $svg_class-&gt;svgDefineStyle($critere_style);
<a name="l01344"></a>01344           <span class="keywordflow">break</span>;
<a name="l01345"></a>01345 
<a name="l01346"></a>01346         <span class="keywordflow">case</span> <span class="stringliteral">&#39;line&#39;</span>:
<a name="l01347"></a>01347           $arguments = array($attribs[<span class="stringliteral">&#39;x1&#39;</span>],$attribs[<span class="stringliteral">&#39;y1&#39;</span>],$attribs[<span class="stringliteral">&#39;x2&#39;</span>],$attribs[<span class="stringliteral">&#39;y2&#39;</span>]);
<a name="l01348"></a>01348           $path_cmd =  $svg_class-&gt;svgPolyline($arguments);
<a name="l01349"></a>01349           $critere_style = $attribs;
<a name="l01350"></a>01350           unset($critere_style[<span class="stringliteral">&#39;x1&#39;</span>],$critere_style[<span class="stringliteral">&#39;y1&#39;</span>],$critere_style[<span class="stringliteral">&#39;x2&#39;</span>],$critere_style[<span class="stringliteral">&#39;y2&#39;</span>]);
<a name="l01351"></a>01351           $path_style = $svg_class-&gt;svgDefineStyle($critere_style);
<a name="l01352"></a>01352           <span class="keywordflow">break</span>;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354         <span class="keywordflow">case</span> <span class="stringliteral">&#39;polyline&#39;</span>:
<a name="l01355"></a>01355           $path = $attribs[<span class="stringliteral">&#39;points&#39;</span>];
<a name="l01356"></a>01356           preg_match_all(<span class="stringliteral">&#39;/[0-9\-\.]*/&#39;</span>,$path, $tmp, PREG_SET_ORDER);
<a name="l01357"></a>01357           $arguments = array();
<a name="l01358"></a>01358           <span class="keywordflow">for</span> ($i=0;$i&lt;count($tmp);$i++){
<a name="l01359"></a>01359             <span class="keywordflow">if</span> ($tmp[$i][0] !=<span class="stringliteral">&#39;&#39;</span>){
<a name="l01360"></a>01360               array_push($arguments, $tmp[$i][0]);
<a name="l01361"></a>01361             }
<a name="l01362"></a>01362           }
<a name="l01363"></a>01363           $path_cmd =  $svg_class-&gt;svgPolyline($arguments);
<a name="l01364"></a>01364           $critere_style = $attribs;
<a name="l01365"></a>01365           unset($critere_style[<span class="stringliteral">&#39;points&#39;</span>]);
<a name="l01366"></a>01366           $path_style = $svg_class-&gt;svgDefineStyle($critere_style);
<a name="l01367"></a>01367           <span class="keywordflow">break</span>;
<a name="l01368"></a>01368 
<a name="l01369"></a>01369         <span class="keywordflow">case</span> <span class="stringliteral">&#39;polygon&#39;</span>:
<a name="l01370"></a>01370           $path = $attribs[<span class="stringliteral">&#39;points&#39;</span>];
<a name="l01371"></a>01371           preg_match_all(<span class="stringliteral">&#39;/([\-]*[0-9\.]+)/&#39;</span>,$path, $tmp);
<a name="l01372"></a>01372           $arguments = array();
<a name="l01373"></a>01373           <span class="keywordflow">for</span> ($i=0;$i&lt;count($tmp[0]);$i++){
<a name="l01374"></a>01374             <span class="keywordflow">if</span> ($tmp[0][$i] !=<span class="stringliteral">&#39;&#39;</span>){
<a name="l01375"></a>01375               array_push($arguments, $tmp[0][$i]);
<a name="l01376"></a>01376             }
<a name="l01377"></a>01377           }
<a name="l01378"></a>01378           $path_cmd =  $svg_class-&gt;svgPolygon($arguments);
<a name="l01379"></a>01379           <span class="comment">//  definition du style de la forme:</span>
<a name="l01380"></a>01380           $critere_style = $attribs;
<a name="l01381"></a>01381           unset($critere_style[<span class="stringliteral">&#39;points&#39;</span>]);
<a name="l01382"></a>01382           $path_style = $svg_class-&gt;svgDefineStyle($critere_style);
<a name="l01383"></a>01383           <span class="keywordflow">break</span>;
<a name="l01384"></a>01384 
<a name="l01385"></a>01385         <span class="keywordflow">case</span> <span class="stringliteral">&#39;lineargradient&#39;</span>:
<a name="l01386"></a>01386             $tmp_gradient = array(
<a name="l01387"></a>01387               <span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;linear&#39;</span>,
<a name="l01388"></a>01388               <span class="stringliteral">&#39;info&#39;</span> =&gt; array(
<a name="l01389"></a>01389                 <span class="stringliteral">&#39;x1&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;x1&#39;</span>],
<a name="l01390"></a>01390                 <span class="stringliteral">&#39;y1&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;y1&#39;</span>],
<a name="l01391"></a>01391                 <span class="stringliteral">&#39;x2&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;x2&#39;</span>],
<a name="l01392"></a>01392                 <span class="stringliteral">&#39;y2&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;y2&#39;</span>]
<a name="l01393"></a>01393               ),
<a name="l01394"></a>01394               <span class="stringliteral">&#39;transform&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;gradientTransform&#39;</span>],
<a name="l01395"></a>01395               <span class="stringliteral">&#39;color&#39;</span> =&gt; array()
<a name="l01396"></a>01396             );
<a name="l01397"></a>01397 
<a name="l01398"></a>01398             $last_gradid = $attribs[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l01399"></a>01399 
<a name="l01400"></a>01400             $svg_class-&gt;svgAddGradient($attribs[<span class="stringliteral">&#39;id&#39;</span>],$tmp_gradient);
<a name="l01401"></a>01401 
<a name="l01402"></a>01402           <span class="keywordflow">break</span>;
<a name="l01403"></a>01403 
<a name="l01404"></a>01404         <span class="keywordflow">case</span> <span class="stringliteral">&#39;radialgradient&#39;</span>:
<a name="l01405"></a>01405 
<a name="l01406"></a>01406             $tmp_gradient = array(
<a name="l01407"></a>01407               <span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;radial&#39;</span>,
<a name="l01408"></a>01408               <span class="stringliteral">&#39;info&#39;</span> =&gt; array(
<a name="l01409"></a>01409                 <span class="stringliteral">&#39;x0&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;cx&#39;</span>],
<a name="l01410"></a>01410                 <span class="stringliteral">&#39;y0&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;cy&#39;</span>],
<a name="l01411"></a>01411                 <span class="stringliteral">&#39;x1&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;fx&#39;</span>],
<a name="l01412"></a>01412                 <span class="stringliteral">&#39;y1&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;fy&#39;</span>],
<a name="l01413"></a>01413                 <span class="charliteral">&#39;r&#39;</span> =&gt; $attribs[<span class="charliteral">&#39;r&#39;</span>]
<a name="l01414"></a>01414               ),
<a name="l01415"></a>01415               <span class="stringliteral">&#39;transform&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;gradientTransform&#39;</span>],
<a name="l01416"></a>01416               <span class="stringliteral">&#39;color&#39;</span> =&gt; array()
<a name="l01417"></a>01417             );
<a name="l01418"></a>01418 
<a name="l01419"></a>01419             $last_gradid = $attribs[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l01420"></a>01420 
<a name="l01421"></a>01421             $svg_class-&gt;svgAddGradient($attribs[<span class="stringliteral">&#39;id&#39;</span>],$tmp_gradient);
<a name="l01422"></a>01422 
<a name="l01423"></a>01423           <span class="keywordflow">break</span>;
<a name="l01424"></a>01424 
<a name="l01425"></a>01425         <span class="keywordflow">case</span> <span class="stringliteral">&#39;stop&#39;</span>:
<a name="l01426"></a>01426 
<a name="l01427"></a>01427 <span class="keywordflow">if</span> (!$last_gradid) <span class="keywordflow">break</span>;
<a name="l01428"></a>01428             <span class="keywordflow">if</span> (isset($attribs[<span class="stringliteral">&#39;style&#39;</span>]) AND !isset($attribs[<span class="stringliteral">&#39;stop-color&#39;</span>])){
<a name="l01429"></a>01429               $color = preg_replace(<span class="stringliteral">&#39;/stop-color:([0-9#]*)/i&#39;</span>,<span class="stringliteral">&#39;$1&#39;</span>,$attribs[<span class="stringliteral">&#39;style&#39;</span>]);
<a name="l01430"></a>01430             } <span class="keywordflow">else</span> {
<a name="l01431"></a>01431               $color = $attribs[<span class="stringliteral">&#39;stop-color&#39;</span>];
<a name="l01432"></a>01432             }
<a name="l01433"></a>01433             $col = $svg_class-&gt;mpdf_ref-&gt;ConvertColor($color);
<a name="l01434"></a>01434             $color_r = $col[<span class="charliteral">&#39;R&#39;</span>];
<a name="l01435"></a>01435             $color_g = $col[<span class="charliteral">&#39;G&#39;</span>];
<a name="l01436"></a>01436             $color_b = $col[<span class="charliteral">&#39;B&#39;</span>];
<a name="l01437"></a>01437             $color_final = $path_style .= sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f&#39;</span>,$color_r/255,$color_g/255,$color_b/255);
<a name="l01438"></a>01438             $tmp_color = array(
<a name="l01439"></a>01439               <span class="stringliteral">&#39;color&#39;</span> =&gt; $color_final,
<a name="l01440"></a>01440               <span class="stringliteral">&#39;offset&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;offset&#39;</span>],
<a name="l01441"></a>01441               <span class="stringliteral">&#39;opacity&#39;</span> =&gt; $attribs[<span class="stringliteral">&#39;stop-opacity&#39;</span>]
<a name="l01442"></a>01442             );
<a name="l01443"></a>01443             array_push($svg_class-&gt;svg_gradient[$last_gradid][<span class="stringliteral">&#39;color&#39;</span>],$tmp_color);
<a name="l01444"></a>01444           <span class="keywordflow">break</span>;
<a name="l01445"></a>01445 
<a name="l01446"></a>01446 
<a name="l01447"></a>01447         <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:
<a name="l01448"></a>01448             $array_style = $svg_class-&gt;svgDefineStyle($attribs);
<a name="l01449"></a>01449             <span class="keywordflow">if</span> ($array_style[<span class="stringliteral">&#39;transformations&#39;</span>]) {
<a name="l01450"></a>01450               $svg_class-&gt;svgWriteString(<span class="stringliteral">&#39; q &#39;</span>.$array_style[<span class="stringliteral">&#39;transformations&#39;</span>]);
<a name="l01451"></a>01451             }
<a name="l01452"></a>01452             array_push($svg_class-&gt;svg_style,$array_style);
<a name="l01453"></a>01453           <span class="keywordflow">break</span>;
<a name="l01454"></a>01454 
<a name="l01455"></a>01455         <span class="keywordflow">case</span> <span class="stringliteral">&#39;text&#39;</span>:
<a name="l01456"></a>01456             $svg_class-&gt;txt_data = array();
<a name="l01457"></a>01457             $svg_class-&gt;txt_data[0] = $attribs[<span class="charliteral">&#39;x&#39;</span>];
<a name="l01458"></a>01458             $svg_class-&gt;txt_data[1] = $attribs[<span class="charliteral">&#39;y&#39;</span>];
<a name="l01459"></a>01459             $critere_style = $attribs;
<a name="l01460"></a>01460             unset($critere_style[<span class="charliteral">&#39;x&#39;</span>], $critere_style[<span class="charliteral">&#39;y&#39;</span>]);
<a name="l01461"></a>01461             $svg_class-&gt;svgDefineTxtStyle($critere_style);
<a name="l01462"></a>01462 
<a name="l01463"></a>01463           <span class="keywordflow">break</span>;
<a name="l01464"></a>01464         }
<a name="l01465"></a>01465 
<a name="l01466"></a>01466         <span class="comment">//</span>
<a name="l01467"></a>01467         <span class="comment">//insertion des path et du style dans le flux de donné general.</span>
<a name="l01468"></a>01468         <span class="keywordflow">if</span> (isset($path_cmd)){
<a name="l01469"></a>01469           $get_style = $svg_class-&gt;svgStyle($path_style, $attribs, strtolower($name));
<a name="l01470"></a>01470           <span class="keywordflow">if</span> ($path_style[<span class="stringliteral">&#39;transformations&#39;</span>]) { <span class="comment">// transformation on an element</span>
<a name="l01471"></a>01471             $svg_class-&gt;svgWriteString(<span class="stringliteral">&quot; q &quot;</span>.$path_style[<span class="stringliteral">&#39;transformations&#39;</span>]. <span class="stringliteral">&quot;$path_cmd $get_style&quot;</span> . <span class="stringliteral">&quot; Q\n&quot;</span>);
<a name="l01472"></a>01472           }
<a name="l01473"></a>01473           <span class="keywordflow">else</span> {
<a name="l01474"></a>01474             $svg_class-&gt;svgWriteString(<span class="stringliteral">&quot;$path_cmd $get_style\n&quot;</span>);
<a name="l01475"></a>01475           }
<a name="l01476"></a>01476         }
<a name="l01477"></a>01477       }
<a name="l01478"></a>01478 
<a name="l01479"></a>01479       function characterData($parser, $data)
<a name="l01480"></a>01480       {
<a name="l01481"></a>01481         global $svg_class;
<a name="l01482"></a>01482         <span class="keywordflow">if</span>(isset($svg_class-&gt;txt_data[2]))
<a name="l01483"></a>01483         {
<a name="l01484"></a>01484           $svg_class-&gt;txt_data[2] .= $data;
<a name="l01485"></a>01485         }
<a name="l01486"></a>01486         <span class="keywordflow">else</span>
<a name="l01487"></a>01487         {
<a name="l01488"></a>01488           $svg_class-&gt;txt_data[2] = $data;
<a name="l01489"></a>01489         }
<a name="l01490"></a>01490       }
<a name="l01491"></a>01491 
<a name="l01492"></a>01492 
<a name="l01493"></a>01493       function xml_svg2pdf_end($parser, $name){
<a name="l01494"></a>01494         global $svg_class;
<a name="l01495"></a>01495         <span class="keywordflow">switch</span>($name){
<a name="l01496"></a>01496           <span class="keywordflow">case</span> <span class="stringliteral">&quot;g&quot;</span>:
<a name="l01497"></a>01497             $tmp = count($svg_class-&gt;svg_style)-1;
<a name="l01498"></a>01498             $current_style = $svg_class-&gt;svg_style[$tmp];
<a name="l01499"></a>01499             <span class="keywordflow">if</span> ($current_style[<span class="stringliteral">&#39;transformations&#39;</span>]) {
<a name="l01500"></a>01500               $svg_class-&gt;svgWriteString(<span class="stringliteral">&quot; Q &quot;</span>);
<a name="l01501"></a>01501             }
<a name="l01502"></a>01502             array_pop($svg_class-&gt;svg_style);
<a name="l01503"></a>01503           <span class="keywordflow">break</span>;
<a name="l01504"></a>01504           <span class="keywordflow">case</span> <span class="stringliteral">&#39;radialgradient&#39;</span>:
<a name="l01505"></a>01505           <span class="keywordflow">case</span> <span class="stringliteral">&#39;lineargradient&#39;</span>:
<a name="l01506"></a>01506             $last_gradid = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01507"></a>01507           <span class="keywordflow">break</span>;
<a name="l01508"></a>01508           <span class="keywordflow">case</span> <span class="stringliteral">&quot;text&quot;</span>:
<a name="l01509"></a>01509             $path_cmd = $svg_class-&gt;svgText();
<a name="l01510"></a>01510             <span class="comment">// echo &#39;path &gt;&gt; &#39;.$path_cmd.&quot;&lt;br&gt;&lt;br&gt;&quot;;</span>
<a name="l01511"></a>01511             <span class="comment">// echo &quot;style &gt;&gt; &quot;.$get_style[1].&quot;&lt;br&gt;&lt;br&gt;&quot;;</span>
<a name="l01512"></a>01512             $svg_class-&gt;svgWriteString($path_cmd);
<a name="l01513"></a>01513           <span class="keywordflow">break</span>;
<a name="l01514"></a>01514         }
<a name="l01515"></a>01515 
<a name="l01516"></a>01516       }
<a name="l01517"></a>01517 
<a name="l01518"></a>01518     }
<a name="l01519"></a>01519 
<a name="l01520"></a>01520     $svg2pdf_xml=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01521"></a>01521     global $svg_class;
<a name="l01522"></a>01522 
<a name="l01523"></a>01523     $svg_class = $this;
<a name="l01524"></a>01524     $svg2pdf_xml_parser = xml_parser_create(<span class="stringliteral">&quot;utf-8&quot;</span>);
<a name="l01525"></a>01525     xml_parser_set_option($svg2pdf_xml_parser, XML_OPTION_CASE_FOLDING, <span class="keyword">false</span>);
<a name="l01526"></a>01526     xml_set_element_handler($svg2pdf_xml_parser, <span class="stringliteral">&quot;xml_svg2pdf_start&quot;</span>, <span class="stringliteral">&quot;xml_svg2pdf_end&quot;</span>);
<a name="l01527"></a>01527     xml_set_character_data_handler($svg2pdf_xml_parser, <span class="stringliteral">&quot;characterData&quot;</span>);
<a name="l01528"></a>01528     xml_parse($svg2pdf_xml_parser, $data);
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     <span class="keywordflow">return</span> array(<span class="charliteral">&#39;x&#39;</span>=&gt;$this-&gt;svg_info[<span class="charliteral">&#39;x&#39;</span>],<span class="charliteral">&#39;y&#39;</span>=&gt;-$this-&gt;svg_info[<span class="charliteral">&#39;y&#39;</span>],<span class="charliteral">&#39;w&#39;</span>=&gt;$this-&gt;svg_info[<span class="charliteral">&#39;w&#39;</span>],<span class="charliteral">&#39;h&#39;</span>=&gt;-$this-&gt;svg_info[<span class="charliteral">&#39;h&#39;</span>],<span class="stringliteral">&#39;data&#39;</span>=&gt;$svg_class-&gt;svg_string);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532   }
<a name="l01533"></a>01533 
<a name="l01534"></a>01534 }
<a name="l01535"></a>01535 
<a name="l01536"></a>01536 ?&gt;
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
