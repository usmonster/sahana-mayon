<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: web/wiki/install.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>web/wiki/install.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00008"></a>00008 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;DOKU_INC&#39;</span>)) define(<span class="stringliteral">&#39;DOKU_INC&#39;</span>,dirname(__FILE__).<span class="charliteral">&#39;/&#39;</span>);
<a name="l00009"></a>00009 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;DOKU_CONF&#39;</span>)) define(<span class="stringliteral">&#39;DOKU_CONF&#39;</span>,DOKU_INC.<span class="stringliteral">&#39;conf/&#39;</span>);
<a name="l00010"></a>00010 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;DOKU_LOCAL&#39;</span>)) define(<span class="stringliteral">&#39;DOKU_LOCAL&#39;</span>,DOKU_INC.<span class="stringliteral">&#39;conf/&#39;</span>);
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment">// check for error reporting override or set error reporting to sane values</span>
<a name="l00013"></a>00013 <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DOKU_E_LEVEL&#39;</span>)) { error_reporting(E_ALL ^ E_NOTICE); }
<a name="l00014"></a>00014 <span class="keywordflow">else</span> { error_reporting(DOKU_E_LEVEL); }
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">// kill magic quotes</span>
<a name="l00017"></a>00017 <span class="keywordflow">if</span> (get_magic_quotes_gpc() &amp;&amp; !defined(<span class="stringliteral">&#39;MAGIC_QUOTES_STRIPPED&#39;</span>)) {
<a name="l00018"></a>00018     <span class="keywordflow">if</span> (!empty($_GET))    remove_magic_quotes($_GET);
<a name="l00019"></a>00019     <span class="keywordflow">if</span> (!empty($_POST))   remove_magic_quotes($_POST);
<a name="l00020"></a>00020     <span class="keywordflow">if</span> (!empty($_COOKIE)) remove_magic_quotes($_COOKIE);
<a name="l00021"></a>00021     <span class="keywordflow">if</span> (!empty($_REQUEST)) remove_magic_quotes($_REQUEST);
<a name="l00022"></a>00022     @ini_set(<span class="stringliteral">&#39;magic_quotes_gpc&#39;</span>, 0);
<a name="l00023"></a>00023     define(<span class="stringliteral">&#39;MAGIC_QUOTES_STRIPPED&#39;</span>,1);
<a name="l00024"></a>00024 }
<a name="l00025"></a>00025 @set_magic_quotes_runtime(0);
<a name="l00026"></a>00026 @ini_set(<span class="stringliteral">&#39;magic_quotes_sybase&#39;</span>,0);
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">// language strings</span>
<a name="l00029"></a>00029 require_once(DOKU_INC.<span class="stringliteral">&#39;inc/lang/en/lang.php&#39;</span>);
<a name="l00030"></a>00030 $LC = preg_replace(<span class="stringliteral">&#39;/[^a-z\-]+/&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$_REQUEST[<span class="charliteral">&#39;l&#39;</span>]);
<a name="l00031"></a>00031 <span class="keywordflow">if</span>(!$LC) $LC = <span class="stringliteral">&#39;en&#39;</span>;
<a name="l00032"></a>00032 <span class="keywordflow">if</span>($LC &amp;&amp; $LC != <span class="stringliteral">&#39;en&#39;</span> ) {
<a name="l00033"></a>00033     require_once(DOKU_INC.<span class="stringliteral">&#39;inc/lang/&#39;</span>.$LC.<span class="stringliteral">&#39;/lang.php&#39;</span>);
<a name="l00034"></a>00034 }
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">// initialise variables ...</span>
<a name="l00037"></a>00037 $error = array();
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 $dokuwiki_hash = array(
<a name="l00040"></a>00040     <span class="stringliteral">&#39;2005-09-22&#39;</span>   =&gt; <span class="stringliteral">&#39;e33223e957b0b0a130d0520db08f8fb7&#39;</span>,
<a name="l00041"></a>00041     <span class="stringliteral">&#39;2006-03-05&#39;</span>   =&gt; <span class="stringliteral">&#39;51295727f79ab9af309a2fd9e0b61acc&#39;</span>,
<a name="l00042"></a>00042     <span class="stringliteral">&#39;2006-03-09&#39;</span>   =&gt; <span class="stringliteral">&#39;51295727f79ab9af309a2fd9e0b61acc&#39;</span>,
<a name="l00043"></a>00043     <span class="stringliteral">&#39;2006-11-06&#39;</span>   =&gt; <span class="stringliteral">&#39;b3a8af76845977c2000d85d6990dd72b&#39;</span>,
<a name="l00044"></a>00044     <span class="stringliteral">&#39;2007-05-24&#39;</span>   =&gt; <span class="stringliteral">&#39;d80f2740c84c4a6a791fd3c7a353536f&#39;</span>,
<a name="l00045"></a>00045     <span class="stringliteral">&#39;2007-06-26&#39;</span>   =&gt; <span class="stringliteral">&#39;b3ca19c7a654823144119980be73cd77&#39;</span>,
<a name="l00046"></a>00046     <span class="stringliteral">&#39;2008-05-04&#39;</span>   =&gt; <span class="stringliteral">&#39;1e5c42eac3219d9e21927c39e3240aad&#39;</span>,
<a name="l00047"></a>00047     <span class="stringliteral">&#39;2009-02-14&#39;</span>   =&gt; <span class="stringliteral">&#39;ec8c04210732a14fdfce0f7f6eead865&#39;</span>,
<a name="l00048"></a>00048     <span class="stringliteral">&#39;2009-12-25&#39;</span>   =&gt; <span class="stringliteral">&#39;993c4b2b385643efe5abf8e7010e11f4&#39;</span>,
<a name="l00049"></a>00049     <span class="stringliteral">&#39;2010-11-07&#39;</span>   =&gt; <span class="stringliteral">&#39;7921d48195f4db21b8ead6d9bea801b8&#39;</span>,
<a name="l00050"></a>00050     <span class="stringliteral">&#39;2011-05-25&#39;</span>   =&gt; <span class="stringliteral">&#39;4241865472edb6fa14a1227721008072&#39;</span>,
<a name="l00051"></a>00051     <span class="stringliteral">&#39;2011-11-10&#39;</span>   =&gt; <span class="stringliteral">&#39;b46ff19a7587966ac4df61cbab1b8b31&#39;</span>,
<a name="l00052"></a>00052     <span class="stringliteral">&#39;2012-01-25&#39;</span>   =&gt; <span class="stringliteral">&#39;72c083c73608fc43c586901fd5dabb74&#39;</span>,
<a name="l00053"></a>00053 );
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">// begin output</span>
<a name="l00058"></a>00058 header(<span class="stringliteral">&#39;Content-Type: text/html; charset=utf-8&#39;</span>);
<a name="l00059"></a>00059 ?&gt;
<a name="l00060"></a>00060 &lt;!DOCTYPE html PUBLIC <span class="stringliteral">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
<a name="l00061"></a>00061  <span class="stringliteral">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;
<a name="l00062"></a>00062 &lt;html xmlns=<span class="stringliteral">&quot;http://www.w3.org/1999/xhtml&quot;</span> xml:lang=<span class="stringliteral">&quot;&lt;?php echo $LC?&gt;&quot;</span>
<a name="l00063"></a>00063  lang=<span class="stringliteral">&quot;&lt;?php echo $LC?&gt;&quot;</span> dir=<span class="stringliteral">&quot;&lt;?php echo $lang[&#39;direction&#39;]?&gt;&quot;</span>&gt;
<a name="l00064"></a>00064 &lt;head&gt;
<a name="l00065"></a>00065     &lt;meta http-equiv=<span class="stringliteral">&quot;Content-Type&quot;</span> content=<span class="stringliteral">&quot;text/html; charset=utf-8&quot;</span> /&gt;
<a name="l00066"></a>00066     &lt;title&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_installer&#39;</span>]?&gt;&lt;/title&gt;
<a name="l00067"></a>00067     &lt;style type=<span class="stringliteral">&quot;text/css&quot;</span>&gt;
<a name="l00068"></a>00068         body { width: 90%; margin: 0 <span class="keyword">auto</span>; font: 84% Verdana, Helvetica, Arial, sans-serif; }
<a name="l00069"></a>00069         img { border: none }
<a name="l00070"></a>00070         br.cl { clear:both; }
<a name="l00071"></a>00071         code { font-size: 110%; color: #800000; }
<a name="l00072"></a>00072         fieldset { border: none }
<a name="l00073"></a>00073         label { display: block; margin-top: 0.5em; }
<a name="l00074"></a>00074         select.text, input.text { width: 30em; margin: 0 0.5em; }
<a name="l00075"></a>00075         a {text-decoration: none}
<a name="l00076"></a>00076     &lt;/style&gt;
<a name="l00077"></a>00077     &lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span> language=<span class="stringliteral">&quot;javascript&quot;</span>&gt;
<a name="l00078"></a>00078         function acltoggle(){
<a name="l00079"></a>00079             var cb = document.getElementById(<span class="stringliteral">&#39;acl&#39;</span>);
<a name="l00080"></a>00080             var fs = document.getElementById(<span class="stringliteral">&#39;acldep&#39;</span>);
<a name="l00081"></a>00081             <span class="keywordflow">if</span>(!cb || !fs) <span class="keywordflow">return</span>;
<a name="l00082"></a>00082             <span class="keywordflow">if</span>(cb.checked){
<a name="l00083"></a>00083                 fs.style.display = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00084"></a>00084             }<span class="keywordflow">else</span>{
<a name="l00085"></a>00085                 fs.style.display = <span class="stringliteral">&#39;none&#39;</span>;
<a name="l00086"></a>00086             }
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088         window.onload = function(){
<a name="l00089"></a>00089             acltoggle();
<a name="l00090"></a>00090             var cb = document.getElementById(<span class="stringliteral">&#39;acl&#39;</span>);
<a name="l00091"></a>00091             <span class="keywordflow">if</span>(cb) cb.onchange = acltoggle;
<a name="l00092"></a>00092         };
<a name="l00093"></a>00093     &lt;/script&gt;
<a name="l00094"></a>00094 &lt;/head&gt;
<a name="l00095"></a>00095 &lt;body style=<span class="stringliteral">&quot;&quot;</span>&gt;
<a name="l00096"></a>00096     &lt;h1 style=<span class="stringliteral">&quot;float:left&quot;</span>&gt;
<a name="l00097"></a>00097         &lt;img src=<span class="stringliteral">&quot;lib/exe/fetch.php?media=wiki:dokuwiki-128.png&amp;w=64&quot;</span>
<a name="l00098"></a>00098              style=<span class="stringliteral">&quot;vertical-align: middle;&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> /&gt;
<a name="l00099"></a>00099         &lt;?php echo $lang[<span class="stringliteral">&#39;i_installer&#39;</span>]?&gt;
<a name="l00100"></a>00100     &lt;/h1&gt;
<a name="l00101"></a>00101     &lt;div style=<span class="stringliteral">&quot;float:right; margin: 1em;&quot;</span>&gt;
<a name="l00102"></a>00102         &lt;?php langsel()?&gt;
<a name="l00103"></a>00103     &lt;/div&gt;
<a name="l00104"></a>00104     &lt;br <span class="keyword">class</span>=<span class="stringliteral">&quot;cl&quot;</span> /&gt;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     &lt;div style=<span class="stringliteral">&quot;float: right; width: 34%;&quot;</span>&gt;
<a name="l00107"></a>00107         &lt;?php
<a name="l00108"></a>00108             <span class="keywordflow">if</span>(@file_exists(DOKU_INC.<span class="stringliteral">&#39;inc/lang/&#39;</span>.$LC.<span class="stringliteral">&#39;/install.html&#39;</span>)){
<a name="l00109"></a>00109                 include(DOKU_INC.<span class="stringliteral">&#39;inc/lang/&#39;</span>.$LC.<span class="stringliteral">&#39;/install.html&#39;</span>);
<a name="l00110"></a>00110             }<span class="keywordflow">else</span>{
<a name="l00111"></a>00111                 print <span class="stringliteral">&quot;&lt;div lang=\&quot;en\&quot; dir=\&quot;ltr\&quot;&gt;\n&quot;</span>;
<a name="l00112"></a>00112                 include(DOKU_INC.<span class="stringliteral">&#39;inc/lang/en/install.html&#39;</span>);
<a name="l00113"></a>00113                 print <span class="stringliteral">&quot;&lt;/div&gt;\n&quot;</span>;
<a name="l00114"></a>00114             }
<a name="l00115"></a>00115         ?&gt;
<a name="l00116"></a>00116         &lt;a style=<span class="stringliteral">&quot;background: transparent url(data/security.png) left top no-repeat;</span>
<a name="l00117"></a>00117 <span class="stringliteral">                  display: block; width:380px; height:73px; border:none; clear:both;&quot;</span>
<a name="l00118"></a>00118            target=<span class="stringliteral">&quot;_blank&quot;</span>
<a name="l00119"></a>00119            href=<span class="stringliteral">&quot;http://www.dokuwiki.org/security#web_access_security&quot;</span>&gt;&lt;/a&gt;
<a name="l00120"></a>00120     &lt;/div&gt;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     &lt;div style=<span class="stringliteral">&quot;float: left; width: 58%;&quot;</span>&gt;
<a name="l00123"></a>00123         &lt;?php
<a name="l00124"></a>00124             <span class="keywordflow">if</span>(! (check_functions() &amp;&amp; check_permissions()) ){
<a name="l00125"></a>00125                 echo <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;i_problems&#39;</span>].<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
<a name="l00126"></a>00126                 print_errors();
<a name="l00127"></a>00127                 print_retry();
<a name="l00128"></a>00128             }elseif(!check_configs()){
<a name="l00129"></a>00129                 echo <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;i_modified&#39;</span>].<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
<a name="l00130"></a>00130                 print_errors();
<a name="l00131"></a>00131             }elseif($_REQUEST[<span class="stringliteral">&#39;submit&#39;</span>]){
<a name="l00132"></a>00132                 <span class="keywordflow">if</span>(!check_data($_REQUEST[<span class="charliteral">&#39;d&#39;</span>])){
<a name="l00133"></a>00133                     print_errors();
<a name="l00134"></a>00134                     print_form($_REQUEST[<span class="charliteral">&#39;d&#39;</span>]);
<a name="l00135"></a>00135                 }elseif(!store_data($_REQUEST[<span class="charliteral">&#39;d&#39;</span>])){
<a name="l00136"></a>00136                     echo <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;i_failure&#39;</span>].<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
<a name="l00137"></a>00137                     print_errors();
<a name="l00138"></a>00138                 }<span class="keywordflow">else</span>{
<a name="l00139"></a>00139                     echo <span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;i_success&#39;</span>].<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
<a name="l00140"></a>00140                 }
<a name="l00141"></a>00141             }<span class="keywordflow">else</span>{
<a name="l00142"></a>00142                 print_form($_REQUEST[<span class="charliteral">&#39;d&#39;</span>]);
<a name="l00143"></a>00143             }
<a name="l00144"></a>00144         ?&gt;
<a name="l00145"></a>00145     &lt;/div&gt;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 &lt;div style=<span class="stringliteral">&quot;clear: both&quot;</span>&gt;
<a name="l00149"></a>00149   &lt;a href=<span class="stringliteral">&quot;http://dokuwiki.org/&quot;</span>&gt;&lt;img src=<span class="stringliteral">&quot;lib/tpl/default/images/button-dw.png&quot;</span> alt=<span class="stringliteral">&quot;driven by DokuWiki&quot;</span> /&gt;&lt;/a&gt;
<a name="l00150"></a>00150   &lt;a href=<span class="stringliteral">&quot;http://www.php.net&quot;</span>&gt;&lt;img src=<span class="stringliteral">&quot;lib/tpl/default/images/button-php.gif&quot;</span> alt=<span class="stringliteral">&quot;powered by PHP&quot;</span> /&gt;&lt;/a&gt;
<a name="l00151"></a>00151 &lt;/div&gt;
<a name="l00152"></a>00152 &lt;/body&gt;
<a name="l00153"></a>00153 &lt;/html&gt;
<a name="l00154"></a>00154 &lt;?php
<a name="l00155"></a>00155 
<a name="l00159"></a>00159 function print_form($d){
<a name="l00160"></a>00160     global $lang;
<a name="l00161"></a>00161     global $LC;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     include(DOKU_CONF.<span class="stringliteral">&#39;license.php&#39;</span>);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">if</span>(!is_array($d)) $d = array();
<a name="l00166"></a>00166     $d = array_map(<span class="stringliteral">&#39;htmlspecialchars&#39;</span>,$d);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <span class="keywordflow">if</span>(!isset($d[<span class="stringliteral">&#39;acl&#39;</span>])) $d[<span class="stringliteral">&#39;acl&#39;</span>]=1;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     ?&gt;
<a name="l00171"></a>00171     &lt;form action=<span class="stringliteral">&quot;&quot;</span> method=<span class="stringliteral">&quot;post&quot;</span>&gt;
<a name="l00172"></a>00172     &lt;input type=<span class="stringliteral">&quot;hidden&quot;</span> name=<span class="stringliteral">&quot;l&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $LC ?&gt;&quot;</span> /&gt;
<a name="l00173"></a>00173     &lt;fieldset&gt;
<a name="l00174"></a>00174         &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;title&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_wikiname&#39;</span>]?&gt;
<a name="l00175"></a>00175         &lt;input type=<span class="stringliteral">&quot;text&quot;</span> name=<span class="stringliteral">&quot;d[title]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;title&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $d[&#39;title&#39;] ?&gt;&quot;</span> style=<span class="stringliteral">&quot;width: 20em;&quot;</span> /&gt;
<a name="l00176"></a>00176         &lt;/label&gt;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         &lt;fieldset style=<span class="stringliteral">&quot;margin-top: 1em;&quot;</span>&gt;
<a name="l00179"></a>00179             &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;acl&quot;</span>&gt;
<a name="l00180"></a>00180             &lt;input type=<span class="stringliteral">&quot;checkbox&quot;</span> name=<span class="stringliteral">&quot;d[acl]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;acl&quot;</span> &lt;?php echo(($d[<span class="stringliteral">&#39;acl&#39;</span>] ? <span class="stringliteral">&#39;checked=&quot;checked&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>));?&gt; /&gt;
<a name="l00181"></a>00181             &lt;?php echo $lang[<span class="stringliteral">&#39;i_enableacl&#39;</span>]?&gt;&lt;/label&gt;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183             &lt;fieldset <span class="keywordtype">id</span>=<span class="stringliteral">&quot;acldep&quot;</span>&gt;
<a name="l00184"></a>00184                 &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;superuser&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_superuser&#39;</span>]?&gt;&lt;/label&gt;
<a name="l00185"></a>00185                 &lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;text&quot;</span> type=<span class="stringliteral">&quot;text&quot;</span> name=<span class="stringliteral">&quot;d[superuser]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;superuser&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $d[&#39;superuser&#39;] ?&gt;&quot;</span> /&gt;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                 &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;fullname&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;fullname&#39;</span>]?&gt;&lt;/label&gt;
<a name="l00188"></a>00188                 &lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;text&quot;</span> type=<span class="stringliteral">&quot;text&quot;</span> name=<span class="stringliteral">&quot;d[fullname]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;fullname&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $d[&#39;fullname&#39;] ?&gt;&quot;</span> /&gt;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190                 &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;email&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;email&#39;</span>]?&gt;&lt;/label&gt;
<a name="l00191"></a>00191                 &lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;text&quot;</span> type=<span class="stringliteral">&quot;text&quot;</span> name=<span class="stringliteral">&quot;d[email]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;email&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $d[&#39;email&#39;] ?&gt;&quot;</span> /&gt;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193                 &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;password&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;pass&#39;</span>]?&gt;&lt;/label&gt;
<a name="l00194"></a>00194                 &lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;text&quot;</span> type=<span class="stringliteral">&quot;password&quot;</span> name=<span class="stringliteral">&quot;d[password]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;password&quot;</span> /&gt;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196                 &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;confirm&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;passchk&#39;</span>]?&gt;&lt;/label&gt;
<a name="l00197"></a>00197                 &lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;text&quot;</span> type=<span class="stringliteral">&quot;password&quot;</span> name=<span class="stringliteral">&quot;d[confirm]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;confirm&quot;</span> /&gt;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199                 &lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;policy&quot;</span>&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_policy&#39;</span>]?&gt;&lt;/label&gt;
<a name="l00200"></a>00200                 &lt;select <span class="keyword">class</span>=<span class="stringliteral">&quot;text&quot;</span> name=<span class="stringliteral">&quot;d[policy]&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;policy&quot;</span>&gt;
<a name="l00201"></a>00201                     &lt;option value=<span class="stringliteral">&quot;0&quot;</span> &lt;?php echo ($d[<span class="stringliteral">&#39;policy&#39;</span>] == 0)?<span class="stringliteral">&#39;selected=&quot;selected&quot;&#39;</span>:<span class="stringliteral">&#39;&#39;</span> ?&gt;&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_pol0&#39;</span>]?&gt;&lt;/option&gt;
<a name="l00202"></a>00202                     &lt;option value=<span class="stringliteral">&quot;1&quot;</span> &lt;?php echo ($d[<span class="stringliteral">&#39;policy&#39;</span>] == 1)?<span class="stringliteral">&#39;selected=&quot;selected&quot;&#39;</span>:<span class="stringliteral">&#39;&#39;</span> ?&gt;&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_pol1&#39;</span>]?&gt;&lt;/option&gt;
<a name="l00203"></a>00203                     &lt;option value=<span class="stringliteral">&quot;2&quot;</span> &lt;?php echo ($d[<span class="stringliteral">&#39;policy&#39;</span>] == 2)?<span class="stringliteral">&#39;selected=&quot;selected&quot;&#39;</span>:<span class="stringliteral">&#39;&#39;</span> ?&gt;&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_pol2&#39;</span>]?&gt;&lt;/option&gt;
<a name="l00204"></a>00204                 &lt;/select&gt;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206             &lt;/fieldset&gt;
<a name="l00207"></a>00207         &lt;/fieldset&gt;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         &lt;fieldset&gt;
<a name="l00210"></a>00210             &lt;p&gt;&lt;?php echo $lang[<span class="stringliteral">&#39;i_license&#39;</span>]?&gt;&lt;/p&gt;
<a name="l00211"></a>00211             &lt;?php
<a name="l00212"></a>00212             array_unshift($license,array(<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;None&#39;</span>, <span class="stringliteral">&#39;url&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>));
<a name="l00213"></a>00213             <span class="keywordflow">if</span>(!isset($d[<span class="stringliteral">&#39;license&#39;</span>])) $d[<span class="stringliteral">&#39;license&#39;</span>] = <span class="stringliteral">&#39;cc-by-sa&#39;</span>;
<a name="l00214"></a>00214             <span class="keywordflow">foreach</span>($license as $key =&gt; $lic){
<a name="l00215"></a>00215                 echo <span class="stringliteral">&#39;&lt;label for=&quot;lic_&#39;</span>.$key.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00216"></a>00216                 echo <span class="stringliteral">&#39;&lt;input type=&quot;radio&quot; name=&quot;d[license]&quot; value=&quot;&#39;</span>.htmlspecialchars($key).<span class="stringliteral">&#39;&quot; id=&quot;lic_&#39;</span>.$key.<span class="charliteral">&#39;&quot;&#39;</span>.
<a name="l00217"></a>00217                      (($d[<span class="stringliteral">&#39;license&#39;</span>] == $key)?<span class="stringliteral">&#39;checked=&quot;checked&quot;&#39;</span>:<span class="stringliteral">&#39;&#39;</span>).<span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l00218"></a>00218                 echo htmlspecialchars($lic[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l00219"></a>00219                 <span class="keywordflow">if</span>($lic[<span class="stringliteral">&#39;url&#39;</span>]) echo <span class="stringliteral">&#39; &lt;a href=&quot;&#39;</span>.$lic[<span class="stringliteral">&#39;url&#39;</span>].<span class="stringliteral">&#39;&quot; target=&quot;_blank&quot;&gt;&lt;sup&gt;[?]&lt;/sup&gt;&lt;/a&gt;&#39;</span>;
<a name="l00220"></a>00220                 echo <span class="stringliteral">&#39;&lt;/label&gt;&#39;</span>;
<a name="l00221"></a>00221             }
<a name="l00222"></a>00222             ?&gt;
<a name="l00223"></a>00223         &lt;/fieldset&gt;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     &lt;/fieldset&gt;
<a name="l00226"></a>00226     &lt;fieldset <span class="keywordtype">id</span>=<span class="stringliteral">&quot;process&quot;</span>&gt;
<a name="l00227"></a>00227         &lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;button&quot;</span> type=<span class="stringliteral">&quot;submit&quot;</span> name=<span class="stringliteral">&quot;submit&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $lang[&#39;btn_save&#39;]?&gt;&quot;</span> /&gt;
<a name="l00228"></a>00228     &lt;/fieldset&gt;
<a name="l00229"></a>00229     &lt;/form&gt;
<a name="l00230"></a>00230     &lt;?php
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 function print_retry() {
<a name="l00234"></a>00234     global $lang;
<a name="l00235"></a>00235     global $LC;
<a name="l00236"></a>00236     ?&gt;
<a name="l00237"></a>00237     &lt;form action=<span class="stringliteral">&quot;&quot;</span> method=<span class="stringliteral">&quot;get&quot;</span>&gt;
<a name="l00238"></a>00238       &lt;fieldset&gt;
<a name="l00239"></a>00239         &lt;input type=<span class="stringliteral">&quot;hidden&quot;</span> name=<span class="stringliteral">&quot;l&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $LC ?&gt;&quot;</span> /&gt;
<a name="l00240"></a>00240         &lt;input <span class="keyword">class</span>=<span class="stringliteral">&quot;button&quot;</span> type=<span class="stringliteral">&quot;submit&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $lang[&#39;i_retry&#39;];?&gt;&quot;</span> /&gt;
<a name="l00241"></a>00241       &lt;/fieldset&gt;
<a name="l00242"></a>00242     &lt;/form&gt;
<a name="l00243"></a>00243     &lt;?php
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00251"></a>00251 function check_data(&amp;$d){
<a name="l00252"></a>00252     global $lang;
<a name="l00253"></a>00253     global $error;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="comment">//autolowercase the username</span>
<a name="l00256"></a>00256     $d[<span class="stringliteral">&#39;superuser&#39;</span>] = strtolower($d[<span class="stringliteral">&#39;superuser&#39;</span>]);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     $ok = <span class="keyword">true</span>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     <span class="comment">// check input</span>
<a name="l00261"></a>00261     <span class="keywordflow">if</span>(empty($d[<span class="stringliteral">&#39;title&#39;</span>])){
<a name="l00262"></a>00262         $error[] = sprintf($lang[<span class="stringliteral">&#39;i_badval&#39;</span>],$lang[<span class="stringliteral">&#39;i_wikiname&#39;</span>]);
<a name="l00263"></a>00263         $ok      = <span class="keyword">false</span>;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265     <span class="keywordflow">if</span>($d[<span class="stringliteral">&#39;acl&#39;</span>]){
<a name="l00266"></a>00266         <span class="keywordflow">if</span>(!preg_match(<span class="stringliteral">&#39;/^[a-z0-9_]+$/&#39;</span>,$d[<span class="stringliteral">&#39;superuser&#39;</span>])){
<a name="l00267"></a>00267             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_badval&#39;</span>],$lang[<span class="stringliteral">&#39;i_superuser&#39;</span>]);
<a name="l00268"></a>00268             $ok      = <span class="keyword">false</span>;
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270         <span class="keywordflow">if</span>(empty($d[<span class="stringliteral">&#39;password&#39;</span>])){
<a name="l00271"></a>00271             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_badval&#39;</span>],$lang[<span class="stringliteral">&#39;pass&#39;</span>]);
<a name="l00272"></a>00272             $ok      = <span class="keyword">false</span>;
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         <span class="keywordflow">if</span>($d[<span class="stringliteral">&#39;confirm&#39;</span>] != $d[<span class="stringliteral">&#39;password&#39;</span>]){
<a name="l00275"></a>00275             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_badval&#39;</span>],$lang[<span class="stringliteral">&#39;passchk&#39;</span>]);
<a name="l00276"></a>00276             $ok      = <span class="keyword">false</span>;
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278         <span class="keywordflow">if</span>(empty($d[<span class="stringliteral">&#39;fullname&#39;</span>]) || strstr($d[<span class="stringliteral">&#39;fullname&#39;</span>],<span class="charliteral">&#39;:&#39;</span>)){
<a name="l00279"></a>00279             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_badval&#39;</span>],$lang[<span class="stringliteral">&#39;fullname&#39;</span>]);
<a name="l00280"></a>00280             $ok      = <span class="keyword">false</span>;
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282         <span class="keywordflow">if</span>(empty($d[<span class="stringliteral">&#39;email&#39;</span>]) || strstr($d[<span class="stringliteral">&#39;email&#39;</span>],<span class="charliteral">&#39;:&#39;</span>) || !strstr($d[<span class="stringliteral">&#39;email&#39;</span>],<span class="charliteral">&#39;@&#39;</span>)){
<a name="l00283"></a>00283             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_badval&#39;</span>],$lang[<span class="stringliteral">&#39;email&#39;</span>]);
<a name="l00284"></a>00284             $ok      = <span class="keyword">false</span>;
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287     <span class="keywordflow">return</span> $ok;
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00295"></a>00295 function store_data($d){
<a name="l00296"></a>00296     global $LC;
<a name="l00297"></a>00297     $ok = <span class="keyword">true</span>;
<a name="l00298"></a>00298     $d[<span class="stringliteral">&#39;policy&#39;</span>] = (int) $d[<span class="stringliteral">&#39;policy&#39;</span>];
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">// create local.php</span>
<a name="l00301"></a>00301     $now    = gmdate(<span class="charliteral">&#39;r&#39;</span>);
<a name="l00302"></a>00302     $output = &lt;&lt;&lt;EOT
<a name="l00303"></a>00303 &lt;?php
<a name="l00310"></a>00310 EOT;
<a name="l00311"></a>00311     $output .= <span class="stringliteral">&#39;$conf[\&#39;title\&#39;] = \&#39;&#39;</span>.addslashes($d[<span class="stringliteral">&#39;title&#39;</span>]).<span class="stringliteral">&quot;&#39;;\n&quot;</span>;
<a name="l00312"></a>00312     $output .= <span class="stringliteral">&#39;$conf[\&#39;lang\&#39;] = \&#39;&#39;</span>.addslashes($LC).<span class="stringliteral">&quot;&#39;;\n&quot;</span>;
<a name="l00313"></a>00313     $output .= <span class="stringliteral">&#39;$conf[\&#39;license\&#39;] = \&#39;&#39;</span>.addslashes($d[<span class="stringliteral">&#39;license&#39;</span>]).<span class="stringliteral">&quot;&#39;;\n&quot;</span>;
<a name="l00314"></a>00314     <span class="keywordflow">if</span>($d[<span class="stringliteral">&#39;acl&#39;</span>]){
<a name="l00315"></a>00315         $output .= <span class="stringliteral">&#39;$conf[\&#39;useacl\&#39;] = 1&#39;</span>.<span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00316"></a>00316         $output .= <span class="stringliteral">&quot;\$conf[&#39;superuser&#39;] = &#39;@admin&#39;;\n&quot;</span>;
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318     $ok = $ok &amp;&amp; fileWrite(DOKU_LOCAL.<span class="stringliteral">&#39;local.php&#39;</span>,$output);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">if</span> ($d[<span class="stringliteral">&#39;acl&#39;</span>]) {
<a name="l00321"></a>00321         <span class="comment">// create users.auth.php</span>
<a name="l00322"></a>00322         <span class="comment">// --- user:MD5password:Real Name:email:groups,comma,seperated</span>
<a name="l00323"></a>00323         $output = join(<span class="stringliteral">&quot;:&quot;</span>,array($d[<span class="stringliteral">&#39;superuser&#39;</span>], md5($d[<span class="stringliteral">&#39;password&#39;</span>]), $d[<span class="stringliteral">&#39;fullname&#39;</span>], $d[<span class="stringliteral">&#39;email&#39;</span>], <span class="stringliteral">&#39;admin,user&#39;</span>));
<a name="l00324"></a>00324         $output = @file_get_contents(DOKU_CONF.<span class="stringliteral">&#39;users.auth.php.dist&#39;</span>).<span class="stringliteral">&quot;\n$output\n&quot;</span>;
<a name="l00325"></a>00325         $ok = $ok &amp;&amp; fileWrite(DOKU_LOCAL.<span class="stringliteral">&#39;users.auth.php&#39;</span>, $output);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327         <span class="comment">// create acl.auth.php</span>
<a name="l00328"></a>00328         $output = &lt;&lt;&lt;EOT
<a name="l00329"></a>00329 <span class="preprocessor"># acl.auth.php</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span><span class="preprocessor"># &lt;?php exit()?&gt;</span>
<a name="l00331"></a>00331 <span class="preprocessor"></span><span class="preprocessor"># Don&#39;t modify the lines above</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span><span class="preprocessor"># Access Control Lists</span>
<a name="l00334"></a>00334 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span><span class="preprocessor"># Auto-generated by install script</span>
<a name="l00336"></a>00336 <span class="preprocessor"></span><span class="preprocessor"># Date: $now</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>
<a name="l00338"></a>00338 EOT;
<a name="l00339"></a>00339         <span class="keywordflow">if</span>($d[<span class="stringliteral">&#39;policy&#39;</span>] == 2){
<a name="l00340"></a>00340             $output .=  <span class="stringliteral">&quot;*               @ALL          0\n&quot;</span>;
<a name="l00341"></a>00341             $output .=  <span class="stringliteral">&quot;*               @user         8\n&quot;</span>;
<a name="l00342"></a>00342         }elseif($d[<span class="stringliteral">&#39;policy&#39;</span>] == 1){
<a name="l00343"></a>00343             $output .=  <span class="stringliteral">&quot;*               @ALL          1\n&quot;</span>;
<a name="l00344"></a>00344             $output .=  <span class="stringliteral">&quot;*               @user         8\n&quot;</span>;
<a name="l00345"></a>00345         }<span class="keywordflow">else</span>{
<a name="l00346"></a>00346             $output .=  <span class="stringliteral">&quot;*               @ALL          8\n&quot;</span>;
<a name="l00347"></a>00347         }
<a name="l00348"></a>00348         $ok = $ok &amp;&amp; fileWrite(DOKU_LOCAL.<span class="stringliteral">&#39;acl.auth.php&#39;</span>, $output);
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350     <span class="keywordflow">return</span> $ok;
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00358"></a>00358 function fileWrite($filename, $data) {
<a name="l00359"></a>00359     global $error;
<a name="l00360"></a>00360     global $lang;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (($fp = @fopen($filename, <span class="stringliteral">&#39;wb&#39;</span>)) === <span class="keyword">false</span>) {
<a name="l00363"></a>00363         $filename = str_replace($_SERVER[<span class="stringliteral">&#39;DOCUMENT_ROOT&#39;</span>],<span class="stringliteral">&#39;{DOCUMENT_ROOT}/&#39;</span>, $filename);
<a name="l00364"></a>00364         $error[]  = sprintf($lang[<span class="stringliteral">&#39;i_writeerr&#39;</span>],$filename);
<a name="l00365"></a>00365         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="keywordflow">if</span> (!empty($data)) { fwrite($fp, $data);  }
<a name="l00369"></a>00369     fclose($fp);
<a name="l00370"></a>00370     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 
<a name="l00380"></a>00380 function check_configs(){
<a name="l00381"></a>00381     global $error;
<a name="l00382"></a>00382     global $lang;
<a name="l00383"></a>00383     global $dokuwiki_hash;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     $ok = <span class="keyword">true</span>;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     $config_files = array(
<a name="l00388"></a>00388         <span class="stringliteral">&#39;local&#39;</span> =&gt; DOKU_LOCAL.<span class="stringliteral">&#39;local.php&#39;</span>,
<a name="l00389"></a>00389         <span class="stringliteral">&#39;users&#39;</span> =&gt; DOKU_LOCAL.<span class="stringliteral">&#39;users.auth.php&#39;</span>,
<a name="l00390"></a>00390         <span class="stringliteral">&#39;auth&#39;</span>  =&gt; DOKU_LOCAL.<span class="stringliteral">&#39;acl.auth.php&#39;</span>
<a name="l00391"></a>00391     );
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="comment">// main dokuwiki config file (conf/dokuwiki.php) must not have been modified</span>
<a name="l00394"></a>00394     $installation_hash = md5(preg_replace(<span class="stringliteral">&quot;/(\015\012)|(\015)/&quot;</span>,<span class="stringliteral">&quot;\012&quot;</span>,
<a name="l00395"></a>00395                              @file_get_contents(DOKU_CONF.<span class="stringliteral">&#39;dokuwiki.php&#39;</span>)));
<a name="l00396"></a>00396     <span class="keywordflow">if</span> (!in_array($installation_hash, $dokuwiki_hash)) {
<a name="l00397"></a>00397         $error[] = sprintf($lang[<span class="stringliteral">&#39;i_badhash&#39;</span>],$installation_hash);
<a name="l00398"></a>00398         $ok = <span class="keyword">false</span>;
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="comment">// configs shouldn&#39;t exist</span>
<a name="l00402"></a>00402     <span class="keywordflow">foreach</span> ($config_files as $file) {
<a name="l00403"></a>00403         <span class="keywordflow">if</span> (@file_exists($file)) {
<a name="l00404"></a>00404             $file    = str_replace($_SERVER[<span class="stringliteral">&#39;DOCUMENT_ROOT&#39;</span>],<span class="stringliteral">&#39;{DOCUMENT_ROOT}/&#39;</span>, $file);
<a name="l00405"></a>00405             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_confexists&#39;</span>],$file);
<a name="l00406"></a>00406             $ok      = <span class="keyword">false</span>;
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409     <span class="keywordflow">return</span> $ok;
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00418"></a>00418 function check_permissions(){
<a name="l00419"></a>00419     global $error;
<a name="l00420"></a>00420     global $lang;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     $dirs = array(
<a name="l00423"></a>00423         <span class="stringliteral">&#39;conf&#39;</span>        =&gt; DOKU_LOCAL,
<a name="l00424"></a>00424         <span class="stringliteral">&#39;data&#39;</span>        =&gt; DOKU_INC.<span class="stringliteral">&#39;data&#39;</span>,
<a name="l00425"></a>00425         <span class="stringliteral">&#39;pages&#39;</span>       =&gt; DOKU_INC.<span class="stringliteral">&#39;data/pages&#39;</span>,
<a name="l00426"></a>00426         <span class="stringliteral">&#39;attic&#39;</span>       =&gt; DOKU_INC.<span class="stringliteral">&#39;data/attic&#39;</span>,
<a name="l00427"></a>00427         <span class="stringliteral">&#39;media&#39;</span>       =&gt; DOKU_INC.<span class="stringliteral">&#39;data/media&#39;</span>,
<a name="l00428"></a>00428         <span class="stringliteral">&#39;media_attic&#39;</span> =&gt; DOKU_INC.<span class="stringliteral">&#39;data/media_attic&#39;</span>,
<a name="l00429"></a>00429         <span class="stringliteral">&#39;media_meta&#39;</span>  =&gt; DOKU_INC.<span class="stringliteral">&#39;data/media_meta&#39;</span>,
<a name="l00430"></a>00430         <span class="stringliteral">&#39;meta&#39;</span>        =&gt; DOKU_INC.<span class="stringliteral">&#39;data/meta&#39;</span>,
<a name="l00431"></a>00431         <span class="stringliteral">&#39;cache&#39;</span>       =&gt; DOKU_INC.<span class="stringliteral">&#39;data/cache&#39;</span>,
<a name="l00432"></a>00432         <span class="stringliteral">&#39;locks&#39;</span>       =&gt; DOKU_INC.<span class="stringliteral">&#39;data/locks&#39;</span>,
<a name="l00433"></a>00433         <span class="stringliteral">&#39;index&#39;</span>       =&gt; DOKU_INC.<span class="stringliteral">&#39;data/index&#39;</span>,
<a name="l00434"></a>00434         <span class="stringliteral">&#39;tmp&#39;</span>         =&gt; DOKU_INC.<span class="stringliteral">&#39;data/tmp&#39;</span>
<a name="l00435"></a>00435     );
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     $ok = <span class="keyword">true</span>;
<a name="l00438"></a>00438     <span class="keywordflow">foreach</span>($dirs as $dir){
<a name="l00439"></a>00439         <span class="keywordflow">if</span>(!@file_exists(<span class="stringliteral">&quot;$dir/.&quot;</span>) || !@is_writable($dir)){
<a name="l00440"></a>00440             $dir     = str_replace($_SERVER[<span class="stringliteral">&#39;DOCUMENT_ROOT&#39;</span>],<span class="stringliteral">&#39;{DOCUMENT_ROOT}&#39;</span>, $dir);
<a name="l00441"></a>00441             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_permfail&#39;</span>],$dir);
<a name="l00442"></a>00442             $ok      = <span class="keyword">false</span>;
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445     <span class="keywordflow">return</span> $ok;
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00453"></a>00453 function check_functions(){
<a name="l00454"></a>00454     global $error;
<a name="l00455"></a>00455     global $lang;
<a name="l00456"></a>00456     $ok = <span class="keyword">true</span>;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="keywordflow">if</span>(version_compare(phpversion(),<span class="stringliteral">&#39;5.1.2&#39;</span>,<span class="charliteral">&#39;&lt;&#39;</span>)){
<a name="l00459"></a>00459         $error[] = sprintf($lang[<span class="stringliteral">&#39;i_phpver&#39;</span>],phpversion(),<span class="stringliteral">&#39;5.1.2&#39;</span>);
<a name="l00460"></a>00460         $ok = <span class="keyword">false</span>;
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     $funcs = explode(<span class="charliteral">&#39; &#39;</span>,<span class="stringliteral">&#39;addslashes basename call_user_func chmod copy fgets &#39;</span>.
<a name="l00464"></a>00464                          <span class="stringliteral">&#39;file file_exists fseek flush filesize ftell fopen &#39;</span>.
<a name="l00465"></a>00465                          <span class="stringliteral">&#39;glob header ignore_user_abort ini_get mail mkdir &#39;</span>.
<a name="l00466"></a>00466                          <span class="stringliteral">&#39;ob_start opendir parse_ini_file readfile realpath &#39;</span>.
<a name="l00467"></a>00467                          <span class="stringliteral">&#39;rename rmdir serialize session_start unlink usleep &#39;</span>.
<a name="l00468"></a>00468                          <span class="stringliteral">&#39;preg_replace file_get_contents htmlspecialchars_decode &#39;</span>.
<a name="l00469"></a>00469                          <span class="stringliteral">&#39;spl_autoload_register&#39;</span>);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;mb_substr&#39;</span>)) {
<a name="l00472"></a>00472         $funcs[] = <span class="stringliteral">&#39;utf8_encode&#39;</span>;
<a name="l00473"></a>00473         $funcs[] = <span class="stringliteral">&#39;utf8_decode&#39;</span>;
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="keywordflow">foreach</span>($funcs as $func){
<a name="l00477"></a>00477         <span class="keywordflow">if</span>(!function_exists($func)){
<a name="l00478"></a>00478             $error[] = sprintf($lang[<span class="stringliteral">&#39;i_funcna&#39;</span>],$func);
<a name="l00479"></a>00479             $ok = <span class="keyword">false</span>;
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482     <span class="keywordflow">return</span> $ok;
<a name="l00483"></a>00483 }
<a name="l00484"></a>00484 
<a name="l00490"></a>00490 function langsel(){
<a name="l00491"></a>00491     global $lang;
<a name="l00492"></a>00492     global $LC;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     $dir = DOKU_INC.<span class="stringliteral">&#39;inc/lang&#39;</span>;
<a name="l00495"></a>00495     $dh  = opendir($dir);
<a name="l00496"></a>00496     <span class="keywordflow">if</span>(!$dh) <span class="keywordflow">return</span>;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     $langs = array();
<a name="l00499"></a>00499     <span class="keywordflow">while</span> (($file = readdir($dh)) !== <span class="keyword">false</span>) {
<a name="l00500"></a>00500         <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/^[\._]/&#39;</span>,$file)) <span class="keywordflow">continue</span>;
<a name="l00501"></a>00501         <span class="keywordflow">if</span>(is_dir($dir.<span class="charliteral">&#39;/&#39;</span>.$file) &amp;&amp; @file_exists($dir.<span class="charliteral">&#39;/&#39;</span>.$file.<span class="stringliteral">&#39;/lang.php&#39;</span>)){
<a name="l00502"></a>00502             $langs[] = $file;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505     closedir($dh);
<a name="l00506"></a>00506     sort($langs);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     echo <span class="stringliteral">&#39;&lt;form action=&quot;&quot;&gt;&#39;</span>;
<a name="l00509"></a>00509     echo $lang[<span class="stringliteral">&#39;i_chooselang&#39;</span>];
<a name="l00510"></a>00510     echo <span class="stringliteral">&#39;: &lt;select name=&quot;l&quot; onchange=&quot;submit()&quot;&gt;&#39;</span>;
<a name="l00511"></a>00511     <span class="keywordflow">foreach</span>($langs as $l){
<a name="l00512"></a>00512         $sel = ($l == $LC) ? <span class="stringliteral">&#39;selected=&quot;selected&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00513"></a>00513         echo <span class="stringliteral">&#39;&lt;option value=&quot;&#39;</span>.$l.<span class="stringliteral">&#39;&quot; &#39;</span>.$sel.<span class="charliteral">&#39;&gt;&#39;</span>.$l.<span class="stringliteral">&#39;&lt;/option&gt;&#39;</span>;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515     echo <span class="stringliteral">&#39;&lt;/select&gt; &#39;</span>;
<a name="l00516"></a>00516     echo <span class="stringliteral">&#39;&lt;input type=&quot;submit&quot; value=&quot;&#39;</span>.$lang[<span class="stringliteral">&#39;btn_update&#39;</span>].<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l00517"></a>00517     echo <span class="stringliteral">&#39;&lt;/form&gt;&#39;</span>;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00525"></a>00525 function print_errors(){
<a name="l00526"></a>00526     global $error;
<a name="l00527"></a>00527     echo <span class="stringliteral">&#39;&lt;ul&gt;&#39;</span>;
<a name="l00528"></a>00528     <span class="keywordflow">foreach</span> ($error as $err){
<a name="l00529"></a>00529         echo <span class="stringliteral">&quot;&lt;li&gt;$err&lt;/li&gt;&quot;</span>;
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531     echo <span class="stringliteral">&#39;&lt;/ul&gt;&#39;</span>;
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00539"></a>00539 function remove_magic_quotes(&amp;$array) {
<a name="l00540"></a>00540     <span class="keywordflow">foreach</span> (array_keys($array) as $key) {
<a name="l00541"></a>00541         <span class="keywordflow">if</span> (is_array($array[$key])) {
<a name="l00542"></a>00542             remove_magic_quotes($array[$key]);
<a name="l00543"></a>00543         }<span class="keywordflow">else</span> {
<a name="l00544"></a>00544             $array[$key] = stripslashes($array[$key]);
<a name="l00545"></a>00545         }
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
