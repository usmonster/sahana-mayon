<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/phing/Phing.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/phing/Phing.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * $Id: Phing.php 385 2008-08-19 18:09:17Z mrook $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information please see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://phing.info&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 require_once <span class="stringliteral">&#39;phing/Project.php&#39;</span>;
<a name="l00023"></a>00023 require_once <span class="stringliteral">&#39;phing/ProjectComponent.php&#39;</span>;
<a name="l00024"></a>00024 require_once <span class="stringliteral">&#39;phing/Target.php&#39;</span>;
<a name="l00025"></a>00025 require_once <span class="stringliteral">&#39;phing/Task.php&#39;</span>;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 include_once <span class="stringliteral">&#39;phing/BuildException.php&#39;</span>;
<a name="l00028"></a>00028 include_once <span class="stringliteral">&#39;phing/ConfigurationException.php&#39;</span>;
<a name="l00029"></a>00029 include_once <span class="stringliteral">&#39;phing/BuildEvent.php&#39;</span>;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 include_once <span class="stringliteral">&#39;phing/parser/Location.php&#39;</span>;
<a name="l00032"></a>00032 include_once <span class="stringliteral">&#39;phing/parser/ExpatParser.php&#39;</span>;
<a name="l00033"></a>00033 include_once <span class="stringliteral">&#39;phing/parser/AbstractHandler.php&#39;</span>;
<a name="l00034"></a>00034 include_once <span class="stringliteral">&#39;phing/parser/ProjectConfigurator.php&#39;</span>;
<a name="l00035"></a>00035 include_once <span class="stringliteral">&#39;phing/parser/RootHandler.php&#39;</span>;
<a name="l00036"></a>00036 include_once <span class="stringliteral">&#39;phing/parser/ProjectHandler.php&#39;</span>;
<a name="l00037"></a>00037 include_once <span class="stringliteral">&#39;phing/parser/TaskHandler.php&#39;</span>;
<a name="l00038"></a>00038 include_once <span class="stringliteral">&#39;phing/parser/TargetHandler.php&#39;</span>;
<a name="l00039"></a>00039 include_once <span class="stringliteral">&#39;phing/parser/DataTypeHandler.php&#39;</span>;
<a name="l00040"></a>00040 include_once <span class="stringliteral">&#39;phing/parser/NestedElementHandler.php&#39;</span>;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 include_once <span class="stringliteral">&#39;phing/system/util/Properties.php&#39;</span>;
<a name="l00043"></a>00043 include_once <span class="stringliteral">&#39;phing/util/StringHelper.php&#39;</span>;
<a name="l00044"></a>00044 include_once <span class="stringliteral">&#39;phing/system/io/PhingFile.php&#39;</span>;
<a name="l00045"></a>00045 include_once <span class="stringliteral">&#39;phing/system/io/OutputStream.php&#39;</span>;
<a name="l00046"></a>00046 include_once <span class="stringliteral">&#39;phing/system/io/FileOutputStream.php&#39;</span>;
<a name="l00047"></a>00047 include_once <span class="stringliteral">&#39;phing/system/io/FileReader.php&#39;</span>;
<a name="l00048"></a>00048 include_once <span class="stringliteral">&#39;phing/system/util/Register.php&#39;</span>;
<a name="l00049"></a>00049 
<a name="l00064"></a><a class="code" href="classPhing.html">00064</a> <span class="keyword">class </span><a class="code" href="classPhing.html">Phing</a> {
<a name="l00065"></a>00065 
<a name="l00067"></a><a class="code" href="classPhing.html#a33b3318203bfe402a7641c21f53d52ae">00067</a>   <span class="keyword">const</span> <a class="code" href="classPhing.html#a33b3318203bfe402a7641c21f53d52ae" title="The default build file name.">DEFAULT_BUILD_FILENAME</a> = <span class="stringliteral">&quot;build.xml&quot;</span>;
<a name="l00068"></a>00068 
<a name="l00070"></a>00070   <span class="keyword">private</span> <span class="keyword">static</span> $msgOutputLevel = Project::MSG_INFO;
<a name="l00071"></a>00071 
<a name="l00073"></a>00073   <span class="keyword">private</span> $buildFile = null;
<a name="l00074"></a>00074 
<a name="l00076"></a>00076   <span class="keyword">private</span> $targets = array();
<a name="l00077"></a>00077 
<a name="l00082"></a>00082   <span class="keyword">private</span> <span class="keyword">static</span> $definedProps;
<a name="l00083"></a>00083 
<a name="l00085"></a>00085   <span class="keyword">private</span> $listeners = array();
<a name="l00086"></a>00086 
<a name="l00087"></a>00087   <span class="keyword">private</span> $loggerClassname = null;
<a name="l00088"></a>00088 
<a name="l00090"></a>00090   <span class="keyword">private</span> $inputHandlerClassname;
<a name="l00091"></a>00091 
<a name="l00093"></a>00093   <span class="keyword">private</span> $readyToRun = <span class="keyword">false</span>;
<a name="l00094"></a>00094 
<a name="l00096"></a>00096   <span class="keyword">private</span> $projectHelp = <span class="keyword">false</span>;
<a name="l00097"></a>00097 
<a name="l00099"></a>00099   <span class="keyword">private</span> <span class="keyword">static</span> $importPaths;
<a name="l00100"></a>00100 
<a name="l00102"></a>00102   <span class="keyword">private</span> <span class="keyword">static</span> $properties = array();
<a name="l00103"></a>00103 
<a name="l00105"></a>00105   <span class="keyword">private</span> <span class="keyword">static</span> $timer;
<a name="l00106"></a>00106 
<a name="l00108"></a>00108   <span class="keyword">private</span> <span class="keyword">static</span> $currentProject;
<a name="l00109"></a>00109 
<a name="l00111"></a>00111   <span class="keyword">private</span> <span class="keyword">static</span> $phpErrorCapture = <span class="keyword">false</span>;
<a name="l00112"></a>00112 
<a name="l00114"></a>00114   <span class="keyword">private</span> <span class="keyword">static</span> $capturedPhpErrors = array();
<a name="l00115"></a>00115 
<a name="l00119"></a>00119   <span class="keyword">private</span> <span class="keyword">static</span> $out;
<a name="l00120"></a>00120 
<a name="l00124"></a>00124   <span class="keyword">private</span> <span class="keyword">static</span> $err;
<a name="l00125"></a>00125 
<a name="l00129"></a>00129   <span class="keyword">private</span> <span class="keyword">static</span> $isLogFileUsed = <span class="keyword">false</span>;
<a name="l00130"></a>00130 
<a name="l00138"></a>00138   <span class="keyword">private</span> <span class="keyword">static</span> $origIniSettings = array();
<a name="l00139"></a>00139 
<a name="l00153"></a><a class="code" href="classPhing.html#a963467e5073e2841ceb2315366beb9b8">00153</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a963467e5073e2841ceb2315366beb9b8" title="Entry point allowing for more options from other front ends.">start</a>($args, array $additionalUserProperties = null) {
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keywordflow">try</span> {
<a name="l00156"></a>00156       $m = <span class="keyword">new</span> <a class="code" href="classPhing.html">Phing</a>();
<a name="l00157"></a>00157       $m-&gt;execute($args);
<a name="l00158"></a>00158     } <span class="keywordflow">catch</span> (Exception $exc) {
<a name="l00159"></a>00159       self::handleLogfile();
<a name="l00160"></a>00160       <span class="keywordflow">throw</span> $exc;
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="keywordflow">if</span> ($additionalUserProperties !== null) {
<a name="l00164"></a>00164       <span class="keywordflow">foreach</span>($additionalUserProperties as $key =&gt; $value) {
<a name="l00165"></a>00165         $m-&gt;setDefinedProperty($key, $value);
<a name="l00166"></a>00166       }
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="keywordflow">try</span> {
<a name="l00170"></a>00170       $m-&gt;runBuild();
<a name="l00171"></a>00171     } <span class="keywordflow">catch</span>(Exception $exc) {
<a name="l00172"></a>00172       self::handleLogfile();
<a name="l00173"></a>00173       <span class="keywordflow">throw</span> $exc;
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">// everything fine, shutdown</span>
<a name="l00177"></a>00177     self::handleLogfile();
<a name="l00178"></a>00178   }
<a name="l00179"></a>00179 
<a name="l00184"></a><a class="code" href="classPhing.html#ab6c9a21c93eae1d060f34a6c17c217c6">00184</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#ab6c9a21c93eae1d060f34a6c17c217c6" title="Prints the message of the Exception if it&amp;#39;s not null.">printMessage</a>(Exception $t) {
<a name="l00185"></a>00185     <span class="keywordflow">if</span> (self::$err === null) { <span class="comment">// Make sure our error output is initialized</span>
<a name="l00186"></a>00186       self::initializeOutputStreams();
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (self::getMsgOutputLevel() &gt;= Project::MSG_VERBOSE) {
<a name="l00189"></a>00189       self::$err-&gt;write($t-&gt;__toString() . PHP_EOL);
<a name="l00190"></a>00190     } <span class="keywordflow">else</span> {
<a name="l00191"></a>00191       self::$err-&gt;write($t-&gt;getMessage() . PHP_EOL);
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193   }
<a name="l00194"></a>00194 
<a name="l00198"></a>00198   <span class="keyword">private</span> <span class="keyword">static</span> function initializeOutputStreams() {
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (self::$out === null) {
<a name="l00200"></a>00200       self::$out = <span class="keyword">new</span> <a class="code" href="classOutputStream.html">OutputStream</a>(fopen(<span class="stringliteral">&quot;php://stdout&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>));
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202     <span class="keywordflow">if</span> (self::$err === null) {
<a name="l00203"></a>00203       self::$err = <span class="keyword">new</span> <a class="code" href="classOutputStream.html">OutputStream</a>(fopen(<span class="stringliteral">&quot;php://stderr&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>));
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206 
<a name="l00211"></a><a class="code" href="classPhing.html#afb59f3a87870911d88d8002f1e866851">00211</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#afb59f3a87870911d88d8002f1e866851" title="Sets the stream to use for standard (non-error) output.">setOutputStream</a>(<a class="code" href="classOutputStream.html">OutputStream</a> $stream) {
<a name="l00212"></a>00212     self::$out = $stream;
<a name="l00213"></a>00213   }
<a name="l00214"></a>00214 
<a name="l00219"></a><a class="code" href="classPhing.html#a5f0b86bdc86e5478f22fe139dba3526f">00219</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a5f0b86bdc86e5478f22fe139dba3526f" title="Gets the stream to use for standard (non-error) output.">getOutputStream</a>() {
<a name="l00220"></a>00220     <span class="keywordflow">return</span> self::$out;
<a name="l00221"></a>00221   }
<a name="l00222"></a>00222 
<a name="l00227"></a><a class="code" href="classPhing.html#a88413afd07b8b0e2e063dc254f803411">00227</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a88413afd07b8b0e2e063dc254f803411" title="Sets the stream to use for error output.">setErrorStream</a>(<a class="code" href="classOutputStream.html">OutputStream</a> $stream) {
<a name="l00228"></a>00228     self::$err = $stream;
<a name="l00229"></a>00229   }
<a name="l00230"></a>00230 
<a name="l00235"></a><a class="code" href="classPhing.html#a727e0b0066fd0452628ae3766becf9f0">00235</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a727e0b0066fd0452628ae3766becf9f0" title="Gets the stream to use for error output.">getErrorStream</a>() {
<a name="l00236"></a>00236     <span class="keywordflow">return</span> self::$err;
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238 
<a name="l00244"></a>00244   <span class="keyword">private</span> <span class="keyword">static</span> function handleLogfile() {
<a name="l00245"></a>00245     <span class="keywordflow">if</span> (self::$isLogFileUsed) {
<a name="l00246"></a>00246       self::$err-&gt;close();
<a name="l00247"></a>00247       self::$out-&gt;close();
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249   }
<a name="l00250"></a>00250 
<a name="l00257"></a><a class="code" href="classPhing.html#abd26c5c16ea4163c0cc8023748778677">00257</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#abd26c5c16ea4163c0cc8023748778677" title="Making output level a static property so that this property can be accessed by other...">getMsgOutputLevel</a>() {
<a name="l00258"></a>00258     <span class="keywordflow">return</span> self::$msgOutputLevel;
<a name="l00259"></a>00259   }
<a name="l00260"></a>00260 
<a name="l00269"></a><a class="code" href="classPhing.html#a41213da3d45223f9f8bf4b27640b9a15">00269</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a41213da3d45223f9f8bf4b27640b9a15" title="Command line entry point.">fire</a>($args) {
<a name="l00270"></a>00270     <a class="code" href="classPhing.html#a963467e5073e2841ceb2315366beb9b8" title="Entry point allowing for more options from other front ends.">self::start</a>($args, null);
<a name="l00271"></a>00271   }
<a name="l00272"></a>00272 
<a name="l00278"></a><a class="code" href="classPhing.html#a9e6d4bf8cade8dea330d204992213d97">00278</a>   <span class="keyword">public</span> function <a class="code" href="classPhing.html#a9e6d4bf8cade8dea330d204992213d97" title="Setup/initialize Phing environment from commandline args.">execute</a>($args) {
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     self::$definedProps = <span class="keyword">new</span> <a class="code" href="classProperties.html">Properties</a>();
<a name="l00281"></a>00281     $this-&gt;searchForThis = null;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="comment">// 1) First handle any options which should always</span>
<a name="l00284"></a>00284     <span class="comment">// Note: The order in which these are executed is important (if multiple of these options are specified)</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="keywordflow">if</span> (in_array(<span class="stringliteral">&#39;-help&#39;</span>, $args) || in_array(<span class="stringliteral">&#39;-h&#39;</span>, $args)) {
<a name="l00287"></a>00287       $this-&gt;<a class="code" href="classPhing.html#a5fd1f31b2f73847ec1ca7885d6d2d2e7" title="Prints the usage of how to use this class.">printUsage</a>();
<a name="l00288"></a>00288       <span class="keywordflow">return</span>;
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="keywordflow">if</span> (in_array(<span class="stringliteral">&#39;-version&#39;</span>, $args) || in_array(<span class="stringliteral">&#39;-v&#39;</span>, $args)) {
<a name="l00292"></a>00292       $this-&gt;<a class="code" href="classPhing.html#affb9abca6481a019ed7cf23aceb15a0c" title="Prints the current Phing version.">printVersion</a>();
<a name="l00293"></a>00293       <span class="keywordflow">return</span>;
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="comment">// 2) Next pull out stand-alone args.</span>
<a name="l00297"></a>00297     <span class="comment">// Note: The order in which these are executed is important (if multiple of these options are specified)</span>
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (<span class="keyword">false</span> !== ($key = array_search(<span class="stringliteral">&#39;-quiet&#39;</span>, $args, <span class="keyword">true</span>))) {
<a name="l00300"></a>00300       self::$msgOutputLevel = Project::MSG_WARN;
<a name="l00301"></a>00301       unset($args[$key]);
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (<span class="keyword">false</span> !== ($key = array_search(<span class="stringliteral">&#39;-verbose&#39;</span>, $args, <span class="keyword">true</span>))) {
<a name="l00305"></a>00305       self::$msgOutputLevel = Project::MSG_VERBOSE;
<a name="l00306"></a>00306       unset($args[$key]);
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="keywordflow">if</span> (<span class="keyword">false</span> !== ($key = array_search(<span class="stringliteral">&#39;-debug&#39;</span>, $args, <span class="keyword">true</span>))) {
<a name="l00310"></a>00310       self::$msgOutputLevel = Project::MSG_DEBUG;
<a name="l00311"></a>00311       unset($args[$key]);
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="comment">// 3) Finally, cycle through to parse remaining args</span>
<a name="l00315"></a>00315     <span class="comment">//</span>
<a name="l00316"></a>00316     $keys = array_keys($args); <span class="comment">// Use keys and iterate to max(keys) since there may be some gaps    </span>
<a name="l00317"></a>00317     $max = $keys ? max($keys) : -1;
<a name="l00318"></a>00318     <span class="keywordflow">for</span>($i=0; $i &lt;= $max; $i++) {
<a name="l00319"></a>00319 
<a name="l00320"></a>00320       <span class="keywordflow">if</span> (!array_key_exists($i, $args)) {
<a name="l00321"></a>00321         <span class="comment">// skip this argument, since it must have been removed above.</span>
<a name="l00322"></a>00322         <span class="keywordflow">continue</span>;
<a name="l00323"></a>00323       }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325       $arg = $args[$i];
<a name="l00326"></a>00326 
<a name="l00327"></a>00327       <span class="keywordflow">if</span> ($arg == <span class="stringliteral">&quot;-logfile&quot;</span>) {
<a name="l00328"></a>00328         <span class="keywordflow">try</span> {
<a name="l00329"></a>00329           <span class="comment">// see: http://phing.info/trac/ticket/65</span>
<a name="l00330"></a>00330           <span class="keywordflow">if</span> (!isset($args[$i+1])) {
<a name="l00331"></a>00331             $msg = <span class="stringliteral">&quot;You must specify a log file when using the -logfile argument\n&quot;</span>;
<a name="l00332"></a>00332             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l00333"></a>00333           } <span class="keywordflow">else</span> {
<a name="l00334"></a>00334             $logFile = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($args[++$i]);
<a name="l00335"></a>00335             $out = <span class="keyword">new</span> <a class="code" href="classFileOutputStream.html">FileOutputStream</a>($logFile); <span class="comment">// overwrite</span>
<a name="l00336"></a>00336             <a class="code" href="classPhing.html#afb59f3a87870911d88d8002f1e866851" title="Sets the stream to use for standard (non-error) output.">self::setOutputStream</a>($out);
<a name="l00337"></a>00337             <a class="code" href="classPhing.html#a88413afd07b8b0e2e063dc254f803411" title="Sets the stream to use for error output.">self::setErrorStream</a>($out);
<a name="l00338"></a>00338             self::$isLogFileUsed = <span class="keyword">true</span>;
<a name="l00339"></a>00339           }
<a name="l00340"></a>00340         } <span class="keywordflow">catch</span> (<a class="code" href="classIOException.html">IOException</a> $ioe) {
<a name="l00341"></a>00341           $msg = <span class="stringliteral">&quot;Cannot write on the specified log file. Make sure the path exists and you have write permissions.&quot;</span>;
<a name="l00342"></a>00342           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg, $ioe);
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344       } elseif ($arg == <span class="stringliteral">&quot;-buildfile&quot;</span> || $arg == <span class="stringliteral">&quot;-file&quot;</span> || $arg == <span class="stringliteral">&quot;-f&quot;</span>) {
<a name="l00345"></a>00345         <span class="keywordflow">if</span> (!isset($args[$i+1])) {
<a name="l00346"></a>00346           $msg = <span class="stringliteral">&quot;You must specify a buildfile when using the -buildfile argument.&quot;</span>;
<a name="l00347"></a>00347           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l00348"></a>00348         } <span class="keywordflow">else</span> {
<a name="l00349"></a>00349           $this-&gt;buildFile = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($args[++$i]);
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351       } elseif ($arg == <span class="stringliteral">&quot;-listener&quot;</span>) {
<a name="l00352"></a>00352         <span class="keywordflow">if</span> (!isset($args[$i+1])) {
<a name="l00353"></a>00353           $msg = <span class="stringliteral">&quot;You must specify a listener class when using the -listener argument&quot;</span>;
<a name="l00354"></a>00354           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l00355"></a>00355         } <span class="keywordflow">else</span> {
<a name="l00356"></a>00356           $this-&gt;listeners[] = $args[++$i];
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358       } elseif (<a class="code" href="classStringHelper.html#a5378978e5b71a9284d46196959752de2" title="tests if a string starts with a given string">StringHelper::startsWith</a>(<span class="stringliteral">&quot;-D&quot;</span>, $arg)) {
<a name="l00359"></a>00359         $name = substr($arg, 2);
<a name="l00360"></a>00360         $value = null;
<a name="l00361"></a>00361         $posEq = strpos($name, <span class="stringliteral">&quot;=&quot;</span>);
<a name="l00362"></a>00362         <span class="keywordflow">if</span> ($posEq !== <span class="keyword">false</span>) {
<a name="l00363"></a>00363           $value = substr($name, $posEq+1);
<a name="l00364"></a>00364           $name  = substr($name, 0, $posEq);
<a name="l00365"></a>00365         } elseif ($i &lt; count($args)-1) {
<a name="l00366"></a>00366           $value = $args[++$i];
<a name="l00367"></a>00367         }
<a name="l00368"></a>00368         self::$definedProps-&gt;setProperty($name, $value);
<a name="l00369"></a>00369       } elseif ($arg == <span class="stringliteral">&quot;-logger&quot;</span>) {
<a name="l00370"></a>00370         <span class="keywordflow">if</span> (!isset($args[$i+1])) {
<a name="l00371"></a>00371           $msg = <span class="stringliteral">&quot;You must specify a classname when using the -logger argument&quot;</span>;
<a name="l00372"></a>00372           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l00373"></a>00373         } <span class="keywordflow">else</span> {
<a name="l00374"></a>00374           $this-&gt;loggerClassname = $args[++$i];
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376       } elseif ($arg == <span class="stringliteral">&quot;-inputhandler&quot;</span>) {
<a name="l00377"></a>00377         <span class="keywordflow">if</span> ($this-&gt;inputHandlerClassname !== null) {
<a name="l00378"></a>00378           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;Only one input handler class may be specified.&quot;</span>);
<a name="l00379"></a>00379         }
<a name="l00380"></a>00380         <span class="keywordflow">if</span> (!isset($args[$i+1])) {
<a name="l00381"></a>00381           $msg = <span class="stringliteral">&quot;You must specify a classname when using the -inputhandler argument&quot;</span>;
<a name="l00382"></a>00382           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l00383"></a>00383         } <span class="keywordflow">else</span> {
<a name="l00384"></a>00384           $this-&gt;inputHandlerClassname = $args[++$i];
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386       } elseif ($arg == <span class="stringliteral">&quot;-projecthelp&quot;</span> || $arg == <span class="stringliteral">&quot;-targets&quot;</span> || $arg == <span class="stringliteral">&quot;-list&quot;</span> || $arg == <span class="stringliteral">&quot;-l&quot;</span> || $arg == <span class="stringliteral">&quot;-p&quot;</span>) {
<a name="l00387"></a>00387         <span class="comment">// set the flag to display the targets and quit</span>
<a name="l00388"></a>00388         $this-&gt;projectHelp = <span class="keyword">true</span>;
<a name="l00389"></a>00389       } elseif ($arg == <span class="stringliteral">&quot;-find&quot;</span>) {
<a name="l00390"></a>00390         <span class="comment">// eat up next arg if present, default to build.xml</span>
<a name="l00391"></a>00391         <span class="keywordflow">if</span> ($i &lt; count($args)-1) {
<a name="l00392"></a>00392           $this-&gt;searchForThis = $args[++$i];
<a name="l00393"></a>00393         } <span class="keywordflow">else</span> {
<a name="l00394"></a>00394           $this-&gt;searchForThis = self::DEFAULT_BUILD_FILENAME;
<a name="l00395"></a>00395         }
<a name="l00396"></a>00396       } elseif (substr($arg,0,1) == <span class="stringliteral">&quot;-&quot;</span>) {
<a name="l00397"></a>00397         <span class="comment">// we don&#39;t have any more args</span>
<a name="l00398"></a>00398         self::$err-&gt;write(<span class="stringliteral">&quot;Unknown argument: $arg&quot;</span> . PHP_EOL);
<a name="l00399"></a>00399         <a class="code" href="classPhing.html#a5fd1f31b2f73847ec1ca7885d6d2d2e7" title="Prints the usage of how to use this class.">self::printUsage</a>();
<a name="l00400"></a>00400         <span class="keywordflow">return</span>;
<a name="l00401"></a>00401       } <span class="keywordflow">else</span> {
<a name="l00402"></a>00402         <span class="comment">// if it&#39;s no other arg, it may be the target</span>
<a name="l00403"></a>00403         array_push($this-&gt;targets, $arg);
<a name="l00404"></a>00404       }
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="comment">// if buildFile was not specified on the command line,</span>
<a name="l00408"></a>00408     <span class="keywordflow">if</span> ($this-&gt;buildFile === null) {
<a name="l00409"></a>00409       <span class="comment">// but -find then search for it</span>
<a name="l00410"></a>00410       <span class="keywordflow">if</span> ($this-&gt;searchForThis !== null) {
<a name="l00411"></a>00411         $this-&gt;buildFile = $this-&gt;_findBuildFile(self::getProperty(<span class="stringliteral">&quot;user.dir&quot;</span>), $this-&gt;searchForThis);
<a name="l00412"></a>00412       } <span class="keywordflow">else</span> {
<a name="l00413"></a>00413         $this-&gt;buildFile = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>(self::DEFAULT_BUILD_FILENAME);
<a name="l00414"></a>00414       }
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416     <span class="comment">// make sure buildfile exists</span>
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (!$this-&gt;buildFile-&gt;exists()) {
<a name="l00418"></a>00418       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;Buildfile: &quot;</span> . $this-&gt;buildFile-&gt;__toString() . <span class="stringliteral">&quot; does not exist!&quot;</span>);
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="comment">// make sure it&#39;s not a directory</span>
<a name="l00422"></a>00422     <span class="keywordflow">if</span> ($this-&gt;buildFile-&gt;isDirectory()) {
<a name="l00423"></a>00423       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;Buildfile: &quot;</span> . $this-&gt;buildFile-&gt;__toString() . <span class="stringliteral">&quot; is a dir!&quot;</span>);
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     $this-&gt;readyToRun = <span class="keyword">true</span>;
<a name="l00427"></a>00427   }
<a name="l00428"></a>00428 
<a name="l00435"></a>00435   <span class="keyword">private</span> function _getParentFile(<a class="code" href="classPhingFile.html">PhingFile</a> $file) {
<a name="l00436"></a>00436     $filename = $file-&gt;<a class="code" href="classPhingFile.html#a0fc082cd4cd620d7a94557de890df81d" title="Returns the absolute pathname string of this abstract pathname.">getAbsolutePath</a>();
<a name="l00437"></a>00437     $file     = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($filename);
<a name="l00438"></a>00438     $filename = $file-&gt;<a class="code" href="classPhingFile.html#a660a9bcc34803812b92cf3a70b72de50" title="Returns the pathname string of this abstract pathname&amp;#39;s parent, or null if this...">getParent</a>();
<a name="l00439"></a>00439     <span class="keywordflow">return</span> ($filename === null) ? null : <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($filename);
<a name="l00440"></a>00440   }
<a name="l00441"></a>00441 
<a name="l00456"></a>00456   <span class="keyword">private</span> function _findBuildFile($start, $suffix) {
<a name="l00457"></a>00457     $startf = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($start);
<a name="l00458"></a>00458     $parent = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($startf-&gt;getAbsolutePath());
<a name="l00459"></a>00459     $file   = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($parent, $suffix);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <span class="comment">// check if the target file exists in the current directory</span>
<a name="l00462"></a>00462     <span class="keywordflow">while</span> (!$file-&gt;<a class="code" href="classPhingFile.html#a03f03f57cbf788a351ce75fa5d9057d1" title="Tests whether the file denoted by this abstract pathname exists.">exists</a>()) {
<a name="l00463"></a>00463       <span class="comment">// change to parent directory</span>
<a name="l00464"></a>00464       $parent = $this-&gt;_getParentFile($parent);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466       <span class="comment">// if parent is null, then we are at the root of the fs,</span>
<a name="l00467"></a>00467       <span class="comment">// complain that we can&#39;t find the build file.</span>
<a name="l00468"></a>00468       <span class="keywordflow">if</span> ($parent === null) {
<a name="l00469"></a>00469         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;Could not locate a build file!&quot;</span>);
<a name="l00470"></a>00470       }
<a name="l00471"></a>00471       <span class="comment">// refresh our file handle</span>
<a name="l00472"></a>00472       $file = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($parent, $suffix);
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474     <span class="keywordflow">return</span> $file;
<a name="l00475"></a>00475   }
<a name="l00476"></a>00476 
<a name="l00481"></a><a class="code" href="classPhing.html#aba7b60523aca0c9684c7f749756a5eff">00481</a>   function <a class="code" href="classPhing.html#aba7b60523aca0c9684c7f749756a5eff" title="Executes the build.">runBuild</a>() {
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (!$this-&gt;readyToRun) {
<a name="l00484"></a>00484       <span class="keywordflow">return</span>;
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     $project = <span class="keyword">new</span> <a class="code" href="classProject.html">Project</a>();
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <a class="code" href="classPhing.html#a600e46ad9fb002d69fb204648c54c2f8" title="Sets the current Project.">self::setCurrentProject</a>($project);
<a name="l00490"></a>00490     set_error_handler(array(<span class="stringliteral">&#39;Phing&#39;</span>, <span class="stringliteral">&#39;handlePhpError&#39;</span>));
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     $error = null;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     $this-&gt;addBuildListeners($project);
<a name="l00495"></a>00495     $this-&gt;addInputHandler($project);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="comment">// set this right away, so that it can be used in logging.</span>
<a name="l00498"></a>00498     $project-&gt;setUserProperty(<span class="stringliteral">&quot;phing.file&quot;</span>, $this-&gt;buildFile-&gt;getAbsolutePath());
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="keywordflow">try</span> {
<a name="l00501"></a>00501       $project-&gt;fireBuildStarted();
<a name="l00502"></a>00502       $project-&gt;init();
<a name="l00503"></a>00503     } <span class="keywordflow">catch</span> (Exception $exc) {
<a name="l00504"></a>00504       $project-&gt;fireBuildFinished($exc);
<a name="l00505"></a>00505       <span class="keywordflow">throw</span> $exc;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     $project-&gt;setUserProperty(<span class="stringliteral">&quot;phing.version&quot;</span>, $this-&gt;<a class="code" href="classPhing.html#a8f26ff0c140770b2907c33938b039cc3" title="Gets the current Phing version based on VERSION.TXT file.">getPhingVersion</a>());
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     $e = self::$definedProps-&gt;keys();
<a name="l00511"></a>00511     <span class="keywordflow">while</span> (count($e)) {
<a name="l00512"></a>00512       $arg   = (string) array_shift($e);
<a name="l00513"></a>00513       $value = (string) self::$definedProps-&gt;<a class="code" href="classPhing.html#a268f776beab540ebeac9f45eadfcb709" title="Returns property value for a System property.">getProperty</a>($arg);
<a name="l00514"></a>00514       $project-&gt;setUserProperty($arg, $value);
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     unset($e);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     $project-&gt;setUserProperty(<span class="stringliteral">&quot;phing.file&quot;</span>, $this-&gt;buildFile-&gt;getAbsolutePath());
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">// first use the Configurator to create the project object</span>
<a name="l00521"></a>00521     <span class="comment">// from the given build file.</span>
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="keywordflow">try</span> {
<a name="l00524"></a>00524       <a class="code" href="classProjectConfigurator.html#a9f1b7c44c2d2244f93bf0f02931c447b" title="Static call to ProjectConfigurator.">ProjectConfigurator::configureProject</a>($project, $this-&gt;buildFile);
<a name="l00525"></a>00525     } <span class="keywordflow">catch</span> (Exception $exc) {
<a name="l00526"></a>00526       $project-&gt;fireBuildFinished($exc);
<a name="l00527"></a>00527       restore_error_handler();
<a name="l00528"></a>00528       <a class="code" href="classPhing.html#a9fdb5756ac49d4d5a291ad2760766e0c" title="Unsets the current Project.">self::unsetCurrentProject</a>();
<a name="l00529"></a>00529       <span class="keywordflow">throw</span> $exc;
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <span class="comment">// make sure that we have a target to execute</span>
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (count($this-&gt;targets) === 0) {
<a name="l00534"></a>00534       $this-&gt;targets[] = $project-&gt;getDefaultTarget();
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="comment">// execute targets if help param was not given</span>
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (!$this-&gt;projectHelp) {
<a name="l00539"></a>00539 
<a name="l00540"></a>00540       <span class="keywordflow">try</span> {
<a name="l00541"></a>00541         $project-&gt;executeTargets($this-&gt;targets);
<a name="l00542"></a>00542       } <span class="keywordflow">catch</span> (Exception $exc) {
<a name="l00543"></a>00543         $project-&gt;fireBuildFinished($exc);
<a name="l00544"></a>00544         restore_error_handler();
<a name="l00545"></a>00545         <a class="code" href="classPhing.html#a9fdb5756ac49d4d5a291ad2760766e0c" title="Unsets the current Project.">self::unsetCurrentProject</a>();
<a name="l00546"></a>00546         <span class="keywordflow">throw</span> $exc;
<a name="l00547"></a>00547       }
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549     <span class="comment">// if help is requested print it</span>
<a name="l00550"></a>00550     <span class="keywordflow">if</span> ($this-&gt;projectHelp) {
<a name="l00551"></a>00551       <span class="keywordflow">try</span> {
<a name="l00552"></a>00552         $this-&gt;<a class="code" href="classPhing.html#a6e6758a21f1e4ae6124bc92dec59b007" title="Print the project description, if any.">printDescription</a>($project);
<a name="l00553"></a>00553         $this-&gt;<a class="code" href="classPhing.html#a10a1ea044465398826b4bafab843db4b" title="Print out a list of all targets in the current buildfile.">printTargets</a>($project);
<a name="l00554"></a>00554       } <span class="keywordflow">catch</span> (Exception $exc) {
<a name="l00555"></a>00555         $project-&gt;fireBuildFinished($exc);
<a name="l00556"></a>00556         restore_error_handler();
<a name="l00557"></a>00557         <a class="code" href="classPhing.html#a9fdb5756ac49d4d5a291ad2760766e0c" title="Unsets the current Project.">self::unsetCurrentProject</a>();
<a name="l00558"></a>00558         <span class="keywordflow">throw</span> $exc;
<a name="l00559"></a>00559       }
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="comment">// finally {</span>
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (!$this-&gt;projectHelp) {
<a name="l00564"></a>00564       $project-&gt;fireBuildFinished(null);
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     restore_error_handler();
<a name="l00568"></a>00568     <a class="code" href="classPhing.html#a9fdb5756ac49d4d5a291ad2760766e0c" title="Unsets the current Project.">self::unsetCurrentProject</a>();
<a name="l00569"></a>00569   }
<a name="l00570"></a>00570 
<a name="l00580"></a>00580   <span class="keyword">private</span> function addBuildListeners(<a class="code" href="classProject.html">Project</a> $project) {
<a name="l00581"></a>00581     <span class="comment">// Add the default listener</span>
<a name="l00582"></a>00582     $project-&gt;addBuildListener($this-&gt;createLogger());
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     <span class="keywordflow">foreach</span>($this-&gt;listeners as $listenerClassname) {
<a name="l00585"></a>00585       <span class="keywordflow">try</span> {
<a name="l00586"></a>00586         $clz = <a class="code" href="classPhing.html#a73b5e28e35cc81359886f1f187d661fa" title="Import a dot-path notation class path.">Phing::import</a>($listenerClassname);
<a name="l00587"></a>00587       } <span class="keywordflow">catch</span> (Exception $x) {
<a name="l00588"></a>00588         $msg = <span class="stringliteral">&quot;Unable to instantiate specified listener &quot;</span>
<a name="l00589"></a>00589         . <span class="stringliteral">&quot;class &quot;</span> . $listenerClassname . <span class="stringliteral">&quot; : &quot;</span>
<a name="l00590"></a>00590         . $e-&gt;getMessage();
<a name="l00591"></a>00591         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l00592"></a>00592       }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594       $listener = <span class="keyword">new</span> $clz();
<a name="l00595"></a>00595 
<a name="l00596"></a>00596       <span class="keywordflow">if</span> ($listener instanceof <a class="code" href="interfaceStreamRequiredBuildLogger.html">StreamRequiredBuildLogger</a>) {
<a name="l00597"></a>00597         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;Unable to add &quot;</span> . $listenerClassname . <span class="stringliteral">&quot; as a listener, since it requires explicit error/output streams. (You can specify it as a -logger.)&quot;</span>);
<a name="l00598"></a>00598       }
<a name="l00599"></a>00599       $project-&gt;addBuildListener($listener);
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601   }
<a name="l00602"></a>00602 
<a name="l00611"></a>00611   <span class="keyword">private</span> function addInputHandler(<a class="code" href="classProject.html">Project</a> $project) {
<a name="l00612"></a>00612     <span class="keywordflow">if</span> ($this-&gt;inputHandlerClassname === null) {
<a name="l00613"></a>00613       $handler = <span class="keyword">new</span> <a class="code" href="classDefaultInputHandler.html">DefaultInputHandler</a>();
<a name="l00614"></a>00614     } <span class="keywordflow">else</span> {
<a name="l00615"></a>00615       <span class="keywordflow">try</span> {
<a name="l00616"></a>00616         $clz = <a class="code" href="classPhing.html#a73b5e28e35cc81359886f1f187d661fa" title="Import a dot-path notation class path.">Phing::import</a>($this-&gt;inputHandlerClassname);
<a name="l00617"></a>00617         $handler = <span class="keyword">new</span> $clz();
<a name="l00618"></a>00618         <span class="keywordflow">if</span> ($project !== null &amp;&amp; method_exists($handler, <span class="stringliteral">&#39;setProject&#39;</span>)) {
<a name="l00619"></a>00619           $handler-&gt;setProject($project);
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621       } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00622"></a>00622         $msg = <span class="stringliteral">&quot;Unable to instantiate specified input handler &quot;</span>
<a name="l00623"></a>00623         . <span class="stringliteral">&quot;class &quot;</span> . $this-&gt;inputHandlerClassname . <span class="stringliteral">&quot; : &quot;</span>
<a name="l00624"></a>00624         . $e-&gt;getMessage();
<a name="l00625"></a>00625         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l00626"></a>00626       }
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628     $project-&gt;<a class="code" href="classProject.html#a7959c705e2ba66c67ec855276c71ae61" title="Sets the input handler.">setInputHandler</a>($handler);
<a name="l00629"></a>00629   }
<a name="l00630"></a>00630 
<a name="l00635"></a>00635   <span class="keyword">private</span> function createLogger() {
<a name="l00636"></a>00636     <span class="keywordflow">if</span> ($this-&gt;loggerClassname !== null) {
<a name="l00637"></a>00637       <a class="code" href="classPhing.html#a73b5e28e35cc81359886f1f187d661fa" title="Import a dot-path notation class path.">self::import</a>($this-&gt;loggerClassname);
<a name="l00638"></a>00638       <span class="comment">// get class name part</span>
<a name="l00639"></a>00639       $classname = <a class="code" href="classPhing.html#a73b5e28e35cc81359886f1f187d661fa" title="Import a dot-path notation class path.">self::import</a>($this-&gt;loggerClassname);
<a name="l00640"></a>00640       $logger = <span class="keyword">new</span> $classname;
<a name="l00641"></a>00641       <span class="keywordflow">if</span> (!($logger instanceof <a class="code" href="interfaceBuildLogger.html">BuildLogger</a>)) {
<a name="l00642"></a>00642         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classBuildException.html">BuildException</a>($classname . <span class="stringliteral">&#39; does not implement the BuildLogger interface.&#39;</span>);
<a name="l00643"></a>00643       }
<a name="l00644"></a>00644     } <span class="keywordflow">else</span> {
<a name="l00645"></a>00645       require_once <span class="stringliteral">&#39;phing/listener/DefaultLogger.php&#39;</span>;
<a name="l00646"></a>00646       $logger = <span class="keyword">new</span> <a class="code" href="classDefaultLogger.html">DefaultLogger</a>();
<a name="l00647"></a>00647     }
<a name="l00648"></a>00648     $logger-&gt;setMessageOutputLevel(self::$msgOutputLevel);
<a name="l00649"></a>00649     $logger-&gt;setOutputStream(self::$out);
<a name="l00650"></a>00650     $logger-&gt;setErrorStream(self::$err);
<a name="l00651"></a>00651     <span class="keywordflow">return</span> $logger;
<a name="l00652"></a>00652   }
<a name="l00653"></a>00653 
<a name="l00658"></a><a class="code" href="classPhing.html#a600e46ad9fb002d69fb204648c54c2f8">00658</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a600e46ad9fb002d69fb204648c54c2f8" title="Sets the current Project.">setCurrentProject</a>($p) {
<a name="l00659"></a>00659     self::$currentProject = $p;
<a name="l00660"></a>00660   }
<a name="l00661"></a>00661 
<a name="l00665"></a><a class="code" href="classPhing.html#a9fdb5756ac49d4d5a291ad2760766e0c">00665</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a9fdb5756ac49d4d5a291ad2760766e0c" title="Unsets the current Project.">unsetCurrentProject</a>() {
<a name="l00666"></a>00666     self::$currentProject = null;
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668 
<a name="l00673"></a><a class="code" href="classPhing.html#a91cc47e708141d2fa00644e792eaa85f">00673</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a91cc47e708141d2fa00644e792eaa85f" title="Gets the current Project.">getCurrentProject</a>() {
<a name="l00674"></a>00674     <span class="keywordflow">return</span> self::$currentProject;
<a name="l00675"></a>00675   }
<a name="l00676"></a>00676 
<a name="l00683"></a><a class="code" href="classPhing.html#a6583fbd668bb14a4383ccf6ed5ca9736">00683</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a6583fbd668bb14a4383ccf6ed5ca9736" title="A static convenience method to send a log to the current (last-setup) Project.">log</a>($message, $priority = Project::MSG_INFO) {
<a name="l00684"></a>00684     $p = <a class="code" href="classPhing.html#a91cc47e708141d2fa00644e792eaa85f" title="Gets the current Project.">self::getCurrentProject</a>();
<a name="l00685"></a>00685     <span class="keywordflow">if</span> ($p) {
<a name="l00686"></a>00686       $p-&gt;log($message, $priority);
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689 
<a name="l00694"></a><a class="code" href="classPhing.html#a6c627db9067b9913168c2ac702a97489">00694</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a6c627db9067b9913168c2ac702a97489" title="Error handler for PHP errors encountered during the build.">handlePhpError</a>($level, $message, $file, $line) {
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     <span class="comment">// don&#39;t want to print supressed errors</span>
<a name="l00697"></a>00697     <span class="keywordflow">if</span> (error_reporting() &gt; 0) {
<a name="l00698"></a>00698 
<a name="l00699"></a>00699       <span class="keywordflow">if</span> (self::$phpErrorCapture) {
<a name="l00700"></a>00700 
<a name="l00701"></a>00701         self::$capturedPhpErrors[] = array(<span class="stringliteral">&#39;message&#39;</span> =&gt; $message, <span class="stringliteral">&#39;level&#39;</span> =&gt; $level, <span class="stringliteral">&#39;line&#39;</span> =&gt; $line, <span class="stringliteral">&#39;file&#39;</span> =&gt; $file);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703       } <span class="keywordflow">else</span> {
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         $message = <span class="stringliteral">&#39;[PHP Error] &#39;</span> . $message;
<a name="l00706"></a>00706         $message .= <span class="stringliteral">&#39; [line &#39;</span> . $line . <span class="stringliteral">&#39; of &#39;</span> . $file . <span class="charliteral">&#39;]&#39;</span>;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         <span class="keywordflow">switch</span> ($level) {
<a name="l00709"></a>00709 
<a name="l00710"></a>00710           <span class="keywordflow">case</span> E_STRICT:
<a name="l00711"></a>00711           <span class="keywordflow">case</span> E_NOTICE:
<a name="l00712"></a>00712           <span class="keywordflow">case</span> E_USER_NOTICE:
<a name="l00713"></a>00713             <a class="code" href="classPhing.html#a6583fbd668bb14a4383ccf6ed5ca9736" title="A static convenience method to send a log to the current (last-setup) Project.">self::log</a>($message, Project::MSG_VERBOSE);
<a name="l00714"></a>00714             <span class="keywordflow">break</span>;
<a name="l00715"></a>00715           <span class="keywordflow">case</span> E_WARNING:
<a name="l00716"></a>00716           <span class="keywordflow">case</span> E_USER_WARNING:
<a name="l00717"></a>00717             <a class="code" href="classPhing.html#a6583fbd668bb14a4383ccf6ed5ca9736" title="A static convenience method to send a log to the current (last-setup) Project.">self::log</a>($message, Project::MSG_WARN);
<a name="l00718"></a>00718             <span class="keywordflow">break</span>;
<a name="l00719"></a>00719           <span class="keywordflow">case</span> E_ERROR:
<a name="l00720"></a>00720           <span class="keywordflow">case</span> E_USER_ERROR:
<a name="l00721"></a>00721           <span class="keywordflow">default</span>:
<a name="l00722"></a>00722             <a class="code" href="classPhing.html#a6583fbd668bb14a4383ccf6ed5ca9736" title="A static convenience method to send a log to the current (last-setup) Project.">self::log</a>($message, Project::MSG_ERR);
<a name="l00723"></a>00723 
<a name="l00724"></a>00724         } <span class="comment">// switch</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726       } <span class="comment">// if phpErrorCapture</span>
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     } <span class="comment">// if not @</span>
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   }
<a name="l00731"></a>00731 
<a name="l00736"></a><a class="code" href="classPhing.html#aebe44d71f9cc4d7c747ee12d9c937323">00736</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#aebe44d71f9cc4d7c747ee12d9c937323" title="Begins capturing PHP errors to a buffer.">startPhpErrorCapture</a>() {
<a name="l00737"></a>00737     self::$phpErrorCapture = <span class="keyword">true</span>;
<a name="l00738"></a>00738     self::$capturedPhpErrors = array();
<a name="l00739"></a>00739   }
<a name="l00740"></a>00740 
<a name="l00745"></a><a class="code" href="classPhing.html#adab2d70724a025c56011cc7eac45bc02">00745</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#adab2d70724a025c56011cc7eac45bc02" title="Stops capturing PHP errors to a buffer.">stopPhpErrorCapture</a>() {
<a name="l00746"></a>00746     self::$phpErrorCapture = <span class="keyword">false</span>;
<a name="l00747"></a>00747   }
<a name="l00748"></a>00748 
<a name="l00752"></a><a class="code" href="classPhing.html#a1a3b93f48369a187226c4fa4dd18ceb4">00752</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a1a3b93f48369a187226c4fa4dd18ceb4" title="Clears the captured errors without affecting the starting/stopping of the capture...">clearCapturedPhpErrors</a>() {
<a name="l00753"></a>00753     self::$capturedPhpErrors = array();
<a name="l00754"></a>00754   }
<a name="l00755"></a>00755 
<a name="l00760"></a><a class="code" href="classPhing.html#ac19936887ddbda969183d0891222ad75">00760</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#ac19936887ddbda969183d0891222ad75" title="Gets any PHP errors that were captured to buffer.">getCapturedPhpErrors</a>() {
<a name="l00761"></a>00761     <span class="keywordflow">return</span> self::$capturedPhpErrors;
<a name="l00762"></a>00762   }
<a name="l00763"></a>00763 
<a name="l00765"></a><a class="code" href="classPhing.html#a5fd1f31b2f73847ec1ca7885d6d2d2e7">00765</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a5fd1f31b2f73847ec1ca7885d6d2d2e7" title="Prints the usage of how to use this class.">printUsage</a>() {
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     $msg = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00768"></a>00768     $msg .= <span class="stringliteral">&quot;phing [options] [target [target2 [target3] ...]]&quot;</span> . PHP_EOL;
<a name="l00769"></a>00769     $msg .= <span class="stringliteral">&quot;Options: &quot;</span> . PHP_EOL;
<a name="l00770"></a>00770     $msg .= <span class="stringliteral">&quot;  -h -help               print this message&quot;</span> . PHP_EOL;
<a name="l00771"></a>00771     $msg .= <span class="stringliteral">&quot;  -l -list               list available targets in this project&quot;</span> . PHP_EOL;
<a name="l00772"></a>00772     $msg .= <span class="stringliteral">&quot;  -v -version            print the version information and exit&quot;</span> . PHP_EOL;
<a name="l00773"></a>00773     $msg .= <span class="stringliteral">&quot;  -q -quiet              be extra quiet&quot;</span> . PHP_EOL;
<a name="l00774"></a>00774     $msg .= <span class="stringliteral">&quot;  -verbose               be extra verbose&quot;</span> . PHP_EOL;
<a name="l00775"></a>00775     $msg .= <span class="stringliteral">&quot;  -debug                 print debugging information&quot;</span> . PHP_EOL;
<a name="l00776"></a>00776     $msg .= <span class="stringliteral">&quot;  -logfile &lt;file&gt;        use given file for log&quot;</span> . PHP_EOL;
<a name="l00777"></a>00777     $msg .= <span class="stringliteral">&quot;  -logger &lt;classname&gt;    the class which is to perform logging&quot;</span> . PHP_EOL;
<a name="l00778"></a>00778     $msg .= <span class="stringliteral">&quot;  -f -buildfile &lt;file&gt;   use given buildfile&quot;</span> . PHP_EOL;
<a name="l00779"></a>00779     $msg .= <span class="stringliteral">&quot;  -D&lt;property&gt;=&lt;value&gt;   use value for given property&quot;</span> . PHP_EOL;
<a name="l00780"></a>00780     $msg .= <span class="stringliteral">&quot;  -find &lt;file&gt;           search for buildfile towards the root of the&quot;</span> . PHP_EOL;
<a name="l00781"></a>00781     $msg .= <span class="stringliteral">&quot;                         filesystem and use it&quot;</span> . PHP_EOL;
<a name="l00782"></a>00782     $msg .= <span class="stringliteral">&quot;  -inputhandler &lt;file&gt;   the class to use to handle user input&quot;</span> . PHP_EOL;
<a name="l00783"></a>00783     <span class="comment">//$msg .= &quot;  -recursive &lt;file&gt;      search for buildfile downwards and use it&quot; . PHP_EOL;</span>
<a name="l00784"></a>00784     $msg .= PHP_EOL;
<a name="l00785"></a>00785     $msg .= <span class="stringliteral">&quot;Report bugs to &lt;dev@phing.tigris.org&gt;&quot;</span>.PHP_EOL;
<a name="l00786"></a>00786     self::$err-&gt;write($msg);
<a name="l00787"></a>00787   }
<a name="l00788"></a>00788 
<a name="l00792"></a><a class="code" href="classPhing.html#affb9abca6481a019ed7cf23aceb15a0c">00792</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#affb9abca6481a019ed7cf23aceb15a0c" title="Prints the current Phing version.">printVersion</a>() {
<a name="l00793"></a>00793     self::$out-&gt;write(self::getPhingVersion().PHP_EOL);
<a name="l00794"></a>00794   }
<a name="l00795"></a>00795 
<a name="l00801"></a><a class="code" href="classPhing.html#a8f26ff0c140770b2907c33938b039cc3">00801</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a8f26ff0c140770b2907c33938b039cc3" title="Gets the current Phing version based on VERSION.TXT file.">getPhingVersion</a>() {
<a name="l00802"></a>00802     $versionPath = <a class="code" href="classPhing.html#a3ce6bb47e4628f678c8ab07aedfc935f" title="Looks on include path for specified file.">self::getResourcePath</a>(<span class="stringliteral">&quot;phing/etc/VERSION.TXT&quot;</span>);
<a name="l00803"></a>00803     <span class="keywordflow">if</span> ($versionPath === null) {
<a name="l00804"></a>00804       $versionPath = <a class="code" href="classPhing.html#a3ce6bb47e4628f678c8ab07aedfc935f" title="Looks on include path for specified file.">self::getResourcePath</a>(<span class="stringliteral">&quot;etc/VERSION.TXT&quot;</span>);
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806     <span class="keywordflow">if</span> ($versionPath === null) {
<a name="l00807"></a>00807       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;No VERSION.TXT file found; try setting phing.home environment variable.&quot;</span>);
<a name="l00808"></a>00808     }
<a name="l00809"></a>00809     <span class="keywordflow">try</span> { <span class="comment">// try to read file</span>
<a name="l00810"></a>00810       $buffer = null;
<a name="l00811"></a>00811       $file = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($versionPath);
<a name="l00812"></a>00812       $reader = <span class="keyword">new</span> <a class="code" href="classFileReader.html">FileReader</a>($file);
<a name="l00813"></a>00813       $reader-&gt;readInto($buffer);
<a name="l00814"></a>00814       $buffer = trim($buffer);
<a name="l00815"></a>00815       <span class="comment">//$buffer = &quot;PHING version 1.0, Released 2002-??-??&quot;;</span>
<a name="l00816"></a>00816       $phingVersion = $buffer;
<a name="l00817"></a>00817     } <span class="keywordflow">catch</span> (<a class="code" href="classIOException.html">IOException</a> $iox) {
<a name="l00818"></a>00818       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;Can&#39;t read version information file&quot;</span>);
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820     <span class="keywordflow">return</span> $phingVersion;
<a name="l00821"></a>00821   }
<a name="l00822"></a>00822 
<a name="l00826"></a><a class="code" href="classPhing.html#a6e6758a21f1e4ae6124bc92dec59b007">00826</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a6e6758a21f1e4ae6124bc92dec59b007" title="Print the project description, if any.">printDescription</a>(<a class="code" href="classProject.html">Project</a> $project) {
<a name="l00827"></a>00827     <span class="keywordflow">if</span> ($project-&gt;<a class="code" href="classProject.html#a601e757eaebaf9c69dba57ad704df873" title="return the description, null otherwise">getDescription</a>() !== null) {
<a name="l00828"></a>00828       self::$out-&gt;write($project-&gt;<a class="code" href="classProject.html#a601e757eaebaf9c69dba57ad704df873" title="return the description, null otherwise">getDescription</a>() . PHP_EOL);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830   }
<a name="l00831"></a>00831 
<a name="l00833"></a><a class="code" href="classPhing.html#a10a1ea044465398826b4bafab843db4b">00833</a>   function <a class="code" href="classPhing.html#a10a1ea044465398826b4bafab843db4b" title="Print out a list of all targets in the current buildfile.">printTargets</a>($project) {
<a name="l00834"></a>00834     <span class="comment">// find the target with the longest name</span>
<a name="l00835"></a>00835     $maxLength = 0;
<a name="l00836"></a>00836     $targets = $project-&gt;getTargets();
<a name="l00837"></a>00837     $targetNames = array_keys($targets);
<a name="l00838"></a>00838     $targetName = null;
<a name="l00839"></a>00839     $targetDescription = null;
<a name="l00840"></a>00840     $currentTarget = null;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <span class="comment">// split the targets in top-level and sub-targets depending</span>
<a name="l00843"></a>00843     <span class="comment">// on the presence of a description</span>
<a name="l00844"></a>00844 
<a name="l00845"></a>00845     $subNames = array();
<a name="l00846"></a>00846     $topNameDescMap = array();
<a name="l00847"></a>00847 
<a name="l00848"></a>00848     <span class="keywordflow">foreach</span>($targets as $currentTarget) {
<a name="l00849"></a>00849       $targetName = $currentTarget-&gt;getName();
<a name="l00850"></a>00850       $targetDescription = $currentTarget-&gt;getDescription();
<a name="l00851"></a>00851 
<a name="l00852"></a>00852       <span class="comment">// subtargets are targets w/o descriptions</span>
<a name="l00853"></a>00853       <span class="keywordflow">if</span> ($targetDescription === null) {
<a name="l00854"></a>00854         $subNames[] = $targetName;
<a name="l00855"></a>00855       } <span class="keywordflow">else</span> {
<a name="l00856"></a>00856         <span class="comment">// topNames and topDescriptions are handled later</span>
<a name="l00857"></a>00857         <span class="comment">// here we store in hash map (for sorting purposes)</span>
<a name="l00858"></a>00858         $topNameDescMap[$targetName] = $targetDescription;
<a name="l00859"></a>00859         <span class="keywordflow">if</span> (strlen($targetName) &gt; $maxLength) {
<a name="l00860"></a>00860           $maxLength = strlen($targetName);
<a name="l00861"></a>00861         }
<a name="l00862"></a>00862       }
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <span class="comment">// Sort the arrays</span>
<a name="l00866"></a>00866     sort($subNames); <span class="comment">// sort array values, resetting keys (which are numeric)</span>
<a name="l00867"></a>00867     ksort($topNameDescMap); <span class="comment">// sort the keys (targetName) keeping key=&gt;val associations</span>
<a name="l00868"></a>00868 
<a name="l00869"></a>00869     $topNames = array_keys($topNameDescMap);
<a name="l00870"></a>00870     $topDescriptions = array_values($topNameDescMap);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872     $defaultTarget = $project-&gt;getDefaultTarget();
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     <span class="keywordflow">if</span> ($defaultTarget !== null &amp;&amp; $defaultTarget !== <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00875"></a>00875       $defaultName = array();
<a name="l00876"></a>00876       $defaultDesc = array();
<a name="l00877"></a>00877       $defaultName[] = $defaultTarget;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879       $indexOfDefDesc = array_search($defaultTarget, $topNames, <span class="keyword">true</span>);
<a name="l00880"></a>00880       <span class="keywordflow">if</span> ($indexOfDefDesc !== <span class="keyword">false</span> &amp;&amp; $indexOfDefDesc &gt;= 0) {
<a name="l00881"></a>00881         $defaultDesc = array();
<a name="l00882"></a>00882         $defaultDesc[] = $topDescriptions[$indexOfDefDesc];
<a name="l00883"></a>00883       }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885       $this-&gt;_printTargets($defaultName, $defaultDesc, <span class="stringliteral">&quot;Default target:&quot;</span>, $maxLength);
<a name="l00886"></a>00886 
<a name="l00887"></a>00887     }
<a name="l00888"></a>00888     $this-&gt;_printTargets($topNames, $topDescriptions, <span class="stringliteral">&quot;Main targets:&quot;</span>, $maxLength);
<a name="l00889"></a>00889     $this-&gt;_printTargets($subNames, null, <span class="stringliteral">&quot;Subtargets:&quot;</span>, 0);
<a name="l00890"></a>00890   }
<a name="l00891"></a>00891 
<a name="l00909"></a>00909   <span class="keyword">private</span> function _printTargets($names, $descriptions, $heading, $maxlen) {
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     $spaces = <span class="stringliteral">&#39;  &#39;</span>;
<a name="l00912"></a>00912     <span class="keywordflow">while</span> (strlen($spaces) &lt; $maxlen) {
<a name="l00913"></a>00913       $spaces .= $spaces;
<a name="l00914"></a>00914     }
<a name="l00915"></a>00915     $msg = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00916"></a>00916     $msg .= $heading . PHP_EOL;
<a name="l00917"></a>00917     $msg .= str_repeat(<span class="stringliteral">&quot;-&quot;</span>,79) . PHP_EOL;
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     $total = count($names);
<a name="l00920"></a>00920     <span class="keywordflow">for</span>($i=0; $i &lt; $total; $i++) {
<a name="l00921"></a>00921       $msg .= <span class="stringliteral">&quot; &quot;</span>;
<a name="l00922"></a>00922       $msg .= $names[$i];
<a name="l00923"></a>00923       <span class="keywordflow">if</span> (!empty($descriptions)) {
<a name="l00924"></a>00924         $msg .= substr($spaces, 0, $maxlen - strlen($names[$i]) + 2);
<a name="l00925"></a>00925         $msg .= $descriptions[$i];
<a name="l00926"></a>00926       }
<a name="l00927"></a>00927       $msg .= PHP_EOL;
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929     <span class="keywordflow">if</span> ($total &gt; 0) {
<a name="l00930"></a>00930       self::$out-&gt;write($msg . PHP_EOL);
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932   }
<a name="l00933"></a>00933 
<a name="l00941"></a><a class="code" href="classPhing.html#a73b5e28e35cc81359886f1f187d661fa">00941</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <span class="keyword">import</span>($dotPath, $classpath = null) {
<a name="l00942"></a>00942 
<a name="l00943"></a>00943     <span class="comment">// first check to see that the class specified hasn&#39;t already been included.</span>
<a name="l00944"></a>00944     <span class="comment">// (this also handles case where this method is called w/ a classname rather than dotpath)</span>
<a name="l00945"></a>00945     $classname = <a class="code" href="classStringHelper.html#a0fc80d4b33d6338c986a0b8a2172db2a" title="Remove qualification to name.">StringHelper::unqualify</a>($dotPath);
<a name="l00946"></a>00946     <span class="keywordflow">if</span> (class_exists($classname, <span class="keyword">false</span>)) {
<a name="l00947"></a>00947       <span class="keywordflow">return</span> $classname;
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950     $dotClassname = basename($dotPath);
<a name="l00951"></a>00951     $dotClassnamePos = strlen($dotPath) - strlen($dotClassname);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <span class="comment">// 1- temporarily replace escaped &#39;.&#39; with another illegal char (#)</span>
<a name="l00954"></a>00954     $tmp = str_replace(<span class="charliteral">&#39;\.&#39;</span>, <span class="stringliteral">&#39;##&#39;</span>, $dotClassname);
<a name="l00955"></a>00955     <span class="comment">// 2- swap out the remaining &#39;.&#39; with DIR_SEP</span>
<a name="l00956"></a>00956     $tmp = strtr($tmp, <span class="charliteral">&#39;.&#39;</span>, DIRECTORY_SEPARATOR);
<a name="l00957"></a>00957     <span class="comment">// 3- swap back the escaped &#39;.&#39;</span>
<a name="l00958"></a>00958     $tmp = str_replace(<span class="stringliteral">&#39;##&#39;</span>, <span class="charliteral">&#39;.&#39;</span>, $tmp);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     $classFile = $tmp . <span class="stringliteral">&quot;.php&quot;</span>;
<a name="l00961"></a>00961 
<a name="l00962"></a>00962     $path = substr_replace($dotPath, $classFile, $dotClassnamePos);
<a name="l00963"></a>00963 
<a name="l00964"></a>00964     <a class="code" href="classPhing.html#a2c003da38700fcc6587df0c0c1857582" title="Import a PHP file.">Phing::__import</a>($path, $classpath);
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="keywordflow">return</span> $classname;
<a name="l00967"></a>00967   }
<a name="l00968"></a>00968 
<a name="l00975"></a><a class="code" href="classPhing.html#a2c003da38700fcc6587df0c0c1857582">00975</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a2c003da38700fcc6587df0c0c1857582" title="Import a PHP file.">__import</a>($path, $classpath = null) {
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="keywordflow">if</span> ($classpath) {
<a name="l00978"></a>00978 
<a name="l00979"></a>00979       <span class="comment">// Apparently casting to (string) no longer invokes __toString() automatically.</span>
<a name="l00980"></a>00980       <span class="keywordflow">if</span> (is_object($classpath)) {
<a name="l00981"></a>00981         $classpath = $classpath-&gt;__toString();
<a name="l00982"></a>00982       }
<a name="l00983"></a>00983 
<a name="l00984"></a>00984       <span class="comment">// classpaths are currently additive, but we also don&#39;t want to just</span>
<a name="l00985"></a>00985       <span class="comment">// indiscriminantly prepand/append stuff to the include_path.  This means</span>
<a name="l00986"></a>00986       <span class="comment">// we need to parse current incldue_path, and prepend any</span>
<a name="l00987"></a>00987       <span class="comment">// specified classpath locations that are not already in the include_path.</span>
<a name="l00988"></a>00988       <span class="comment">//</span>
<a name="l00989"></a>00989       <span class="comment">// NOTE:  the reason why we do it this way instead of just changing include_path</span>
<a name="l00990"></a>00990       <span class="comment">// and then changing it back, is that in many cases applications (e.g. Propel) will</span>
<a name="l00991"></a>00991       <span class="comment">// include/require class files from within method calls.  This means that not all</span>
<a name="l00992"></a>00992       <span class="comment">// necessary files will be included in this import() call, and hence we can&#39;t</span>
<a name="l00993"></a>00993       <span class="comment">// change the include_path back without breaking those apps.  While this method could</span>
<a name="l00994"></a>00994       <span class="comment">// be more expensive than switching &amp; switching back (not sure, but maybe), it makes it</span>
<a name="l00995"></a>00995       <span class="comment">// possible to write far less expensive run-time applications (e.g. using Propel), which is</span>
<a name="l00996"></a>00996       <span class="comment">// really where speed matters more.</span>
<a name="l00997"></a>00997 
<a name="l00998"></a>00998       $curr_parts = explode(PATH_SEPARATOR, get_include_path());
<a name="l00999"></a>00999       $add_parts = explode(PATH_SEPARATOR, $classpath);
<a name="l01000"></a>01000       $new_parts = array_diff($add_parts, $curr_parts);
<a name="l01001"></a>01001       <span class="keywordflow">if</span> ($new_parts) {
<a name="l01002"></a>01002         set_include_path(implode(PATH_SEPARATOR, array_merge($new_parts, $curr_parts)));
<a name="l01003"></a>01003       }
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006     $ret = include_once($path);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     <span class="keywordflow">if</span> ($ret === <span class="keyword">false</span>) {
<a name="l01009"></a>01009       $msg = <span class="stringliteral">&quot;Error importing $path&quot;</span>;
<a name="l01010"></a>01010       <span class="keywordflow">if</span> (self::getMsgOutputLevel() &gt;= Project::MSG_DEBUG) {
<a name="l01011"></a>01011         $x = <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;for-path-trace-only&quot;</span>);
<a name="l01012"></a>01012         $msg .= $x-&gt;getTraceAsString();
<a name="l01013"></a>01013       }
<a name="l01014"></a>01014       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>($msg);
<a name="l01015"></a>01015     }
<a name="l01016"></a>01016   }
<a name="l01017"></a>01017 
<a name="l01022"></a><a class="code" href="classPhing.html#a3ce6bb47e4628f678c8ab07aedfc935f">01022</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a3ce6bb47e4628f678c8ab07aedfc935f" title="Looks on include path for specified file.">getResourcePath</a>($path) {
<a name="l01023"></a>01023 
<a name="l01024"></a>01024     <span class="keywordflow">if</span> (self::$importPaths === null) {
<a name="l01025"></a>01025       $paths = get_include_path();
<a name="l01026"></a>01026       self::$importPaths = explode(PATH_SEPARATOR, ini_get(<span class="stringliteral">&quot;include_path&quot;</span>));
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029     $path = str_replace(<span class="charliteral">&#39;\\&#39;</span>, DIRECTORY_SEPARATOR, $path);
<a name="l01030"></a>01030     $path = str_replace(<span class="charliteral">&#39;/&#39;</span>, DIRECTORY_SEPARATOR, $path);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     <span class="keywordflow">foreach</span> (self::$importPaths as $prefix) {
<a name="l01033"></a>01033       $testPath = $prefix . DIRECTORY_SEPARATOR . $path;
<a name="l01034"></a>01034       <span class="keywordflow">if</span> (file_exists($testPath)) {
<a name="l01035"></a>01035         <span class="keywordflow">return</span> $testPath;
<a name="l01036"></a>01036       }
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039     <span class="comment">// Check for the property phing.home</span>
<a name="l01040"></a>01040     $homeDir = <a class="code" href="classPhing.html#a268f776beab540ebeac9f45eadfcb709" title="Returns property value for a System property.">self::getProperty</a>(<span class="stringliteral">&#39;phing.home&#39;</span>);
<a name="l01041"></a>01041     <span class="keywordflow">if</span> ($homeDir) {
<a name="l01042"></a>01042       $testPath = $homeDir . DIRECTORY_SEPARATOR . $path;
<a name="l01043"></a>01043       <span class="keywordflow">if</span> (file_exists($testPath)) {
<a name="l01044"></a>01044         <span class="keywordflow">return</span> $testPath;
<a name="l01045"></a>01045       }
<a name="l01046"></a>01046     }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048     <span class="comment">// If we are using this via PEAR then check for the file in the data dir</span>
<a name="l01049"></a>01049     <span class="comment">// This is a bit of a hack, but works better than previous solution of assuming</span>
<a name="l01050"></a>01050     <span class="comment">// data_dir is on the include_path.</span>
<a name="l01051"></a>01051     $dataDir = <span class="stringliteral">&#39;@DATA-DIR@&#39;</span>;
<a name="l01052"></a>01052     <span class="keywordflow">if</span> ($dataDir{0} != <span class="charliteral">&#39;@&#39;</span>) { <span class="comment">// if we&#39;re using PEAR then the @ DATA-DIR @ token will have been substituted.</span>
<a name="l01053"></a>01053       $testPath = $dataDir . DIRECTORY_SEPARATOR . $path;
<a name="l01054"></a>01054       <span class="keywordflow">if</span> (file_exists($testPath)) {
<a name="l01055"></a>01055         <span class="keywordflow">return</span> $testPath;
<a name="l01056"></a>01056       }
<a name="l01057"></a>01057     } <span class="keywordflow">else</span> {
<a name="l01058"></a>01058       <span class="comment">// We&#39;re not using PEAR, so do one additional check based on path of</span>
<a name="l01059"></a>01059       <span class="comment">// current file (Phing.php)</span>
<a name="l01060"></a>01060       $maybeHomeDir = realpath(dirname(__FILE__) . DIRECTORY_SEPARATOR . <span class="stringliteral">&#39;..&#39;</span> . DIRECTORY_SEPARATOR  . <span class="stringliteral">&#39;..&#39;</span>);
<a name="l01061"></a>01061       $testPath = $maybeHomeDir . DIRECTORY_SEPARATOR . $path;
<a name="l01062"></a>01062       <span class="keywordflow">if</span> (file_exists($testPath)) {
<a name="l01063"></a>01063         <span class="keywordflow">return</span> $testPath;
<a name="l01064"></a>01064       }
<a name="l01065"></a>01065     }
<a name="l01066"></a>01066 
<a name="l01067"></a>01067     <span class="keywordflow">return</span> null;
<a name="l01068"></a>01068   }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070   <span class="comment">// -------------------------------------------------------------------------------------------</span>
<a name="l01071"></a>01071   <span class="comment">// System-wide methods (moved from System class, which had namespace conflicts w/ PEAR System)</span>
<a name="l01072"></a>01072   <span class="comment">// -------------------------------------------------------------------------------------------</span>
<a name="l01073"></a>01073 
<a name="l01078"></a>01078   <span class="keyword">private</span> <span class="keyword">static</span> function setSystemConstants() {
<a name="l01079"></a>01079 
<a name="l01080"></a>01080     <span class="comment">/*</span>
<a name="l01081"></a>01081 <span class="comment">     * PHP_OS returns on</span>
<a name="l01082"></a>01082 <span class="comment">     *   WindowsNT4.0sp6  =&gt; WINNT</span>
<a name="l01083"></a>01083 <span class="comment">     *   Windows2000      =&gt; WINNT</span>
<a name="l01084"></a>01084 <span class="comment">     *   Windows ME       =&gt; WIN32</span>
<a name="l01085"></a>01085 <span class="comment">     *   Windows 98SE     =&gt; WIN32</span>
<a name="l01086"></a>01086 <span class="comment">     *   FreeBSD 4.5p7    =&gt; FreeBSD</span>
<a name="l01087"></a>01087 <span class="comment">     *   Redhat Linux     =&gt; Linux</span>
<a name="l01088"></a>01088 <span class="comment">     *   Mac OS X     =&gt; Darwin</span>
<a name="l01089"></a>01089 <span class="comment">     */</span>
<a name="l01090"></a>01090     self::setProperty(<span class="stringliteral">&#39;host.os&#39;</span>, PHP_OS);
<a name="l01091"></a>01091 
<a name="l01092"></a>01092     <span class="comment">// this is used by some tasks too</span>
<a name="l01093"></a>01093     self::setProperty(<span class="stringliteral">&#39;os.name&#39;</span>, PHP_OS);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095     <span class="comment">// it&#39;s still possible this won&#39;t be defined,</span>
<a name="l01096"></a>01096     <span class="comment">// e.g. if Phing is being included in another app w/o</span>
<a name="l01097"></a>01097     <span class="comment">// using the phing.php script.</span>
<a name="l01098"></a>01098     <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;PHP_CLASSPATH&#39;</span>)) {
<a name="l01099"></a>01099       define(<span class="stringliteral">&#39;PHP_CLASSPATH&#39;</span>, get_include_path());
<a name="l01100"></a>01100     }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102     self::setProperty(<span class="stringliteral">&#39;php.classpath&#39;</span>, PHP_CLASSPATH);
<a name="l01103"></a>01103 
<a name="l01104"></a>01104     <span class="comment">// try to determine the host filesystem and set system property</span>
<a name="l01105"></a>01105     <span class="comment">// used by Fileself::getFileSystem to instantiate the correct</span>
<a name="l01106"></a>01106     <span class="comment">// abstraction layer</span>
<a name="l01107"></a>01107 
<a name="l01108"></a>01108     <span class="keywordflow">switch</span> (strtoupper(PHP_OS)) {
<a name="l01109"></a>01109       <span class="keywordflow">case</span> <span class="stringliteral">&#39;WINNT&#39;</span>:
<a name="l01110"></a>01110         self::setProperty(<span class="stringliteral">&#39;host.fstype&#39;</span>, <span class="stringliteral">&#39;WINNT&#39;</span>);
<a name="l01111"></a>01111         self::setProperty(<span class="stringliteral">&#39;php.interpreter&#39;</span>, getenv(<span class="stringliteral">&#39;PHP_COMMAND&#39;</span>));
<a name="l01112"></a>01112         <span class="keywordflow">break</span>;
<a name="l01113"></a>01113       <span class="keywordflow">case</span> <span class="stringliteral">&#39;WIN32&#39;</span>:
<a name="l01114"></a>01114         self::setProperty(<span class="stringliteral">&#39;host.fstype&#39;</span>, <span class="stringliteral">&#39;WIN32&#39;</span>);
<a name="l01115"></a>01115         <span class="keywordflow">break</span>;
<a name="l01116"></a>01116       <span class="keywordflow">default</span>:
<a name="l01117"></a>01117         self::setProperty(<span class="stringliteral">&#39;host.fstype&#39;</span>, <span class="stringliteral">&#39;UNIX&#39;</span>);
<a name="l01118"></a>01118         <span class="keywordflow">break</span>;
<a name="l01119"></a>01119     }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121     self::setProperty(<span class="stringliteral">&#39;line.separator&#39;</span>, PHP_EOL);
<a name="l01122"></a>01122     self::setProperty(<span class="stringliteral">&#39;php.version&#39;</span>, PHP_VERSION);
<a name="l01123"></a>01123     self::setProperty(<span class="stringliteral">&#39;user.home&#39;</span>, getenv(<span class="stringliteral">&#39;HOME&#39;</span>));
<a name="l01124"></a>01124     self::setProperty(<span class="stringliteral">&#39;application.startdir&#39;</span>, getcwd());
<a name="l01125"></a>01125     self::setProperty(<span class="stringliteral">&#39;phing.startTime&#39;</span>, gmdate(<span class="stringliteral">&#39;D, d M Y H:i:s&#39;</span>, time()) . <span class="stringliteral">&#39; GMT&#39;</span>);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="comment">// try to detect machine dependent information</span>
<a name="l01128"></a>01128     $sysInfo = array();
<a name="l01129"></a>01129     <span class="keywordflow">if</span> (strtoupper(substr(PHP_OS, 0, 3)) !== <span class="stringliteral">&#39;WIN&#39;</span> &amp;&amp; function_exists(<span class="stringliteral">&quot;posix_uname&quot;</span>)) {
<a name="l01130"></a>01130       $sysInfo = posix_uname();
<a name="l01131"></a>01131     } <span class="keywordflow">else</span> {
<a name="l01132"></a>01132       $sysInfo[<span class="stringliteral">&#39;nodename&#39;</span>] = php_uname(<span class="charliteral">&#39;n&#39;</span>);
<a name="l01133"></a>01133       $sysInfo[<span class="stringliteral">&#39;machine&#39;</span>]= php_uname(<span class="charliteral">&#39;m&#39;</span>) ;
<a name="l01134"></a>01134       <span class="comment">//this is a not so ideal substition, but maybe better than nothing</span>
<a name="l01135"></a>01135       $sysInfo[<span class="stringliteral">&#39;domain&#39;</span>] = isset($_SERVER[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>]) ? $_SERVER[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>] : <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l01136"></a>01136       $sysInfo[<span class="stringliteral">&#39;release&#39;</span>] = php_uname(<span class="charliteral">&#39;r&#39;</span>);
<a name="l01137"></a>01137       $sysInfo[<span class="stringliteral">&#39;version&#39;</span>] = php_uname(<span class="charliteral">&#39;v&#39;</span>);
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     self::setProperty(<span class="stringliteral">&quot;host.name&quot;</span>, isset($sysInfo[<span class="stringliteral">&#39;nodename&#39;</span>]) ? $sysInfo[<span class="stringliteral">&#39;nodename&#39;</span>] : <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l01142"></a>01142     self::setProperty(<span class="stringliteral">&quot;host.arch&quot;</span>, isset($sysInfo[<span class="stringliteral">&#39;machine&#39;</span>]) ? $sysInfo[<span class="stringliteral">&#39;machine&#39;</span>] : <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l01143"></a>01143     self::setProperty(<span class="stringliteral">&quot;host.domain&quot;</span>,isset($sysInfo[<span class="stringliteral">&#39;domain&#39;</span>]) ? $sysInfo[<span class="stringliteral">&#39;domain&#39;</span>] : <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l01144"></a>01144     self::setProperty(<span class="stringliteral">&quot;host.os.release&quot;</span>, isset($sysInfo[<span class="stringliteral">&#39;release&#39;</span>]) ? $sysInfo[<span class="stringliteral">&#39;release&#39;</span>] : <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l01145"></a>01145     self::setProperty(<span class="stringliteral">&quot;host.os.version&quot;</span>, isset($sysInfo[<span class="stringliteral">&#39;version&#39;</span>]) ? $sysInfo[<span class="stringliteral">&#39;version&#39;</span>] : <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l01146"></a>01146     unset($sysInfo);
<a name="l01147"></a>01147   }
<a name="l01148"></a>01148 
<a name="l01159"></a><a class="code" href="classPhing.html#ad92c3a773b615ad24e438465c766ba55">01159</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#ad92c3a773b615ad24e438465c766ba55" title="This gets a property that was set via command line or otherwise passed into Phing...">getDefinedProperty</a>($name) {
<a name="l01160"></a>01160     <span class="keywordflow">return</span> self::$definedProps-&gt;getProperty($name);
<a name="l01161"></a>01161   }
<a name="l01162"></a>01162 
<a name="l01169"></a><a class="code" href="classPhing.html#a01c0606f1a365af137e62e8121dedd4a">01169</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a01c0606f1a365af137e62e8121dedd4a" title="This sets a property that was set via command line or otherwise passed into Phing...">setDefinedProperty</a>($name, $value) {
<a name="l01170"></a>01170     <span class="keywordflow">return</span> self::$definedProps-&gt;setProperty($name, $value);
<a name="l01171"></a>01171   }
<a name="l01172"></a>01172 
<a name="l01182"></a><a class="code" href="classPhing.html#a268f776beab540ebeac9f45eadfcb709">01182</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a268f776beab540ebeac9f45eadfcb709" title="Returns property value for a System property.">getProperty</a>($propName) {
<a name="l01183"></a>01183 
<a name="l01184"></a>01184     <span class="comment">// some properties are detemined on each access</span>
<a name="l01185"></a>01185     <span class="comment">// some are cached, see below</span>
<a name="l01186"></a>01186 
<a name="l01187"></a>01187     <span class="comment">// default is the cached value:</span>
<a name="l01188"></a>01188     $val = isset(self::$properties[$propName]) ? self::$properties[$propName] : null;
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="comment">// special exceptions</span>
<a name="l01191"></a>01191     <span class="keywordflow">switch</span>($propName) {
<a name="l01192"></a>01192       <span class="keywordflow">case</span> <span class="stringliteral">&#39;user.dir&#39;</span>:
<a name="l01193"></a>01193         $val = getcwd();
<a name="l01194"></a>01194         <span class="keywordflow">break</span>;
<a name="l01195"></a>01195     }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="keywordflow">return</span> $val;
<a name="l01198"></a>01198   }
<a name="l01199"></a>01199 
<a name="l01201"></a><a class="code" href="classPhing.html#a38c8104cab279b3008e98cd383c9ec57">01201</a>   <span class="keyword">public</span> <span class="keyword">static</span> function &amp;<a class="code" href="classPhing.html#a38c8104cab279b3008e98cd383c9ec57" title="Retuns reference to all properties.">getProperties</a>() {
<a name="l01202"></a>01202     <span class="keywordflow">return</span> self::$properties;
<a name="l01203"></a>01203   }
<a name="l01204"></a>01204 
<a name="l01205"></a>01205   <span class="keyword">public</span> <span class="keyword">static</span> function setProperty($propName, $propValue) {
<a name="l01206"></a>01206     $propName = (string) $propName;
<a name="l01207"></a>01207     $oldValue = <a class="code" href="classPhing.html#a268f776beab540ebeac9f45eadfcb709" title="Returns property value for a System property.">self::getProperty</a>($propName);
<a name="l01208"></a>01208     self::$properties[$propName] = $propValue;
<a name="l01209"></a>01209     <span class="keywordflow">return</span> $oldValue;
<a name="l01210"></a>01210   }
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   <span class="keyword">public</span> <span class="keyword">static</span> function currentTimeMillis() {
<a name="l01213"></a>01213     list($usec, $sec) = explode(<span class="stringliteral">&quot; &quot;</span>,microtime());
<a name="l01214"></a>01214     <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>)$usec + (<span class="keywordtype">float</span>)$sec);
<a name="l01215"></a>01215   }
<a name="l01216"></a>01216 
<a name="l01222"></a>01222   <span class="keyword">private</span> <span class="keyword">static</span> function setIncludePaths() {
<a name="l01223"></a>01223     <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;PHP_CLASSPATH&#39;</span>)) {
<a name="l01224"></a>01224       $result = set_include_path(PHP_CLASSPATH);
<a name="l01225"></a>01225       <span class="keywordflow">if</span> ($result === <span class="keyword">false</span>) {
<a name="l01226"></a>01226         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classConfigurationException.html">ConfigurationException</a>(<span class="stringliteral">&quot;Could not set PHP include_path.&quot;</span>);
<a name="l01227"></a>01227       }
<a name="l01228"></a>01228       self::$origIniSettings[<span class="stringliteral">&#39;include_path&#39;</span>] = $result; <span class="comment">// save original value for setting back later</span>
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230   }
<a name="l01231"></a>01231 
<a name="l01236"></a>01236   <span class="keyword">private</span> <span class="keyword">static</span> function setIni() {
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     self::$origIniSettings[<span class="stringliteral">&#39;error_reporting&#39;</span>] = error_reporting(E_ALL);
<a name="l01239"></a>01239 
<a name="l01240"></a>01240     <span class="comment">// We won&#39;t bother storing original max_execution_time, since 1) the value in</span>
<a name="l01241"></a>01241     <span class="comment">// php.ini may be wrong (and there&#39;s no way to get the current value) and</span>
<a name="l01242"></a>01242     <span class="comment">// 2) it would mean something very strange to set it to a value less than time script</span>
<a name="l01243"></a>01243     <span class="comment">// has already been running, which would be the likely change.</span>
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     set_time_limit(0);
<a name="l01246"></a>01246 
<a name="l01247"></a>01247     self::$origIniSettings[<span class="stringliteral">&#39;magic_quotes_gpc&#39;</span>] = ini_set(<span class="stringliteral">&#39;magic_quotes_gpc&#39;</span>, <span class="stringliteral">&#39;off&#39;</span>);
<a name="l01248"></a>01248     self::$origIniSettings[<span class="stringliteral">&#39;short_open_tag&#39;</span>] = ini_set(<span class="stringliteral">&#39;short_open_tag&#39;</span>, <span class="stringliteral">&#39;off&#39;</span>);
<a name="l01249"></a>01249     self::$origIniSettings[<span class="stringliteral">&#39;default_charset&#39;</span>] = ini_set(<span class="stringliteral">&#39;default_charset&#39;</span>, <span class="stringliteral">&#39;iso-8859-1&#39;</span>);
<a name="l01250"></a>01250     self::$origIniSettings[<span class="stringliteral">&#39;register_globals&#39;</span>] = ini_set(<span class="stringliteral">&#39;register_globals&#39;</span>, <span class="stringliteral">&#39;off&#39;</span>);
<a name="l01251"></a>01251     self::$origIniSettings[<span class="stringliteral">&#39;allow_call_time_pass_reference&#39;</span>] = ini_set(<span class="stringliteral">&#39;allow_call_time_pass_reference&#39;</span>, <span class="stringliteral">&#39;on&#39;</span>);
<a name="l01252"></a>01252     self::$origIniSettings[<span class="stringliteral">&#39;track_errors&#39;</span>] = ini_set(<span class="stringliteral">&#39;track_errors&#39;</span>, 1);
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     <span class="comment">// should return memory limit in MB</span>
<a name="l01255"></a>01255     $mem_limit = (int) ini_get(<span class="stringliteral">&#39;memory_limit&#39;</span>);
<a name="l01256"></a>01256     <span class="keywordflow">if</span> ($mem_limit &lt; 32) {
<a name="l01257"></a>01257       <span class="comment">// We do *not* need to save the original value here, since we don&#39;t plan to restore</span>
<a name="l01258"></a>01258       <span class="comment">// this after shutdown (we don&#39;t trust the effectiveness of PHP&#39;s garbage collection).</span>
<a name="l01259"></a>01259       ini_set(<span class="stringliteral">&#39;memory_limit&#39;</span>, <span class="stringliteral">&#39;32M&#39;</span>); <span class="comment">// nore: this may need to be higher for many projects</span>
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261   }
<a name="l01262"></a>01262 
<a name="l01272"></a>01272   <span class="keyword">private</span> <span class="keyword">static</span> function restoreIni()
<a name="l01273"></a>01273   {
<a name="l01274"></a>01274     <span class="keywordflow">foreach</span>(self::$origIniSettings as $settingName =&gt; $settingValue) {
<a name="l01275"></a>01275       <span class="keywordflow">switch</span>($settingName) {
<a name="l01276"></a>01276         <span class="keywordflow">case</span> <span class="stringliteral">&#39;error_reporting&#39;</span>:
<a name="l01277"></a>01277           error_reporting($settingValue);
<a name="l01278"></a>01278           <span class="keywordflow">break</span>;
<a name="l01279"></a>01279         <span class="keywordflow">default</span>:
<a name="l01280"></a>01280           ini_set($settingName, $settingValue);
<a name="l01281"></a>01281       }
<a name="l01282"></a>01282     }
<a name="l01283"></a>01283   }
<a name="l01284"></a>01284 
<a name="l01289"></a><a class="code" href="classPhing.html#af9d4f6685cba550acb9791baaab0c9bc">01289</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#af9d4f6685cba550acb9791baaab0c9bc" title="Returns reference to Timer object.">getTimer</a>() {
<a name="l01290"></a>01290     <span class="keywordflow">if</span> (self::$timer === null) {
<a name="l01291"></a>01291       include_once <span class="stringliteral">&#39;phing/system/util/Timer.php&#39;</span>;
<a name="l01292"></a>01292       self::$timer= <span class="keyword">new</span> <a class="code" href="classTimer.html">Timer</a>();
<a name="l01293"></a>01293     }
<a name="l01294"></a>01294     <span class="keywordflow">return</span> self::$timer;
<a name="l01295"></a>01295   }
<a name="l01296"></a>01296 
<a name="l01303"></a><a class="code" href="classPhing.html#aa387ffc2ca5dc45eefa74544de3f79c0">01303</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#aa387ffc2ca5dc45eefa74544de3f79c0" title="Start up Phing.">startup</a>() {
<a name="l01304"></a>01304 
<a name="l01305"></a>01305     <span class="comment">// setup STDOUT and STDERR defaults</span>
<a name="l01306"></a>01306     self::initializeOutputStreams();
<a name="l01307"></a>01307 
<a name="l01308"></a>01308     <span class="comment">// some init stuff</span>
<a name="l01309"></a>01309     <a class="code" href="classPhing.html#af9d4f6685cba550acb9791baaab0c9bc" title="Returns reference to Timer object.">self::getTimer</a>()-&gt;start();
<a name="l01310"></a>01310 
<a name="l01311"></a>01311     self::setSystemConstants();
<a name="l01312"></a>01312     self::setIncludePaths();
<a name="l01313"></a>01313     self::setIni();
<a name="l01314"></a>01314   }
<a name="l01315"></a>01315 
<a name="l01322"></a><a class="code" href="classPhing.html#afed88d1a66b40e5dfc049c7b992a562a">01322</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#afed88d1a66b40e5dfc049c7b992a562a" title="Halts the system.">halt</a>() {
<a name="l01323"></a>01323     <a class="code" href="classPhing.html#a28b4d8abd082c4f571569c582f85987e" title="Performs any shutdown routines, such as stopping timers.">self::shutdown</a>();
<a name="l01324"></a>01324   }
<a name="l01325"></a>01325 
<a name="l01330"></a><a class="code" href="classPhing.html#a28b4d8abd082c4f571569c582f85987e">01330</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classPhing.html#a28b4d8abd082c4f571569c582f85987e" title="Performs any shutdown routines, such as stopping timers.">shutdown</a>() {
<a name="l01331"></a>01331     self::restoreIni();
<a name="l01332"></a>01332     <a class="code" href="classPhing.html#af9d4f6685cba550acb9791baaab0c9bc" title="Returns reference to Timer object.">self::getTimer</a>()-&gt;stop();
<a name="l01333"></a>01333   }
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
