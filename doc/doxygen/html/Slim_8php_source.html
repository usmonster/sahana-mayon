<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: web/install/Slim/Slim.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>web/install/Slim/Slim.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00033"></a>00033 <span class="comment">//Ensure PHP session IDs only use the characters [a-z0-9]</span>
<a name="l00034"></a>00034 ini_set(<span class="stringliteral">&#39;session.hash_bits_per_character&#39;</span>, 4);
<a name="l00035"></a>00035 ini_set(<span class="stringliteral">&#39;session.hash_function&#39;</span>, 0);
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">//Slim&#39;s Encryted Cookies rely on libmcyrpt and these two constants.</span>
<a name="l00038"></a>00038 <span class="comment">//If libmycrpt is unavailable, we ensure the expected constants</span>
<a name="l00039"></a>00039 <span class="comment">//are available to avoid errors.</span>
<a name="l00040"></a>00040 <span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;MCRYPT_RIJNDAEL_256&#39;</span>) ) {
<a name="l00041"></a>00041     define(<span class="stringliteral">&#39;MCRYPT_RIJNDAEL_256&#39;</span>, 0);
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 <span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;MCRYPT_MODE_CBC&#39;</span>) ) {
<a name="l00044"></a>00044     define(<span class="stringliteral">&#39;MCRYPT_MODE_CBC&#39;</span>, 0);
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">//This determines which errors are reported by PHP. By default, all</span>
<a name="l00048"></a>00048 <span class="comment">//errors (including E_STRICT) are reported.</span>
<a name="l00049"></a>00049 error_reporting(E_ALL | E_STRICT);
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">//This tells PHP to auto-load classes using Slim&#39;s autoloader; this will</span>
<a name="l00052"></a>00052 <span class="comment">//only auto-load a class file located in the same directory as Slim.php</span>
<a name="l00053"></a>00053 <span class="comment">//whose file name (excluding the final dot and extension) is the same</span>
<a name="l00054"></a>00054 <span class="comment">//as its class name (case-sensitive). For example, &quot;View.php&quot; will be</span>
<a name="l00055"></a>00055 <span class="comment">//loaded when Slim uses the &quot;View&quot; class for the first time.</span>
<a name="l00056"></a>00056 spl_autoload_register(array(<span class="stringliteral">&#39;Slim&#39;</span>, <span class="stringliteral">&#39;autoload&#39;</span>));
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">//PHP 5.3 will complain if you don&#39;t set a timezone. If you do not</span>
<a name="l00059"></a>00059 <span class="comment">//specify your own timezone before requiring Slim, this tells PHP to use UTC.</span>
<a name="l00060"></a>00060 <span class="keywordflow">if</span> ( @date_default_timezone_set(date_default_timezone_get()) === <span class="keyword">false</span> ) {
<a name="l00061"></a>00061     date_default_timezone_set(<span class="stringliteral">&#39;UTC&#39;</span>);
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00071"></a><a class="code" href="classSlim.html">00071</a> <span class="keyword">class </span><a class="code" href="classSlim.html">Slim</a> {
<a name="l00072"></a>00072 
<a name="l00076"></a>00076     <span class="keyword">protected</span> <span class="keyword">static</span> $apps = array();
<a name="l00077"></a>00077 
<a name="l00081"></a>00081     <span class="keyword">protected</span> $name;
<a name="l00082"></a>00082 
<a name="l00086"></a>00086     <span class="keyword">protected</span> $request;
<a name="l00087"></a>00087 
<a name="l00091"></a>00091     <span class="keyword">protected</span> $response;
<a name="l00092"></a>00092 
<a name="l00096"></a>00096     <span class="keyword">protected</span> $router;
<a name="l00097"></a>00097 
<a name="l00101"></a>00101     <span class="keyword">protected</span> $view;
<a name="l00102"></a>00102 
<a name="l00106"></a>00106     <span class="keyword">protected</span> $log;
<a name="l00107"></a>00107 
<a name="l00111"></a>00111     <span class="keyword">protected</span> $settings;
<a name="l00112"></a>00112 
<a name="l00116"></a>00116     <span class="keyword">protected</span> $mode;
<a name="l00117"></a>00117 
<a name="l00121"></a>00121     <span class="keyword">protected</span> $hooks = array(
<a name="l00122"></a>00122         <span class="stringliteral">&#39;slim.before&#39;</span> =&gt; array(array()),
<a name="l00123"></a>00123         <span class="stringliteral">&#39;slim.before.router&#39;</span> =&gt; array(array()),
<a name="l00124"></a>00124         <span class="stringliteral">&#39;slim.before.dispatch&#39;</span> =&gt; array(array()),
<a name="l00125"></a>00125         <span class="stringliteral">&#39;slim.after.dispatch&#39;</span> =&gt; array(array()),
<a name="l00126"></a>00126         <span class="stringliteral">&#39;slim.after.router&#39;</span> =&gt; array(array()),
<a name="l00127"></a>00127         <span class="stringliteral">&#39;slim.after&#39;</span> =&gt; array(array())
<a name="l00128"></a>00128     );
<a name="l00129"></a>00129 
<a name="l00139"></a><a class="code" href="classSlim.html#a44b394581828057191aba0b9452c24e8">00139</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classSlim.html#a44b394581828057191aba0b9452c24e8" title="Slim auto-loader.">autoload</a>( $class ) {
<a name="l00140"></a>00140         <span class="keywordflow">if</span> ( strpos($class, <span class="stringliteral">&#39;Slim&#39;</span>) !== 0 ) {
<a name="l00141"></a>00141             <span class="keywordflow">return</span>;
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         $file = dirname(__FILE__) . <span class="charliteral">&#39;/&#39;</span> . str_replace(<span class="charliteral">&#39;_&#39;</span>, DIRECTORY_SEPARATOR, substr($class,5)) . <span class="stringliteral">&#39;.php&#39;</span>;
<a name="l00144"></a>00144         <span class="keywordflow">if</span> ( file_exists($file) ) {
<a name="l00145"></a>00145             require $file;
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="comment">/***** INITIALIZATION *****/</span>
<a name="l00150"></a>00150 
<a name="l00156"></a><a class="code" href="classSlim.html#afeb8661ac253cc826e8d4f4536cf63c6">00156</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#afeb8661ac253cc826e8d4f4536cf63c6" title="Constructor.">__construct</a>( $userSettings = array() ) {
<a name="l00157"></a>00157         <span class="comment">//Merge application settings</span>
<a name="l00158"></a>00158         $this-&gt;settings = array_merge(array(
<a name="l00159"></a>00159             <span class="comment">//Mode</span>
<a name="l00160"></a>00160             <span class="stringliteral">&#39;mode&#39;</span> =&gt; <span class="stringliteral">&#39;development&#39;</span>,
<a name="l00161"></a>00161             <span class="comment">//Logging</span>
<a name="l00162"></a>00162             <span class="stringliteral">&#39;log.enable&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l00163"></a>00163             <span class="stringliteral">&#39;log.logger&#39;</span> =&gt; null,
<a name="l00164"></a>00164             <span class="stringliteral">&#39;log.path&#39;</span> =&gt; <span class="stringliteral">&#39;./logs&#39;</span>,
<a name="l00165"></a>00165             <span class="stringliteral">&#39;log.level&#39;</span> =&gt; 4,
<a name="l00166"></a>00166             <span class="comment">//Debugging</span>
<a name="l00167"></a>00167             <span class="stringliteral">&#39;debug&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00168"></a>00168             <span class="comment">//View</span>
<a name="l00169"></a>00169             <span class="stringliteral">&#39;templates.path&#39;</span> =&gt; <span class="stringliteral">&#39;./templates&#39;</span>,
<a name="l00170"></a>00170             <span class="stringliteral">&#39;view&#39;</span> =&gt; <span class="stringliteral">&#39;Slim_View&#39;</span>,
<a name="l00171"></a>00171             <span class="comment">//Settings for all cookies</span>
<a name="l00172"></a>00172             <span class="stringliteral">&#39;cookies.lifetime&#39;</span> =&gt; <span class="stringliteral">&#39;20 minutes&#39;</span>,
<a name="l00173"></a>00173             <span class="stringliteral">&#39;cookies.path&#39;</span> =&gt; <span class="charliteral">&#39;/&#39;</span>,
<a name="l00174"></a>00174             <span class="stringliteral">&#39;cookies.domain&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00175"></a>00175             <span class="stringliteral">&#39;cookies.secure&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l00176"></a>00176             <span class="stringliteral">&#39;cookies.httponly&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l00177"></a>00177             <span class="comment">//Settings for encrypted cookies</span>
<a name="l00178"></a>00178             <span class="stringliteral">&#39;cookies.secret_key&#39;</span> =&gt; <span class="stringliteral">&#39;CHANGE_ME&#39;</span>,
<a name="l00179"></a>00179             <span class="stringliteral">&#39;cookies.cipher&#39;</span> =&gt; MCRYPT_RIJNDAEL_256,
<a name="l00180"></a>00180             <span class="stringliteral">&#39;cookies.cipher_mode&#39;</span> =&gt; MCRYPT_MODE_CBC,
<a name="l00181"></a>00181             <span class="stringliteral">&#39;cookies.encrypt&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00182"></a>00182             <span class="stringliteral">&#39;cookies.user_id&#39;</span> =&gt; <span class="stringliteral">&#39;DEFAULT&#39;</span>,
<a name="l00183"></a>00183             <span class="comment">//Session handler</span>
<a name="l00184"></a>00184             <span class="stringliteral">&#39;session.handler&#39;</span> =&gt; <span class="keyword">new</span> <a class="code" href="classSlim__Session__Handler__Cookies.html">Slim_Session_Handler_Cookies</a>(),
<a name="l00185"></a>00185             <span class="stringliteral">&#39;session.flash_key&#39;</span> =&gt; <span class="stringliteral">&#39;flash&#39;</span>,
<a name="l00186"></a>00186             <span class="comment">//HTTP</span>
<a name="l00187"></a>00187             <span class="stringliteral">&#39;http.version&#39;</span> =&gt; null
<a name="l00188"></a>00188         ), $userSettings);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190         <span class="comment">//Determine application mode</span>
<a name="l00191"></a>00191         $this-&gt;<a class="code" href="classSlim.html#a3bf15442e4e9dbb7e29373cc7c934d66" title="Get application mode.">getMode</a>();
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         <span class="comment">//Setup HTTP request and response handling</span>
<a name="l00194"></a>00194         $this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a> = <span class="keyword">new</span> <a class="code" href="classSlim__Http__Request.html">Slim_Http_Request</a>();
<a name="l00195"></a>00195         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a> = <span class="keyword">new</span> <a class="code" href="classSlim__Http__Response.html">Slim_Http_Response</a>($this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>);
<a name="l00196"></a>00196         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;setCookieJar(<span class="keyword">new</span> <a class="code" href="classSlim__Http__CookieJar.html" title="Slim - a micro PHP 5 framework.">Slim_Http_CookieJar</a>($this-&gt;settings[<span class="stringliteral">&#39;cookies.secret_key&#39;</span>], array(
<a name="l00197"></a>00197             <span class="stringliteral">&#39;high_confidentiality&#39;</span> =&gt; $this-&gt;settings[<span class="stringliteral">&#39;cookies.encrypt&#39;</span>],
<a name="l00198"></a>00198             <span class="stringliteral">&#39;mcrypt_algorithm&#39;</span> =&gt; $this-&gt;settings[<span class="stringliteral">&#39;cookies.cipher&#39;</span>],
<a name="l00199"></a>00199             <span class="stringliteral">&#39;mcrypt_mode&#39;</span> =&gt; $this-&gt;settings[<span class="stringliteral">&#39;cookies.cipher_mode&#39;</span>],
<a name="l00200"></a>00200             <span class="stringliteral">&#39;enable_ssl&#39;</span> =&gt; $this-&gt;settings[<span class="stringliteral">&#39;cookies.secure&#39;</span>]
<a name="l00201"></a>00201         )));
<a name="l00202"></a>00202         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;httpVersion($this-&gt;settings[<span class="stringliteral">&#39;http.version&#39;</span>]);
<a name="l00203"></a>00203         $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a> = <span class="keyword">new</span> <a class="code" href="classSlim__Router.html">Slim_Router</a>($this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="comment">//Start session if not already started</span>
<a name="l00206"></a>00206         <span class="keywordflow">if</span> ( session_id() === <span class="stringliteral">&#39;&#39;</span> ) {
<a name="l00207"></a>00207             $sessionHandler = $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;session.handler&#39;</span>);
<a name="l00208"></a>00208             <span class="keywordflow">if</span> ( $sessionHandler instanceof <a class="code" href="classSlim__Session__Handler.html">Slim_Session_Handler</a> ) {
<a name="l00209"></a>00209                 $sessionHandler-&gt;register($this);
<a name="l00210"></a>00210             }
<a name="l00211"></a>00211             session_cache_limiter(<span class="keyword">false</span>); 
<a name="l00212"></a>00212             session_start();
<a name="l00213"></a>00213         }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         <span class="comment">//Setup view with flash messaging</span>
<a name="l00216"></a>00216         $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>($this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;view&#39;</span>))-&gt;setData(<span class="stringliteral">&#39;flash&#39;</span>, <span class="keyword">new</span> <a class="code" href="classSlim__Session__Flash.html">Slim_Session_Flash</a>($this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;session.flash_key&#39;</span>)));
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         <span class="comment">//Set app name</span>
<a name="l00219"></a>00219         <span class="keywordflow">if</span> ( !isset(self::$apps[<span class="stringliteral">&#39;default&#39;</span>]) ) {
<a name="l00220"></a>00220             $this-&gt;<a class="code" href="classSlim.html#ab415b8cf1c07452cd7f710049295b659" title="Set Slim application name.">setName</a>(<span class="stringliteral">&#39;default&#39;</span>);
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <span class="comment">//Set global Error handler after Slim app instantiated</span>
<a name="l00224"></a>00224         set_error_handler(array(<span class="stringliteral">&#39;Slim&#39;</span>, <span class="stringliteral">&#39;handleErrors&#39;</span>));
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00231"></a><a class="code" href="classSlim.html#a3bf15442e4e9dbb7e29373cc7c934d66">00231</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a3bf15442e4e9dbb7e29373cc7c934d66" title="Get application mode.">getMode</a>() {
<a name="l00232"></a>00232         <span class="keywordflow">if</span> ( !isset($this-&gt;mode) ) {
<a name="l00233"></a>00233             <span class="keywordflow">if</span> ( isset($_ENV[<span class="stringliteral">&#39;SLIM_MODE&#39;</span>]) ) {
<a name="l00234"></a>00234                 $this-&gt;mode = (string)$_ENV[<span class="stringliteral">&#39;SLIM_MODE&#39;</span>];
<a name="l00235"></a>00235             } <span class="keywordflow">else</span> {
<a name="l00236"></a>00236                 $envMode = getenv(<span class="stringliteral">&#39;SLIM_MODE&#39;</span>);
<a name="l00237"></a>00237                 <span class="keywordflow">if</span> ( $envMode !== <span class="keyword">false</span> ) {
<a name="l00238"></a>00238                     $this-&gt;mode = $envMode;
<a name="l00239"></a>00239                 } <span class="keywordflow">else</span> {
<a name="l00240"></a>00240                     $this-&gt;mode = (string)$this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;mode&#39;</span>);
<a name="l00241"></a>00241                 }
<a name="l00242"></a>00242             }
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244         <span class="keywordflow">return</span> $this-&gt;mode;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <span class="comment">/***** NAMING *****/</span>
<a name="l00248"></a>00248 
<a name="l00254"></a><a class="code" href="classSlim.html#a15af1ec2af4ab920cd25cba9910ec85f">00254</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classSlim.html#a15af1ec2af4ab920cd25cba9910ec85f" title="Get Slim application with name.">getInstance</a>( $name = <span class="stringliteral">&#39;default&#39;</span> ) {
<a name="l00255"></a>00255         <span class="keywordflow">return</span> isset(self::$apps[(<span class="keywordtype">string</span>)$name]) ? self::$apps[(string)$name] : null;
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257 
<a name="l00263"></a><a class="code" href="classSlim.html#ab415b8cf1c07452cd7f710049295b659">00263</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ab415b8cf1c07452cd7f710049295b659" title="Set Slim application name.">setName</a>( $name ) {
<a name="l00264"></a>00264         $this-&gt;name = $name;
<a name="l00265"></a>00265         self::$apps[$name] = $this;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 
<a name="l00272"></a><a class="code" href="classSlim.html#aff3169f678f73966191163b2ba9c2ff3">00272</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#aff3169f678f73966191163b2ba9c2ff3" title="Get Slim application name.">getName</a>() {
<a name="l00273"></a>00273         <span class="keywordflow">return</span> $this-&gt;name;
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="comment">/***** LOGGING *****/</span>
<a name="l00277"></a>00277 
<a name="l00282"></a><a class="code" href="classSlim.html#a582c26a494b297345e3ab36f259907cd">00282</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a582c26a494b297345e3ab36f259907cd" title="Get application Log (lazy-loaded).">getLog</a>() {
<a name="l00283"></a>00283         <span class="keywordflow">if</span> ( !isset($this-&gt;log) ) {
<a name="l00284"></a>00284             $this-&gt;log = <span class="keyword">new</span> <a class="code" href="classSlim__Log.html">Slim_Log</a>();
<a name="l00285"></a>00285             $this-&gt;log-&gt;setEnabled($this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;log.enable&#39;</span>));
<a name="l00286"></a>00286             $logger = $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;log.logger&#39;</span>);
<a name="l00287"></a>00287             <span class="keywordflow">if</span> ( $logger ) {
<a name="l00288"></a>00288                 $this-&gt;log-&gt;setLogger($logger);
<a name="l00289"></a>00289             } <span class="keywordflow">else</span> {
<a name="l00290"></a>00290                 $this-&gt;log-&gt;setLogger(<span class="keyword">new</span> <a class="code" href="classSlim__Logger.html">Slim_Logger</a>($this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;log.path&#39;</span>), $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;log.level&#39;</span>)));
<a name="l00291"></a>00291             }
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293         <span class="keywordflow">return</span> $this-&gt;log;
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="comment">/***** CONFIGURATION *****/</span>
<a name="l00297"></a>00297 
<a name="l00310"></a><a class="code" href="classSlim.html#af553b55799be42e3822b3cdd7dc7b17c">00310</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#af553b55799be42e3822b3cdd7dc7b17c" title="Configure Slim for a given mode.">configureMode</a>( $mode, $callable ) {
<a name="l00311"></a>00311         <span class="keywordflow">if</span> ( $mode === $this-&gt;<a class="code" href="classSlim.html#a3bf15442e4e9dbb7e29373cc7c934d66" title="Get application mode.">getMode</a>() &amp;&amp; is_callable($callable) ) {
<a name="l00312"></a>00312             call_user_func($callable);
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 
<a name="l00335"></a><a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b">00335</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>( $name, $value = null ) {
<a name="l00336"></a>00336         <span class="keywordflow">if</span> ( func_num_args() === 1 ) {
<a name="l00337"></a>00337             <span class="keywordflow">if</span> ( is_array($name) ) {
<a name="l00338"></a>00338                 $this-&gt;settings = array_merge($this-&gt;settings, $name);
<a name="l00339"></a>00339             } <span class="keywordflow">else</span> {
<a name="l00340"></a>00340                 <span class="keywordflow">return</span> in_array($name, array_keys($this-&gt;settings)) ? $this-&gt;settings[$name] : null;
<a name="l00341"></a>00341             }
<a name="l00342"></a>00342         } <span class="keywordflow">else</span> {
<a name="l00343"></a>00343             $this-&gt;settings[$name] = $value;
<a name="l00344"></a>00344         }
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="comment">/***** ROUTING *****/</span>
<a name="l00348"></a>00348 
<a name="l00379"></a><a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f">00379</a>     <span class="keyword">protected</span> function <a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f" title="Add GET|POST|PUT|DELETE route.">mapRoute</a>($args) {
<a name="l00380"></a>00380         $pattern = array_shift($args);
<a name="l00381"></a>00381         $callable = array_pop($args);
<a name="l00382"></a>00382         $route = $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>-&gt;map($pattern, $callable);
<a name="l00383"></a>00383         <span class="keywordflow">if</span> ( count($args) &gt; 0 ) {
<a name="l00384"></a>00384             $route-&gt;setMiddleware($args);
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386         <span class="keywordflow">return</span> $route;
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388 
<a name="l00394"></a><a class="code" href="classSlim.html#a883b7fb8431c7814cdc83cec5ddc4a72">00394</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a883b7fb8431c7814cdc83cec5ddc4a72" title="Add generic route without associated HTTP method.">map</a>() {
<a name="l00395"></a>00395         $args = func_get_args();
<a name="l00396"></a>00396         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f" title="Add GET|POST|PUT|DELETE route.">mapRoute</a>($args);
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00404"></a><a class="code" href="classSlim.html#a4b6c1ba09123a5bf8cc3faf0227cfb52">00404</a>     <span class="keyword">public</span> function <span class="keyword">get</span>() {
<a name="l00405"></a>00405         $args = func_get_args();
<a name="l00406"></a>00406         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f" title="Add GET|POST|PUT|DELETE route.">mapRoute</a>($args)-&gt;via(Slim_Http_Request::METHOD_GET, Slim_Http_Request::METHOD_HEAD);
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00414"></a><a class="code" href="classSlim.html#aa6a4f6c23a5136762feedf84966d18bf">00414</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#aa6a4f6c23a5136762feedf84966d18bf" title="Add POST route.">post</a>() {
<a name="l00415"></a>00415         $args = func_get_args();
<a name="l00416"></a>00416         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f" title="Add GET|POST|PUT|DELETE route.">mapRoute</a>($args)-&gt;via(Slim_Http_Request::METHOD_POST);
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418 
<a name="l00424"></a><a class="code" href="classSlim.html#a93a7e4213ce0fd4a4b1b64d72eeeac9e">00424</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a93a7e4213ce0fd4a4b1b64d72eeeac9e" title="Add PUT route.">put</a>() {
<a name="l00425"></a>00425         $args = func_get_args();
<a name="l00426"></a>00426         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f" title="Add GET|POST|PUT|DELETE route.">mapRoute</a>($args)-&gt;via(Slim_Http_Request::METHOD_PUT);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 
<a name="l00434"></a><a class="code" href="classSlim.html#a3c608585588528c5e6cea5063233c2a3">00434</a>     <span class="keyword">public</span> function <span class="keyword">delete</span>() {
<a name="l00435"></a>00435         $args = func_get_args();
<a name="l00436"></a>00436         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f" title="Add GET|POST|PUT|DELETE route.">mapRoute</a>($args)-&gt;via(Slim_Http_Request::METHOD_DELETE);
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438 
<a name="l00444"></a><a class="code" href="classSlim.html#a455ec2b45bcb64ff50dc1e8ec6160acf">00444</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a455ec2b45bcb64ff50dc1e8ec6160acf" title="Add OPTIONS route.">options</a>() {
<a name="l00445"></a>00445         $args = func_get_args();
<a name="l00446"></a>00446         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4ba7f682abc9c4dedd1894974f77266f" title="Add GET|POST|PUT|DELETE route.">mapRoute</a>($args)-&gt;via(Slim_Http_Request::METHOD_OPTIONS);
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448 
<a name="l00471"></a><a class="code" href="classSlim.html#a7757d85bd57f35d69f27bd3ebd8eae4d">00471</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a7757d85bd57f35d69f27bd3ebd8eae4d" title="Not Found Handler.">notFound</a>( $callable = null ) {
<a name="l00472"></a>00472         <span class="keywordflow">if</span> ( !is_null($callable) ) {
<a name="l00473"></a>00473             $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>-&gt;notFound($callable);
<a name="l00474"></a>00474         } <span class="keywordflow">else</span> {
<a name="l00475"></a>00475             ob_start();
<a name="l00476"></a>00476             $customNotFoundHandler = $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>-&gt;notFound();
<a name="l00477"></a>00477             <span class="keywordflow">if</span> ( is_callable($customNotFoundHandler) ) {
<a name="l00478"></a>00478                 call_user_func($customNotFoundHandler);
<a name="l00479"></a>00479             } <span class="keywordflow">else</span> {
<a name="l00480"></a>00480                 call_user_func(array($this, <span class="stringliteral">&#39;defaultNotFound&#39;</span>));
<a name="l00481"></a>00481             }
<a name="l00482"></a>00482             $this-&gt;<a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>(404, ob_get_clean());
<a name="l00483"></a>00483         }
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485 
<a name="l00510"></a><a class="code" href="classSlim.html#ae0f2060161b86ee70dfe9a704624cfc2">00510</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ae0f2060161b86ee70dfe9a704624cfc2" title="Error Handler.">error</a>( $argument = null ) {
<a name="l00511"></a>00511         <span class="keywordflow">if</span> ( is_callable($argument) ) {
<a name="l00512"></a>00512             <span class="comment">//Register error handler</span>
<a name="l00513"></a>00513             $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>-&gt;error($argument);
<a name="l00514"></a>00514         } <span class="keywordflow">else</span> {
<a name="l00515"></a>00515             <span class="comment">//Invoke error handler</span>
<a name="l00516"></a>00516             ob_start();
<a name="l00517"></a>00517             $customErrorHandler = $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>-&gt;error();
<a name="l00518"></a>00518             <span class="keywordflow">if</span> ( is_callable($customErrorHandler) ) {
<a name="l00519"></a>00519                 call_user_func_array($customErrorHandler, array($argument));
<a name="l00520"></a>00520             } <span class="keywordflow">else</span> {
<a name="l00521"></a>00521                 call_user_func_array(array($this, <span class="stringliteral">&#39;defaultError&#39;</span>), array($argument));
<a name="l00522"></a>00522             }
<a name="l00523"></a>00523             $this-&gt;<a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>(500, ob_get_clean());
<a name="l00524"></a>00524         }
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     <span class="comment">/***** ACCESSORS *****/</span>
<a name="l00528"></a>00528 
<a name="l00533"></a><a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e">00533</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>() {
<a name="l00534"></a>00534         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>;
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536 
<a name="l00541"></a><a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807">00541</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>() {
<a name="l00542"></a>00542         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 
<a name="l00549"></a><a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49">00549</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>() {
<a name="l00550"></a>00550         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>;
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552 
<a name="l00569"></a><a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875">00569</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>( $viewClass = null ) {
<a name="l00570"></a>00570         <span class="keywordflow">if</span> ( !is_null($viewClass) ) {
<a name="l00571"></a>00571             $existingData = is_null($this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>) ? array() : $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;getData();
<a name="l00572"></a>00572             <span class="keywordflow">if</span> ( $viewClass instanceOf <a class="code" href="classSlim__View.html">Slim_View</a> ) {
<a name="l00573"></a>00573                 $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a> = $viewClass;
<a name="l00574"></a>00574             } <span class="keywordflow">else</span> {
<a name="l00575"></a>00575                 $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a> = <span class="keyword">new</span> $viewClass();
<a name="l00576"></a>00576             }
<a name="l00577"></a>00577             $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;appendData($existingData);
<a name="l00578"></a>00578             $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;setTemplatesDirectory($this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;templates.path&#39;</span>));
<a name="l00579"></a>00579         }
<a name="l00580"></a>00580         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>;
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <span class="comment">/***** RENDERING *****/</span>
<a name="l00584"></a>00584 
<a name="l00598"></a><a class="code" href="classSlim.html#a54f61bda14f93007c46d03f609acfe4d">00598</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a54f61bda14f93007c46d03f609acfe4d" title="Render a template.">render</a>( $template, $data = array(), $status = null ) {
<a name="l00599"></a>00599         <span class="keywordflow">if</span> ( !is_null($status) ) {
<a name="l00600"></a>00600             $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;status($status);
<a name="l00601"></a>00601         }
<a name="l00602"></a>00602         $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;appendData($data);
<a name="l00603"></a>00603         $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;display($template);
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     <span class="comment">/***** HTTP CACHING *****/</span>
<a name="l00607"></a>00607 
<a name="l00623"></a><a class="code" href="classSlim.html#a8c81dc8753f5585235e165472a6b2756">00623</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a8c81dc8753f5585235e165472a6b2756" title="Set Last-Modified HTTP Response Header.">lastModified</a>( $time ) {
<a name="l00624"></a>00624         <span class="keywordflow">if</span> ( is_integer($time) ) {
<a name="l00625"></a>00625             $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;header(<span class="stringliteral">&#39;Last-Modified&#39;</span>, date(DATE_RFC1123, $time));
<a name="l00626"></a>00626             <span class="keywordflow">if</span> ( $time === strtotime($this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>-&gt;headers(<span class="stringliteral">&#39;IF_MODIFIED_SINCE&#39;</span>)) ) $this-&gt;<a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>(304);
<a name="l00627"></a>00627         } <span class="keywordflow">else</span> {
<a name="l00628"></a>00628             <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidArgumentException(<span class="stringliteral">&#39;Slim::lastModified only accepts an integer UNIX timestamp value.&#39;</span>);
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631 
<a name="l00649"></a><a class="code" href="classSlim.html#af601513e48fdfe2bd13ebfb3528c70d6">00649</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#af601513e48fdfe2bd13ebfb3528c70d6" title="Set ETag HTTP Response Header.">etag</a>( $value, $type = <span class="stringliteral">&#39;strong&#39;</span> ) {
<a name="l00650"></a>00650 
<a name="l00651"></a>00651         <span class="comment">//Ensure type is correct</span>
<a name="l00652"></a>00652         <span class="keywordflow">if</span> ( !in_array($type, array(<span class="stringliteral">&#39;strong&#39;</span>, <span class="stringliteral">&#39;weak&#39;</span>)) ) {
<a name="l00653"></a>00653             <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidArgumentException(<span class="stringliteral">&#39;Invalid Slim::etag type. Expected &quot;strong&quot; or &quot;weak&quot;.&#39;</span>);
<a name="l00654"></a>00654         }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656         <span class="comment">//Set etag value</span>
<a name="l00657"></a>00657         $value = <span class="charliteral">&#39;&quot;&#39;</span> . $value . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00658"></a>00658         <span class="keywordflow">if</span> ( $type === <span class="stringliteral">&#39;weak&#39;</span> ) $value = <span class="stringliteral">&#39;W/&#39;</span>.$value;
<a name="l00659"></a>00659         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;header(<span class="stringliteral">&#39;ETag&#39;</span>, $value);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661         <span class="comment">//Check conditional GET</span>
<a name="l00662"></a>00662         <span class="keywordflow">if</span> ( $etagsHeader = $this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>-&gt;headers(<span class="stringliteral">&#39;IF_NONE_MATCH&#39;</span>)) {
<a name="l00663"></a>00663             $etags = preg_split(<span class="stringliteral">&#39;@\s*,\s*@&#39;</span>, $etagsHeader);
<a name="l00664"></a>00664             <span class="keywordflow">if</span> ( in_array($value, $etags) || in_array(<span class="charliteral">&#39;*&#39;</span>, $etags) ) $this-&gt;<a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>(304);
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <span class="comment">/***** COOKIES *****/</span>
<a name="l00670"></a>00670 
<a name="l00686"></a><a class="code" href="classSlim.html#a45058fb695d298fff434d0234d8fd858">00686</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a45058fb695d298fff434d0234d8fd858" title="Set a normal, unencrypted Cookie.">setCookie</a>( $name, $value, $time = null, $path = null, $domain = null, $secure = null, $httponly = null ) {
<a name="l00687"></a>00687         $time = is_null($time) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.lifetime&#39;</span>) : $time;
<a name="l00688"></a>00688         $path = is_null($path) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.path&#39;</span>) : $path;
<a name="l00689"></a>00689         $domain = is_null($domain) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.domain&#39;</span>) : $domain;
<a name="l00690"></a>00690         $secure = is_null($secure) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.secure&#39;</span>) : $secure;
<a name="l00691"></a>00691         $httponly = is_null($httponly) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.httponly&#39;</span>) : $httponly;
<a name="l00692"></a>00692         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;getCookieJar()-&gt;setClassicCookie($name, $value, $time, $path, $domain, $secure, $httponly);
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694 
<a name="l00705"></a><a class="code" href="classSlim.html#a18be8858bafad86369e8392db64d152e">00705</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a18be8858bafad86369e8392db64d152e" title="Get the value of a Cookie from the current HTTP Request.">getCookie</a>( $name ) {
<a name="l00706"></a>00706         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>-&gt;cookies($name);
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708 
<a name="l00724"></a><a class="code" href="classSlim.html#ac8d34899995cb07d788a51e98b5a0674">00724</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ac8d34899995cb07d788a51e98b5a0674" title="Set an encrypted Cookie.">setEncryptedCookie</a>( $name, $value, $time = null, $path = null, $domain = null, $secure = null, $httponly = null ) {
<a name="l00725"></a>00725         $time = is_null($time) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.lifetime&#39;</span>) : $time;
<a name="l00726"></a>00726         $path = is_null($path) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.path&#39;</span>) : $path;
<a name="l00727"></a>00727         $domain = is_null($domain) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.domain&#39;</span>) : $domain;
<a name="l00728"></a>00728         $secure = is_null($secure) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.secure&#39;</span>) : $secure;
<a name="l00729"></a>00729         $httponly = is_null($httponly) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.httponly&#39;</span>) : $httponly;
<a name="l00730"></a>00730         $userId = $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.user_id&#39;</span>);
<a name="l00731"></a>00731         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;getCookieJar()-&gt;setCookie($name, $value, $userId, $time, $path, $domain, $secure, $httponly);
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00744"></a><a class="code" href="classSlim.html#a8db96ba19d7847d7e532e609fac0aac5">00744</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a8db96ba19d7847d7e532e609fac0aac5" title="Get the value of an encrypted Cookie from the current HTTP request.">getEncryptedCookie</a>( $name ) {
<a name="l00745"></a>00745         $value = $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;getCookieJar()-&gt;getCookieValue($name);
<a name="l00746"></a>00746         <span class="keywordflow">return</span> ($value === <span class="keyword">false</span>) ? null : $value;
<a name="l00747"></a>00747     }
<a name="l00748"></a>00748 
<a name="l00766"></a><a class="code" href="classSlim.html#ada580eb304df64eb62e855a21d2bc128">00766</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ada580eb304df64eb62e855a21d2bc128" title="Delete a Cookie (for both normal or encrypted Cookies).">deleteCookie</a>( $name, $path = null, $domain = null, $secure = null, $httponly = null ) {
<a name="l00767"></a>00767         $path = is_null($path) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.path&#39;</span>) : $path;
<a name="l00768"></a>00768         $domain = is_null($domain) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.domain&#39;</span>) : $domain;
<a name="l00769"></a>00769         $secure = is_null($secure) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.secure&#39;</span>) : $secure;
<a name="l00770"></a>00770         $httponly = is_null($httponly) ? $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;cookies.httponly&#39;</span>) : $httponly;
<a name="l00771"></a>00771         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;getCookieJar()-&gt;deleteCookie( $name, $path, $domain, $secure, $httponly );
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     <span class="comment">/***** HELPERS *****/</span>
<a name="l00775"></a>00775 
<a name="l00786"></a><a class="code" href="classSlim.html#a2bafd96a3f489c028f4da162392864cd">00786</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a2bafd96a3f489c028f4da162392864cd" title="Get the Slim application&amp;#39;s absolute directory path.">root</a>() {
<a name="l00787"></a>00787         <span class="keywordflow">return</span> rtrim($_SERVER[<span class="stringliteral">&#39;DOCUMENT_ROOT&#39;</span>], <span class="charliteral">&#39;/&#39;</span>) . rtrim($this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>-&gt;getRootUri(), <span class="charliteral">&#39;/&#39;</span>) . <span class="charliteral">&#39;/&#39;</span>;
<a name="l00788"></a>00788     }
<a name="l00789"></a>00789 
<a name="l00800"></a><a class="code" href="classSlim.html#a128ceb80cb1a104cbdd096b928025048">00800</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a128ceb80cb1a104cbdd096b928025048" title="Stop.">stop</a>() {
<a name="l00801"></a>00801         $flash = $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;getData(<span class="stringliteral">&#39;flash&#39;</span>);
<a name="l00802"></a>00802         <span class="keywordflow">if</span> ( $flash ) {
<a name="l00803"></a>00803             $flash-&gt;save();
<a name="l00804"></a>00804         }
<a name="l00805"></a>00805         session_write_close();
<a name="l00806"></a>00806         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;send();
<a name="l00807"></a>00807         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classSlim__Exception__Stop.html">Slim_Exception_Stop</a>();
<a name="l00808"></a>00808     }
<a name="l00809"></a>00809 
<a name="l00823"></a><a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313">00823</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>( $status, $message = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00824"></a>00824         <span class="keywordflow">if</span> ( ob_get_level() !== 0 ) {
<a name="l00825"></a>00825             ob_clean();
<a name="l00826"></a>00826         }
<a name="l00827"></a>00827         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;status($status);
<a name="l00828"></a>00828         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;body($message);
<a name="l00829"></a>00829         $this-&gt;<a class="code" href="classSlim.html#a128ceb80cb1a104cbdd096b928025048" title="Stop.">stop</a>();
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831 
<a name="l00843"></a><a class="code" href="classSlim.html#a3a4b9340a253b16c30e5a69b44eb6c15">00843</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a3a4b9340a253b16c30e5a69b44eb6c15" title="Pass.">pass</a>() {
<a name="l00844"></a>00844         <span class="keywordflow">if</span> ( ob_get_level() !== 0 ) {
<a name="l00845"></a>00845             ob_clean();
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classSlim__Exception__Pass.html">Slim_Exception_Pass</a>();
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849 
<a name="l00855"></a><a class="code" href="classSlim.html#a7a3deaa0ff9a0e2c0e81d18bb19cbcee">00855</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a7a3deaa0ff9a0e2c0e81d18bb19cbcee" title="Set the HTTP response Content-Type.">contentType</a>( $type ) {
<a name="l00856"></a>00856         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;header(<span class="stringliteral">&#39;Content-Type&#39;</span>, $type);
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858 
<a name="l00864"></a><a class="code" href="classSlim.html#ac2e944f9335b790bbffd074906ae66c9">00864</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ac2e944f9335b790bbffd074906ae66c9" title="Set the HTTP response status code.">status</a>( $code ) {
<a name="l00865"></a>00865         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;status($code);
<a name="l00866"></a>00866     }
<a name="l00867"></a>00867 
<a name="l00875"></a><a class="code" href="classSlim.html#a619eec5f1d38d00c23c0cf4a00332dc3">00875</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a619eec5f1d38d00c23c0cf4a00332dc3" title="Get the URL for a named Route.">urlFor</a>( $name, $params = array() ) {
<a name="l00876"></a>00876         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a>-&gt;urlFor($name, $params);
<a name="l00877"></a>00877     }
<a name="l00878"></a>00878 
<a name="l00894"></a><a class="code" href="classSlim.html#abc3d96753db97261addd25fc269f47c1">00894</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#abc3d96753db97261addd25fc269f47c1" title="Redirect.">redirect</a>( $url, $status = 302 ) {
<a name="l00895"></a>00895         <span class="keywordflow">if</span> ( $status &gt;= 300 &amp;&amp; $status &lt;= 307 ) {
<a name="l00896"></a>00896             $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;header(<span class="stringliteral">&#39;Location&#39;</span>, (<span class="keywordtype">string</span>)$url);
<a name="l00897"></a>00897             $this-&gt;<a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>($status, (<span class="keywordtype">string</span>)$url);
<a name="l00898"></a>00898         } <span class="keywordflow">else</span> {
<a name="l00899"></a>00899             <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidArgumentException(<span class="stringliteral">&#39;Slim::redirect only accepts HTTP 300-307 status codes.&#39;</span>);
<a name="l00900"></a>00900         }
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     <span class="comment">/***** FLASH *****/</span>
<a name="l00904"></a>00904 
<a name="l00911"></a><a class="code" href="classSlim.html#a5d9b4e928971cb1ea3c6ea0cb1e22085">00911</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a5d9b4e928971cb1ea3c6ea0cb1e22085" title="Set flash message for subsequent request.">flash</a>( $key, $value ) {
<a name="l00912"></a>00912         $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;getData(<span class="stringliteral">&#39;flash&#39;</span>)-&gt;set($key, $value);
<a name="l00913"></a>00913     }
<a name="l00914"></a>00914 
<a name="l00921"></a><a class="code" href="classSlim.html#ada0aa04bbc4f1d1693da7527c49a3207">00921</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ada0aa04bbc4f1d1693da7527c49a3207" title="Set flash message for current request.">flashNow</a>( $key, $value ) {
<a name="l00922"></a>00922         $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;getData(<span class="stringliteral">&#39;flash&#39;</span>)-&gt;now($key, $value);
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924 
<a name="l00929"></a><a class="code" href="classSlim.html#afa74ca22261ccffbd0d5b4b3d8cc0a22">00929</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#afa74ca22261ccffbd0d5b4b3d8cc0a22" title="Keep flash messages from previous request for subsequent request.">flashKeep</a>() {
<a name="l00930"></a>00930         $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;getData(<span class="stringliteral">&#39;flash&#39;</span>)-&gt;keep();
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="comment">/***** HOOKS *****/</span>
<a name="l00934"></a>00934 
<a name="l00942"></a><a class="code" href="classSlim.html#acf11a598b8308bf8a832373e5de0915f">00942</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#acf11a598b8308bf8a832373e5de0915f" title="Assign hook.">hook</a>( $name, $callable, $priority = 10 ) {
<a name="l00943"></a>00943         <span class="keywordflow">if</span> ( !isset($this-&gt;hooks[$name]) ) {
<a name="l00944"></a>00944             $this-&gt;hooks[$name] = array(array());
<a name="l00945"></a>00945         }
<a name="l00946"></a>00946         <span class="keywordflow">if</span> ( is_callable($callable) ) {
<a name="l00947"></a>00947             $this-&gt;hooks[$name][(int)$priority][] = $callable;
<a name="l00948"></a>00948         }
<a name="l00949"></a>00949     }
<a name="l00950"></a>00950 
<a name="l00957"></a><a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32">00957</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32" title="Invoke hook.">applyHook</a>( $name, $hookArg = null ) {
<a name="l00958"></a>00958         <span class="keywordflow">if</span> ( !isset($this-&gt;hooks[$name]) ) {
<a name="l00959"></a>00959             $this-&gt;hooks[$name] = array(array());
<a name="l00960"></a>00960         }
<a name="l00961"></a>00961         <span class="keywordflow">if</span>( !empty($this-&gt;hooks[$name]) ) {
<a name="l00962"></a>00962             <span class="comment">// Sort by priority, low to high, if there&#39;s more than one priority</span>
<a name="l00963"></a>00963             <span class="keywordflow">if</span> ( count($this-&gt;hooks[$name]) &gt; 1 ) {
<a name="l00964"></a>00964                 ksort($this-&gt;hooks[$name]);
<a name="l00965"></a>00965             }
<a name="l00966"></a>00966             <span class="keywordflow">foreach</span>( $this-&gt;hooks[$name] as $priority ) {
<a name="l00967"></a>00967                 <span class="keywordflow">if</span>( !empty($priority) ) {
<a name="l00968"></a>00968                     <span class="keywordflow">foreach</span>($priority as $callable) {
<a name="l00969"></a>00969                         $hookArg = call_user_func($callable, $hookArg);
<a name="l00970"></a>00970                     }
<a name="l00971"></a>00971                 }
<a name="l00972"></a>00972             }
<a name="l00973"></a>00973             <span class="keywordflow">return</span> $hookArg;
<a name="l00974"></a>00974         }
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976 
<a name="l00988"></a><a class="code" href="classSlim.html#ad0c604144f3f3bb5f820b2623a860a1b">00988</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ad0c604144f3f3bb5f820b2623a860a1b" title="Get hook listeners.">getHooks</a>( $name = null ) {
<a name="l00989"></a>00989         <span class="keywordflow">if</span> ( !is_null($name) ) {
<a name="l00990"></a>00990             <span class="keywordflow">return</span> isset($this-&gt;hooks[(<span class="keywordtype">string</span>)$name]) ? $this-&gt;hooks[(string)$name] : null;
<a name="l00991"></a>00991         } <span class="keywordflow">else</span> {
<a name="l00992"></a>00992             <span class="keywordflow">return</span> $this-&gt;hooks;
<a name="l00993"></a>00993         }
<a name="l00994"></a>00994     }
<a name="l00995"></a>00995 
<a name="l01006"></a><a class="code" href="classSlim.html#ab3a9f3a5a9aa004a5e93f54bf1f33d1c">01006</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#ab3a9f3a5a9aa004a5e93f54bf1f33d1c" title="Clear hook listeners.">clearHooks</a>( $name = null ) {
<a name="l01007"></a>01007         <span class="keywordflow">if</span> ( !is_null($name) &amp;&amp; isset($this-&gt;hooks[(<span class="keywordtype">string</span>)$name]) ) {
<a name="l01008"></a>01008             $this-&gt;hooks[(string)$name] = array(array());
<a name="l01009"></a>01009         } <span class="keywordflow">else</span> {
<a name="l01010"></a>01010             <span class="keywordflow">foreach</span>( $this-&gt;hooks as $key =&gt; $value ) {
<a name="l01011"></a>01011                 $this-&gt;hooks[$key] = array(array());
<a name="l01012"></a>01012             }
<a name="l01013"></a>01013         }
<a name="l01014"></a>01014     }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016     <span class="comment">/***** RUN SLIM *****/</span>
<a name="l01017"></a>01017 
<a name="l01034"></a><a class="code" href="classSlim.html#a30357eb7dfeff0a1056abe713da03ca6">01034</a>     <span class="keyword">public</span> function <a class="code" href="classSlim.html#a30357eb7dfeff0a1056abe713da03ca6" title="Run the Slim application.">run</a>() {
<a name="l01035"></a>01035         <span class="keywordflow">try</span> {
<a name="l01036"></a>01036             <span class="keywordflow">try</span> {
<a name="l01037"></a>01037                 $this-&gt;<a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32" title="Invoke hook.">applyHook</a>(<span class="stringliteral">&#39;slim.before&#39;</span>);
<a name="l01038"></a>01038                 ob_start();
<a name="l01039"></a>01039                 $this-&gt;<a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32" title="Invoke hook.">applyHook</a>(<span class="stringliteral">&#39;slim.before.router&#39;</span>);
<a name="l01040"></a>01040                 $dispatched = <span class="keyword">false</span>;
<a name="l01041"></a>01041                 $httpMethod = $this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>()-&gt;getMethod();
<a name="l01042"></a>01042                 $httpMethodsAllowed = array();
<a name="l01043"></a>01043                 <span class="keywordflow">foreach</span> ( $this-&gt;<a class="code" href="classSlim.html#a4f09ed32e82b083e573a8a06b872cb49" title="Get the Router object.">router</a> as $route ) {
<a name="l01044"></a>01044                     <span class="keywordflow">if</span> ( $route-&gt;supportsHttpMethod($httpMethod) ) {
<a name="l01045"></a>01045                         <span class="keywordflow">try</span> {
<a name="l01046"></a>01046                             $this-&gt;<a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32" title="Invoke hook.">applyHook</a>(<span class="stringliteral">&#39;slim.before.dispatch&#39;</span>);
<a name="l01047"></a>01047                             $dispatched = $route-&gt;dispatch();
<a name="l01048"></a>01048                             $this-&gt;<a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32" title="Invoke hook.">applyHook</a>(<span class="stringliteral">&#39;slim.after.dispatch&#39;</span>);
<a name="l01049"></a>01049                             <span class="keywordflow">if</span> ( $dispatched ) {
<a name="l01050"></a>01050                                 <span class="keywordflow">break</span>;
<a name="l01051"></a>01051                             }
<a name="l01052"></a>01052                         } <span class="keywordflow">catch</span> ( <a class="code" href="classSlim__Exception__Pass.html">Slim_Exception_Pass</a> $e ) {
<a name="l01053"></a>01053                             <span class="keywordflow">continue</span>;
<a name="l01054"></a>01054                         }
<a name="l01055"></a>01055                     } <span class="keywordflow">else</span> {
<a name="l01056"></a>01056                         $httpMethodsAllowed = array_merge($httpMethodsAllowed, $route-&gt;getHttpMethods());
<a name="l01057"></a>01057                     }
<a name="l01058"></a>01058                 }
<a name="l01059"></a>01059                 <span class="keywordflow">if</span> ( !$dispatched ) {
<a name="l01060"></a>01060                     <span class="keywordflow">if</span> ( $httpMethodsAllowed ) {
<a name="l01061"></a>01061                         $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>()-&gt;header(<span class="stringliteral">&#39;Allow&#39;</span>, implode(<span class="charliteral">&#39; &#39;</span>, $httpMethodsAllowed));
<a name="l01062"></a>01062                         $this-&gt;<a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>(405);
<a name="l01063"></a>01063                     } <span class="keywordflow">else</span> {
<a name="l01064"></a>01064                         $this-&gt;<a class="code" href="classSlim.html#a7757d85bd57f35d69f27bd3ebd8eae4d" title="Not Found Handler.">notFound</a>();
<a name="l01065"></a>01065                     }
<a name="l01066"></a>01066                 }
<a name="l01067"></a>01067                 $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>()-&gt;write(ob_get_clean());
<a name="l01068"></a>01068                 $this-&gt;<a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32" title="Invoke hook.">applyHook</a>(<span class="stringliteral">&#39;slim.after.router&#39;</span>);
<a name="l01069"></a>01069                 $this-&gt;<a class="code" href="classSlim.html#ac0360b96072aec18a9fc87e665ab8875" title="Get and/or set the View.">view</a>-&gt;getData(<span class="stringliteral">&#39;flash&#39;</span>)-&gt;save();
<a name="l01070"></a>01070                 session_write_close();
<a name="l01071"></a>01071                 $this-&gt;<a class="code" href="classSlim.html#ae16554c0770fd25160e1b0b0e2e51807" title="Get the Response object.">response</a>-&gt;send();
<a name="l01072"></a>01072                 $this-&gt;<a class="code" href="classSlim.html#aedd984e02a7b7f51f3cd1c267e974b32" title="Invoke hook.">applyHook</a>(<span class="stringliteral">&#39;slim.after&#39;</span>);
<a name="l01073"></a>01073             } <span class="keywordflow">catch</span> ( <a class="code" href="classSlim__Exception__RequestSlash.html">Slim_Exception_RequestSlash</a> $e ) {
<a name="l01074"></a>01074                 $this-&gt;<a class="code" href="classSlim.html#abc3d96753db97261addd25fc269f47c1" title="Redirect.">redirect</a>($this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>-&gt;getRootUri() . $this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>-&gt;getResourceUri() . <span class="charliteral">&#39;/&#39;</span>, 301);
<a name="l01075"></a>01075             } <span class="keywordflow">catch</span> ( Exception $e ) {
<a name="l01076"></a>01076                 <span class="keywordflow">if</span> ( $e instanceof <a class="code" href="classSlim__Exception__Stop.html">Slim_Exception_Stop</a> ) <span class="keywordflow">throw</span> $e;
<a name="l01077"></a>01077                 $this-&gt;<a class="code" href="classSlim.html#a582c26a494b297345e3ab36f259907cd" title="Get application Log (lazy-loaded).">getLog</a>()-&gt;error($e);
<a name="l01078"></a>01078                 <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="classSlim.html#ac4cdda75ee89148d4ce24217f693409b" title="Configure Slim Settings.">config</a>(<span class="stringliteral">&#39;debug&#39;</span>) === <span class="keyword">true</span> ) {
<a name="l01079"></a>01079                     $this-&gt;<a class="code" href="classSlim.html#a0b53d545b279911a0f0ab2bb84765313" title="Halt.">halt</a>(500, self::generateErrorMarkup($e-&gt;getMessage(), $e-&gt;getFile(), $e-&gt;getLine(), $e-&gt;getTraceAsString()));
<a name="l01080"></a>01080                 } <span class="keywordflow">else</span> {
<a name="l01081"></a>01081                     $this-&gt;<a class="code" href="classSlim.html#ae0f2060161b86ee70dfe9a704624cfc2" title="Error Handler.">error</a>($e);
<a name="l01082"></a>01082                 }
<a name="l01083"></a>01083             }
<a name="l01084"></a>01084         } <span class="keywordflow">catch</span> ( <a class="code" href="classSlim__Exception__Stop.html">Slim_Exception_Stop</a> $e ) {
<a name="l01085"></a>01085             <span class="comment">//Exit application context</span>
<a name="l01086"></a>01086         }
<a name="l01087"></a>01087     }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <span class="comment">/***** EXCEPTION AND ERROR HANDLING *****/</span>
<a name="l01090"></a>01090 
<a name="l01105"></a><a class="code" href="classSlim.html#ac3ba2741cca83984fc811ad3dd72f656">01105</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classSlim.html#ac3ba2741cca83984fc811ad3dd72f656" title="Handle errors.">handleErrors</a>( $errno, $errstr = <span class="stringliteral">&#39;&#39;</span>, $errfile = <span class="stringliteral">&#39;&#39;</span>, $errline = <span class="stringliteral">&#39;&#39;</span> ) {
<a name="l01106"></a>01106         <span class="keywordflow">if</span> ( error_reporting() &amp; $errno ) {
<a name="l01107"></a>01107             <span class="keywordflow">throw</span> <span class="keyword">new</span> ErrorException($errstr, $errno, 0, $errfile, $errline);
<a name="l01108"></a>01108         }
<a name="l01109"></a>01109         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01110"></a>01110     }
<a name="l01111"></a>01111 
<a name="l01125"></a><a class="code" href="classSlim.html#ad6b16a9bbfb1ee9791b64c08098eb383">01125</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classSlim.html#ad6b16a9bbfb1ee9791b64c08098eb383" title="Generate markup for error message.">generateErrorMarkup</a>( $message, $file = <span class="stringliteral">&#39;&#39;</span>, $line = <span class="stringliteral">&#39;&#39;</span>, $trace = <span class="stringliteral">&#39;&#39;</span> ) {
<a name="l01126"></a>01126         $body = <span class="stringliteral">&#39;&lt;p&gt;The application could not run because of the following error:&lt;/p&gt;&#39;</span>;
<a name="l01127"></a>01127         $body .= <span class="stringliteral">&quot;&lt;h2&gt;Details:&lt;/h2&gt;&lt;strong&gt;Message:&lt;/strong&gt; $message&lt;br/&gt;&quot;</span>;
<a name="l01128"></a>01128         <span class="keywordflow">if</span> ( $file !== <span class="stringliteral">&#39;&#39;</span> ) $body .= <span class="stringliteral">&quot;&lt;strong&gt;File:&lt;/strong&gt; $file&lt;br/&gt;&quot;</span>;
<a name="l01129"></a>01129         <span class="keywordflow">if</span> ( $line !== <span class="stringliteral">&#39;&#39;</span> ) $body .= <span class="stringliteral">&quot;&lt;strong&gt;Line:&lt;/strong&gt; $line&lt;br/&gt;&quot;</span>;
<a name="l01130"></a>01130         <span class="keywordflow">if</span> ( $trace !== <span class="stringliteral">&#39;&#39;</span> ) $body .= <span class="stringliteral">&#39;&lt;h2&gt;Stack Trace:&lt;/h2&gt;&#39;</span> . nl2br($trace);
<a name="l01131"></a>01131         <span class="keywordflow">return</span> <a class="code" href="classSlim.html#a991db59d2b66364f9a30d32dae4ba43e" title="Generate default template markup.">self::generateTemplateMarkup</a>(<span class="stringliteral">&#39;Slim Application Error&#39;</span>, $body);
<a name="l01132"></a>01132     }
<a name="l01133"></a>01133 
<a name="l01145"></a><a class="code" href="classSlim.html#a991db59d2b66364f9a30d32dae4ba43e">01145</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classSlim.html#a991db59d2b66364f9a30d32dae4ba43e" title="Generate default template markup.">generateTemplateMarkup</a>( $title, $body ) {
<a name="l01146"></a>01146         $html = <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;$title&lt;/title&gt;&lt;style&gt;body{margin:0;padding:30px;font:12px/1.5 Helvetica,Arial,Verdana,sans-serif;}h1{margin:0;font-size:48px;font-weight:normal;line-height:48px;}strong{display:inline-block;width:65px;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>;
<a name="l01147"></a>01147         $html .= <span class="stringliteral">&quot;&lt;h1&gt;$title&lt;/h1&gt;&quot;</span>;
<a name="l01148"></a>01148         $html .= $body;
<a name="l01149"></a>01149         $html .= <span class="stringliteral">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span>;
<a name="l01150"></a>01150         <span class="keywordflow">return</span> $html;
<a name="l01151"></a>01151     }
<a name="l01152"></a>01152 
<a name="l01157"></a><a class="code" href="classSlim.html#a3f0d528c84aa604b361c680000c37f38">01157</a>     <span class="keyword">protected</span> function <a class="code" href="classSlim.html#a3f0d528c84aa604b361c680000c37f38" title="Default Not Found handler.">defaultNotFound</a>() {
<a name="l01158"></a>01158         echo <a class="code" href="classSlim.html#a991db59d2b66364f9a30d32dae4ba43e" title="Generate default template markup.">self::generateTemplateMarkup</a>(<span class="stringliteral">&#39;404 Page Not Found&#39;</span>, <span class="stringliteral">&#39;&lt;p&gt;The page you are looking for could not be found. Check the address bar to ensure your URL is spelled correctly. If all else fails, you can visit our home page at the link below.&lt;/p&gt;&lt;a href=&quot;&#39;</span> . $this-&gt;<a class="code" href="classSlim.html#ae6f44c8af9dedaf584829c14b2a3c32e" title="Get the Request object.">request</a>-&gt;getRootUri() . <span class="stringliteral">&#39;&quot;&gt;Visit the Home Page&lt;/a&gt;&#39;</span>);
<a name="l01159"></a>01159     }
<a name="l01160"></a>01160 
<a name="l01165"></a><a class="code" href="classSlim.html#a80f52b7860b9986aec59a7ee509cc18a">01165</a>     <span class="keyword">protected</span> function <a class="code" href="classSlim.html#a80f52b7860b9986aec59a7ee509cc18a" title="Default Error handler.">defaultError</a>() {
<a name="l01166"></a>01166         echo <a class="code" href="classSlim.html#a991db59d2b66364f9a30d32dae4ba43e" title="Generate default template markup.">self::generateTemplateMarkup</a>(<span class="stringliteral">&#39;Error&#39;</span>, <span class="stringliteral">&#39;&lt;p&gt;A website error has occured. The website administrator has been notified of the issue. Sorry for the temporary inconvenience.&lt;/p&gt;&#39;</span>);
<a name="l01167"></a>01167     }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
