<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Query/Abstract.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Query/Abstract.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> *  $Id: Query.php 1393 2007-05-19 17:49:16Z zYne $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information, see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://www.doctrine-project.org&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00034"></a><a class="code" href="classDoctrine__Query__Abstract.html">00034</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classDoctrine__Query__Abstract.html">Doctrine_Query_Abstract</a>
<a name="l00035"></a>00035 {
<a name="l00043"></a><a class="code" href="classDoctrine__Query__Abstract.html#a374f84bab2c519f3f025d06c681351d1">00043</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#a374f84bab2c519f3f025d06c681351d1" title="QUERY TYPE CONSTANTS.">SELECT</a> = 0;
<a name="l00044"></a>00044 
<a name="l00048"></a><a class="code" href="classDoctrine__Query__Abstract.html#a393d03b019860e951466ed96ae931c1d">00048</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#a393d03b019860e951466ed96ae931c1d" title="constant for DELETE queries">DELETE</a> = 1;
<a name="l00049"></a>00049 
<a name="l00053"></a><a class="code" href="classDoctrine__Query__Abstract.html#a57b74ad60588bacf557d2eb479745e00">00053</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#a57b74ad60588bacf557d2eb479745e00" title="constant for UPDATE queries">UPDATE</a> = 2;
<a name="l00054"></a>00054 
<a name="l00058"></a><a class="code" href="classDoctrine__Query__Abstract.html#aa2b8ce7d591eb8c95a579c7c5e83d3c4">00058</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#aa2b8ce7d591eb8c95a579c7c5e83d3c4" title="constant for INSERT queries">INSERT</a> = 3;
<a name="l00059"></a>00059 
<a name="l00063"></a><a class="code" href="classDoctrine__Query__Abstract.html#af1066b5cd599ca2263d91c7cae13b93c">00063</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#af1066b5cd599ca2263d91c7cae13b93c" title="constant for CREATE queries">CREATE</a> = 4;
<a name="l00064"></a>00064 
<a name="l00069"></a><a class="code" href="classDoctrine__Query__Abstract.html#a53db9067dc7890c0f1b709c2ff636422">00069</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#a53db9067dc7890c0f1b709c2ff636422" title="A query object is in CLEAN state when it has NO unparsed/unprocessed DQL parts.">STATE_CLEAN</a>  = 1;
<a name="l00070"></a>00070 
<a name="l00075"></a><a class="code" href="classDoctrine__Query__Abstract.html#a61793c3540cfd3bfc4f65f65c430e47c">00075</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#a61793c3540cfd3bfc4f65f65c430e47c" title="A query object is in state DIRTY when it has DQL parts that have not yet been parsed/processed...">STATE_DIRTY</a>  = 2;
<a name="l00076"></a>00076 
<a name="l00080"></a><a class="code" href="classDoctrine__Query__Abstract.html#a170f6137f22440a7d8b0818cec4ac1fc">00080</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#a170f6137f22440a7d8b0818cec4ac1fc" title="A query is in DIRECT state when .">STATE_DIRECT</a> = 3;
<a name="l00081"></a>00081 
<a name="l00085"></a><a class="code" href="classDoctrine__Query__Abstract.html#a80260ca22fa01896910bbac0a9463190">00085</a>     <span class="keyword">const</span> <a class="code" href="classDoctrine__Query__Abstract.html#a80260ca22fa01896910bbac0a9463190" title="A query object is on LOCKED state when .">STATE_LOCKED</a> = 4;
<a name="l00086"></a>00086 
<a name="l00090"></a>00090     <span class="keyword">protected</span> $_tableAliasMap = array();
<a name="l00091"></a>00091 
<a name="l00095"></a>00095     <span class="keyword">protected</span> $_view;
<a name="l00096"></a>00096 
<a name="l00100"></a>00100     <span class="keyword">protected</span> $_state = <a class="code" href="classDoctrine__Query__Abstract.html#a53db9067dc7890c0f1b709c2ff636422" title="A query object is in CLEAN state when it has NO unparsed/unprocessed DQL parts.">Doctrine_Query::STATE_CLEAN</a>;
<a name="l00101"></a>00101 
<a name="l00105"></a>00105     <span class="keyword">protected</span> $_params = array(<span class="stringliteral">&#39;exec&#39;</span> =&gt; array(),
<a name="l00106"></a>00106                                <span class="stringliteral">&#39;join&#39;</span> =&gt; array(),
<a name="l00107"></a>00107                                <span class="stringliteral">&#39;where&#39;</span> =&gt; array(),
<a name="l00108"></a>00108                                <span class="stringliteral">&#39;set&#39;</span> =&gt; array(),
<a name="l00109"></a>00109                                <span class="stringliteral">&#39;having&#39;</span> =&gt; array());
<a name="l00110"></a>00110 
<a name="l00114"></a>00114     <span class="keyword">protected</span> $_execParams = array();
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment">/* Caching properties */</span>
<a name="l00120"></a>00120     <span class="keyword">protected</span> $_resultCache;
<a name="l00121"></a>00121 
<a name="l00125"></a>00125     <span class="keyword">protected</span> $_resultCacheHash;
<a name="l00126"></a>00126 
<a name="l00131"></a>00131     <span class="keyword">protected</span> $_expireResultCache = <span class="keyword">false</span>;
<a name="l00132"></a>00132     <span class="keyword">protected</span> $_resultCacheTTL;
<a name="l00133"></a>00133 
<a name="l00137"></a>00137     <span class="keyword">protected</span> $_queryCache;
<a name="l00138"></a>00138     <span class="keyword">protected</span> $_expireQueryCache = <span class="keyword">false</span>;
<a name="l00139"></a>00139     <span class="keyword">protected</span> $_queryCacheTTL;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 
<a name="l00145"></a>00145     <span class="keyword">protected</span> $_conn;
<a name="l00146"></a>00146 
<a name="l00150"></a>00150     <span class="keyword">protected</span> $_passedConn = <span class="keyword">false</span>;
<a name="l00151"></a>00151 
<a name="l00155"></a>00155     <span class="keyword">protected</span> $_sqlParts = array(
<a name="l00156"></a>00156             <span class="stringliteral">&#39;select&#39;</span>    =&gt; array(),
<a name="l00157"></a>00157             <span class="stringliteral">&#39;distinct&#39;</span>  =&gt; <span class="keyword">false</span>,
<a name="l00158"></a>00158             <span class="stringliteral">&#39;forUpdate&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l00159"></a>00159             <span class="stringliteral">&#39;from&#39;</span>      =&gt; array(),
<a name="l00160"></a>00160             <span class="stringliteral">&#39;set&#39;</span>       =&gt; array(),
<a name="l00161"></a>00161             <span class="stringliteral">&#39;join&#39;</span>      =&gt; array(),
<a name="l00162"></a>00162             <span class="stringliteral">&#39;where&#39;</span>     =&gt; array(),
<a name="l00163"></a>00163             <span class="stringliteral">&#39;groupby&#39;</span>   =&gt; array(),
<a name="l00164"></a>00164             <span class="stringliteral">&#39;having&#39;</span>    =&gt; array(),
<a name="l00165"></a>00165             <span class="stringliteral">&#39;orderby&#39;</span>   =&gt; array(),
<a name="l00166"></a>00166             <span class="stringliteral">&#39;limit&#39;</span>     =&gt; <span class="keyword">false</span>,
<a name="l00167"></a>00167             <span class="stringliteral">&#39;offset&#39;</span>    =&gt; <span class="keyword">false</span>,
<a name="l00168"></a>00168             );
<a name="l00169"></a>00169 
<a name="l00173"></a>00173     <span class="keyword">protected</span> $_dqlParts = array(
<a name="l00174"></a>00174                             <span class="stringliteral">&#39;from&#39;</span>      =&gt; array(),
<a name="l00175"></a>00175                             <span class="stringliteral">&#39;select&#39;</span>    =&gt; array(),
<a name="l00176"></a>00176                             <span class="stringliteral">&#39;forUpdate&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l00177"></a>00177                             <span class="stringliteral">&#39;set&#39;</span>       =&gt; array(),
<a name="l00178"></a>00178                             <span class="stringliteral">&#39;join&#39;</span>      =&gt; array(),
<a name="l00179"></a>00179                             <span class="stringliteral">&#39;where&#39;</span>     =&gt; array(),
<a name="l00180"></a>00180                             <span class="stringliteral">&#39;groupby&#39;</span>   =&gt; array(),
<a name="l00181"></a>00181                             <span class="stringliteral">&#39;having&#39;</span>    =&gt; array(),
<a name="l00182"></a>00182                             <span class="stringliteral">&#39;orderby&#39;</span>   =&gt; array(),
<a name="l00183"></a>00183                             <span class="stringliteral">&#39;limit&#39;</span>     =&gt; array(),
<a name="l00184"></a>00184                             <span class="stringliteral">&#39;offset&#39;</span>    =&gt; array(),
<a name="l00185"></a>00185                             );
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00206"></a>00206     <span class="keyword">protected</span> $_queryComponents = array();
<a name="l00207"></a>00207 
<a name="l00213"></a>00213     <span class="keyword">protected</span> $_rootAlias = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00214"></a>00214   
<a name="l00220"></a>00220     <span class="keyword">protected</span> $_type = self::SELECT;
<a name="l00221"></a>00221 
<a name="l00225"></a>00225     <span class="keyword">protected</span> $_hydrator;
<a name="l00226"></a>00226 
<a name="l00230"></a>00230     <span class="keyword">protected</span> $_tokenizer;
<a name="l00231"></a>00231 
<a name="l00235"></a>00235     <span class="keyword">protected</span> $_parser;
<a name="l00236"></a>00236 
<a name="l00242"></a>00242     <span class="keyword">protected</span> $_tableAliasSeeds = array();
<a name="l00243"></a>00243 
<a name="l00247"></a>00247     <span class="keyword">protected</span> $_options    = array(
<a name="l00248"></a>00248         <span class="stringliteral">&#39;hydrationMode&#39;</span>      =&gt; <a class="code" href="classDoctrine__Core.html#a56801dd8a24bb6f44afc2ba1dd0a0ba1" title="HYDRATION CONSTANTS.">Doctrine_Core::HYDRATE_RECORD</a>
<a name="l00249"></a>00249     );
<a name="l00250"></a>00250 
<a name="l00254"></a>00254     <span class="keyword">protected</span> $_isLimitSubqueryUsed = <span class="keyword">false</span>;
<a name="l00255"></a>00255 
<a name="l00259"></a>00259     <span class="keyword">protected</span> $_components;
<a name="l00260"></a>00260 
<a name="l00264"></a>00264     <span class="keyword">protected</span> $_preQueried = <span class="keyword">false</span>;
<a name="l00265"></a>00265 
<a name="l00271"></a>00271     <span class="keyword">protected</span> $disableLimitSubquery = <span class="keyword">false</span>;
<a name="l00272"></a>00272 
<a name="l00279"></a><a class="code" href="classDoctrine__Query__Abstract.html#a013b372063739d7ceb17cc741131fe5a">00279</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a013b372063739d7ceb17cc741131fe5a" title="Constructor.">__construct</a>(<a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $connection = null,
<a name="l00280"></a>00280             <a class="code" href="classDoctrine__Hydrator__Abstract.html">Doctrine_Hydrator_Abstract</a> $hydrator = null)
<a name="l00281"></a>00281     {
<a name="l00282"></a>00282         <span class="keywordflow">if</span> ($connection === null) {
<a name="l00283"></a>00283             $connection = <a class="code" href="classDoctrine__Manager.html#a0f1f11c9be78468eed7768f4130aac2e" title="Returns an instance of this class (this class uses the singleton pattern).">Doctrine_Manager::getInstance</a>()-&gt;getCurrentConnection();
<a name="l00284"></a>00284         } <span class="keywordflow">else</span> {
<a name="l00285"></a>00285             $this-&gt;_passedConn = <span class="keyword">true</span>;
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287         <span class="keywordflow">if</span> ($hydrator === null) {
<a name="l00288"></a>00288             $hydrator = <span class="keyword">new</span> <a class="code" href="classDoctrine__Hydrator.html">Doctrine_Hydrator</a>();
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         $this-&gt;_conn = $connection;
<a name="l00291"></a>00291         $this-&gt;_hydrator = $hydrator;
<a name="l00292"></a>00292         $this-&gt;_tokenizer = <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Tokenizer.html">Doctrine_Query_Tokenizer</a>();
<a name="l00293"></a>00293         $this-&gt;_resultCacheTTL = $this-&gt;_conn-&gt;getAttribute(Doctrine_Core::ATTR_RESULT_CACHE_LIFESPAN);
<a name="l00294"></a>00294         $this-&gt;_queryCacheTTL = $this-&gt;_conn-&gt;getAttribute(Doctrine_Core::ATTR_QUERY_CACHE_LIFESPAN);
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00303"></a><a class="code" href="classDoctrine__Query__Abstract.html#aa325d156be119c653600355c7fa6e817">00303</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aa325d156be119c653600355c7fa6e817" title="Set the connection this query object should use.">setConnection</a>(<a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $connection)
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305         $this-&gt;_passedConn = <span class="keyword">true</span>;
<a name="l00306"></a>00306         $this-&gt;_conn = $connection;
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00316"></a><a class="code" href="classDoctrine__Query__Abstract.html#a308f9330f1c959b57ff750e2834ee43d">00316</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a308f9330f1c959b57ff750e2834ee43d" title="setOption">setOption</a>($name, $value)
<a name="l00317"></a>00317     {
<a name="l00318"></a>00318         <span class="keywordflow">if</span> ( ! isset($this-&gt;_options[$name])) {
<a name="l00319"></a>00319             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown option &#39;</span> . $name);
<a name="l00320"></a>00320         }
<a name="l00321"></a>00321         $this-&gt;_options[$name] = $value;
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323 
<a name="l00331"></a><a class="code" href="classDoctrine__Query__Abstract.html#a31db2e131aedae0169cbbd351854d3ed">00331</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a31db2e131aedae0169cbbd351854d3ed" title="hasSqlTableAlias whether or not this object has given tableAlias">hasSqlTableAlias</a>($sqlTableAlias)
<a name="l00332"></a>00332     {
<a name="l00333"></a>00333         <span class="keywordflow">return</span> (isset($this-&gt;_tableAliasMap[$sqlTableAlias]));
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335 
<a name="l00342"></a><a class="code" href="classDoctrine__Query__Abstract.html#aaded861a1d82005c5fe4c2d32f0653bd">00342</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aaded861a1d82005c5fe4c2d32f0653bd" title="getTableAliasMap returns all table aliases">getTableAliasMap</a>()
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344         <span class="keywordflow">return</span> $this-&gt;_tableAliasMap;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00355"></a><a class="code" href="classDoctrine__Query__Abstract.html#afab62ca7b2fd4f605de4caadfa072f53">00355</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#afab62ca7b2fd4f605de4caadfa072f53" title="getDql returns the DQL query that is represented by this query object.">getDql</a>()
<a name="l00356"></a>00356     {
<a name="l00357"></a>00357         $q = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00358"></a>00358         <span class="keywordflow">if</span> ($this-&gt;_type == self::SELECT) {
<a name="l00359"></a>00359             $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;select&#39;</span>])) ? <span class="stringliteral">&#39;SELECT &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;select&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00360"></a>00360             $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>])) ? <span class="stringliteral">&#39; FROM &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00361"></a>00361         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($this-&gt;_type == self::DELETE) {
<a name="l00362"></a>00362             $q .= <span class="stringliteral">&#39;DELETE&#39;</span>;
<a name="l00363"></a>00363             $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>])) ? <span class="stringliteral">&#39; FROM &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00364"></a>00364         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($this-&gt;_type == self::UPDATE) {
<a name="l00365"></a>00365             $q .= <span class="stringliteral">&#39;UPDATE &#39;</span>;
<a name="l00366"></a>00366             $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>])) ? implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00367"></a>00367             $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;set&#39;</span>])) ? <span class="stringliteral">&#39; SET &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;set&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369         $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;where&#39;</span>])) ? <span class="stringliteral">&#39; WHERE &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;where&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00370"></a>00370         $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;groupby&#39;</span>])) ? <span class="stringliteral">&#39; GROUP BY &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;groupby&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00371"></a>00371         $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;having&#39;</span>])) ? <span class="stringliteral">&#39; HAVING &#39;</span> . implode(<span class="stringliteral">&#39; AND &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;having&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00372"></a>00372         $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;orderby&#39;</span>])) ? <span class="stringliteral">&#39; ORDER BY &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;orderby&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00373"></a>00373         $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;limit&#39;</span>])) ? <span class="stringliteral">&#39; LIMIT &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;limit&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00374"></a>00374         $q .= ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;offset&#39;</span>])) ? <span class="stringliteral">&#39; OFFSET &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_dqlParts[<span class="stringliteral">&#39;offset&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         <span class="keywordflow">return</span> $q;
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 
<a name="l00388"></a><a class="code" href="classDoctrine__Query__Abstract.html#aaa687db03cd346b543ab41cbdcc7f343">00388</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aaa687db03cd346b543ab41cbdcc7f343" title="getSqlQueryPart gets an SQL query part from the SQL query part array">getSqlQueryPart</a>($part)
<a name="l00389"></a>00389     {
<a name="l00390"></a>00390         <span class="keywordflow">if</span> ( ! isset($this-&gt;_sqlParts[$part])) {
<a name="l00391"></a>00391             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown SQL query part &#39;</span> . $part);
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393         <span class="keywordflow">return</span> $this-&gt;_sqlParts[$part];
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395 
<a name="l00405"></a><a class="code" href="classDoctrine__Query__Abstract.html#aabc6c9d0df77db39e53f330b24c81b19">00405</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aabc6c9d0df77db39e53f330b24c81b19" title="setSqlQueryPart sets an SQL query part in the SQL query part array">setSqlQueryPart</a>($name, $part)
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407         <span class="keywordflow">if</span> ( ! isset($this-&gt;_sqlParts[$name])) {
<a name="l00408"></a>00408             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown query part &#39;</span> . $name);
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         <span class="keywordflow">if</span> ($name !== <span class="stringliteral">&#39;limit&#39;</span> &amp;&amp; $name !== <span class="stringliteral">&#39;offset&#39;</span>) {
<a name="l00412"></a>00412             <span class="keywordflow">if</span> (is_array($part)) {
<a name="l00413"></a>00413                 $this-&gt;_sqlParts[$name] = $part;
<a name="l00414"></a>00414             } <span class="keywordflow">else</span> {
<a name="l00415"></a>00415                 $this-&gt;_sqlParts[$name] = array($part);
<a name="l00416"></a>00416             }
<a name="l00417"></a>00417         } <span class="keywordflow">else</span> {
<a name="l00418"></a>00418             $this-&gt;_sqlParts[$name] = $part;
<a name="l00419"></a>00419         }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421         <span class="keywordflow">return</span> $this;
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00433"></a><a class="code" href="classDoctrine__Query__Abstract.html#ab467fe6969d42d79a1c1d7fd66b510b2">00433</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ab467fe6969d42d79a1c1d7fd66b510b2" title="addSqlQueryPart adds an SQL query part to the SQL query part array">addSqlQueryPart</a>($name, $part)
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435         <span class="keywordflow">if</span> ( ! isset($this-&gt;_sqlParts[$name])) {
<a name="l00436"></a>00436             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown query part &#39;</span> . $name);
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438         <span class="keywordflow">if</span> (is_array($part)) {
<a name="l00439"></a>00439             $this-&gt;_sqlParts[$name] = array_merge($this-&gt;_sqlParts[$name], $part);
<a name="l00440"></a>00440         } <span class="keywordflow">else</span> {
<a name="l00441"></a>00441             $this-&gt;_sqlParts[$name][] = $part;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443         <span class="keywordflow">return</span> $this;
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445 
<a name="l00454"></a><a class="code" href="classDoctrine__Query__Abstract.html#a6dfe8660e266ed2a2b7a36d2454fc869">00454</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a6dfe8660e266ed2a2b7a36d2454fc869" title="removeSqlQueryPart removes a query part from the query part array">removeSqlQueryPart</a>($name)
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456         <span class="keywordflow">if</span> ( ! isset($this-&gt;_sqlParts[$name])) {
<a name="l00457"></a>00457             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown query part &#39;</span> . $name);
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460         <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;limit&#39;</span> || $name == <span class="stringliteral">&#39;offset&#39;</span> || $name == <span class="stringliteral">&#39;forUpdate&#39;</span>) {
<a name="l00461"></a>00461             $this-&gt;_sqlParts[$name] = <span class="keyword">false</span>;
<a name="l00462"></a>00462         } <span class="keywordflow">else</span> {
<a name="l00463"></a>00463             $this-&gt;_sqlParts[$name] = array();
<a name="l00464"></a>00464         }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         <span class="keywordflow">return</span> $this;
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468 
<a name="l00477"></a><a class="code" href="classDoctrine__Query__Abstract.html#ac85219aead2243994ba4cf9c14d713fc">00477</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ac85219aead2243994ba4cf9c14d713fc" title="removeDqlQueryPart removes a dql query part from the dql query part array">removeDqlQueryPart</a>($name)
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479         <span class="keywordflow">if</span> ( ! isset($this-&gt;_dqlParts[$name])) {
<a name="l00480"></a>00480             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown query part &#39;</span> . $name);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483         <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;limit&#39;</span> || $name == <span class="stringliteral">&#39;offset&#39;</span>) {
<a name="l00484"></a>00484             $this-&gt;_dqlParts[$name] = <span class="keyword">false</span>;
<a name="l00485"></a>00485         } <span class="keywordflow">else</span> {
<a name="l00486"></a>00486             $this-&gt;_dqlParts[$name] = array();
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489         <span class="keywordflow">return</span> $this;
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00497"></a><a class="code" href="classDoctrine__Query__Abstract.html#ac863280a0bb07b807052396c7199aa7c">00497</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ac863280a0bb07b807052396c7199aa7c" title="Get raw array of parameters for query and all parts.">getParams</a>()
<a name="l00498"></a>00498     {
<a name="l00499"></a>00499         <span class="keywordflow">return</span> $this-&gt;_params;
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501 
<a name="l00509"></a><a class="code" href="classDoctrine__Query__Abstract.html#aae571f5a486c271f70a7cd14c1309387">00509</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aae571f5a486c271f70a7cd14c1309387" title="Get flattened array of parameters for query.">getFlattenedParams</a>($params = array())
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         <span class="keywordflow">return</span> array_merge(
<a name="l00512"></a>00512             (array) $params, (array) $this-&gt;_params[<span class="stringliteral">&#39;exec&#39;</span>], 
<a name="l00513"></a>00513             $this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>], $this-&gt;_params[<span class="stringliteral">&#39;set&#39;</span>],
<a name="l00514"></a>00514             $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>], $this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>]
<a name="l00515"></a>00515         );
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517 
<a name="l00523"></a><a class="code" href="classDoctrine__Query__Abstract.html#a69bac20bfc56df1c7a5dc105205fc968">00523</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a69bac20bfc56df1c7a5dc105205fc968" title="getInternalParams">getInternalParams</a>($params = array())
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525         <span class="keywordflow">return</span> array_merge($params, $this-&gt;_execParams);
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00533"></a><a class="code" href="classDoctrine__Query__Abstract.html#affacd4fa1886efbcbfe0e8a896c142a1">00533</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#affacd4fa1886efbcbfe0e8a896c142a1" title="setParams">setParams</a>(array $params = array())
<a name="l00534"></a>00534     {
<a name="l00535"></a>00535         $this-&gt;_params = $params;
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537     
<a name="l00544"></a><a class="code" href="classDoctrine__Query__Abstract.html#a27e462833789ddd102dd878ddbd26be3">00544</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a27e462833789ddd102dd878ddbd26be3" title="getCountQueryParams Retrieves the parameters for count query">getCountQueryParams</a>($params = array())
<a name="l00545"></a>00545     {
<a name="l00546"></a>00546         <span class="keywordflow">if</span> ( ! is_array($params)) {
<a name="l00547"></a>00547             $params = array($params);
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         $this-&gt;_params[<span class="stringliteral">&#39;exec&#39;</span>] = $params;
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         $params = array_merge($this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>], $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>], $this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>], $this-&gt;_params[<span class="stringliteral">&#39;exec&#39;</span>]);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a51ce05daab0bd7f7f61783348a843ced">fixArrayParameterValues</a>($params);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556         <span class="keywordflow">return</span> $this-&gt;_execParams;
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558 
<a name="l00562"></a><a class="code" href="classDoctrine__Query__Abstract.html#a51ce05daab0bd7f7f61783348a843ced">00562</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a51ce05daab0bd7f7f61783348a843ced">fixArrayParameterValues</a>($params = array())
<a name="l00563"></a>00563     {
<a name="l00564"></a>00564         $i = 0;
<a name="l00565"></a>00565   
<a name="l00566"></a>00566         <span class="keywordflow">foreach</span> ($params as $param) {
<a name="l00567"></a>00567             <span class="keywordflow">if</span> (is_array($param)) {
<a name="l00568"></a>00568                 $c = count($param);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570                 array_splice($params, $i, 1, $param);
<a name="l00571"></a>00571                 
<a name="l00572"></a>00572                 $i += $c;
<a name="l00573"></a>00573             } <span class="keywordflow">else</span> {
<a name="l00574"></a>00574                 $i++;
<a name="l00575"></a>00575             }
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577         
<a name="l00578"></a>00578         $this-&gt;_execParams = $params;
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 
<a name="l00589"></a><a class="code" href="classDoctrine__Query__Abstract.html#ab5874ed03d053a50b22f1845d8760cf4">00589</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ab5874ed03d053a50b22f1845d8760cf4" title="setView sets a database view this query object uses this method should only be called...">setView</a>(<a class="code" href="classDoctrine__View.html">Doctrine_View</a> $view)
<a name="l00590"></a>00590     {
<a name="l00591"></a>00591         $this-&gt;_view = $view;
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593 
<a name="l00600"></a><a class="code" href="classDoctrine__Query__Abstract.html#ab0ba207a2563ed459b7c0ea2bafd6fc7">00600</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ab0ba207a2563ed459b7c0ea2bafd6fc7" title="getView returns the view associated with this query object (if any)">getView</a>()
<a name="l00601"></a>00601     {
<a name="l00602"></a>00602         <span class="keywordflow">return</span> $this-&gt;_view;
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 
<a name="l00610"></a><a class="code" href="classDoctrine__Query__Abstract.html#a4a08f09dedcbe2394323e69ac95ed349">00610</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a4a08f09dedcbe2394323e69ac95ed349" title="limitSubqueryUsed">isLimitSubqueryUsed</a>()
<a name="l00611"></a>00611     {
<a name="l00612"></a>00612         <span class="keywordflow">return</span> $this-&gt;_isLimitSubqueryUsed;
<a name="l00613"></a>00613     }
<a name="l00614"></a>00614 
<a name="l00625"></a><a class="code" href="classDoctrine__Query__Abstract.html#adf86c632e10028a4c934ec8fc008b3bf">00625</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#adf86c632e10028a4c934ec8fc008b3bf" title="Returns the inheritance condition for the passed componentAlias If no component alias...">getInheritanceCondition</a>($componentAlias)
<a name="l00626"></a>00626     {
<a name="l00627"></a>00627         $map = $this-&gt;_queryComponents[$componentAlias][<span class="stringliteral">&#39;table&#39;</span>]-&gt;inheritanceMap;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <span class="comment">// No inheritance map so lets just return</span>
<a name="l00630"></a>00630         <span class="keywordflow">if</span> (empty($map)) {
<a name="l00631"></a>00631           <span class="keywordflow">return</span>;
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         $tableAlias = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ac4a458f62a7d9366059d8c6818dfaae8" title="getSqlTableAlias some database such as Oracle need the identifier lengths to be &amp;lt;...">getSqlTableAlias</a>($componentAlias);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         <span class="keywordflow">if</span> ($this-&gt;_type !== <a class="code" href="classDoctrine__Query__Abstract.html#a374f84bab2c519f3f025d06c681351d1" title="QUERY TYPE CONSTANTS.">Doctrine_Query::SELECT</a>) {
<a name="l00637"></a>00637             $tableAlias = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00638"></a>00638         } <span class="keywordflow">else</span> {
<a name="l00639"></a>00639             $tableAlias .= <span class="charliteral">&#39;.&#39;</span>;
<a name="l00640"></a>00640         }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642         <span class="comment">// Fix for 2015: loop through whole inheritanceMap to add all   </span>
<a name="l00643"></a>00643         <span class="comment">// keyFields for inheritance (and not only the first) </span>
<a name="l00644"></a>00644         $retVal = <span class="stringliteral">&quot;&quot;</span>; 
<a name="l00645"></a>00645         $count = 0; 
<a name="l00646"></a>00646          
<a name="l00647"></a>00647         <span class="keywordflow">foreach</span> ($map as $field =&gt; $value) { 
<a name="l00648"></a>00648             <span class="keywordflow">if</span> ($count++ &gt; 0) {
<a name="l00649"></a>00649                 $retVal .= <span class="stringliteral">&#39; AND &#39;</span>;
<a name="l00650"></a>00650             }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652             $identifier = $this-&gt;_conn-&gt;quoteIdentifier($tableAlias . $field); 
<a name="l00653"></a>00653             $retVal .= $identifier . <span class="stringliteral">&#39; = &#39;</span> . $this-&gt;_conn-&gt;quote($value);
<a name="l00654"></a>00654         }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656         <span class="keywordflow">return</span> $retVal;
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658 
<a name="l00671"></a><a class="code" href="classDoctrine__Query__Abstract.html#ac4a458f62a7d9366059d8c6818dfaae8">00671</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ac4a458f62a7d9366059d8c6818dfaae8" title="getSqlTableAlias some database such as Oracle need the identifier lengths to be &amp;lt;...">getSqlTableAlias</a>($componentAlias, $tableName = null)
<a name="l00672"></a>00672     {
<a name="l00673"></a>00673         $alias = array_search($componentAlias, $this-&gt;_tableAliasMap);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         <span class="keywordflow">if</span> ($alias !== <span class="keyword">false</span>) {
<a name="l00676"></a>00676             <span class="keywordflow">return</span> $alias;
<a name="l00677"></a>00677         }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679         <span class="keywordflow">if</span> ($tableName === null) {
<a name="l00680"></a>00680             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&quot;Couldn&#39;t get short alias for &quot;</span> . $componentAlias);
<a name="l00681"></a>00681         }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aca1d5b07fc26cab312cc63f23045dd3c" title="generateSqlTableAlias generates a table alias from given table name and associates...">generateSqlTableAlias</a>($componentAlias, $tableName);
<a name="l00684"></a>00684     }
<a name="l00685"></a>00685 
<a name="l00693"></a><a class="code" href="classDoctrine__Query__Abstract.html#aefee677f7563161fc022ae6578ac100d">00693</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aefee677f7563161fc022ae6578ac100d" title="generateNewSqlTableAlias generates a new alias from given table alias">generateNewSqlTableAlias</a>($oldAlias)
<a name="l00694"></a>00694     {
<a name="l00695"></a>00695         <span class="keywordflow">if</span> (isset($this-&gt;_tableAliasMap[$oldAlias])) {
<a name="l00696"></a>00696             <span class="comment">// generate a new alias</span>
<a name="l00697"></a>00697             $name = substr($oldAlias, 0, 1);
<a name="l00698"></a>00698             $i    = ((int) substr($oldAlias, 1));
<a name="l00699"></a>00699 
<a name="l00700"></a>00700             <span class="comment">// Fix #1530: It was reaching unexistent seeds index</span>
<a name="l00701"></a>00701             <span class="keywordflow">if</span> ( ! isset($this-&gt;_tableAliasSeeds[$name])) {
<a name="l00702"></a>00702                 $this-&gt;_tableAliasSeeds[$name] = 1;
<a name="l00703"></a>00703             }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705             $newIndex  = ($this-&gt;_tableAliasSeeds[$name] + (($i == 0) ? 1 : $i));
<a name="l00706"></a>00706 
<a name="l00707"></a>00707             <span class="keywordflow">return</span> $name . $newIndex;
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710         <span class="keywordflow">return</span> $oldAlias;
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712 
<a name="l00720"></a><a class="code" href="classDoctrine__Query__Abstract.html#a68ce5bf39c2c08779a67714fc3c9759d">00720</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a68ce5bf39c2c08779a67714fc3c9759d" title="getSqlTableAliasSeed returns the alias seed for given table alias">getSqlTableAliasSeed</a>($sqlTableAlias)
<a name="l00721"></a>00721     {
<a name="l00722"></a>00722         <span class="keywordflow">if</span> ( ! isset($this-&gt;_tableAliasSeeds[$sqlTableAlias])) {
<a name="l00723"></a>00723             <span class="keywordflow">return</span> 0;
<a name="l00724"></a>00724         }
<a name="l00725"></a>00725         <span class="keywordflow">return</span> $this-&gt;_tableAliasSeeds[$sqlTableAlias];
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727 
<a name="l00735"></a><a class="code" href="classDoctrine__Query__Abstract.html#a2a107ec8a12e756b584f463844db4ba0">00735</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a2a107ec8a12e756b584f463844db4ba0" title="hasAliasDeclaration whether or not this object has a declaration for given component...">hasAliasDeclaration</a>($componentAlias)
<a name="l00736"></a>00736     {
<a name="l00737"></a>00737         <span class="keywordflow">return</span> isset($this-&gt;_queryComponents[$componentAlias]);
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739 
<a name="l00747"></a><a class="code" href="classDoctrine__Query__Abstract.html#a35fa36ad8a424683a8f06bbe9d903817">00747</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a35fa36ad8a424683a8f06bbe9d903817" title="getQueryComponent get the declaration for given component alias">getQueryComponent</a>($componentAlias)
<a name="l00748"></a>00748     {
<a name="l00749"></a>00749         <span class="keywordflow">if</span> ( ! isset($this-&gt;_queryComponents[$componentAlias])) {
<a name="l00750"></a>00750             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown component alias &#39;</span> . $componentAlias);
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         <span class="keywordflow">return</span> $this-&gt;_queryComponents[$componentAlias];
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755 
<a name="l00767"></a><a class="code" href="classDoctrine__Query__Abstract.html#a6f8cf6fc746e44c5ce9e0eee7fc7b039">00767</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a6f8cf6fc746e44c5ce9e0eee7fc7b039" title="copySubqueryInfo copy aliases from another Hydrate object">copySubqueryInfo</a>(<a class="code" href="classDoctrine__Query__Abstract.html">Doctrine_Query_Abstract</a> $query)
<a name="l00768"></a>00768     {
<a name="l00769"></a>00769         $this-&gt;_params =&amp; $query-&gt;_params;
<a name="l00770"></a>00770         $this-&gt;_tableAliasMap =&amp; $query-&gt;_tableAliasMap;
<a name="l00771"></a>00771         $this-&gt;_queryComponents =&amp; $query-&gt;_queryComponents;
<a name="l00772"></a>00772         $this-&gt;_tableAliasSeeds = $query-&gt;_tableAliasSeeds;
<a name="l00773"></a>00773         <span class="keywordflow">return</span> $this;
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775 
<a name="l00782"></a><a class="code" href="classDoctrine__Query__Abstract.html#a1d38cc19315d608f118852e835879dee">00782</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a1d38cc19315d608f118852e835879dee" title="getRootAlias returns the alias of the root component">getRootAlias</a>()
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784         <span class="keywordflow">if</span> ( ! $this-&gt;_queryComponents) {
<a name="l00785"></a>00785             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a035205e03bdce3f27104fab79daeee07" title="Gets the SQL query that corresponds to this query object.">getSqlQuery</a>(array(), <span class="keyword">false</span>);
<a name="l00786"></a>00786         }
<a name="l00787"></a>00787         
<a name="l00788"></a>00788         <span class="keywordflow">return</span> $this-&gt;_rootAlias;
<a name="l00789"></a>00789     }
<a name="l00790"></a>00790 
<a name="l00797"></a><a class="code" href="classDoctrine__Query__Abstract.html#a82bcfeafae635387057c74deac108ca1">00797</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a82bcfeafae635387057c74deac108ca1" title="getRootDeclaration returns the root declaration">getRootDeclaration</a>()
<a name="l00798"></a>00798     {
<a name="l00799"></a>00799         $map = $this-&gt;_queryComponents[$this-&gt;_rootAlias];
<a name="l00800"></a>00800         <span class="keywordflow">return</span> $map;
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802 
<a name="l00809"></a><a class="code" href="classDoctrine__Query__Abstract.html#a7934020d389d94694e8bc5ffac36d30c">00809</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a7934020d389d94694e8bc5ffac36d30c" title="getRoot returns the root component for this object">getRoot</a>()
<a name="l00810"></a>00810     {
<a name="l00811"></a>00811         $map = $this-&gt;_queryComponents[$this-&gt;_rootAlias];
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="keywordflow">if</span> ( ! isset($map[<span class="stringliteral">&#39;table&#39;</span>])) {
<a name="l00814"></a>00814             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Root component not initialized.&#39;</span>);
<a name="l00815"></a>00815         }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <span class="keywordflow">return</span> $map[<span class="stringliteral">&#39;table&#39;</span>];
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819 
<a name="l00829"></a><a class="code" href="classDoctrine__Query__Abstract.html#aca1d5b07fc26cab312cc63f23045dd3c">00829</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aca1d5b07fc26cab312cc63f23045dd3c" title="generateSqlTableAlias generates a table alias from given table name and associates...">generateSqlTableAlias</a>($componentAlias, $tableName)
<a name="l00830"></a>00830     {
<a name="l00831"></a>00831         preg_match(<span class="stringliteral">&#39;/([^_|\d])/&#39;</span>, $tableName, $matches);
<a name="l00832"></a>00832         $char = strtolower($matches[0]);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834         $alias = $char;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <span class="keywordflow">if</span> ( ! isset($this-&gt;_tableAliasSeeds[$alias])) {
<a name="l00837"></a>00837             $this-&gt;_tableAliasSeeds[$alias] = 1;
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         <span class="keywordflow">while</span> (isset($this-&gt;_tableAliasMap[$alias])) {
<a name="l00841"></a>00841             <span class="keywordflow">if</span> ( ! isset($this-&gt;_tableAliasSeeds[$alias])) {
<a name="l00842"></a>00842                 $this-&gt;_tableAliasSeeds[$alias] = 1;
<a name="l00843"></a>00843             }
<a name="l00844"></a>00844             $alias = $char . ++$this-&gt;_tableAliasSeeds[$alias];
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847         $this-&gt;_tableAliasMap[$alias] = $componentAlias;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849         <span class="keywordflow">return</span> $alias;
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851 
<a name="l00859"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0e3c92621557181179cb878cd03d77de">00859</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a0e3c92621557181179cb878cd03d77de" title="getComponentAlias get component alias associated with given table alias">getComponentAlias</a>($sqlTableAlias)
<a name="l00860"></a>00860     {
<a name="l00861"></a>00861         $sqlTableAlias = trim($sqlTableAlias, <span class="stringliteral">&#39;[]`&quot;&#39;</span>);
<a name="l00862"></a>00862         <span class="keywordflow">if</span> ( ! isset($this-&gt;_tableAliasMap[$sqlTableAlias])) {
<a name="l00863"></a>00863             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Unknown table alias &#39;</span> . $sqlTableAlias);
<a name="l00864"></a>00864         }
<a name="l00865"></a>00865         <span class="keywordflow">return</span> $this-&gt;_tableAliasMap[$sqlTableAlias];
<a name="l00866"></a>00866     }
<a name="l00867"></a>00867 
<a name="l00874"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0feadea5ba3d84a3cccdae727e86bb88">00874</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a0feadea5ba3d84a3cccdae727e86bb88" title="calculateQueryCacheHash calculate hash key for query cache">calculateQueryCacheHash</a>()
<a name="l00875"></a>00875     {
<a name="l00876"></a>00876         $dql = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#afab62ca7b2fd4f605de4caadfa072f53" title="getDql returns the DQL query that is represented by this query object.">getDql</a>();
<a name="l00877"></a>00877         $hash = md5($dql . var_export($this-&gt;_pendingJoinConditions, <span class="keyword">true</span>) . <span class="stringliteral">&#39;DOCTRINE_QUERY_CACHE_SALT&#39;</span>);
<a name="l00878"></a>00878         <span class="keywordflow">return</span> $hash;
<a name="l00879"></a>00879     }
<a name="l00880"></a>00880 
<a name="l00888"></a><a class="code" href="classDoctrine__Query__Abstract.html#a9847edc5159761caff388ceb76b40812">00888</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a9847edc5159761caff388ceb76b40812" title="calculateResultCacheHash calculate hash key for result cache">calculateResultCacheHash</a>($params = array())
<a name="l00889"></a>00889     {
<a name="l00890"></a>00890         $dql = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#afab62ca7b2fd4f605de4caadfa072f53" title="getDql returns the DQL query that is represented by this query object.">getDql</a>();
<a name="l00891"></a>00891         $conn = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ab08c6b21e634cdbca5f45f7e81a99231" title="getConnection">getConnection</a>();
<a name="l00892"></a>00892         $params = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aae571f5a486c271f70a7cd14c1309387" title="Get flattened array of parameters for query.">getFlattenedParams</a>($params);
<a name="l00893"></a>00893         $hash = md5($this-&gt;_hydrator-&gt;getHydrationMode() . $conn-&gt;getName() . $conn-&gt;getOption(<span class="stringliteral">&#39;dsn&#39;</span>) . $dql . var_export($this-&gt;_pendingJoinConditions, <span class="keyword">true</span>) . var_export($params, <span class="keyword">true</span>));
<a name="l00894"></a>00894         <span class="keywordflow">return</span> $hash;
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896 
<a name="l00904"></a><a class="code" href="classDoctrine__Query__Abstract.html#a7bce266181f43183b4eb3a99f3cfde3b">00904</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a7bce266181f43183b4eb3a99f3cfde3b" title="Get the result cache hash/key.">getResultCacheHash</a>($params = array())
<a name="l00905"></a>00905     {
<a name="l00906"></a>00906       <span class="keywordflow">if</span> ($this-&gt;_resultCacheHash) {
<a name="l00907"></a>00907           <span class="keywordflow">return</span> $this-&gt;_resultCacheHash;
<a name="l00908"></a>00908       } <span class="keywordflow">else</span> {
<a name="l00909"></a>00909           <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a9847edc5159761caff388ceb76b40812" title="calculateResultCacheHash calculate hash key for result cache">calculateResultCacheHash</a>($params);
<a name="l00910"></a>00910       }
<a name="l00911"></a>00911     }
<a name="l00912"></a>00912 
<a name="l00919"></a><a class="code" href="classDoctrine__Query__Abstract.html#aaa912b64d45fd11acda9bb40acf59d62">00919</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aaa912b64d45fd11acda9bb40acf59d62" title="_execute">_execute</a>($params)
<a name="l00920"></a>00920     {
<a name="l00921"></a>00921         <span class="comment">// Apply boolean conversion in DQL params</span>
<a name="l00922"></a>00922         $params = $this-&gt;_conn-&gt;convertBooleans($params);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924         <span class="keywordflow">foreach</span> ($this-&gt;_params as $k =&gt; $v) {
<a name="l00925"></a>00925             $this-&gt;_params[$k] = $this-&gt;_conn-&gt;convertBooleans($v);
<a name="l00926"></a>00926         }
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         $dqlParams = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aae571f5a486c271f70a7cd14c1309387" title="Get flattened array of parameters for query.">getFlattenedParams</a>($params);
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         <span class="comment">// Check if we&#39;re not using a Doctrine_View</span>
<a name="l00931"></a>00931         <span class="keywordflow">if</span> ( ! $this-&gt;_view) {
<a name="l00932"></a>00932             <span class="keywordflow">if</span> ($this-&gt;_queryCache !== <span class="keyword">false</span> &amp;&amp; ($this-&gt;_queryCache || $this-&gt;_conn-&gt;getAttribute(Doctrine_Core::ATTR_QUERY_CACHE))) {
<a name="l00933"></a>00933                 $queryCacheDriver = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a08a56aa1c837ce2bf2900de62635778d" title="getQueryCacheDriver returns the cache driver used for caching queries">getQueryCacheDriver</a>();
<a name="l00934"></a>00934                 $hash = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a0feadea5ba3d84a3cccdae727e86bb88" title="calculateQueryCacheHash calculate hash key for query cache">calculateQueryCacheHash</a>();
<a name="l00935"></a>00935                 $cached = $queryCacheDriver-&gt;fetch($hash);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937                 <span class="comment">// If we have a cached query...</span>
<a name="l00938"></a>00938                 <span class="keywordflow">if</span> ($cached) {
<a name="l00939"></a>00939                     <span class="comment">// Rebuild query from cache</span>
<a name="l00940"></a>00940                     $query = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a5ea42e3dd70940fe87598da5463869c4" title="Constructs the query from the cached form.">_constructQueryFromCache</a>($cached);
<a name="l00941"></a>00941                     
<a name="l00942"></a>00942                     <span class="comment">// Assign building/execution specific params</span>
<a name="l00943"></a>00943                     $this-&gt;_params[<span class="stringliteral">&#39;exec&#39;</span>] = $params;
<a name="l00944"></a>00944             
<a name="l00945"></a>00945                     <span class="comment">// Initialize prepared parameters array</span>
<a name="l00946"></a>00946                     $this-&gt;_execParams = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aae571f5a486c271f70a7cd14c1309387" title="Get flattened array of parameters for query.">getFlattenedParams</a>();
<a name="l00947"></a>00947                     
<a name="l00948"></a>00948                     <span class="comment">// Fix possible array parameter values in SQL params</span>
<a name="l00949"></a>00949                     $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a51ce05daab0bd7f7f61783348a843ced">fixArrayParameterValues</a>($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a69bac20bfc56df1c7a5dc105205fc968" title="getInternalParams">getInternalParams</a>());
<a name="l00950"></a>00950                 } <span class="keywordflow">else</span> {
<a name="l00951"></a>00951                     <span class="comment">// Generate SQL or pick already processed one</span>
<a name="l00952"></a>00952                     $query = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a035205e03bdce3f27104fab79daeee07" title="Gets the SQL query that corresponds to this query object.">getSqlQuery</a>($params);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954                     <span class="comment">// Check again because getSqlQuery() above could have flipped the _queryCache flag</span>
<a name="l00955"></a>00955                     <span class="comment">// if this query contains the limit sub query algorithm we don&#39;t need to cache it</span>
<a name="l00956"></a>00956                     <span class="keywordflow">if</span> ($this-&gt;_queryCache !== <span class="keyword">false</span> &amp;&amp; ($this-&gt;_queryCache || $this-&gt;_conn-&gt;getAttribute(Doctrine_Core::ATTR_QUERY_CACHE))) {
<a name="l00957"></a>00957                         <span class="comment">// Convert query into a serialized form</span>
<a name="l00958"></a>00958                         $serializedQuery = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a796becc0b79f93fea197c26825fededb" title="getCachedForm returns the cached form of this query for given resultSet">getCachedForm</a>($query);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960                         <span class="comment">// Save cached query</span>
<a name="l00961"></a>00961                         $queryCacheDriver-&gt;save($hash, $serializedQuery, $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aa31586e21567ea6c279340baae31f461" title="Gets the life span of the query cache the Query object is using.">getQueryCacheLifeSpan</a>());
<a name="l00962"></a>00962                     }
<a name="l00963"></a>00963                 }
<a name="l00964"></a>00964             } <span class="keywordflow">else</span> {
<a name="l00965"></a>00965                 $query = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a035205e03bdce3f27104fab79daeee07" title="Gets the SQL query that corresponds to this query object.">getSqlQuery</a>($params);
<a name="l00966"></a>00966             }
<a name="l00967"></a>00967         } <span class="keywordflow">else</span> {
<a name="l00968"></a>00968             $query = $this-&gt;_view-&gt;getSelectSql();
<a name="l00969"></a>00969         }
<a name="l00970"></a>00970         
<a name="l00971"></a>00971         <span class="comment">// Get prepared SQL params for execution</span>
<a name="l00972"></a>00972         $params = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a69bac20bfc56df1c7a5dc105205fc968" title="getInternalParams">getInternalParams</a>();
<a name="l00973"></a>00973 
<a name="l00974"></a>00974         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a4a08f09dedcbe2394323e69ac95ed349" title="limitSubqueryUsed">isLimitSubqueryUsed</a>() &amp;&amp;
<a name="l00975"></a>00975                 $this-&gt;_conn-&gt;getAttribute(Doctrine_Core::ATTR_DRIVER_NAME) !== <span class="stringliteral">&#39;mysql&#39;</span>) {
<a name="l00976"></a>00976             $params = array_merge((array) $params, (array) $params);
<a name="l00977"></a>00977         }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979         <span class="keywordflow">if</span> ($this-&gt;_type !== self::SELECT) {
<a name="l00980"></a>00980             <span class="keywordflow">return</span> $this-&gt;_conn-&gt;exec($query, $params);
<a name="l00981"></a>00981         }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983         $stmt = $this-&gt;_conn-&gt;execute($query, $params);
<a name="l00984"></a>00984 
<a name="l00985"></a>00985         $this-&gt;_params[<span class="stringliteral">&#39;exec&#39;</span>] = array();
<a name="l00986"></a>00986 
<a name="l00987"></a>00987         <span class="keywordflow">return</span> $stmt;
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989 
<a name="l00997"></a><a class="code" href="classDoctrine__Query__Abstract.html#a17243067d561323fe00413bbadb6e71c">00997</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a17243067d561323fe00413bbadb6e71c" title="execute executes the query and populates the data set">execute</a>($params = array(), $hydrationMode = null)
<a name="l00998"></a>00998     {
<a name="l00999"></a>00999         <span class="comment">// Clean any possible processed params</span>
<a name="l01000"></a>01000         $this-&gt;_execParams = array();
<a name="l01001"></a>01001 
<a name="l01002"></a>01002         <span class="keywordflow">if</span> (empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>]) &amp;&amp; empty($this-&gt;_sqlParts[<span class="stringliteral">&#39;from&#39;</span>])) {
<a name="l01003"></a>01003             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;You must have at least one component specified in your from.&#39;</span>);
<a name="l01004"></a>01004         }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006         $dqlParams = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aae571f5a486c271f70a7cd14c1309387" title="Get flattened array of parameters for query.">getFlattenedParams</a>($params);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008         $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a0ce43da6f066e274a0d01ee20a03f021" title="Pre query method which invokes the pre*Query() methods on the model instance or any...">_preQuery</a>($dqlParams);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010         <span class="keywordflow">if</span> ($hydrationMode !== null) {
<a name="l01011"></a>01011             $this-&gt;_hydrator-&gt;setHydrationMode($hydrationMode);
<a name="l01012"></a>01012         }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014         $hydrationMode = $this-&gt;_hydrator-&gt;getHydrationMode();
<a name="l01015"></a>01015 
<a name="l01016"></a>01016         <span class="keywordflow">if</span> ($this-&gt;_resultCache &amp;&amp; $this-&gt;_type == self::SELECT) {
<a name="l01017"></a>01017             $cacheDriver = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#af6b80376c526255744b0da891bf9a0b8" title="getResultCacheDriver returns the cache driver used for caching result sets">getResultCacheDriver</a>();
<a name="l01018"></a>01018             $hash = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a7bce266181f43183b4eb3a99f3cfde3b" title="Get the result cache hash/key.">getResultCacheHash</a>($params);
<a name="l01019"></a>01019             $cached = ($this-&gt;_expireResultCache) ? <span class="keyword">false</span> : $cacheDriver-&gt;fetch($hash);
<a name="l01020"></a>01020 
<a name="l01021"></a>01021             <span class="keywordflow">if</span> ($cached === <span class="keyword">false</span>) {
<a name="l01022"></a>01022                 <span class="comment">// cache miss</span>
<a name="l01023"></a>01023                 $stmt = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aaa912b64d45fd11acda9bb40acf59d62" title="_execute">_execute</a>($params);
<a name="l01024"></a>01024                 $this-&gt;_hydrator-&gt;setQueryComponents($this-&gt;_queryComponents);
<a name="l01025"></a>01025                 $result = $this-&gt;_hydrator-&gt;hydrateResultSet($stmt, $this-&gt;_tableAliasMap);
<a name="l01026"></a>01026 
<a name="l01027"></a>01027                 $cached = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a796becc0b79f93fea197c26825fededb" title="getCachedForm returns the cached form of this query for given resultSet">getCachedForm</a>($result);
<a name="l01028"></a>01028                 $cacheDriver-&gt;save($hash, $cached, $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a40a132109b30fe2196e3e077945d6016" title="Gets the life span of the result cache in seconds.">getResultCacheLifeSpan</a>());
<a name="l01029"></a>01029             } <span class="keywordflow">else</span> {
<a name="l01030"></a>01030                 $result = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a5ea42e3dd70940fe87598da5463869c4" title="Constructs the query from the cached form.">_constructQueryFromCache</a>($cached);
<a name="l01031"></a>01031             }
<a name="l01032"></a>01032         } <span class="keywordflow">else</span> {
<a name="l01033"></a>01033             $stmt = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aaa912b64d45fd11acda9bb40acf59d62" title="_execute">_execute</a>($params);
<a name="l01034"></a>01034 
<a name="l01035"></a>01035             <span class="keywordflow">if</span> (is_integer($stmt)) {
<a name="l01036"></a>01036                 $result = $stmt;
<a name="l01037"></a>01037             } <span class="keywordflow">else</span> {
<a name="l01038"></a>01038                 $this-&gt;_hydrator-&gt;setQueryComponents($this-&gt;_queryComponents);
<a name="l01039"></a>01039                 <span class="keywordflow">if</span> ($this-&gt;_type == self::SELECT &amp;&amp; $hydrationMode == <a class="code" href="classDoctrine__Core.html#a60ede861db6c2521d7e74124fdb3b9c1" title="HYDRATE_ON_DEMAND.">Doctrine_Core::HYDRATE_ON_DEMAND</a>) {
<a name="l01040"></a>01040                     $hydrationDriver = $this-&gt;_hydrator-&gt;getHydratorDriver($hydrationMode, $this-&gt;_tableAliasMap);
<a name="l01041"></a>01041                     $result = <span class="keyword">new</span> <a class="code" href="classDoctrine__Collection__OnDemand.html">Doctrine_Collection_OnDemand</a>($stmt, $hydrationDriver, $this-&gt;_tableAliasMap); 
<a name="l01042"></a>01042                 } <span class="keywordflow">else</span> {
<a name="l01043"></a>01043                     $result = $this-&gt;_hydrator-&gt;hydrateResultSet($stmt, $this-&gt;_tableAliasMap);
<a name="l01044"></a>01044                 }
<a name="l01045"></a>01045             }
<a name="l01046"></a>01046         }
<a name="l01047"></a>01047         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ab08c6b21e634cdbca5f45f7e81a99231" title="getConnection">getConnection</a>()-&gt;getAttribute(Doctrine_Core::ATTR_AUTO_FREE_QUERY_OBJECTS)) {
<a name="l01048"></a>01048             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a0ede332eed8973a5721f0748a541bdaa" title="Blank template method free().">free</a>();
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050 
<a name="l01051"></a>01051         <span class="keywordflow">return</span> $result;
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053 
<a name="l01057"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0ede332eed8973a5721f0748a541bdaa">01057</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a0ede332eed8973a5721f0748a541bdaa" title="Blank template method free().">free</a>()
<a name="l01058"></a>01058     { 
<a name="l01059"></a>01059     }
<a name="l01060"></a>01060 
<a name="l01066"></a><a class="code" href="classDoctrine__Query__Abstract.html#a572c0239d4e5c669d2c0c5bedd7ed7ab">01066</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a572c0239d4e5c669d2c0c5bedd7ed7ab" title="Get the dql call back for this query.">_getDqlCallback</a>()
<a name="l01067"></a>01067     {
<a name="l01068"></a>01068         $callback = <span class="keyword">false</span>;
<a name="l01069"></a>01069         <span class="keywordflow">if</span> ( ! empty($this-&gt;_dqlParts[<span class="stringliteral">&#39;from&#39;</span>])) {
<a name="l01070"></a>01070             <span class="keywordflow">switch</span> ($this-&gt;_type) {
<a name="l01071"></a>01071                 <span class="keywordflow">case</span> self::DELETE:
<a name="l01072"></a>01072                     $callback = array(
<a name="l01073"></a>01073                         <span class="stringliteral">&#39;callback&#39;</span> =&gt; <span class="stringliteral">&#39;preDqlDelete&#39;</span>,
<a name="l01074"></a>01074                         <span class="stringliteral">&#39;const&#39;</span> =&gt; Doctrine_Event::RECORD_DQL_DELETE
<a name="l01075"></a>01075                     );
<a name="l01076"></a>01076                 <span class="keywordflow">break</span>;
<a name="l01077"></a>01077                 <span class="keywordflow">case</span> self::UPDATE:
<a name="l01078"></a>01078                     $callback = array(
<a name="l01079"></a>01079                         <span class="stringliteral">&#39;callback&#39;</span> =&gt; <span class="stringliteral">&#39;preDqlUpdate&#39;</span>,
<a name="l01080"></a>01080                         <span class="stringliteral">&#39;const&#39;</span> =&gt; Doctrine_Event::RECORD_DQL_UPDATE
<a name="l01081"></a>01081                     );
<a name="l01082"></a>01082                 <span class="keywordflow">break</span>;
<a name="l01083"></a>01083                 <span class="keywordflow">case</span> self::SELECT:
<a name="l01084"></a>01084                     $callback = array(
<a name="l01085"></a>01085                         <span class="stringliteral">&#39;callback&#39;</span> =&gt; <span class="stringliteral">&#39;preDqlSelect&#39;</span>,
<a name="l01086"></a>01086                         <span class="stringliteral">&#39;const&#39;</span> =&gt; Doctrine_Event::RECORD_DQL_SELECT
<a name="l01087"></a>01087                     );
<a name="l01088"></a>01088                 <span class="keywordflow">break</span>;
<a name="l01089"></a>01089             }
<a name="l01090"></a>01090         }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092         <span class="keywordflow">return</span> $callback;
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094 
<a name="l01101"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0ce43da6f066e274a0d01ee20a03f021">01101</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a0ce43da6f066e274a0d01ee20a03f021" title="Pre query method which invokes the pre*Query() methods on the model instance or any...">_preQuery</a>($params = array())
<a name="l01102"></a>01102     {
<a name="l01103"></a>01103         <span class="keywordflow">if</span> ( ! $this-&gt;_preQueried &amp;&amp; $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ab08c6b21e634cdbca5f45f7e81a99231" title="getConnection">getConnection</a>()-&gt;getAttribute(Doctrine_Core::ATTR_USE_DQL_CALLBACKS)) {
<a name="l01104"></a>01104             $this-&gt;_preQueried = <span class="keyword">true</span>;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106             $callback = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a572c0239d4e5c669d2c0c5bedd7ed7ab" title="Get the dql call back for this query.">_getDqlCallback</a>();
<a name="l01107"></a>01107 
<a name="l01108"></a>01108             <span class="comment">// if there is no callback for the query type, then we can return early</span>
<a name="l01109"></a>01109             <span class="keywordflow">if</span> ( ! $callback) {
<a name="l01110"></a>01110                 <span class="keywordflow">return</span>;
<a name="l01111"></a>01111             }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113             <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a670443a93b021a55b96fa315f3e19d54" title="Returns an array of components to execute the query callbacks for.">_getDqlCallbackComponents</a>($params) as $alias =&gt; $component) {
<a name="l01114"></a>01114                 $table = $component[<span class="stringliteral">&#39;table&#39;</span>];
<a name="l01115"></a>01115                 $record = $table-&gt;getRecordInstance();
<a name="l01116"></a>01116 
<a name="l01117"></a>01117                 <span class="comment">// Trigger preDql*() callback event</span>
<a name="l01118"></a>01118                 $params = array(<span class="stringliteral">&#39;component&#39;</span> =&gt; $component, <span class="stringliteral">&#39;alias&#39;</span> =&gt; $alias);
<a name="l01119"></a>01119                 $event = <span class="keyword">new</span> <a class="code" href="classDoctrine__Event.html">Doctrine_Event</a>($record, $callback[<span class="stringliteral">&#39;const&#39;</span>], $this, $params);
<a name="l01120"></a>01120 
<a name="l01121"></a>01121                 $record-&gt;$callback[<span class="stringliteral">&#39;callback&#39;</span>]($event);
<a name="l01122"></a>01122                 $table-&gt;getRecordListener()-&gt;$callback[<span class="stringliteral">&#39;callback&#39;</span>]($event);
<a name="l01123"></a>01123             }
<a name="l01124"></a>01124         }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126         <span class="comment">// Invoke preQuery() hook on Doctrine_Query for child classes which implement this hook</span>
<a name="l01127"></a>01127         $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a1ae20502cd1e3e2f0de31c02cdf93d8e" title="Blank hook methods which can be implemented in Doctrine_Query child classes.">preQuery</a>();
<a name="l01128"></a>01128     }
<a name="l01129"></a>01129 
<a name="l01136"></a><a class="code" href="classDoctrine__Query__Abstract.html#a670443a93b021a55b96fa315f3e19d54">01136</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a670443a93b021a55b96fa315f3e19d54" title="Returns an array of components to execute the query callbacks for.">_getDqlCallbackComponents</a>($params = array())
<a name="l01137"></a>01137     {
<a name="l01138"></a>01138         $componentsBefore = array();
<a name="l01139"></a>01139         <span class="keywordflow">if</span> ($this-&gt;isSubquery()) {
<a name="l01140"></a>01140             $componentsBefore = $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aa8573d794b04605a10fd891d21ad8cfc" title="Gets the components of this query.">getQueryComponents</a>();
<a name="l01141"></a>01141         }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143         $copy = $this-&gt;copy();
<a name="l01144"></a>01144         $copy-&gt;getSqlQuery($params, <span class="keyword">false</span>);
<a name="l01145"></a>01145         $componentsAfter = $copy-&gt;getQueryComponents();
<a name="l01146"></a>01146 
<a name="l01147"></a>01147         $this-&gt;_rootAlias = $copy-&gt;getRootAlias();
<a name="l01148"></a>01148 
<a name="l01149"></a>01149         $copy-&gt;free();
<a name="l01150"></a>01150 
<a name="l01151"></a>01151         <span class="keywordflow">if</span> ($componentsBefore !== $componentsAfter) {
<a name="l01152"></a>01152             <span class="keywordflow">return</span> array_diff($componentsAfter, $componentsBefore);
<a name="l01153"></a>01153         } <span class="keywordflow">else</span> {
<a name="l01154"></a>01154             <span class="keywordflow">return</span> $componentsAfter;
<a name="l01155"></a>01155         }
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157 
<a name="l01163"></a><a class="code" href="classDoctrine__Query__Abstract.html#a1ae20502cd1e3e2f0de31c02cdf93d8e">01163</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a1ae20502cd1e3e2f0de31c02cdf93d8e" title="Blank hook methods which can be implemented in Doctrine_Query child classes.">preQuery</a>()
<a name="l01164"></a>01164     {
<a name="l01165"></a>01165     }
<a name="l01166"></a>01166 
<a name="l01175"></a><a class="code" href="classDoctrine__Query__Abstract.html#a5ea42e3dd70940fe87598da5463869c4">01175</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a5ea42e3dd70940fe87598da5463869c4" title="Constructs the query from the cached form.">_constructQueryFromCache</a>($cached)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177         $cached = unserialize($cached);
<a name="l01178"></a>01178         $this-&gt;_tableAliasMap = $cached[2];
<a name="l01179"></a>01179         $customComponent = $cached[0];
<a name="l01180"></a>01180 
<a name="l01181"></a>01181         $queryComponents = array();
<a name="l01182"></a>01182         $cachedComponents = $cached[1];
<a name="l01183"></a>01183         <span class="keywordflow">foreach</span> ($cachedComponents as $alias =&gt; $components) {
<a name="l01184"></a>01184             $e = explode(<span class="charliteral">&#39;.&#39;</span>, $components[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l01185"></a>01185             <span class="keywordflow">if</span> (count($e) === 1) {
<a name="l01186"></a>01186                 $manager = <a class="code" href="classDoctrine__Manager.html#a0f1f11c9be78468eed7768f4130aac2e" title="Returns an instance of this class (this class uses the singleton pattern).">Doctrine_Manager::getInstance</a>(); 
<a name="l01187"></a>01187                 <span class="keywordflow">if</span> ( ! $this-&gt;_passedConn &amp;&amp; $manager-&gt;hasConnectionForComponent($e[0])) { 
<a name="l01188"></a>01188                     $this-&gt;_conn = $manager-&gt;getConnectionForComponent($e[0]); 
<a name="l01189"></a>01189                 }
<a name="l01190"></a>01190                 $queryComponents[$alias][<span class="stringliteral">&#39;table&#39;</span>] = $this-&gt;_conn-&gt;getTable($e[0]);
<a name="l01191"></a>01191             } <span class="keywordflow">else</span> {
<a name="l01192"></a>01192                 $queryComponents[$alias][<span class="stringliteral">&#39;parent&#39;</span>] = $e[0];
<a name="l01193"></a>01193                 $queryComponents[$alias][<span class="stringliteral">&#39;relation&#39;</span>] = $queryComponents[$e[0]][<span class="stringliteral">&#39;table&#39;</span>]-&gt;getRelation($e[1]);
<a name="l01194"></a>01194                 $queryComponents[$alias][<span class="stringliteral">&#39;table&#39;</span>] = $queryComponents[$alias][<span class="stringliteral">&#39;relation&#39;</span>]-&gt;getTable();
<a name="l01195"></a>01195             }
<a name="l01196"></a>01196             <span class="keywordflow">if</span> (isset($components[<span class="stringliteral">&#39;agg&#39;</span>])) {
<a name="l01197"></a>01197                 $queryComponents[$alias][<span class="stringliteral">&#39;agg&#39;</span>] = $components[<span class="stringliteral">&#39;agg&#39;</span>];
<a name="l01198"></a>01198             }
<a name="l01199"></a>01199             <span class="keywordflow">if</span> (isset($components[<span class="stringliteral">&#39;map&#39;</span>])) {
<a name="l01200"></a>01200                 $queryComponents[$alias][<span class="stringliteral">&#39;map&#39;</span>] = $components[<span class="stringliteral">&#39;map&#39;</span>];
<a name="l01201"></a>01201             }
<a name="l01202"></a>01202         }
<a name="l01203"></a>01203         $this-&gt;_queryComponents = $queryComponents;
<a name="l01204"></a>01204 
<a name="l01205"></a>01205         <span class="keywordflow">return</span> $customComponent;
<a name="l01206"></a>01206     }
<a name="l01207"></a>01207 
<a name="l01215"></a><a class="code" href="classDoctrine__Query__Abstract.html#a796becc0b79f93fea197c26825fededb">01215</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a796becc0b79f93fea197c26825fededb" title="getCachedForm returns the cached form of this query for given resultSet">getCachedForm</a>($customComponent = null)
<a name="l01216"></a>01216     {
<a name="l01217"></a>01217         $componentInfo = array();
<a name="l01218"></a>01218 
<a name="l01219"></a>01219         <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aa8573d794b04605a10fd891d21ad8cfc" title="Gets the components of this query.">getQueryComponents</a>() as $alias =&gt; $components) {
<a name="l01220"></a>01220             <span class="keywordflow">if</span> ( ! isset($components[<span class="stringliteral">&#39;parent&#39;</span>])) {
<a name="l01221"></a>01221                 $componentInfo[$alias][<span class="stringliteral">&#39;name&#39;</span>] = $components[<span class="stringliteral">&#39;table&#39;</span>]-&gt;getComponentName();
<a name="l01222"></a>01222             } <span class="keywordflow">else</span> {
<a name="l01223"></a>01223                 $componentInfo[$alias][<span class="stringliteral">&#39;name&#39;</span>] = $components[<span class="stringliteral">&#39;parent&#39;</span>] . <span class="charliteral">&#39;.&#39;</span> . $components[<span class="stringliteral">&#39;relation&#39;</span>]-&gt;getAlias();
<a name="l01224"></a>01224             }
<a name="l01225"></a>01225             <span class="keywordflow">if</span> (isset($components[<span class="stringliteral">&#39;agg&#39;</span>])) {
<a name="l01226"></a>01226                 $componentInfo[$alias][<span class="stringliteral">&#39;agg&#39;</span>] = $components[<span class="stringliteral">&#39;agg&#39;</span>];
<a name="l01227"></a>01227             }
<a name="l01228"></a>01228             <span class="keywordflow">if</span> (isset($components[<span class="stringliteral">&#39;map&#39;</span>])) {
<a name="l01229"></a>01229                 $componentInfo[$alias][<span class="stringliteral">&#39;map&#39;</span>] = $components[<span class="stringliteral">&#39;map&#39;</span>];
<a name="l01230"></a>01230             }
<a name="l01231"></a>01231         }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233         <span class="keywordflow">if</span> ($customComponent instanceof <a class="code" href="classDoctrine__Collection.html">Doctrine_Collection</a>) {
<a name="l01234"></a>01234             <span class="keywordflow">foreach</span> ($customComponent as $record) {
<a name="l01235"></a>01235                 $record-&gt;serializeReferences(<span class="keyword">true</span>);
<a name="l01236"></a>01236             }
<a name="l01237"></a>01237         }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239         <span class="keywordflow">return</span> serialize(array($customComponent, $componentInfo, $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aaded861a1d82005c5fe4c2d32f0653bd" title="getTableAliasMap returns all table aliases">getTableAliasMap</a>()));
<a name="l01240"></a>01240     }
<a name="l01241"></a>01241 
<a name="l01253"></a><a class="code" href="classDoctrine__Query__Abstract.html#adc25f9df470ed29c14318fb14b1b637f">01253</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#adc25f9df470ed29c14318fb14b1b637f" title="Adds fields or aliased functions.">addSelect</a>($select)
<a name="l01254"></a>01254     {
<a name="l01255"></a>01255         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;select&#39;</span>, $select, <span class="keyword">true</span>);
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257 
<a name="l01266"></a><a class="code" href="classDoctrine__Query__Abstract.html#add2cf14e6cff1d72d2fbc8bf258e1b0b">01266</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#add2cf14e6cff1d72d2fbc8bf258e1b0b" title="addSqlTableAlias adds an SQL table alias and associates it a component alias">addSqlTableAlias</a>($sqlTableAlias, $componentAlias)
<a name="l01267"></a>01267     {
<a name="l01268"></a>01268         $this-&gt;_tableAliasMap[$sqlTableAlias] = $componentAlias;
<a name="l01269"></a>01269         <span class="keywordflow">return</span> $this;
<a name="l01270"></a>01270     }
<a name="l01271"></a>01271 
<a name="l01279"></a><a class="code" href="classDoctrine__Query__Abstract.html#a9a89a3781bcf46e9092930f5c481882f">01279</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a9a89a3781bcf46e9092930f5c481882f" title="addFrom adds fields to the FROM part of the query">addFrom</a>($from)
<a name="l01280"></a>01280     {
<a name="l01281"></a>01281         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;from&#39;</span>, $from, <span class="keyword">true</span>);
<a name="l01282"></a>01282     }
<a name="l01283"></a>01283 
<a name="l01288"></a><a class="code" href="classDoctrine__Query__Abstract.html#ac862caabf6ee3631fdccb80c7c817dde">01288</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ac862caabf6ee3631fdccb80c7c817dde" title="Alias for.">addWhere</a>($where, $params = array())
<a name="l01289"></a>01289     {
<a name="l01290"></a>01290         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#aef783c33b23b83a6fb84978443fc63e7" title="Adds conditions to the WHERE part of the query.">andWhere</a>($where, $params);
<a name="l01291"></a>01291     }
<a name="l01292"></a>01292 
<a name="l01303"></a><a class="code" href="classDoctrine__Query__Abstract.html#aef783c33b23b83a6fb84978443fc63e7">01303</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aef783c33b23b83a6fb84978443fc63e7" title="Adds conditions to the WHERE part of the query.">andWhere</a>($where, $params = array())
<a name="l01304"></a>01304     {
<a name="l01305"></a>01305         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01306"></a>01306             $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>] = array_merge($this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>], $params);
<a name="l01307"></a>01307         } <span class="keywordflow">else</span> {
<a name="l01308"></a>01308             $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>][] = $params;
<a name="l01309"></a>01309         }
<a name="l01310"></a>01310 
<a name="l01311"></a>01311         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ad6f3f436024b8a037a1214f17afb4b08" title="Checks if there&amp;#39;s at least one DQL part defined to the internal parts collection...">_hasDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>)) {
<a name="l01312"></a>01312             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, <span class="stringliteral">&#39;AND&#39;</span>, <span class="keyword">true</span>);
<a name="l01313"></a>01313         }
<a name="l01314"></a>01314 
<a name="l01315"></a>01315         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, $where, <span class="keyword">true</span>);
<a name="l01316"></a>01316     }
<a name="l01317"></a>01317 
<a name="l01328"></a><a class="code" href="classDoctrine__Query__Abstract.html#a76b2bf5ec1e69b7b0efb8b4ade81dde1">01328</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a76b2bf5ec1e69b7b0efb8b4ade81dde1" title="Adds conditions to the WHERE part of the query  $q-&amp;gt;orWhere(&amp;#39;u.role = ?&amp;#39;...">orWhere</a>($where, $params = array())
<a name="l01329"></a>01329     {
<a name="l01330"></a>01330         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01331"></a>01331             $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>] = array_merge($this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>], $params);
<a name="l01332"></a>01332         } <span class="keywordflow">else</span> {
<a name="l01333"></a>01333             $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>][] = $params;
<a name="l01334"></a>01334         }
<a name="l01335"></a>01335 
<a name="l01336"></a>01336         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ad6f3f436024b8a037a1214f17afb4b08" title="Checks if there&amp;#39;s at least one DQL part defined to the internal parts collection...">_hasDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>)) {
<a name="l01337"></a>01337             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, <span class="stringliteral">&#39;OR&#39;</span>, <span class="keyword">true</span>);
<a name="l01338"></a>01338         }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, $where, <span class="keyword">true</span>);
<a name="l01341"></a>01341     }
<a name="l01342"></a>01342 
<a name="l01351"></a><a class="code" href="classDoctrine__Query__Abstract.html#ac9035f36e679fc068036e79c4535bec2">01351</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ac9035f36e679fc068036e79c4535bec2" title="Adds IN condition to the query WHERE part.">whereIn</a>($expr, $params = array(), $not = <span class="keyword">false</span>)
<a name="l01352"></a>01352     {
<a name="l01353"></a>01353         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a07ee84e88a20a27ba173bc9fc3526d52" title="Adds IN condition to the query WHERE part  $q-&amp;gt;whereIn(&amp;#39;u.id&amp;#39;, array(10...">andWhereIn</a>($expr, $params, $not);
<a name="l01354"></a>01354     }
<a name="l01355"></a>01355 
<a name="l01367"></a><a class="code" href="classDoctrine__Query__Abstract.html#a07ee84e88a20a27ba173bc9fc3526d52">01367</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a07ee84e88a20a27ba173bc9fc3526d52" title="Adds IN condition to the query WHERE part  $q-&amp;gt;whereIn(&amp;#39;u.id&amp;#39;, array(10...">andWhereIn</a>($expr, $params = array(), $not = <span class="keyword">false</span>)
<a name="l01368"></a>01368     {
<a name="l01369"></a>01369         <span class="comment">// if there&#39;s no params, return (else we&#39;ll get a WHERE IN (), invalid SQL)</span>
<a name="l01370"></a>01370         <span class="keywordflow">if</span> (isset($params) and (count($params) == 0)) {
<a name="l01371"></a>01371             <span class="keywordflow">return</span> $this;
<a name="l01372"></a>01372         }
<a name="l01373"></a>01373 
<a name="l01374"></a>01374         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ad6f3f436024b8a037a1214f17afb4b08" title="Checks if there&amp;#39;s at least one DQL part defined to the internal parts collection...">_hasDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>)) {
<a name="l01375"></a>01375             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, <span class="stringliteral">&#39;AND&#39;</span>, <span class="keyword">true</span>);
<a name="l01376"></a>01376         }
<a name="l01377"></a>01377 
<a name="l01378"></a>01378         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ad421b7bb7604552930ce7934d7fb9bd6">_processWhereIn</a>($expr, $params, $not), <span class="keyword">true</span>);
<a name="l01379"></a>01379     }
<a name="l01380"></a>01380 
<a name="l01394"></a><a class="code" href="classDoctrine__Query__Abstract.html#a21e56f99b9cfdfcc0aef9d4d869400b3">01394</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a21e56f99b9cfdfcc0aef9d4d869400b3" title="Adds IN condition to the query WHERE part, appending it with an OR operator.">orWhereIn</a>($expr, $params = array(), $not = <span class="keyword">false</span>)
<a name="l01395"></a>01395     {
<a name="l01396"></a>01396         <span class="comment">// if there&#39;s no params, return (else we&#39;ll get a WHERE IN (), invalid SQL)</span>
<a name="l01397"></a>01397         <span class="keywordflow">if</span> (isset($params) and (count($params) == 0)) {
<a name="l01398"></a>01398             <span class="keywordflow">return</span> $this;
<a name="l01399"></a>01399         }
<a name="l01400"></a>01400 
<a name="l01401"></a>01401         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ad6f3f436024b8a037a1214f17afb4b08" title="Checks if there&amp;#39;s at least one DQL part defined to the internal parts collection...">_hasDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>)) {
<a name="l01402"></a>01402             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, <span class="stringliteral">&#39;OR&#39;</span>, <span class="keyword">true</span>);
<a name="l01403"></a>01403         }
<a name="l01404"></a>01404 
<a name="l01405"></a>01405         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ad421b7bb7604552930ce7934d7fb9bd6">_processWhereIn</a>($expr, $params, $not), <span class="keyword">true</span>);
<a name="l01406"></a>01406     }
<a name="l01407"></a>01407 
<a name="l01411"></a><a class="code" href="classDoctrine__Query__Abstract.html#ad421b7bb7604552930ce7934d7fb9bd6">01411</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ad421b7bb7604552930ce7934d7fb9bd6">_processWhereIn</a>($expr, $params = array(), $not = <span class="keyword">false</span>)
<a name="l01412"></a>01412     {
<a name="l01413"></a>01413         $params = (array) $params;
<a name="l01414"></a>01414 
<a name="l01415"></a>01415         <span class="comment">// if there&#39;s no params, return (else we&#39;ll get a WHERE IN (), invalid SQL)</span>
<a name="l01416"></a>01416         <span class="keywordflow">if</span> (count($params) == 0) {
<a name="l01417"></a>01417             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;You must pass at least one parameter when using an IN() condition.&#39;</span>);
<a name="l01418"></a>01418         }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420         $a = array();
<a name="l01421"></a>01421         <span class="keywordflow">foreach</span> ($params as $k =&gt; $value) {
<a name="l01422"></a>01422             <span class="keywordflow">if</span> ($value instanceof <a class="code" href="classDoctrine__Expression.html">Doctrine_Expression</a>) {
<a name="l01423"></a>01423                 $value = $value-&gt;getSql();
<a name="l01424"></a>01424                 unset($params[$k]);
<a name="l01425"></a>01425             } <span class="keywordflow">else</span> {
<a name="l01426"></a>01426                 $value = <span class="charliteral">&#39;?&#39;</span>;
<a name="l01427"></a>01427             }
<a name="l01428"></a>01428             $a[] = $value;
<a name="l01429"></a>01429         }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431         $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>] = array_merge($this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>], $params);
<a name="l01432"></a>01432 
<a name="l01433"></a>01433         <span class="keywordflow">return</span> $expr . ($not === <span class="keyword">true</span> ? <span class="stringliteral">&#39; NOT&#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . <span class="stringliteral">&#39; IN (&#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $a) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l01434"></a>01434     }
<a name="l01435"></a>01435 
<a name="l01447"></a><a class="code" href="classDoctrine__Query__Abstract.html#a32ea3fdfb78b2e221991838720d56e79">01447</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a32ea3fdfb78b2e221991838720d56e79" title="Adds NOT IN condition to the query WHERE part.">whereNotIn</a>($expr, $params = array())
<a name="l01448"></a>01448     {
<a name="l01449"></a>01449         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ac9035f36e679fc068036e79c4535bec2" title="Adds IN condition to the query WHERE part.">whereIn</a>($expr, $params, <span class="keyword">true</span>);
<a name="l01450"></a>01450     }
<a name="l01451"></a>01451 
<a name="l01460"></a><a class="code" href="classDoctrine__Query__Abstract.html#a48d3dd5a88e8fb08b1e3e392d8b4b9a4">01460</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a48d3dd5a88e8fb08b1e3e392d8b4b9a4" title="Adds NOT IN condition to the query WHERE part Alias for.">andWhereNotIn</a>($expr, $params = array())
<a name="l01461"></a>01461     {
<a name="l01462"></a>01462         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a07ee84e88a20a27ba173bc9fc3526d52" title="Adds IN condition to the query WHERE part  $q-&amp;gt;whereIn(&amp;#39;u.id&amp;#39;, array(10...">andWhereIn</a>($expr, $params, <span class="keyword">true</span>);
<a name="l01463"></a>01463     }
<a name="l01464"></a>01464 
<a name="l01472"></a><a class="code" href="classDoctrine__Query__Abstract.html#a448626516a003ee707b1af64c8310173">01472</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a448626516a003ee707b1af64c8310173" title="Adds NOT IN condition to the query WHERE part.">orWhereNotIn</a>($expr, $params = array())
<a name="l01473"></a>01473     {
<a name="l01474"></a>01474         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a21e56f99b9cfdfcc0aef9d4d869400b3" title="Adds IN condition to the query WHERE part, appending it with an OR operator.">orWhereIn</a>($expr, $params, <span class="keyword">true</span>);
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476 
<a name="l01486"></a><a class="code" href="classDoctrine__Query__Abstract.html#a6c3daa64c81e20dced6f173dc44adbca">01486</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a6c3daa64c81e20dced6f173dc44adbca" title="Adds fields to the GROUP BY part of the query.">addGroupBy</a>($groupby)
<a name="l01487"></a>01487     {
<a name="l01488"></a>01488         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;groupby&#39;</span>, $groupby, <span class="keyword">true</span>);
<a name="l01489"></a>01489     }
<a name="l01490"></a>01490 
<a name="l01504"></a><a class="code" href="classDoctrine__Query__Abstract.html#a6d677c065551b050f315546b571c1337">01504</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a6d677c065551b050f315546b571c1337" title="Adds conditions to the HAVING part of the query.">addHaving</a>($having, $params = array())
<a name="l01505"></a>01505     {
<a name="l01506"></a>01506         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01507"></a>01507             $this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>] = array_merge($this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>], $params);
<a name="l01508"></a>01508         } <span class="keywordflow">else</span> {
<a name="l01509"></a>01509             $this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>][] = $params;
<a name="l01510"></a>01510         }
<a name="l01511"></a>01511         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;having&#39;</span>, $having, <span class="keyword">true</span>);
<a name="l01512"></a>01512     }
<a name="l01513"></a>01513 
<a name="l01521"></a><a class="code" href="classDoctrine__Query__Abstract.html#a4770810578d2270e0173a65aa018f7f9">01521</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a4770810578d2270e0173a65aa018f7f9" title="addOrderBy adds fields to the ORDER BY part of the query">addOrderBy</a>($orderby)
<a name="l01522"></a>01522     {
<a name="l01523"></a>01523         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;orderby&#39;</span>, $orderby, <span class="keyword">true</span>);
<a name="l01524"></a>01524     }
<a name="l01525"></a>01525 
<a name="l01533"></a><a class="code" href="classDoctrine__Query__Abstract.html#aeecdb46b8947b9c8b20fbaa31a74074e">01533</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aeecdb46b8947b9c8b20fbaa31a74074e" title="select sets the SELECT part of the query">select</a>($select = null)
<a name="l01534"></a>01534     {
<a name="l01535"></a>01535         $this-&gt;_type = self::SELECT;
<a name="l01536"></a>01536         <span class="keywordflow">if</span> ($select) {
<a name="l01537"></a>01537             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;select&#39;</span>, $select);
<a name="l01538"></a>01538         } <span class="keywordflow">else</span> {
<a name="l01539"></a>01539             <span class="keywordflow">return</span> $this;
<a name="l01540"></a>01540         }
<a name="l01541"></a>01541     }
<a name="l01542"></a>01542 
<a name="l01553"></a><a class="code" href="classDoctrine__Query__Abstract.html#a3a7f528428588daff62ef1bf174cc4e2">01553</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a3a7f528428588daff62ef1bf174cc4e2" title="distinct Makes the query SELECT DISTINCT.">distinct</a>($flag = <span class="keyword">true</span>)
<a name="l01554"></a>01554     {
<a name="l01555"></a>01555         $this-&gt;_sqlParts[<span class="stringliteral">&#39;distinct&#39;</span>] = (bool) $flag;
<a name="l01556"></a>01556         <span class="keywordflow">return</span> $this;
<a name="l01557"></a>01557     }
<a name="l01558"></a>01558 
<a name="l01566"></a><a class="code" href="classDoctrine__Query__Abstract.html#a4c43d107324607c063031d2f678a458f">01566</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a4c43d107324607c063031d2f678a458f" title="forUpdate Makes the query SELECT FOR UPDATE.">forUpdate</a>($flag = <span class="keyword">true</span>)
<a name="l01567"></a>01567     {
<a name="l01568"></a>01568         $this-&gt;_sqlParts[<span class="stringliteral">&#39;forUpdate&#39;</span>] = (bool) $flag;
<a name="l01569"></a>01569         <span class="keywordflow">return</span> $this;
<a name="l01570"></a>01570     }
<a name="l01571"></a>01571 
<a name="l01578"></a><a class="code" href="classDoctrine__Query__Abstract.html#a565f41967e7ced17fab5b7cdfb52f6c4">01578</a>     <span class="keyword">public</span> function <span class="keyword">delete</span>($from = null)
<a name="l01579"></a>01579     {
<a name="l01580"></a>01580         $this-&gt;_type = self::DELETE;
<a name="l01581"></a>01581         <span class="keywordflow">if</span> ($from != null) {
<a name="l01582"></a>01582             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;from&#39;</span>, $from);
<a name="l01583"></a>01583         }
<a name="l01584"></a>01584         <span class="keywordflow">return</span> $this;
<a name="l01585"></a>01585     }
<a name="l01586"></a>01586 
<a name="l01594"></a><a class="code" href="classDoctrine__Query__Abstract.html#a8080819912d2a116b78407a9e6233e03">01594</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a8080819912d2a116b78407a9e6233e03" title="update sets the UPDATE part of the query">update</a>($from = null)
<a name="l01595"></a>01595     {
<a name="l01596"></a>01596         $this-&gt;_type = self::UPDATE;
<a name="l01597"></a>01597         <span class="keywordflow">if</span> ($from != null) {
<a name="l01598"></a>01598             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;from&#39;</span>, $from);
<a name="l01599"></a>01599         }
<a name="l01600"></a>01600         <span class="keywordflow">return</span> $this;
<a name="l01601"></a>01601     }
<a name="l01602"></a>01602 
<a name="l01610"></a><a class="code" href="classDoctrine__Query__Abstract.html#a19a16d71a71205501346bdb8eec4fa91">01610</a>     <span class="keyword">public</span> function <span class="keyword">set</span>($key, $value = null, $params = null)
<a name="l01611"></a>01611     {
<a name="l01612"></a>01612         <span class="keywordflow">if</span> (is_array($key)) {
<a name="l01613"></a>01613             <span class="keywordflow">foreach</span> ($key as $k =&gt; $v) {
<a name="l01614"></a>01614                 $this-&gt;<span class="keyword">set</span>($k, <span class="charliteral">&#39;?&#39;</span>, array($v));
<a name="l01615"></a>01615             }
<a name="l01616"></a>01616             <span class="keywordflow">return</span> $this;
<a name="l01617"></a>01617         } <span class="keywordflow">else</span> {
<a name="l01618"></a>01618             <span class="keywordflow">if</span> ($params !== null) {
<a name="l01619"></a>01619                 <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01620"></a>01620                     $this-&gt;_params[<span class="stringliteral">&#39;set&#39;</span>] = array_merge($this-&gt;_params[<span class="stringliteral">&#39;set&#39;</span>], $params);
<a name="l01621"></a>01621                 } <span class="keywordflow">else</span> {
<a name="l01622"></a>01622                     $this-&gt;_params[<span class="stringliteral">&#39;set&#39;</span>][] = $params;
<a name="l01623"></a>01623                 }
<a name="l01624"></a>01624             }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;set&#39;</span>, $key . <span class="stringliteral">&#39; = &#39;</span> . $value, <span class="keyword">true</span>);
<a name="l01627"></a>01627         }
<a name="l01628"></a>01628     }
<a name="l01629"></a>01629 
<a name="l01640"></a><a class="code" href="classDoctrine__Query__Abstract.html#ac9dcb8a571dabb10de63f56598814088">01640</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ac9dcb8a571dabb10de63f56598814088" title="from sets the FROM part of the query  $q-&amp;gt;from(&amp;#39;User u&amp;#39;); ">from</a>($from)
<a name="l01641"></a>01641     {
<a name="l01642"></a>01642         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;from&#39;</span>, $from);
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644 
<a name="l01652"></a><a class="code" href="classDoctrine__Query__Abstract.html#a55b0b7586c1522d8b60dbfcadf83ad6d">01652</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a55b0b7586c1522d8b60dbfcadf83ad6d" title="innerJoin appends an INNER JOIN to the FROM part of the query">innerJoin</a>($join, $params = array())
<a name="l01653"></a>01653     {
<a name="l01654"></a>01654         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01655"></a>01655             $this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>] = array_merge($this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>], $params);
<a name="l01656"></a>01656         } <span class="keywordflow">else</span> {
<a name="l01657"></a>01657             $this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>][] = $params;
<a name="l01658"></a>01658         }
<a name="l01659"></a>01659 
<a name="l01660"></a>01660         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;from&#39;</span>, <span class="stringliteral">&#39;INNER JOIN &#39;</span> . $join, <span class="keyword">true</span>);
<a name="l01661"></a>01661     }
<a name="l01662"></a>01662 
<a name="l01670"></a><a class="code" href="classDoctrine__Query__Abstract.html#a18a4c4b011319eccb7d4b00b492cd222">01670</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a18a4c4b011319eccb7d4b00b492cd222" title="leftJoin appends a LEFT JOIN to the FROM part of the query">leftJoin</a>($join, $params = array())
<a name="l01671"></a>01671     {
<a name="l01672"></a>01672         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01673"></a>01673             $this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>] = array_merge($this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>], $params);
<a name="l01674"></a>01674         } <span class="keywordflow">else</span> {
<a name="l01675"></a>01675             $this-&gt;_params[<span class="stringliteral">&#39;join&#39;</span>][] = $params;
<a name="l01676"></a>01676         }
<a name="l01677"></a>01677 
<a name="l01678"></a>01678         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;from&#39;</span>, <span class="stringliteral">&#39;LEFT JOIN &#39;</span> . $join, <span class="keyword">true</span>);
<a name="l01679"></a>01679     }
<a name="l01680"></a>01680 
<a name="l01688"></a><a class="code" href="classDoctrine__Query__Abstract.html#a28464f2e8a8c823677bcb82fd03d7fc1">01688</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a28464f2e8a8c823677bcb82fd03d7fc1" title="groupBy sets the GROUP BY part of the query">groupBy</a>($groupby)
<a name="l01689"></a>01689     {
<a name="l01690"></a>01690         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;groupby&#39;</span>, $groupby);
<a name="l01691"></a>01691     }
<a name="l01692"></a>01692 
<a name="l01701"></a><a class="code" href="classDoctrine__Query__Abstract.html#abf61aa22e7c4bacb355f7055ac41ab2c">01701</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#abf61aa22e7c4bacb355f7055ac41ab2c" title="where sets the WHERE part of the query">where</a>($where, $params = array())
<a name="l01702"></a>01702     {
<a name="l01703"></a>01703         $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>] = array();
<a name="l01704"></a>01704 
<a name="l01705"></a>01705         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01706"></a>01706             $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>] = $params;
<a name="l01707"></a>01707         } <span class="keywordflow">else</span> {
<a name="l01708"></a>01708             $this-&gt;_params[<span class="stringliteral">&#39;where&#39;</span>][] = $params;
<a name="l01709"></a>01709         }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;where&#39;</span>, $where);
<a name="l01712"></a>01712     }
<a name="l01713"></a>01713 
<a name="l01722"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0b336d3f2d600bb55ef0c3f4b11f58f2">01722</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a0b336d3f2d600bb55ef0c3f4b11f58f2" title="having sets the HAVING part of the query">having</a>($having, $params = array())
<a name="l01723"></a>01723     {
<a name="l01724"></a>01724         $this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>] = array();
<a name="l01725"></a>01725         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l01726"></a>01726             $this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>] = $params;
<a name="l01727"></a>01727         } <span class="keywordflow">else</span> {
<a name="l01728"></a>01728             $this-&gt;_params[<span class="stringliteral">&#39;having&#39;</span>][] = $params;
<a name="l01729"></a>01729         }
<a name="l01730"></a>01730 
<a name="l01731"></a>01731         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;having&#39;</span>, $having);
<a name="l01732"></a>01732     }
<a name="l01733"></a>01733 
<a name="l01744"></a><a class="code" href="classDoctrine__Query__Abstract.html#a43a6d914ef0b26bd9c64fc7fd9adcde5">01744</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a43a6d914ef0b26bd9c64fc7fd9adcde5" title="Sets the ORDER BY part of the query.">orderBy</a>($orderby)
<a name="l01745"></a>01745     {
<a name="l01746"></a>01746         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;orderby&#39;</span>, $orderby);
<a name="l01747"></a>01747     }
<a name="l01748"></a>01748 
<a name="l01756"></a><a class="code" href="classDoctrine__Query__Abstract.html#a6cc3d70d518be09c61632c259321575f">01756</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a6cc3d70d518be09c61632c259321575f" title="limit sets the Query query limit">limit</a>($limit)
<a name="l01757"></a>01757     {
<a name="l01758"></a>01758         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;limit&#39;</span>, $limit);
<a name="l01759"></a>01759     }
<a name="l01760"></a>01760 
<a name="l01768"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0a15eddc522a0719bd92367a64993055">01768</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a0a15eddc522a0719bd92367a64993055" title="offset sets the Query query offset">offset</a>($offset)
<a name="l01769"></a>01769     {
<a name="l01770"></a>01770         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>(<span class="stringliteral">&#39;offset&#39;</span>, $offset);
<a name="l01771"></a>01771     }
<a name="l01772"></a>01772 
<a name="l01778"></a><a class="code" href="classDoctrine__Query__Abstract.html#a42ff3ae8c238e594f42b6f5a1b99907a">01778</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a42ff3ae8c238e594f42b6f5a1b99907a" title="Resets all the sql parts.">clear</a>()
<a name="l01779"></a>01779     {
<a name="l01780"></a>01780         $this-&gt;_sqlParts = array(
<a name="l01781"></a>01781                     <span class="stringliteral">&#39;select&#39;</span>    =&gt; array(),
<a name="l01782"></a>01782                     <span class="stringliteral">&#39;distinct&#39;</span>  =&gt; <span class="keyword">false</span>,
<a name="l01783"></a>01783                     <span class="stringliteral">&#39;forUpdate&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l01784"></a>01784                     <span class="stringliteral">&#39;from&#39;</span>      =&gt; array(),
<a name="l01785"></a>01785                     <span class="stringliteral">&#39;set&#39;</span>       =&gt; array(),
<a name="l01786"></a>01786                     <span class="stringliteral">&#39;join&#39;</span>      =&gt; array(),
<a name="l01787"></a>01787                     <span class="stringliteral">&#39;where&#39;</span>     =&gt; array(),
<a name="l01788"></a>01788                     <span class="stringliteral">&#39;groupby&#39;</span>   =&gt; array(),
<a name="l01789"></a>01789                     <span class="stringliteral">&#39;having&#39;</span>    =&gt; array(),
<a name="l01790"></a>01790                     <span class="stringliteral">&#39;orderby&#39;</span>   =&gt; array(),
<a name="l01791"></a>01791                     <span class="stringliteral">&#39;limit&#39;</span>     =&gt; <span class="keyword">false</span>,
<a name="l01792"></a>01792                     <span class="stringliteral">&#39;offset&#39;</span>    =&gt; <span class="keyword">false</span>,
<a name="l01793"></a>01793                     );
<a name="l01794"></a>01794     }
<a name="l01795"></a>01795 
<a name="l01796"></a>01796     <span class="keyword">public</span> function setHydrationMode($hydrationMode)
<a name="l01797"></a>01797     {
<a name="l01798"></a>01798         $this-&gt;_hydrator-&gt;setHydrationMode($hydrationMode);
<a name="l01799"></a>01799         <span class="keywordflow">return</span> $this;
<a name="l01800"></a>01800     }
<a name="l01801"></a>01801 
<a name="l01805"></a><a class="code" href="classDoctrine__Query__Abstract.html#aa8573d794b04605a10fd891d21ad8cfc">01805</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aa8573d794b04605a10fd891d21ad8cfc" title="Gets the components of this query.">getQueryComponents</a>()
<a name="l01806"></a>01806     {
<a name="l01807"></a>01807         <span class="keywordflow">return</span> $this-&gt;_queryComponents;
<a name="l01808"></a>01808     }
<a name="l01809"></a>01809 
<a name="l01815"></a><a class="code" href="classDoctrine__Query__Abstract.html#a77b5e56d98471ea76ec1cb4494a0c6c0">01815</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a77b5e56d98471ea76ec1cb4494a0c6c0" title="Return the SQL parts.">getSqlParts</a>()
<a name="l01816"></a>01816     {
<a name="l01817"></a>01817         <span class="keywordflow">return</span> $this-&gt;_sqlParts;
<a name="l01818"></a>01818     }
<a name="l01819"></a>01819 
<a name="l01834"></a><a class="code" href="classDoctrine__Query__Abstract.html#a11c4680cf7b99465280b132cdb2b20b4">01834</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a11c4680cf7b99465280b132cdb2b20b4" title="getType">getType</a>()
<a name="l01835"></a>01835     {
<a name="l01836"></a>01836         <span class="keywordflow">return</span> $this-&gt;_type;
<a name="l01837"></a>01837     }
<a name="l01838"></a>01838 
<a name="l01847"></a><a class="code" href="classDoctrine__Query__Abstract.html#adcd50e51b2f0d687c3ea4093db3dfec0">01847</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#adcd50e51b2f0d687c3ea4093db3dfec0" title="useResultCache">useResultCache</a>($driver = <span class="keyword">true</span>, $timeToLive = null, $resultCacheHash = null)
<a name="l01848"></a>01848     {
<a name="l01849"></a>01849         <span class="keywordflow">if</span> ($driver !== null &amp;&amp; $driver !== <span class="keyword">true</span> &amp;&amp; ! ($driver instanceOf <a class="code" href="interfaceDoctrine__Cache__Interface.html">Doctrine_Cache_Interface</a>)) {
<a name="l01850"></a>01850             $msg = <span class="stringliteral">&#39;First argument should be instance of Doctrine_Cache_Interface or null.&#39;</span>;
<a name="l01851"></a>01851             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>($msg);
<a name="l01852"></a>01852         }
<a name="l01853"></a>01853         $this-&gt;_resultCache = $driver;
<a name="l01854"></a>01854         $this-&gt;_resultCacheHash = $resultCacheHash;
<a name="l01855"></a>01855 
<a name="l01856"></a>01856         <span class="keywordflow">if</span> ($timeToLive !== null) {
<a name="l01857"></a>01857             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a9001f514c96e7f1864172c289547226c" title="setResultCacheLifeSpan">setResultCacheLifeSpan</a>($timeToLive);
<a name="l01858"></a>01858         }
<a name="l01859"></a>01859         <span class="keywordflow">return</span> $this;
<a name="l01860"></a>01860     }
<a name="l01861"></a>01861 
<a name="l01868"></a><a class="code" href="classDoctrine__Query__Abstract.html#a8599b0d2c3c1c2b7134e586df5757281">01868</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a8599b0d2c3c1c2b7134e586df5757281" title="Set the result cache hash to be used for storing the results in the cache driver...">setResultCacheHash</a>($resultCacheHash)
<a name="l01869"></a>01869     {
<a name="l01870"></a>01870         $this-&gt;_resultCacheHash = $resultCacheHash;
<a name="l01871"></a>01871 
<a name="l01872"></a>01872         <span class="keywordflow">return</span> $this;
<a name="l01873"></a>01873     }
<a name="l01874"></a>01874 
<a name="l01880"></a><a class="code" href="classDoctrine__Query__Abstract.html#a6efbb671ea93f5650977e3f3dc8035e1">01880</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a6efbb671ea93f5650977e3f3dc8035e1" title="Clear the result cache entry for this query.">clearResultCache</a>()
<a name="l01881"></a>01881     {
<a name="l01882"></a>01882         $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#af6b80376c526255744b0da891bf9a0b8" title="getResultCacheDriver returns the cache driver used for caching result sets">getResultCacheDriver</a>()
<a name="l01883"></a>01883             -&gt;delete($this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a7bce266181f43183b4eb3a99f3cfde3b" title="Get the result cache hash/key.">getResultCacheHash</a>());
<a name="l01884"></a>01884 
<a name="l01885"></a>01885         <span class="keywordflow">return</span> $this;
<a name="l01886"></a>01886     }
<a name="l01887"></a>01887 
<a name="l01895"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0ef267754385e282aabc06800b0700b8">01895</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a0ef267754385e282aabc06800b0700b8" title="useQueryCache">useQueryCache</a>($driver = <span class="keyword">true</span>, $timeToLive = null)
<a name="l01896"></a>01896     {
<a name="l01897"></a>01897         <span class="keywordflow">if</span> ($driver !== null &amp;&amp; $driver !== <span class="keyword">true</span> &amp;&amp; $driver !== <span class="keyword">false</span> &amp;&amp; ! ($driver instanceOf <a class="code" href="interfaceDoctrine__Cache__Interface.html">Doctrine_Cache_Interface</a>)) {
<a name="l01898"></a>01898             $msg = <span class="stringliteral">&#39;First argument should be instance of Doctrine_Cache_Interface or null.&#39;</span>;
<a name="l01899"></a>01899             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>($msg);
<a name="l01900"></a>01900         }
<a name="l01901"></a>01901         $this-&gt;_queryCache = $driver;
<a name="l01902"></a>01902 
<a name="l01903"></a>01903         <span class="keywordflow">if</span> ($timeToLive !== null) {
<a name="l01904"></a>01904             $this-&gt;<a class="code" href="classDoctrine__Query__Abstract.html#a584254821183ee5fca33019838637ad4" title="setQueryCacheLifeSpan">setQueryCacheLifeSpan</a>($timeToLive);
<a name="l01905"></a>01905         }
<a name="l01906"></a>01906         <span class="keywordflow">return</span> $this;
<a name="l01907"></a>01907     }
<a name="l01908"></a>01908 
<a name="l01915"></a><a class="code" href="classDoctrine__Query__Abstract.html#a8d326775056aa3dead1bb44860dc32a6">01915</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a8d326775056aa3dead1bb44860dc32a6" title="expireCache">expireResultCache</a>($expire = <span class="keyword">true</span>)
<a name="l01916"></a>01916     {
<a name="l01917"></a>01917         $this-&gt;_expireResultCache = $expire;
<a name="l01918"></a>01918         <span class="keywordflow">return</span> $this;
<a name="l01919"></a>01919     }
<a name="l01920"></a>01920 
<a name="l01927"></a><a class="code" href="classDoctrine__Query__Abstract.html#a8fff8a33088d724767dd215f2f3b5d46">01927</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a8fff8a33088d724767dd215f2f3b5d46" title="expireQueryCache">expireQueryCache</a>($expire = <span class="keyword">true</span>)
<a name="l01928"></a>01928     {
<a name="l01929"></a>01929         $this-&gt;_expireQueryCache = $expire;
<a name="l01930"></a>01930         <span class="keywordflow">return</span> $this;
<a name="l01931"></a>01931     }
<a name="l01932"></a>01932 
<a name="l01939"></a><a class="code" href="classDoctrine__Query__Abstract.html#a9001f514c96e7f1864172c289547226c">01939</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a9001f514c96e7f1864172c289547226c" title="setResultCacheLifeSpan">setResultCacheLifeSpan</a>($timeToLive)
<a name="l01940"></a>01940     {
<a name="l01941"></a>01941         <span class="keywordflow">if</span> ($timeToLive !== null) {
<a name="l01942"></a>01942             $timeToLive = (int) $timeToLive;
<a name="l01943"></a>01943         }
<a name="l01944"></a>01944         $this-&gt;_resultCacheTTL = $timeToLive;
<a name="l01945"></a>01945 
<a name="l01946"></a>01946         <span class="keywordflow">return</span> $this;
<a name="l01947"></a>01947     }
<a name="l01948"></a>01948 
<a name="l01954"></a><a class="code" href="classDoctrine__Query__Abstract.html#a40a132109b30fe2196e3e077945d6016">01954</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a40a132109b30fe2196e3e077945d6016" title="Gets the life span of the result cache in seconds.">getResultCacheLifeSpan</a>()
<a name="l01955"></a>01955     {
<a name="l01956"></a>01956         <span class="keywordflow">return</span> $this-&gt;_resultCacheTTL;
<a name="l01957"></a>01957     }
<a name="l01958"></a>01958 
<a name="l01965"></a><a class="code" href="classDoctrine__Query__Abstract.html#a584254821183ee5fca33019838637ad4">01965</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a584254821183ee5fca33019838637ad4" title="setQueryCacheLifeSpan">setQueryCacheLifeSpan</a>($timeToLive)
<a name="l01966"></a>01966     {
<a name="l01967"></a>01967         <span class="keywordflow">if</span> ($timeToLive !== null) {
<a name="l01968"></a>01968             $timeToLive = (int) $timeToLive;
<a name="l01969"></a>01969         }
<a name="l01970"></a>01970         $this-&gt;_queryCacheTTL = $timeToLive;
<a name="l01971"></a>01971 
<a name="l01972"></a>01972         <span class="keywordflow">return</span> $this;
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974 
<a name="l01980"></a><a class="code" href="classDoctrine__Query__Abstract.html#aa31586e21567ea6c279340baae31f461">01980</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#aa31586e21567ea6c279340baae31f461" title="Gets the life span of the query cache the Query object is using.">getQueryCacheLifeSpan</a>()
<a name="l01981"></a>01981     {
<a name="l01982"></a>01982         <span class="keywordflow">return</span> $this-&gt;_queryCacheTTL;
<a name="l01983"></a>01983     }
<a name="l01984"></a>01984 
<a name="l01991"></a><a class="code" href="classDoctrine__Query__Abstract.html#af6b80376c526255744b0da891bf9a0b8">01991</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#af6b80376c526255744b0da891bf9a0b8" title="getResultCacheDriver returns the cache driver used for caching result sets">getResultCacheDriver</a>()
<a name="l01992"></a>01992     {
<a name="l01993"></a>01993         <span class="keywordflow">if</span> ($this-&gt;_resultCache instanceof <a class="code" href="interfaceDoctrine__Cache__Interface.html">Doctrine_Cache_Interface</a>) {
<a name="l01994"></a>01994             <span class="keywordflow">return</span> $this-&gt;_resultCache;
<a name="l01995"></a>01995         } <span class="keywordflow">else</span> {
<a name="l01996"></a>01996             <span class="keywordflow">return</span> $this-&gt;_conn-&gt;getResultCacheDriver();
<a name="l01997"></a>01997         }
<a name="l01998"></a>01998     }
<a name="l01999"></a>01999 
<a name="l02006"></a><a class="code" href="classDoctrine__Query__Abstract.html#a08a56aa1c837ce2bf2900de62635778d">02006</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#a08a56aa1c837ce2bf2900de62635778d" title="getQueryCacheDriver returns the cache driver used for caching queries">getQueryCacheDriver</a>()
<a name="l02007"></a>02007     {
<a name="l02008"></a>02008         <span class="keywordflow">if</span> ($this-&gt;_queryCache instanceof <a class="code" href="interfaceDoctrine__Cache__Interface.html">Doctrine_Cache_Interface</a>) {
<a name="l02009"></a>02009             <span class="keywordflow">return</span> $this-&gt;_queryCache;
<a name="l02010"></a>02010         } <span class="keywordflow">else</span> {
<a name="l02011"></a>02011             <span class="keywordflow">return</span> $this-&gt;_conn-&gt;getQueryCacheDriver();
<a name="l02012"></a>02012         }
<a name="l02013"></a>02013     }
<a name="l02014"></a>02014 
<a name="l02020"></a><a class="code" href="classDoctrine__Query__Abstract.html#ab08c6b21e634cdbca5f45f7e81a99231">02020</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ab08c6b21e634cdbca5f45f7e81a99231" title="getConnection">getConnection</a>()
<a name="l02021"></a>02021     {
<a name="l02022"></a>02022         <span class="keywordflow">return</span> $this-&gt;_conn;
<a name="l02023"></a>02023     }
<a name="l02024"></a>02024 
<a name="l02031"></a><a class="code" href="classDoctrine__Query__Abstract.html#ad6f3f436024b8a037a1214f17afb4b08">02031</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ad6f3f436024b8a037a1214f17afb4b08" title="Checks if there&amp;#39;s at least one DQL part defined to the internal parts collection...">_hasDqlQueryPart</a>($queryPartName)
<a name="l02032"></a>02032     {
<a name="l02033"></a>02033         <span class="keywordflow">return</span> count($this-&gt;_dqlParts[$queryPartName]) &gt; 0;
<a name="l02034"></a>02034     }
<a name="l02035"></a>02035 
<a name="l02050"></a><a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6">02050</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Query__Abstract.html#ae3565d86e92f59a3ed473d04860ba7f6" title="Adds a DQL part to the internal parts collection.">_addDqlQueryPart</a>($queryPartName, $queryPart, $append = <span class="keyword">false</span>)
<a name="l02051"></a>02051     {
<a name="l02052"></a>02052         <span class="comment">// We should prevent nullable query parts</span>
<a name="l02053"></a>02053         <span class="keywordflow">if</span> ($queryPart === null) {
<a name="l02054"></a>02054             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Query__Exception.html">Doctrine_Query_Exception</a>(<span class="stringliteral">&#39;Cannot define NULL as part of query when defining \&#39;&#39;</span> . $queryPartName . <span class="charliteral">&#39;\&#39;</span>.<span class="stringliteral">&#39;);</span>
<a name="l02055"></a>02055 <span class="stringliteral">        }</span>
<a name="l02056"></a>02056 <span class="stringliteral"></span>
<a name="l02057"></a>02057 <span class="stringliteral">        if ($append) {</span>
<a name="l02058"></a>02058 <span class="stringliteral">            $this-&gt;_dqlParts[$queryPartName][] = $queryPart;</span>
<a name="l02059"></a>02059 <span class="stringliteral">        } else {</span>
<a name="l02060"></a>02060 <span class="stringliteral">            $this-&gt;_dqlParts[$queryPartName] = array($queryPart);</span>
<a name="l02061"></a>02061 <span class="stringliteral">        }</span>
<a name="l02062"></a>02062 <span class="stringliteral"></span>
<a name="l02063"></a>02063 <span class="stringliteral">        $this-&gt;_state = Doctrine_Query::STATE_DIRTY;</span>
<a name="l02064"></a>02064 <span class="stringliteral">        return $this;</span>
<a name="l02065"></a>02065 <span class="stringliteral">    }</span>
<a name="l02066"></a>02066 <span class="stringliteral"></span>
<a name="l02077"></a><a class="code" href="classDoctrine__Query__Abstract.html#a4f4206a55ec5ed1de682f10f2d14bf40">02077</a> <span class="stringliteral">    protected function _processDqlQueryPart($queryPartName, $queryParts)</span>
<a name="l02078"></a>02078 <span class="stringliteral">    {</span>
<a name="l02079"></a>02079 <span class="stringliteral">        $this-&gt;removeSqlQueryPart($queryPartName);</span>
<a name="l02080"></a>02080 <span class="stringliteral"></span>
<a name="l02081"></a>02081 <span class="stringliteral">        if (is_array($queryParts) &amp;&amp; ! empty($queryParts)) {</span>
<a name="l02082"></a>02082 <span class="stringliteral">            foreach ($queryParts as $queryPart) {</span>
<a name="l02083"></a>02083 <span class="stringliteral">                $parser = $this-&gt;_getParser($queryPartName);</span>
<a name="l02084"></a>02084 <span class="stringliteral">                $sql = $parser-&gt;parse($queryPart);</span>
<a name="l02085"></a>02085 <span class="stringliteral">                if (isset($sql)) {</span>
<a name="l02086"></a>02086 <span class="stringliteral">                    if ($queryPartName == &#39;</span><a class="code" href="classDoctrine__Query__Abstract.html#a6cc3d70d518be09c61632c259321575f" title="limit sets the Query query limit">limit</a><span class="stringliteral">&#39; || $queryPartName == &#39;</span><a class="code" href="classDoctrine__Query__Abstract.html#a0a15eddc522a0719bd92367a64993055" title="offset sets the Query query offset">offset</a><span class="stringliteral">&#39;) {</span>
<a name="l02087"></a>02087 <span class="stringliteral">                        $this-&gt;setSqlQueryPart($queryPartName, $sql);</span>
<a name="l02088"></a>02088 <span class="stringliteral">                    } else {</span>
<a name="l02089"></a>02089 <span class="stringliteral">                        $this-&gt;addSqlQueryPart($queryPartName, $sql);</span>
<a name="l02090"></a>02090 <span class="stringliteral">                    }</span>
<a name="l02091"></a>02091 <span class="stringliteral">                }</span>
<a name="l02092"></a>02092 <span class="stringliteral">            }</span>
<a name="l02093"></a>02093 <span class="stringliteral">        }</span>
<a name="l02094"></a>02094 <span class="stringliteral">    }</span>
<a name="l02095"></a>02095 <span class="stringliteral"></span>
<a name="l02104"></a><a class="code" href="classDoctrine__Query__Abstract.html#ac88875800d573c0c14e41cdbe85b75d2">02104</a> <span class="stringliteral">    protected function _getParser($name)</span>
<a name="l02105"></a>02105 <span class="stringliteral">    {</span>
<a name="l02106"></a>02106 <span class="stringliteral">        if ( ! isset($this-&gt;_parsers[$name])) {</span>
<a name="l02107"></a>02107 <span class="stringliteral">            $class = &#39;</span>Doctrine_Query_<span class="stringliteral">&#39; . ucwords(strtolower($name));</span>
<a name="l02108"></a>02108 <span class="stringliteral"></span>
<a name="l02109"></a>02109 <span class="stringliteral">            Doctrine_Core::autoload($class);</span>
<a name="l02110"></a>02110 <span class="stringliteral"></span>
<a name="l02111"></a>02111 <span class="stringliteral">            if ( ! class_exists($class)) {</span>
<a name="l02112"></a>02112 <span class="stringliteral">                throw new Doctrine_Query_Exception(&#39;</span>Unknown parser <span class="stringliteral">&#39; . $name);</span>
<a name="l02113"></a>02113 <span class="stringliteral">            }</span>
<a name="l02114"></a>02114 <span class="stringliteral"></span>
<a name="l02115"></a>02115 <span class="stringliteral">            $this-&gt;_parsers[$name] = new $class($this, $this-&gt;_tokenizer);</span>
<a name="l02116"></a>02116 <span class="stringliteral">        }</span>
<a name="l02117"></a>02117 <span class="stringliteral"></span>
<a name="l02118"></a>02118 <span class="stringliteral">        return $this-&gt;_parsers[$name];</span>
<a name="l02119"></a>02119 <span class="stringliteral">    }</span>
<a name="l02120"></a>02120 <span class="stringliteral"></span>
<a name="l02128"></a>02128 <span class="stringliteral">    abstract public function getSqlQuery($params = array());</span>
<a name="l02129"></a>02129 <span class="stringliteral"></span>
<a name="l02137"></a>02137 <span class="stringliteral">    abstract public function parseDqlQuery($query);</span>
<a name="l02138"></a>02138 <span class="stringliteral"></span>
<a name="l02146"></a><a class="code" href="classDoctrine__Query__Abstract.html#a0417c8991bad1ceb1451c5fdf8f9153c">02146</a> <span class="stringliteral">    public function __toString()</span>
<a name="l02147"></a>02147 <span class="stringliteral">    {</span>
<a name="l02148"></a>02148 <span class="stringliteral">        return $this-&gt;getDql();</span>
<a name="l02149"></a>02149 <span class="stringliteral">    }</span>
<a name="l02150"></a>02150 <span class="stringliteral"></span>
<a name="l02156"></a><a class="code" href="classDoctrine__Query__Abstract.html#ae06367e3b75f75c7128ca81d522bad24">02156</a> <span class="stringliteral">    public function getDisableLimitSubquery()</span>
<a name="l02157"></a>02157 <span class="stringliteral">    {</span>
<a name="l02158"></a>02158 <span class="stringliteral">        return $this-&gt;disableLimitSubquery;</span>
<a name="l02159"></a>02159 <span class="stringliteral">    }</span>
<a name="l02160"></a>02160 <span class="stringliteral"></span>
<a name="l02167"></a><a class="code" href="classDoctrine__Query__Abstract.html#a08bdb2e8cb4e2e38d188a5695985421e">02167</a> <span class="stringliteral">    public function setDisableLimitSubquery($disableLimitSubquery)</span>
<a name="l02168"></a>02168 <span class="stringliteral">    {</span>
<a name="l02169"></a>02169 <span class="stringliteral">        $this-&gt;disableLimitSubquery = $disableLimitSubquery;</span>
<a name="l02170"></a>02170 <span class="stringliteral">    }</span>
<a name="l02171"></a>02171 <span class="stringliteral">}</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
