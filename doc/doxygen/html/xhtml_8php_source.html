<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: web/wiki/inc/parser/xhtml.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>web/wiki/inc/parser/xhtml.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00008"></a>00008 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;DOKU_INC&#39;</span>)) die(<span class="stringliteral">&#39;meh.&#39;</span>);
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;DOKU_LF&#39;</span>) ) {
<a name="l00011"></a>00011     <span class="comment">// Some whitespace to help View &gt; Source</span>
<a name="l00012"></a>00012     define (<span class="stringliteral">&#39;DOKU_LF&#39;</span>,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00013"></a>00013 }
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;DOKU_TAB&#39;</span>) ) {
<a name="l00016"></a>00016     <span class="comment">// Some whitespace to help View &gt; Source</span>
<a name="l00017"></a>00017     define (<span class="stringliteral">&#39;DOKU_TAB&#39;</span>,<span class="stringliteral">&quot;\t&quot;</span>);
<a name="l00018"></a>00018 }
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 require_once DOKU_INC . <span class="stringliteral">&#39;inc/parser/renderer.php&#39;</span>;
<a name="l00021"></a>00021 require_once DOKU_INC . <span class="stringliteral">&#39;inc/html.php&#39;</span>;
<a name="l00022"></a>00022 
<a name="l00026"></a><a class="code" href="classDoku__Renderer__xhtml.html">00026</a> <span class="keyword">class </span><a class="code" href="classDoku__Renderer__xhtml.html" title="The Renderer.">Doku_Renderer_xhtml</a> <span class="keyword">extends</span> <a class="code" href="classDoku__Renderer.html" title="An empty renderer, produces no output.">Doku_Renderer</a> {
<a name="l00027"></a>00027 
<a name="l00028"></a>00028     <span class="comment">// @access public</span>
<a name="l00029"></a>00029     var $doc = <span class="stringliteral">&#39;&#39;</span>;        <span class="comment">// will contain the whole document</span>
<a name="l00030"></a>00030     var $toc = array();   <span class="comment">// will contain the Table of Contents</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032     <span class="keyword">private</span> $sectionedits = array(); <span class="comment">// A stack of section edit data</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034     var $headers = array();
<a name="l00035"></a>00035     var $footnotes = array();
<a name="l00036"></a>00036     var $lastlevel = 0;
<a name="l00037"></a>00037     var $node = array(0,0,0,0,0);
<a name="l00038"></a>00038     var $store = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040     var $_counter   = array(); <span class="comment">// used as global counter, introduced for table classes</span>
<a name="l00041"></a>00041     var $_codeblock = 0; <span class="comment">// counts the code and file blocks, used to provide download links</span>
<a name="l00042"></a>00042 
<a name="l00052"></a><a class="code" href="classDoku__Renderer__xhtml.html#a362f3c5a77b486cdcad740c3c82a326a">00052</a>     <span class="keyword">public</span> function <a class="code" href="classDoku__Renderer__xhtml.html#a362f3c5a77b486cdcad740c3c82a326a" title="Register a new edit section range.">startSectionEdit</a>($start, $type, $title = null) {
<a name="l00053"></a>00053         <span class="keyword">static</span> $lastsecid = 0;
<a name="l00054"></a>00054         $this-&gt;sectionedits[] = array(++$lastsecid, $start, $type, $title);
<a name="l00055"></a>00055         <span class="keywordflow">return</span> <span class="stringliteral">&#39;sectionedit&#39;</span> . $lastsecid;
<a name="l00056"></a>00056     }
<a name="l00057"></a>00057 
<a name="l00065"></a><a class="code" href="classDoku__Renderer__xhtml.html#aa6456812443ff0a4cd4552ab60483658">00065</a>     <span class="keyword">public</span> function <a class="code" href="classDoku__Renderer__xhtml.html#aa6456812443ff0a4cd4552ab60483658" title="Finish an edit section range.">finishSectionEdit</a>($end = null) {
<a name="l00066"></a>00066         list($id, $start, $type, $title) = array_pop($this-&gt;sectionedits);
<a name="l00067"></a>00067         <span class="keywordflow">if</span> (!is_null($end) &amp;&amp; $end &lt;= $start) {
<a name="l00068"></a>00068             <span class="keywordflow">return</span>;
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070         $this-&gt;doc .= <span class="stringliteral">&quot;&lt;!-- EDIT$id &quot;</span> . strtoupper($type) . <span class="charliteral">&#39; &#39;</span>;
<a name="l00071"></a>00071         <span class="keywordflow">if</span> (!is_null($title)) {
<a name="l00072"></a>00072             $this-&gt;doc .= <span class="charliteral">&#39;&quot;&#39;</span> . str_replace(<span class="charliteral">&#39;&quot;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $title) . <span class="stringliteral">&#39;&quot; &#39;</span>;
<a name="l00073"></a>00073         }
<a name="l00074"></a>00074         $this-&gt;doc .= <span class="stringliteral">&quot;[$start-&quot;</span> . (is_null($end) ? <span class="stringliteral">&#39;&#39;</span> : $end) . <span class="stringliteral">&#39;] --&gt;&#39;</span>;
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classDoku__Renderer__xhtml.html#a93c4ca3de450ad764d55a67523f26a6c">00077</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#a93c4ca3de450ad764d55a67523f26a6c" title="Returns the format produced by this renderer.">getFormat</a>(){
<a name="l00078"></a>00078         <span class="keywordflow">return</span> <span class="stringliteral">&#39;xhtml&#39;</span>;
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     function document_start() {
<a name="l00083"></a>00083         <span class="comment">//reset some internals</span>
<a name="l00084"></a>00084         $this-&gt;toc     = array();
<a name="l00085"></a>00085         $this-&gt;headers = array();
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     function document_end() {
<a name="l00089"></a>00089         <span class="comment">// Finish open section edits.</span>
<a name="l00090"></a>00090         <span class="keywordflow">while</span> (count($this-&gt;sectionedits) &gt; 0) {
<a name="l00091"></a>00091             <span class="keywordflow">if</span> ($this-&gt;sectionedits[count($this-&gt;sectionedits) - 1][1] &lt;= 1) {
<a name="l00092"></a>00092                 <span class="comment">// If there is only one section, do not write a section edit</span>
<a name="l00093"></a>00093                 <span class="comment">// marker.</span>
<a name="l00094"></a>00094                 array_pop($this-&gt;sectionedits);
<a name="l00095"></a>00095             } <span class="keywordflow">else</span> {
<a name="l00096"></a>00096                 $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#aa6456812443ff0a4cd4552ab60483658" title="Finish an edit section range.">finishSectionEdit</a>();
<a name="l00097"></a>00097             }
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         <span class="keywordflow">if</span> ( count ($this-&gt;footnotes) &gt; 0 ) {
<a name="l00101"></a>00101             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;div class=&quot;footnotes&quot;&gt;&#39;</span>.DOKU_LF;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103             $id = 0;
<a name="l00104"></a>00104             <span class="keywordflow">foreach</span> ( $this-&gt;footnotes as $footnote ) {
<a name="l00105"></a>00105                 $id++;   <span class="comment">// the number of the current footnote</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107                 <span class="comment">// check its not a placeholder that indicates actual footnote text is elsewhere</span>
<a name="l00108"></a>00108                 <span class="keywordflow">if</span> (substr($footnote, 0, 5) != <span class="stringliteral">&quot;@@FNT&quot;</span>) {
<a name="l00109"></a>00109 
<a name="l00110"></a>00110                     <span class="comment">// open the footnote and set the anchor and backlink</span>
<a name="l00111"></a>00111                     $this-&gt;doc .= <span class="stringliteral">&#39;&lt;div class=&quot;fn&quot;&gt;&#39;</span>;
<a name="l00112"></a>00112                     $this-&gt;doc .= <span class="stringliteral">&#39;&lt;sup&gt;&lt;a href=&quot;#fnt__&#39;</span>.$id.<span class="stringliteral">&#39;&quot; id=&quot;fn__&#39;</span>.$id.<span class="stringliteral">&#39;&quot; name=&quot;fn__&#39;</span>.$id.<span class="stringliteral">&#39;&quot; class=&quot;fn_bot&quot;&gt;&#39;</span>;
<a name="l00113"></a>00113                     $this-&gt;doc .= $id.<span class="stringliteral">&#39;)&lt;/a&gt;&lt;/sup&gt; &#39;</span>.DOKU_LF;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115                     <span class="comment">// get any other footnotes that use the same markup</span>
<a name="l00116"></a>00116                     $alt = array_keys($this-&gt;footnotes, <span class="stringliteral">&quot;@@FNT$id&quot;</span>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118                     <span class="keywordflow">if</span> (count($alt)) {
<a name="l00119"></a>00119                       <span class="keywordflow">foreach</span> ($alt as $ref) {
<a name="l00120"></a>00120                         <span class="comment">// set anchor and backlink for the other footnotes</span>
<a name="l00121"></a>00121                         $this-&gt;doc .= <span class="stringliteral">&#39;, &lt;sup&gt;&lt;a href=&quot;#fnt__&#39;</span>.($ref+1).<span class="stringliteral">&#39;&quot; id=&quot;fn__&#39;</span>.($ref+1).<span class="stringliteral">&#39;&quot; name=&quot;fn__&#39;</span>.($ref+1).<span class="stringliteral">&#39;&quot; class=&quot;fn_bot&quot;&gt;&#39;</span>;
<a name="l00122"></a>00122                         $this-&gt;doc .= ($ref+1).<span class="stringliteral">&#39;)&lt;/a&gt;&lt;/sup&gt; &#39;</span>.DOKU_LF;
<a name="l00123"></a>00123                       }
<a name="l00124"></a>00124                     }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126                     <span class="comment">// add footnote markup and close this footnote</span>
<a name="l00127"></a>00127                     $this-&gt;doc .= $footnote;
<a name="l00128"></a>00128                     $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span> . DOKU_LF;
<a name="l00129"></a>00129                 }
<a name="l00130"></a>00130             }
<a name="l00131"></a>00131             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.DOKU_LF;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <span class="comment">// Prepare the TOC</span>
<a name="l00135"></a>00135         global $conf;
<a name="l00136"></a>00136         <span class="keywordflow">if</span>($this-&gt;info[<span class="stringliteral">&#39;toc&#39;</span>] &amp;&amp; is_array($this-&gt;toc) &amp;&amp; $conf[<span class="stringliteral">&#39;tocminheads&#39;</span>] &amp;&amp; count($this-&gt;toc) &gt;= $conf[<span class="stringliteral">&#39;tocminheads&#39;</span>]){
<a name="l00137"></a>00137             global $TOC;
<a name="l00138"></a>00138             $TOC = $this-&gt;toc;
<a name="l00139"></a>00139         }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="comment">// make sure there are no empty paragraphs</span>
<a name="l00142"></a>00142         $this-&gt;doc = preg_replace(<span class="stringliteral">&#39;#&lt;p&gt;\s*&lt;/p&gt;#&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$this-&gt;doc);
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     function toc_additem($id, $text, $level) {
<a name="l00146"></a>00146         global $conf;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="comment">//handle TOC</span>
<a name="l00149"></a>00149         <span class="keywordflow">if</span>($level &gt;= $conf[<span class="stringliteral">&#39;toptoclevel&#39;</span>] &amp;&amp; $level &lt;= $conf[<span class="stringliteral">&#39;maxtoclevel&#39;</span>]){
<a name="l00150"></a>00150             $this-&gt;toc[] = html_mktocitem($id, $text, $level-$conf[<span class="stringliteral">&#39;toptoclevel&#39;</span>]+1);
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     function header($text, $level, $pos) {
<a name="l00155"></a>00155         global $conf;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="keywordflow">if</span>(!$text) <span class="keywordflow">return</span>; <span class="comment">//skip empty headlines</span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         $hid = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac1b334f07c4b2a876be90101d10d8c75" title="Creates a linkid from a headline.">_headerToLink</a>($text,<span class="keyword">true</span>);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         <span class="comment">//only add items within configured levels</span>
<a name="l00162"></a>00162         $this-&gt;toc_additem($hid, $text, $level);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="comment">// adjust $node to reflect hierarchy of levels</span>
<a name="l00165"></a>00165         $this-&gt;node[$level-1]++;
<a name="l00166"></a>00166         <span class="keywordflow">if</span> ($level &lt; $this-&gt;lastlevel) {
<a name="l00167"></a>00167             <span class="keywordflow">for</span> ($i = 0; $i &lt; $this-&gt;lastlevel-$level; $i++) {
<a name="l00168"></a>00168                 $this-&gt;node[$this-&gt;lastlevel-$i-1] = 0;
<a name="l00169"></a>00169             }
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171         $this-&gt;lastlevel = $level;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         <span class="keywordflow">if</span> ($level &lt;= $conf[<span class="stringliteral">&#39;maxseclevel&#39;</span>] &amp;&amp;
<a name="l00174"></a>00174             count($this-&gt;sectionedits) &gt; 0 &amp;&amp;
<a name="l00175"></a>00175             $this-&gt;sectionedits[count($this-&gt;sectionedits) - 1][2] === <span class="stringliteral">&#39;section&#39;</span>) {
<a name="l00176"></a>00176             $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#aa6456812443ff0a4cd4552ab60483658" title="Finish an edit section range.">finishSectionEdit</a>($pos - 1);
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="comment">// write the header</span>
<a name="l00180"></a>00180         $this-&gt;doc .= DOKU_LF.<span class="stringliteral">&#39;&lt;h&#39;</span>.$level;
<a name="l00181"></a>00181         <span class="keywordflow">if</span> ($level &lt;= $conf[<span class="stringliteral">&#39;maxseclevel&#39;</span>]) {
<a name="l00182"></a>00182             $this-&gt;doc .= <span class="stringliteral">&#39; class=&quot;&#39;</span> . $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#a362f3c5a77b486cdcad740c3c82a326a" title="Register a new edit section range.">startSectionEdit</a>($pos, <span class="stringliteral">&#39;section&#39;</span>, $text) . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184         $this-&gt;doc .= <span class="stringliteral">&#39;&gt;&lt;a name=&quot;&#39;</span>.$hid.<span class="stringliteral">&#39;&quot; id=&quot;&#39;</span>.$hid.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00185"></a>00185         $this-&gt;doc .= $this-&gt;_xmlEntities($text);
<a name="l00186"></a>00186         $this-&gt;doc .= <span class="stringliteral">&quot;&lt;/a&gt;&lt;/h$level&gt;&quot;</span>.DOKU_LF;
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     function section_open($level) {
<a name="l00190"></a>00190         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;div class=&quot;level&#39;</span> . $level . <span class="stringliteral">&#39;&quot;&gt;&#39;</span> . DOKU_LF;
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     function section_close() {
<a name="l00194"></a>00194         $this-&gt;doc .= DOKU_LF.<span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.DOKU_LF;
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     function cdata($text) {
<a name="l00198"></a>00198         $this-&gt;doc .= $this-&gt;_xmlEntities($text);
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     function p_open() {
<a name="l00202"></a>00202         $this-&gt;doc .= DOKU_LF.<span class="stringliteral">&#39;&lt;p&gt;&#39;</span>.DOKU_LF;
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     function p_close() {
<a name="l00206"></a>00206         $this-&gt;doc .= DOKU_LF.<span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>.DOKU_LF;
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     function linebreak() {
<a name="l00210"></a>00210         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;br/&gt;&#39;</span>.DOKU_LF;
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     function hr() {
<a name="l00214"></a>00214         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;hr /&gt;&#39;</span>.DOKU_LF;
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     function strong_open() {
<a name="l00218"></a>00218         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;strong&gt;&#39;</span>;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     function strong_close() {
<a name="l00222"></a>00222         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/strong&gt;&#39;</span>;
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     function emphasis_open() {
<a name="l00226"></a>00226         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;em&gt;&#39;</span>;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     function emphasis_close() {
<a name="l00230"></a>00230         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/em&gt;&#39;</span>;
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     function underline_open() {
<a name="l00234"></a>00234         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;em class=&quot;u&quot;&gt;&#39;</span>;
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     function underline_close() {
<a name="l00238"></a>00238         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/em&gt;&#39;</span>;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     function monospace_open() {
<a name="l00242"></a>00242         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;code&gt;&#39;</span>;
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     function monospace_close() {
<a name="l00246"></a>00246         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/code&gt;&#39;</span>;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     function subscript_open() {
<a name="l00250"></a>00250         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;sub&gt;&#39;</span>;
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     function subscript_close() {
<a name="l00254"></a>00254         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/sub&gt;&#39;</span>;
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     function superscript_open() {
<a name="l00258"></a>00258         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;sup&gt;&#39;</span>;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     function superscript_close() {
<a name="l00262"></a>00262         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/sup&gt;&#39;</span>;
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     function deleted_open() {
<a name="l00266"></a>00266         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;del&gt;&#39;</span>;
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     function deleted_close() {
<a name="l00270"></a>00270         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/del&gt;&#39;</span>;
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272 
<a name="l00282"></a><a class="code" href="classDoku__Renderer__xhtml.html#a0d1438fbe0aa4a0f95d645a51e193037">00282</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#a0d1438fbe0aa4a0f95d645a51e193037" title="Callback for footnote start syntax.">footnote_open</a>() {
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">// move current content to store and record footnote</span>
<a name="l00285"></a>00285         $this-&gt;store = $this-&gt;doc;
<a name="l00286"></a>00286         $this-&gt;doc   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00297"></a><a class="code" href="classDoku__Renderer__xhtml.html#ab2b6b2e4a39b42bfe7e61d8977318840">00297</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#ab2b6b2e4a39b42bfe7e61d8977318840" title="Callback for footnote end syntax.">footnote_close</a>() {
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="comment">// recover footnote into the stack and restore old content</span>
<a name="l00300"></a>00300         $footnote = $this-&gt;doc;
<a name="l00301"></a>00301         $this-&gt;doc = $this-&gt;store;
<a name="l00302"></a>00302         $this-&gt;store = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="comment">// check to see if this footnote has been seen before</span>
<a name="l00305"></a>00305         $i = array_search($footnote, $this-&gt;footnotes);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="keywordflow">if</span> ($i === <span class="keyword">false</span>) {
<a name="l00308"></a>00308             <span class="comment">// its a new footnote, add it to the $footnotes array</span>
<a name="l00309"></a>00309             $id = count($this-&gt;footnotes)+1;
<a name="l00310"></a>00310             $this-&gt;footnotes[count($this-&gt;footnotes)] = $footnote;
<a name="l00311"></a>00311         } <span class="keywordflow">else</span> {
<a name="l00312"></a>00312             <span class="comment">// seen this one before, translate the index to an id and save a placeholder</span>
<a name="l00313"></a>00313             $i++;
<a name="l00314"></a>00314             $id = count($this-&gt;footnotes)+1;
<a name="l00315"></a>00315             $this-&gt;footnotes[count($this-&gt;footnotes)] = <span class="stringliteral">&quot;@@FNT&quot;</span>.($i);
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <span class="comment">// output the footnote reference and link</span>
<a name="l00319"></a>00319         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;sup&gt;&lt;a href=&quot;#fn__&#39;</span>.$id.<span class="stringliteral">&#39;&quot; name=&quot;fnt__&#39;</span>.$id.<span class="stringliteral">&#39;&quot; id=&quot;fnt__&#39;</span>.$id.<span class="stringliteral">&#39;&quot; class=&quot;fn_top&quot;&gt;&#39;</span>.$id.<span class="stringliteral">&#39;)&lt;/a&gt;&lt;/sup&gt;&#39;</span>;
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     function listu_open() {
<a name="l00323"></a>00323         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;ul&gt;&#39;</span>.DOKU_LF;
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     function listu_close() {
<a name="l00327"></a>00327         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/ul&gt;&#39;</span>.DOKU_LF;
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     function listo_open() {
<a name="l00331"></a>00331         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;ol&gt;&#39;</span>.DOKU_LF;
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     function listo_close() {
<a name="l00335"></a>00335         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/ol&gt;&#39;</span>.DOKU_LF;
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     function listitem_open($level) {
<a name="l00339"></a>00339         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;li class=&quot;level&#39;</span>.$level.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     function listitem_close() {
<a name="l00343"></a>00343         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/li&gt;&#39;</span>.DOKU_LF;
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     function listcontent_open() {
<a name="l00347"></a>00347         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;div class=&quot;li&quot;&gt;&#39;</span>;
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     function listcontent_close() {
<a name="l00351"></a>00351         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.DOKU_LF;
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     function unformatted($text) {
<a name="l00355"></a>00355         $this-&gt;doc .= $this-&gt;_xmlEntities($text);
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357 
<a name="l00365"></a><a class="code" href="classDoku__Renderer__xhtml.html#aaf03ac4e9b4d2e3850f9cdae9c737c89">00365</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#aaf03ac4e9b4d2e3850f9cdae9c737c89" title="Execute PHP code if allowed.">php</a>($text, $wrapper=<span class="stringliteral">&#39;code&#39;</span>) {
<a name="l00366"></a>00366         global $conf;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         <span class="keywordflow">if</span>($conf[<span class="stringliteral">&#39;phpok&#39;</span>]){
<a name="l00369"></a>00369           ob_start();
<a name="l00370"></a>00370           eval($text);
<a name="l00371"></a>00371           $this-&gt;doc .= ob_get_contents();
<a name="l00372"></a>00372           ob_end_clean();
<a name="l00373"></a>00373         } <span class="keywordflow">else</span> {
<a name="l00374"></a>00374           $this-&gt;doc .= p_xhtml_cached_geshi($text, <span class="stringliteral">&#39;php&#39;</span>, $wrapper);
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     function phpblock($text) {
<a name="l00379"></a>00379         $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#aaf03ac4e9b4d2e3850f9cdae9c737c89" title="Execute PHP code if allowed.">php</a>($text, <span class="stringliteral">&#39;pre&#39;</span>);
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 
<a name="l00389"></a><a class="code" href="classDoku__Renderer__xhtml.html#a6cef584ba3fe062ead6abf037dcfd4e4">00389</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#a6cef584ba3fe062ead6abf037dcfd4e4" title="Insert HTML if allowed.">html</a>($text, $wrapper=<span class="stringliteral">&#39;code&#39;</span>) {
<a name="l00390"></a>00390         global $conf;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         <span class="keywordflow">if</span>($conf[<span class="stringliteral">&#39;htmlok&#39;</span>]){
<a name="l00393"></a>00393           $this-&gt;doc .= $text;
<a name="l00394"></a>00394         } <span class="keywordflow">else</span> {
<a name="l00395"></a>00395           $this-&gt;doc .= p_xhtml_cached_geshi($text, <span class="stringliteral">&#39;html4strict&#39;</span>, $wrapper);
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     function htmlblock($text) {
<a name="l00400"></a>00400         $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#a6cef584ba3fe062ead6abf037dcfd4e4" title="Insert HTML if allowed.">html</a>($text, <span class="stringliteral">&#39;pre&#39;</span>);
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     function quote_open() {
<a name="l00404"></a>00404         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;blockquote&gt;&lt;div class=&quot;no&quot;&gt;&#39;</span>.DOKU_LF;
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     function quote_close() {
<a name="l00408"></a>00408         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;/blockquote&gt;&#39;</span>.DOKU_LF;
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     function preformatted($text) {
<a name="l00412"></a>00412         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;pre class=&quot;code&quot;&gt;&#39;</span> . trim($this-&gt;_xmlEntities($text),<span class="stringliteral">&quot;\n\r&quot;</span>) . <span class="stringliteral">&#39;&lt;/pre&gt;&#39;</span>. DOKU_LF;
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     function file($text, $language=null, $filename=null) {
<a name="l00416"></a>00416         $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ae6cefd13a82baafdaa39c9bf63af58d0" title="Use GeSHi to highlight language syntax in code and file blocks.">_highlight</a>(<span class="stringliteral">&#39;file&#39;</span>,$text,$language,$filename);
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     function code($text, $language=null, $filename=null) {
<a name="l00420"></a>00420         $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ae6cefd13a82baafdaa39c9bf63af58d0" title="Use GeSHi to highlight language syntax in code and file blocks.">_highlight</a>(<span class="stringliteral">&#39;code&#39;</span>,$text,$language,$filename);
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 
<a name="l00428"></a><a class="code" href="classDoku__Renderer__xhtml.html#ae6cefd13a82baafdaa39c9bf63af58d0">00428</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#ae6cefd13a82baafdaa39c9bf63af58d0" title="Use GeSHi to highlight language syntax in code and file blocks.">_highlight</a>($type, $text, $language=null, $filename=null) {
<a name="l00429"></a>00429         global $conf;
<a name="l00430"></a>00430         global $ID;
<a name="l00431"></a>00431         global $lang;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433         <span class="keywordflow">if</span>($filename){
<a name="l00434"></a>00434             <span class="comment">// add icon</span>
<a name="l00435"></a>00435             list($ext) = mimetype($filename,<span class="keyword">false</span>);
<a name="l00436"></a>00436             $class = preg_replace(<span class="stringliteral">&#39;/[^_\-a-z0-9]+/i&#39;</span>,<span class="charliteral">&#39;_&#39;</span>,$ext);
<a name="l00437"></a>00437             $class = <span class="stringliteral">&#39;mediafile mf_&#39;</span>.$class;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;dl class=&quot;&#39;</span>.$type.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.DOKU_LF;
<a name="l00440"></a>00440             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;dt&gt;&lt;a href=&quot;&#39;</span>.exportlink($ID,<span class="stringliteral">&#39;code&#39;</span>,array(<span class="stringliteral">&#39;codeblock&#39;</span>=&gt;$this-&gt;_codeblock)).<span class="stringliteral">&#39;&quot; title=&quot;&#39;</span>.$lang[<span class="stringliteral">&#39;download&#39;</span>].<span class="stringliteral">&#39;&quot; class=&quot;&#39;</span>.$class.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>;
<a name="l00441"></a>00441             $this-&gt;doc .= hsc($filename);
<a name="l00442"></a>00442             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/a&gt;&lt;/dt&gt;&#39;</span>.DOKU_LF.<span class="stringliteral">&#39;&lt;dd&gt;&#39;</span>;
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         <span class="keywordflow">if</span> ($text{0} == <span class="stringliteral">&quot;\n&quot;</span>) {
<a name="l00446"></a>00446             $text = substr($text, 1);
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448         <span class="keywordflow">if</span> (substr($text, -1) == <span class="stringliteral">&quot;\n&quot;</span>) {
<a name="l00449"></a>00449             $text = substr($text, 0, -1);
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452         <span class="keywordflow">if</span> ( is_null($language) ) {
<a name="l00453"></a>00453             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;pre class=&quot;&#39;</span>.$type.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$this-&gt;_xmlEntities($text).<span class="stringliteral">&#39;&lt;/pre&gt;&#39;</span>.DOKU_LF;
<a name="l00454"></a>00454         } <span class="keywordflow">else</span> {
<a name="l00455"></a>00455             $class = <span class="stringliteral">&#39;code&#39;</span>; <span class="comment">//we always need the code class to make the syntax highlighting apply</span>
<a name="l00456"></a>00456             <span class="keywordflow">if</span>($type != <span class="stringliteral">&#39;code&#39;</span>) $class .= <span class="charliteral">&#39; &#39;</span>.$type;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458             $this-&gt;doc .= <span class="stringliteral">&quot;&lt;pre class=\&quot;$class $language\&quot;&gt;&quot;</span>.p_xhtml_cached_geshi($text, $language, <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;&lt;/pre&gt;&#39;</span>.DOKU_LF;
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461         <span class="keywordflow">if</span>($filename){
<a name="l00462"></a>00462             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/dd&gt;&lt;/dl&gt;&#39;</span>.DOKU_LF;
<a name="l00463"></a>00463         }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         $this-&gt;_codeblock++;
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     function acronym($acronym) {
<a name="l00469"></a>00469 
<a name="l00470"></a>00470         <span class="keywordflow">if</span> ( array_key_exists($acronym, $this-&gt;acronyms) ) {
<a name="l00471"></a>00471 
<a name="l00472"></a>00472             $title = $this-&gt;_xmlEntities($this-&gt;acronyms[$acronym]);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;acronym title=&quot;&#39;</span>.$title
<a name="l00475"></a>00475                 .<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$this-&gt;_xmlEntities($acronym).<span class="stringliteral">&#39;&lt;/acronym&gt;&#39;</span>;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         } <span class="keywordflow">else</span> {
<a name="l00478"></a>00478             $this-&gt;doc .= $this-&gt;_xmlEntities($acronym);
<a name="l00479"></a>00479         }
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     function smiley($smiley) {
<a name="l00483"></a>00483         <span class="keywordflow">if</span> ( array_key_exists($smiley, $this-&gt;smileys) ) {
<a name="l00484"></a>00484             $title = $this-&gt;_xmlEntities($this-&gt;smileys[$smiley]);
<a name="l00485"></a>00485             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;img src=&quot;&#39;</span>.DOKU_BASE.<span class="stringliteral">&#39;lib/images/smileys/&#39;</span>.$this-&gt;smileys[$smiley].
<a name="l00486"></a>00486                 <span class="stringliteral">&#39;&quot; class=&quot;middle&quot; alt=&quot;&#39;</span>.
<a name="l00487"></a>00487                     $this-&gt;_xmlEntities($smiley).<span class="stringliteral">&#39;&quot; /&gt;&#39;</span>;
<a name="l00488"></a>00488         } <span class="keywordflow">else</span> {
<a name="l00489"></a>00489             $this-&gt;doc .= $this-&gt;_xmlEntities($smiley);
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="comment">/*</span>
<a name="l00494"></a>00494 <span class="comment">    * not used</span>
<a name="l00495"></a>00495 <span class="comment">    function wordblock($word) {</span>
<a name="l00496"></a>00496 <span class="comment">        if ( array_key_exists($word, $this-&gt;badwords) ) {</span>
<a name="l00497"></a>00497 <span class="comment">            $this-&gt;doc .= &#39;** BLEEP **&#39;;</span>
<a name="l00498"></a>00498 <span class="comment">        } else {</span>
<a name="l00499"></a>00499 <span class="comment">            $this-&gt;doc .= $this-&gt;_xmlEntities($word);</span>
<a name="l00500"></a>00500 <span class="comment">        }</span>
<a name="l00501"></a>00501 <span class="comment">    }</span>
<a name="l00502"></a>00502 <span class="comment">    */</span>
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     function entity($entity) {
<a name="l00505"></a>00505         <span class="keywordflow">if</span> ( array_key_exists($entity, $this-&gt;entities) ) {
<a name="l00506"></a>00506             $this-&gt;doc .= $this-&gt;entities[$entity];
<a name="l00507"></a>00507         } <span class="keywordflow">else</span> {
<a name="l00508"></a>00508             $this-&gt;doc .= $this-&gt;_xmlEntities($entity);
<a name="l00509"></a>00509         }
<a name="l00510"></a>00510     }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     function multiplyentity($x, $y) {
<a name="l00513"></a>00513         $this-&gt;doc .= <span class="stringliteral">&quot;$x&amp;times;$y&quot;</span>;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     function singlequoteopening() {
<a name="l00517"></a>00517         global $lang;
<a name="l00518"></a>00518         $this-&gt;doc .= $lang[<span class="stringliteral">&#39;singlequoteopening&#39;</span>];
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     function singlequoteclosing() {
<a name="l00522"></a>00522         global $lang;
<a name="l00523"></a>00523         $this-&gt;doc .= $lang[<span class="stringliteral">&#39;singlequoteclosing&#39;</span>];
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     function apostrophe() {
<a name="l00527"></a>00527         global $lang;
<a name="l00528"></a>00528         $this-&gt;doc .= $lang[<span class="stringliteral">&#39;apostrophe&#39;</span>];
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     function doublequoteopening() {
<a name="l00532"></a>00532         global $lang;
<a name="l00533"></a>00533         $this-&gt;doc .= $lang[<span class="stringliteral">&#39;doublequoteopening&#39;</span>];
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     function doublequoteclosing() {
<a name="l00537"></a>00537         global $lang;
<a name="l00538"></a>00538         $this-&gt;doc .= $lang[<span class="stringliteral">&#39;doublequoteclosing&#39;</span>];
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540 
<a name="l00543"></a>00543     function camelcaselink($link) {
<a name="l00544"></a>00544       $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#acf76c17a667cbb9f3df2717c562a6cdd" title="Render an internal Wiki Link.">internallink</a>($link,$link);
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     function locallink($hash, $name = NULL){
<a name="l00549"></a>00549         global $ID;
<a name="l00550"></a>00550         $name  = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7" title="Construct a title and handle images in titles.">_getLinkTitle</a>($name, $hash, $isImage);
<a name="l00551"></a>00551         $hash  = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac1b334f07c4b2a876be90101d10d8c75" title="Creates a linkid from a headline.">_headerToLink</a>($hash);
<a name="l00552"></a>00552         $title = $ID.<span class="stringliteral">&#39; &amp;crarr;&#39;</span>;
<a name="l00553"></a>00553         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;a href=&quot;#&#39;</span>.$hash.<span class="stringliteral">&#39;&quot; title=&quot;&#39;</span>.$title.<span class="stringliteral">&#39;&quot; class=&quot;wikilink1&quot;&gt;&#39;</span>;
<a name="l00554"></a>00554         $this-&gt;doc .= $name;
<a name="l00555"></a>00555         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557 
<a name="l00566"></a><a class="code" href="classDoku__Renderer__xhtml.html#acf76c17a667cbb9f3df2717c562a6cdd">00566</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#acf76c17a667cbb9f3df2717c562a6cdd" title="Render an internal Wiki Link.">internallink</a>($id, $name = NULL, $search=NULL,$returnonly=<span class="keyword">false</span>,$linktype=<span class="stringliteral">&#39;content&#39;</span>) {
<a name="l00567"></a>00567         global $conf;
<a name="l00568"></a>00568         global $ID;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570         $params = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00571"></a>00571         $parts = explode(<span class="charliteral">&#39;?&#39;</span>, $id, 2);
<a name="l00572"></a>00572         <span class="keywordflow">if</span> (count($parts) === 2) {
<a name="l00573"></a>00573             $id = $parts[0];
<a name="l00574"></a>00574             $params = $parts[1];
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="comment">// For empty $id we need to know the current $ID</span>
<a name="l00578"></a>00578         <span class="comment">// We need this check because _simpleTitle needs</span>
<a name="l00579"></a>00579         <span class="comment">// correct $id and resolve_pageid() use cleanID($id)</span>
<a name="l00580"></a>00580         <span class="comment">// (some things could be lost)</span>
<a name="l00581"></a>00581         <span class="keywordflow">if</span> ($id === <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00582"></a>00582             $id = $ID;
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         <span class="comment">// default name is based on $id as given</span>
<a name="l00586"></a>00586         $default = $this-&gt;<a class="code" href="classDoku__Renderer.html#afe8f3b0534833ea6aa5c3e7c35c4e3c3" title="Removes any Namespace from the given name but keeps casing and special chars.">_simpleTitle</a>($id);
<a name="l00587"></a>00587 
<a name="l00588"></a>00588         <span class="comment">// now first resolve and clean up the $id</span>
<a name="l00589"></a>00589         resolve_pageid(getNS($ID),$id,$exists);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591         $name = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7" title="Construct a title and handle images in titles.">_getLinkTitle</a>($name, $default, $isImage, $id, $linktype);
<a name="l00592"></a>00592         <span class="keywordflow">if</span> ( !$isImage ) {
<a name="l00593"></a>00593             <span class="keywordflow">if</span> ( $exists ) {
<a name="l00594"></a>00594                 $class=<span class="stringliteral">&#39;wikilink1&#39;</span>;
<a name="l00595"></a>00595             } <span class="keywordflow">else</span> {
<a name="l00596"></a>00596                 $class=<span class="stringliteral">&#39;wikilink2&#39;</span>;
<a name="l00597"></a>00597                 $link[<span class="stringliteral">&#39;rel&#39;</span>]=<span class="stringliteral">&#39;nofollow&#39;</span>;
<a name="l00598"></a>00598             }
<a name="l00599"></a>00599         } <span class="keywordflow">else</span> {
<a name="l00600"></a>00600             $class=<span class="stringliteral">&#39;media&#39;</span>;
<a name="l00601"></a>00601         }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603         <span class="comment">//keep hash anchor</span>
<a name="l00604"></a>00604         list($id,$hash) = explode(<span class="charliteral">&#39;#&#39;</span>,$id,2);
<a name="l00605"></a>00605         <span class="keywordflow">if</span>(!empty($hash)) $hash = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac1b334f07c4b2a876be90101d10d8c75" title="Creates a linkid from a headline.">_headerToLink</a>($hash);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607         <span class="comment">//prepare for formating</span>
<a name="l00608"></a>00608         $link[<span class="stringliteral">&#39;target&#39;</span>] = $conf[<span class="stringliteral">&#39;target&#39;</span>][<span class="stringliteral">&#39;wiki&#39;</span>];
<a name="l00609"></a>00609         $link[<span class="stringliteral">&#39;style&#39;</span>]  = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00610"></a>00610         $link[<span class="stringliteral">&#39;pre&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00611"></a>00611         $link[<span class="stringliteral">&#39;suf&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00612"></a>00612         <span class="comment">// highlight link to current page</span>
<a name="l00613"></a>00613         <span class="keywordflow">if</span> ($id == $ID) {
<a name="l00614"></a>00614             $link[<span class="stringliteral">&#39;pre&#39;</span>]    = <span class="stringliteral">&#39;&lt;span class=&quot;curid&quot;&gt;&#39;</span>;
<a name="l00615"></a>00615             $link[<span class="stringliteral">&#39;suf&#39;</span>]    = <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;
<a name="l00616"></a>00616         }
<a name="l00617"></a>00617         $link[<span class="stringliteral">&#39;more&#39;</span>]   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00618"></a>00618         $link[<span class="stringliteral">&#39;class&#39;</span>]  = $class;
<a name="l00619"></a>00619         $link[<span class="stringliteral">&#39;url&#39;</span>]    = wl($id, $params);
<a name="l00620"></a>00620         $link[<span class="stringliteral">&#39;name&#39;</span>]   = $name;
<a name="l00621"></a>00621         $link[<span class="stringliteral">&#39;title&#39;</span>]  = $id;
<a name="l00622"></a>00622         <span class="comment">//add search string</span>
<a name="l00623"></a>00623         <span class="keywordflow">if</span>($search){
<a name="l00624"></a>00624             ($conf[<span class="stringliteral">&#39;userewrite&#39;</span>]) ? $link[<span class="stringliteral">&#39;url&#39;</span>].=<span class="charliteral">&#39;?&#39;</span> : $link[<span class="stringliteral">&#39;url&#39;</span>].=<span class="stringliteral">&#39;&amp;amp;&#39;</span>;
<a name="l00625"></a>00625             <span class="keywordflow">if</span>(is_array($search)){
<a name="l00626"></a>00626                 $search = array_map(<span class="stringliteral">&#39;rawurlencode&#39;</span>,$search);
<a name="l00627"></a>00627                 $link[<span class="stringliteral">&#39;url&#39;</span>] .= <span class="stringliteral">&#39;s[]=&#39;</span>.join(<span class="stringliteral">&#39;&amp;amp;s[]=&#39;</span>,$search);
<a name="l00628"></a>00628             }<span class="keywordflow">else</span>{
<a name="l00629"></a>00629                 $link[<span class="stringliteral">&#39;url&#39;</span>] .= <span class="stringliteral">&#39;s=&#39;</span>.rawurlencode($search);
<a name="l00630"></a>00630             }
<a name="l00631"></a>00631         }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633         <span class="comment">//keep hash</span>
<a name="l00634"></a>00634         <span class="keywordflow">if</span>($hash) $link[<span class="stringliteral">&#39;url&#39;</span>].=<span class="charliteral">&#39;#&#39;</span>.$hash;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         <span class="comment">//output formatted</span>
<a name="l00637"></a>00637         <span class="keywordflow">if</span>($returnonly){
<a name="l00638"></a>00638             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00639"></a>00639         }<span class="keywordflow">else</span>{
<a name="l00640"></a>00640             $this-&gt;doc .= $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     function externallink($url, $name = NULL) {
<a name="l00645"></a>00645         global $conf;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647         $name = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7" title="Construct a title and handle images in titles.">_getLinkTitle</a>($name, $url, $isImage);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649         <span class="comment">// url might be an attack vector, only allow registered protocols</span>
<a name="l00650"></a>00650         <span class="keywordflow">if</span>(is_null($this-&gt;schemes)) $this-&gt;schemes = getSchemes();
<a name="l00651"></a>00651         list($scheme) = explode(<span class="stringliteral">&#39;://&#39;</span>,$url);
<a name="l00652"></a>00652         $scheme = strtolower($scheme);
<a name="l00653"></a>00653         <span class="keywordflow">if</span>(!in_array($scheme,$this-&gt;schemes)) $url = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         <span class="comment">// is there still an URL?</span>
<a name="l00656"></a>00656         <span class="keywordflow">if</span>(!$url){
<a name="l00657"></a>00657             $this-&gt;doc .= $name;
<a name="l00658"></a>00658             <span class="keywordflow">return</span>;
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661         <span class="comment">// set class</span>
<a name="l00662"></a>00662         <span class="keywordflow">if</span> ( !$isImage ) {
<a name="l00663"></a>00663             $class=<span class="stringliteral">&#39;urlextern&#39;</span>;
<a name="l00664"></a>00664         } <span class="keywordflow">else</span> {
<a name="l00665"></a>00665             $class=<span class="stringliteral">&#39;media&#39;</span>;
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667 
<a name="l00668"></a>00668         <span class="comment">//prepare for formating</span>
<a name="l00669"></a>00669         $link[<span class="stringliteral">&#39;target&#39;</span>] = $conf[<span class="stringliteral">&#39;target&#39;</span>][<span class="stringliteral">&#39;extern&#39;</span>];
<a name="l00670"></a>00670         $link[<span class="stringliteral">&#39;style&#39;</span>]  = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00671"></a>00671         $link[<span class="stringliteral">&#39;pre&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00672"></a>00672         $link[<span class="stringliteral">&#39;suf&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00673"></a>00673         $link[<span class="stringliteral">&#39;more&#39;</span>]   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00674"></a>00674         $link[<span class="stringliteral">&#39;class&#39;</span>]  = $class;
<a name="l00675"></a>00675         $link[<span class="stringliteral">&#39;url&#39;</span>]    = $url;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         $link[<span class="stringliteral">&#39;name&#39;</span>]   = $name;
<a name="l00678"></a>00678         $link[<span class="stringliteral">&#39;title&#39;</span>]  = $this-&gt;_xmlEntities($url);
<a name="l00679"></a>00679         <span class="keywordflow">if</span>($conf[<span class="stringliteral">&#39;relnofollow&#39;</span>]) $link[<span class="stringliteral">&#39;more&#39;</span>] .= <span class="stringliteral">&#39; rel=&quot;nofollow&quot;&#39;</span>;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681         <span class="comment">//output formatted</span>
<a name="l00682"></a>00682         $this-&gt;doc .= $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684 
<a name="l00687"></a>00687     function interwikilink($match, $name = NULL, $wikiName, $wikiUri) {
<a name="l00688"></a>00688         global $conf;
<a name="l00689"></a>00689 
<a name="l00690"></a>00690         $link = array();
<a name="l00691"></a>00691         $link[<span class="stringliteral">&#39;target&#39;</span>] = $conf[<span class="stringliteral">&#39;target&#39;</span>][<span class="stringliteral">&#39;interwiki&#39;</span>];
<a name="l00692"></a>00692         $link[<span class="stringliteral">&#39;pre&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00693"></a>00693         $link[<span class="stringliteral">&#39;suf&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00694"></a>00694         $link[<span class="stringliteral">&#39;more&#39;</span>]   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00695"></a>00695         $link[<span class="stringliteral">&#39;name&#39;</span>]   = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7" title="Construct a title and handle images in titles.">_getLinkTitle</a>($name, $wikiUri, $isImage);
<a name="l00696"></a>00696 
<a name="l00697"></a>00697         <span class="comment">//get interwiki URL</span>
<a name="l00698"></a>00698         $url = $this-&gt;<a class="code" href="classDoku__Renderer.html#a0493f436f870000e6d1601abd44d55fe" title="Resolve an interwikilink.">_resolveInterWiki</a>($wikiName,$wikiUri);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         <span class="keywordflow">if</span> ( !$isImage ) {
<a name="l00701"></a>00701             $class = preg_replace(<span class="stringliteral">&#39;/[^_\-a-z0-9]+/i&#39;</span>,<span class="charliteral">&#39;_&#39;</span>,$wikiName);
<a name="l00702"></a>00702             $link[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&quot;interwiki iw_$class&quot;</span>;
<a name="l00703"></a>00703         } <span class="keywordflow">else</span> {
<a name="l00704"></a>00704             $link[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&#39;media&#39;</span>;
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <span class="comment">//do we stay at the same server? Use local target</span>
<a name="l00708"></a>00708         <span class="keywordflow">if</span>( strpos($url,DOKU_URL) === 0 ){
<a name="l00709"></a>00709             $link[<span class="stringliteral">&#39;target&#39;</span>] = $conf[<span class="stringliteral">&#39;target&#39;</span>][<span class="stringliteral">&#39;wiki&#39;</span>];
<a name="l00710"></a>00710         }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712         $link[<span class="stringliteral">&#39;url&#39;</span>] = $url;
<a name="l00713"></a>00713         $link[<span class="stringliteral">&#39;title&#39;</span>] = htmlspecialchars($link[<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715         <span class="comment">//output formatted</span>
<a name="l00716"></a>00716         $this-&gt;doc .= $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718 
<a name="l00721"></a>00721     function windowssharelink($url, $name = NULL) {
<a name="l00722"></a>00722         global $conf;
<a name="l00723"></a>00723         global $lang;
<a name="l00724"></a>00724         <span class="comment">//simple setup</span>
<a name="l00725"></a>00725         $link[<span class="stringliteral">&#39;target&#39;</span>] = $conf[<span class="stringliteral">&#39;target&#39;</span>][<span class="stringliteral">&#39;windows&#39;</span>];
<a name="l00726"></a>00726         $link[<span class="stringliteral">&#39;pre&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00727"></a>00727         $link[<span class="stringliteral">&#39;suf&#39;</span>]   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00728"></a>00728         $link[<span class="stringliteral">&#39;style&#39;</span>]  = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         $link[<span class="stringliteral">&#39;name&#39;</span>] = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7" title="Construct a title and handle images in titles.">_getLinkTitle</a>($name, $url, $isImage);
<a name="l00731"></a>00731         <span class="keywordflow">if</span> ( !$isImage ) {
<a name="l00732"></a>00732             $link[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&#39;windows&#39;</span>;
<a name="l00733"></a>00733         } <span class="keywordflow">else</span> {
<a name="l00734"></a>00734             $link[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&#39;media&#39;</span>;
<a name="l00735"></a>00735         }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         $link[<span class="stringliteral">&#39;title&#39;</span>] = $this-&gt;_xmlEntities($url);
<a name="l00739"></a>00739         $url = str_replace(<span class="charliteral">&#39;\\&#39;</span>,<span class="charliteral">&#39;/&#39;</span>,$url);
<a name="l00740"></a>00740         $url = <span class="stringliteral">&#39;file:///&#39;</span>.$url;
<a name="l00741"></a>00741         $link[<span class="stringliteral">&#39;url&#39;</span>] = $url;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743         <span class="comment">//output formatted</span>
<a name="l00744"></a>00744         $this-&gt;doc .= $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     function emaillink($address, $name = NULL) {
<a name="l00748"></a>00748         global $conf;
<a name="l00749"></a>00749         <span class="comment">//simple setup</span>
<a name="l00750"></a>00750         $link = array();
<a name="l00751"></a>00751         $link[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00752"></a>00752         $link[<span class="stringliteral">&#39;pre&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00753"></a>00753         $link[<span class="stringliteral">&#39;suf&#39;</span>]   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00754"></a>00754         $link[<span class="stringliteral">&#39;style&#39;</span>]  = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00755"></a>00755         $link[<span class="stringliteral">&#39;more&#39;</span>]   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757         $name = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7" title="Construct a title and handle images in titles.">_getLinkTitle</a>($name, <span class="stringliteral">&#39;&#39;</span>, $isImage);
<a name="l00758"></a>00758         <span class="keywordflow">if</span> ( !$isImage ) {
<a name="l00759"></a>00759             $link[<span class="stringliteral">&#39;class&#39;</span>]=<span class="stringliteral">&#39;mail&#39;</span>;
<a name="l00760"></a>00760         } <span class="keywordflow">else</span> {
<a name="l00761"></a>00761             $link[<span class="stringliteral">&#39;class&#39;</span>]=<span class="stringliteral">&#39;media&#39;</span>;
<a name="l00762"></a>00762         }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         $address = $this-&gt;_xmlEntities($address);
<a name="l00765"></a>00765         $address = obfuscate($address);
<a name="l00766"></a>00766         $title   = $address;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768         <span class="keywordflow">if</span>(empty($name)){
<a name="l00769"></a>00769             $name = $address;
<a name="l00770"></a>00770         }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="keywordflow">if</span>($conf[<span class="stringliteral">&#39;mailguard&#39;</span>] == <span class="stringliteral">&#39;visible&#39;</span>) $address = rawurlencode($address);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774         $link[<span class="stringliteral">&#39;url&#39;</span>]   = <span class="stringliteral">&#39;mailto:&#39;</span>.$address;
<a name="l00775"></a>00775         $link[<span class="stringliteral">&#39;name&#39;</span>]  = $name;
<a name="l00776"></a>00776         $link[<span class="stringliteral">&#39;title&#39;</span>] = $title;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778         <span class="comment">//output formatted</span>
<a name="l00779"></a>00779         $this-&gt;doc .= $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782     function internalmedia ($src, $title=NULL, $align=NULL, $width=NULL,
<a name="l00783"></a>00783                             $height=NULL, $cache=NULL, $linking=NULL) {
<a name="l00784"></a>00784         global $ID;
<a name="l00785"></a>00785         list($src,$hash) = explode(<span class="charliteral">&#39;#&#39;</span>,$src,2);
<a name="l00786"></a>00786         resolve_mediaid(getNS($ID),$src, $exists);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788         $noLink = <span class="keyword">false</span>;
<a name="l00789"></a>00789         $render = ($linking == <span class="stringliteral">&#39;linkonly&#39;</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>;
<a name="l00790"></a>00790         $link = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#afd9c8049e60e37807d05579c62dddc1a" title="_getMediaLinkConf is a helperfunction to internalmedia() and externalmedia() which...">_getMediaLinkConf</a>($src, $title, $align, $width, $height, $cache, $render);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792         list($ext,$mime,$dl) = mimetype($src,<span class="keyword">false</span>);
<a name="l00793"></a>00793         <span class="keywordflow">if</span>(substr($mime,0,5) == <span class="stringliteral">&#39;image&#39;</span> &amp;&amp; $render){
<a name="l00794"></a>00794             $link[<span class="stringliteral">&#39;url&#39;</span>] = ml($src,array(<span class="stringliteral">&#39;id&#39;</span>=&gt;$ID,<span class="stringliteral">&#39;cache&#39;</span>=&gt;$cache),($linking==<span class="stringliteral">&#39;direct&#39;</span>));
<a name="l00795"></a>00795         }elseif($mime == <span class="stringliteral">&#39;application/x-shockwave-flash&#39;</span> &amp;&amp; $render){
<a name="l00796"></a>00796             <span class="comment">// don&#39;t link flash movies</span>
<a name="l00797"></a>00797             $noLink = <span class="keyword">true</span>;
<a name="l00798"></a>00798         }<span class="keywordflow">else</span>{
<a name="l00799"></a>00799             <span class="comment">// add file icons</span>
<a name="l00800"></a>00800             $class = preg_replace(<span class="stringliteral">&#39;/[^_\-a-z0-9]+/i&#39;</span>,<span class="charliteral">&#39;_&#39;</span>,$ext);
<a name="l00801"></a>00801             $link[<span class="stringliteral">&#39;class&#39;</span>] .= <span class="stringliteral">&#39; mediafile mf_&#39;</span>.$class;
<a name="l00802"></a>00802             $link[<span class="stringliteral">&#39;url&#39;</span>] = ml($src,array(<span class="stringliteral">&#39;id&#39;</span>=&gt;$ID,<span class="stringliteral">&#39;cache&#39;</span>=&gt;$cache),<span class="keyword">true</span>);
<a name="l00803"></a>00803         }
<a name="l00804"></a>00804 
<a name="l00805"></a>00805         <span class="keywordflow">if</span>($hash) $link[<span class="stringliteral">&#39;url&#39;</span>] .= <span class="charliteral">&#39;#&#39;</span>.$hash;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807         <span class="comment">//markup non existing files</span>
<a name="l00808"></a>00808         <span class="keywordflow">if</span> (!$exists) {
<a name="l00809"></a>00809             $link[<span class="stringliteral">&#39;class&#39;</span>] .= <span class="stringliteral">&#39; wikilink2&#39;</span>;
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812         <span class="comment">//output formatted</span>
<a name="l00813"></a>00813         <span class="keywordflow">if</span> ($linking == <span class="stringliteral">&#39;nolink&#39;</span> || $noLink) $this-&gt;doc .= $link[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00814"></a>00814         <span class="keywordflow">else</span> $this-&gt;doc .= $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     function externalmedia ($src, $title=NULL, $align=NULL, $width=NULL,
<a name="l00818"></a>00818                             $height=NULL, $cache=NULL, $linking=NULL) {
<a name="l00819"></a>00819         list($src,$hash) = explode(<span class="charliteral">&#39;#&#39;</span>,$src,2);
<a name="l00820"></a>00820         $noLink = <span class="keyword">false</span>;
<a name="l00821"></a>00821         $render = ($linking == <span class="stringliteral">&#39;linkonly&#39;</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>;
<a name="l00822"></a>00822         $link = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#afd9c8049e60e37807d05579c62dddc1a" title="_getMediaLinkConf is a helperfunction to internalmedia() and externalmedia() which...">_getMediaLinkConf</a>($src, $title, $align, $width, $height, $cache, $render);
<a name="l00823"></a>00823 
<a name="l00824"></a>00824         $link[<span class="stringliteral">&#39;url&#39;</span>]    = ml($src,array(<span class="stringliteral">&#39;cache&#39;</span>=&gt;$cache));
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         list($ext,$mime,$dl) = mimetype($src,<span class="keyword">false</span>);
<a name="l00827"></a>00827         <span class="keywordflow">if</span>(substr($mime,0,5) == <span class="stringliteral">&#39;image&#39;</span> &amp;&amp; $render){
<a name="l00828"></a>00828             <span class="comment">// link only jpeg images</span>
<a name="l00829"></a>00829             <span class="comment">// if ($ext != &#39;jpg&#39; &amp;&amp; $ext != &#39;jpeg&#39;) $noLink = true;</span>
<a name="l00830"></a>00830         }elseif($mime == <span class="stringliteral">&#39;application/x-shockwave-flash&#39;</span> &amp;&amp; $render){
<a name="l00831"></a>00831             <span class="comment">// don&#39;t link flash movies</span>
<a name="l00832"></a>00832             $noLink = <span class="keyword">true</span>;
<a name="l00833"></a>00833         }<span class="keywordflow">else</span>{
<a name="l00834"></a>00834             <span class="comment">// add file icons</span>
<a name="l00835"></a>00835             $class = preg_replace(<span class="stringliteral">&#39;/[^_\-a-z0-9]+/i&#39;</span>,<span class="charliteral">&#39;_&#39;</span>,$ext);
<a name="l00836"></a>00836             $link[<span class="stringliteral">&#39;class&#39;</span>] .= <span class="stringliteral">&#39; mediafile mf_&#39;</span>.$class;
<a name="l00837"></a>00837         }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839         <span class="keywordflow">if</span>($hash) $link[<span class="stringliteral">&#39;url&#39;</span>] .= <span class="charliteral">&#39;#&#39;</span>.$hash;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841         <span class="comment">//output formatted</span>
<a name="l00842"></a>00842         <span class="keywordflow">if</span> ($linking == <span class="stringliteral">&#39;nolink&#39;</span> || $noLink) $this-&gt;doc .= $link[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00843"></a>00843         <span class="keywordflow">else</span> $this-&gt;doc .= $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link);
<a name="l00844"></a>00844     }
<a name="l00845"></a>00845 
<a name="l00851"></a><a class="code" href="classDoku__Renderer__xhtml.html#a31a83add2a30c158bcc3677458533414">00851</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#a31a83add2a30c158bcc3677458533414" title="Renders an RSS feed.">rss</a> ($url,$params){
<a name="l00852"></a>00852         global $lang;
<a name="l00853"></a>00853         global $conf;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855         require_once(DOKU_INC.<span class="stringliteral">&#39;inc/FeedParser.php&#39;</span>);
<a name="l00856"></a>00856         $feed = <span class="keyword">new</span> <a class="code" href="classFeedParser.html" title="We override some methods of the original SimplePie class here.">FeedParser</a>();
<a name="l00857"></a>00857         $feed-&gt;set_feed_url($url);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859         <span class="comment">//disable warning while fetching</span>
<a name="l00860"></a>00860         <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DOKU_E_LEVEL&#39;</span>)) { $elvl = error_reporting(E_ERROR); }
<a name="l00861"></a>00861         $rc = $feed-&gt;init();
<a name="l00862"></a>00862         <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;DOKU_E_LEVEL&#39;</span>)) { error_reporting($elvl); }
<a name="l00863"></a>00863 
<a name="l00864"></a>00864         <span class="comment">//decide on start and end</span>
<a name="l00865"></a>00865         <span class="keywordflow">if</span>($params[<span class="stringliteral">&#39;reverse&#39;</span>]){
<a name="l00866"></a>00866             $mod = -1;
<a name="l00867"></a>00867             $start = $feed-&gt;get_item_quantity()-1;
<a name="l00868"></a>00868             $end   = $start - ($params[<span class="stringliteral">&#39;max&#39;</span>]);
<a name="l00869"></a>00869             $end   = ($end &lt; -1) ? -1 : $end;
<a name="l00870"></a>00870         }<span class="keywordflow">else</span>{
<a name="l00871"></a>00871             $mod   = 1;
<a name="l00872"></a>00872             $start = 0;
<a name="l00873"></a>00873             $end   = $feed-&gt;get_item_quantity();
<a name="l00874"></a>00874             $end   = ($end &gt; $params[<span class="stringliteral">&#39;max&#39;</span>]) ? $params[<span class="stringliteral">&#39;max&#39;</span>] : $end;;
<a name="l00875"></a>00875         }
<a name="l00876"></a>00876 
<a name="l00877"></a>00877         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;ul class=&quot;rss&quot;&gt;&#39;</span>;
<a name="l00878"></a>00878         <span class="keywordflow">if</span>($rc){
<a name="l00879"></a>00879             <span class="keywordflow">for</span> ($x = $start; $x != $end; $x += $mod) {
<a name="l00880"></a>00880                 $item = $feed-&gt;get_item($x);
<a name="l00881"></a>00881                 $this-&gt;doc .= <span class="stringliteral">&#39;&lt;li&gt;&lt;div class=&quot;li&quot;&gt;&#39;</span>;
<a name="l00882"></a>00882                 <span class="comment">// support feeds without links</span>
<a name="l00883"></a>00883                 $lnkurl = $item-&gt;get_permalink();
<a name="l00884"></a>00884                 <span class="keywordflow">if</span>($lnkurl){
<a name="l00885"></a>00885                     <span class="comment">// title is escaped by SimplePie, we unescape here because it</span>
<a name="l00886"></a>00886                     <span class="comment">// is escaped again in externallink() FS#1705</span>
<a name="l00887"></a>00887                     $this-&gt;externallink($item-&gt;get_permalink(),
<a name="l00888"></a>00888                                         htmlspecialchars_decode($item-&gt;get_title()));
<a name="l00889"></a>00889                 }<span class="keywordflow">else</span>{
<a name="l00890"></a>00890                     $this-&gt;doc .= <span class="charliteral">&#39; &#39;</span>.$item-&gt;get_title();
<a name="l00891"></a>00891                 }
<a name="l00892"></a>00892                 <span class="keywordflow">if</span>($params[<span class="stringliteral">&#39;author&#39;</span>]){
<a name="l00893"></a>00893                     $author = $item-&gt;get_author(0);
<a name="l00894"></a>00894                     <span class="keywordflow">if</span>($author){
<a name="l00895"></a>00895                         $name = $author-&gt;get_name();
<a name="l00896"></a>00896                         <span class="keywordflow">if</span>(!$name) $name = $author-&gt;get_email();
<a name="l00897"></a>00897                         <span class="keywordflow">if</span>($name) $this-&gt;doc .= <span class="charliteral">&#39; &#39;</span>.$lang[<span class="stringliteral">&#39;by&#39;</span>].<span class="charliteral">&#39; &#39;</span>.$name;
<a name="l00898"></a>00898                     }
<a name="l00899"></a>00899                 }
<a name="l00900"></a>00900                 <span class="keywordflow">if</span>($params[<span class="stringliteral">&#39;date&#39;</span>]){
<a name="l00901"></a>00901                     $this-&gt;doc .= <span class="stringliteral">&#39; (&#39;</span>.$item-&gt;get_local_date($conf[<span class="stringliteral">&#39;dformat&#39;</span>]).<span class="charliteral">&#39;)&#39;</span>;
<a name="l00902"></a>00902                 }
<a name="l00903"></a>00903                 <span class="keywordflow">if</span>($params[<span class="stringliteral">&#39;details&#39;</span>]){
<a name="l00904"></a>00904                     $this-&gt;doc .= <span class="stringliteral">&#39;&lt;div class=&quot;detail&quot;&gt;&#39;</span>;
<a name="l00905"></a>00905                     <span class="keywordflow">if</span>($conf[<span class="stringliteral">&#39;htmlok&#39;</span>]){
<a name="l00906"></a>00906                         $this-&gt;doc .= $item-&gt;get_description();
<a name="l00907"></a>00907                     }<span class="keywordflow">else</span>{
<a name="l00908"></a>00908                         $this-&gt;doc .= strip_tags($item-&gt;get_description());
<a name="l00909"></a>00909                     }
<a name="l00910"></a>00910                     $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l00911"></a>00911                 }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913                 $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;/li&gt;&#39;</span>;
<a name="l00914"></a>00914             }
<a name="l00915"></a>00915         }<span class="keywordflow">else</span>{
<a name="l00916"></a>00916             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;li&gt;&lt;div class=&quot;li&quot;&gt;&#39;</span>;
<a name="l00917"></a>00917             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;em&gt;&#39;</span>.$lang[<span class="stringliteral">&#39;rssfailed&#39;</span>].<span class="stringliteral">&#39;&lt;/em&gt;&#39;</span>;
<a name="l00918"></a>00918             $this-&gt;externallink($url);
<a name="l00919"></a>00919             <span class="keywordflow">if</span>($conf[<span class="stringliteral">&#39;allowdebug&#39;</span>]){
<a name="l00920"></a>00920                 $this-&gt;doc .= <span class="stringliteral">&#39;&lt;!--&#39;</span>.hsc($feed-&gt;error).<span class="stringliteral">&#39;--&gt;&#39;</span>;
<a name="l00921"></a>00921             }
<a name="l00922"></a>00922             $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;/li&gt;&#39;</span>;
<a name="l00923"></a>00923         }
<a name="l00924"></a>00924         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/ul&gt;&#39;</span>;
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <span class="comment">// $numrows not yet implemented</span>
<a name="l00928"></a>00928     function table_open($maxcols = null, $numrows = null, $pos = null){
<a name="l00929"></a>00929         global $lang;
<a name="l00930"></a>00930         <span class="comment">// initialize the row counter used for classes</span>
<a name="l00931"></a>00931         $this-&gt;_counter[<span class="stringliteral">&#39;row_counter&#39;</span>] = 0;
<a name="l00932"></a>00932         $class = <span class="stringliteral">&#39;table&#39;</span>;
<a name="l00933"></a>00933         <span class="keywordflow">if</span> ($pos !== null) {
<a name="l00934"></a>00934             $class .= <span class="charliteral">&#39; &#39;</span> . $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#a362f3c5a77b486cdcad740c3c82a326a" title="Register a new edit section range.">startSectionEdit</a>($pos, <span class="stringliteral">&#39;table&#39;</span>);
<a name="l00935"></a>00935         }
<a name="l00936"></a>00936         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;div class=&quot;&#39;</span> . $class . <span class="stringliteral">&#39;&quot;&gt;&lt;table class=&quot;inline&quot;&gt;&#39;</span> .
<a name="l00937"></a>00937                       DOKU_LF;
<a name="l00938"></a>00938     }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     function table_close($pos = null){
<a name="l00941"></a>00941         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/table&gt;&lt;/div&gt;&#39;</span>.DOKU_LF;
<a name="l00942"></a>00942         <span class="keywordflow">if</span> ($pos !== null) {
<a name="l00943"></a>00943             $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#aa6456812443ff0a4cd4552ab60483658" title="Finish an edit section range.">finishSectionEdit</a>($pos);
<a name="l00944"></a>00944         }
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     function tablerow_open(){
<a name="l00948"></a>00948         <span class="comment">// initialize the cell counter used for classes</span>
<a name="l00949"></a>00949         $this-&gt;_counter[<span class="stringliteral">&#39;cell_counter&#39;</span>] = 0;
<a name="l00950"></a>00950         $class = <span class="stringliteral">&#39;row&#39;</span> . $this-&gt;_counter[<span class="stringliteral">&#39;row_counter&#39;</span>]++;
<a name="l00951"></a>00951         $this-&gt;doc .= DOKU_TAB . <span class="stringliteral">&#39;&lt;tr class=&quot;&#39;</span>.$class.<span class="stringliteral">&#39;&quot;&gt;&#39;</span> . DOKU_LF . DOKU_TAB . DOKU_TAB;
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     function tablerow_close(){
<a name="l00955"></a>00955         $this-&gt;doc .= DOKU_LF . DOKU_TAB . <span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span> . DOKU_LF;
<a name="l00956"></a>00956     }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     function tableheader_open($colspan = 1, $align = NULL, $rowspan = 1){
<a name="l00959"></a>00959         $class = <span class="stringliteral">&#39;class=&quot;col&#39;</span> . $this-&gt;_counter[<span class="stringliteral">&#39;cell_counter&#39;</span>]++;
<a name="l00960"></a>00960         <span class="keywordflow">if</span> ( !is_null($align) ) {
<a name="l00961"></a>00961             $class .= <span class="charliteral">&#39; &#39;</span>.$align.<span class="stringliteral">&#39;align&#39;</span>;
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963         $class .= <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00964"></a>00964         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;th &#39;</span> . $class;
<a name="l00965"></a>00965         <span class="keywordflow">if</span> ( $colspan &gt; 1 ) {
<a name="l00966"></a>00966             $this-&gt;_counter[<span class="stringliteral">&#39;cell_counter&#39;</span>] += $colspan-1;
<a name="l00967"></a>00967             $this-&gt;doc .= <span class="stringliteral">&#39; colspan=&quot;&#39;</span>.$colspan.<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00968"></a>00968         }
<a name="l00969"></a>00969         <span class="keywordflow">if</span> ( $rowspan &gt; 1 ) {
<a name="l00970"></a>00970             $this-&gt;doc .= <span class="stringliteral">&#39; rowspan=&quot;&#39;</span>.$rowspan.<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00971"></a>00971         }
<a name="l00972"></a>00972         $this-&gt;doc .= <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l00973"></a>00973     }
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     function tableheader_close(){
<a name="l00976"></a>00976         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/th&gt;&#39;</span>;
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     function tablecell_open($colspan = 1, $align = NULL, $rowspan = 1){
<a name="l00980"></a>00980         $class = <span class="stringliteral">&#39;class=&quot;col&#39;</span> . $this-&gt;_counter[<span class="stringliteral">&#39;cell_counter&#39;</span>]++;
<a name="l00981"></a>00981         <span class="keywordflow">if</span> ( !is_null($align) ) {
<a name="l00982"></a>00982             $class .= <span class="charliteral">&#39; &#39;</span>.$align.<span class="stringliteral">&#39;align&#39;</span>;
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984         $class .= <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00985"></a>00985         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;td &#39;</span>.$class;
<a name="l00986"></a>00986         <span class="keywordflow">if</span> ( $colspan &gt; 1 ) {
<a name="l00987"></a>00987             $this-&gt;_counter[<span class="stringliteral">&#39;cell_counter&#39;</span>] += $colspan-1;
<a name="l00988"></a>00988             $this-&gt;doc .= <span class="stringliteral">&#39; colspan=&quot;&#39;</span>.$colspan.<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00989"></a>00989         }
<a name="l00990"></a>00990         <span class="keywordflow">if</span> ( $rowspan &gt; 1 ) {
<a name="l00991"></a>00991             $this-&gt;doc .= <span class="stringliteral">&#39; rowspan=&quot;&#39;</span>.$rowspan.<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00992"></a>00992         }
<a name="l00993"></a>00993         $this-&gt;doc .= <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l00994"></a>00994     }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996     function tablecell_close(){
<a name="l00997"></a>00997         $this-&gt;doc .= <span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;
<a name="l00998"></a>00998     }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000     <span class="comment">//----------------------------------------------------------</span>
<a name="l01001"></a>01001     <span class="comment">// Utils</span>
<a name="l01002"></a>01002 
<a name="l01010"></a><a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137">01010</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#ac18c46aa0534a15e6d8bbd0201d08137" title="Build a link.">_formatLink</a>($link){
<a name="l01011"></a>01011         <span class="comment">//make sure the url is XHTML compliant (skip mailto)</span>
<a name="l01012"></a>01012         <span class="keywordflow">if</span>(substr($link[<span class="stringliteral">&#39;url&#39;</span>],0,7) != <span class="stringliteral">&#39;mailto:&#39;</span>){
<a name="l01013"></a>01013             $link[<span class="stringliteral">&#39;url&#39;</span>] = str_replace(<span class="charliteral">&#39;&amp;&#39;</span>,<span class="stringliteral">&#39;&amp;amp;&#39;</span>,$link[<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l01014"></a>01014             $link[<span class="stringliteral">&#39;url&#39;</span>] = str_replace(<span class="stringliteral">&#39;&amp;amp;amp;&#39;</span>,<span class="stringliteral">&#39;&amp;amp;&#39;</span>,$link[<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l01015"></a>01015         }
<a name="l01016"></a>01016         <span class="comment">//remove double encodings in titles</span>
<a name="l01017"></a>01017         $link[<span class="stringliteral">&#39;title&#39;</span>] = str_replace(<span class="stringliteral">&#39;&amp;amp;amp;&#39;</span>,<span class="stringliteral">&#39;&amp;amp;&#39;</span>,$link[<span class="stringliteral">&#39;title&#39;</span>]);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         <span class="comment">// be sure there are no bad chars in url or title</span>
<a name="l01020"></a>01020         <span class="comment">// (we can&#39;t do this for name because it can contain an img tag)</span>
<a name="l01021"></a>01021         $link[<span class="stringliteral">&#39;url&#39;</span>]   = strtr($link[<span class="stringliteral">&#39;url&#39;</span>],array(<span class="charliteral">&#39;&gt;&#39;</span>=&gt;<span class="stringliteral">&#39;%3E&#39;</span>,<span class="charliteral">&#39;&lt;&#39;</span>=&gt;<span class="stringliteral">&#39;%3C&#39;</span>,<span class="charliteral">&#39;&quot;&#39;</span>=&gt;<span class="stringliteral">&#39;%22&#39;</span>));
<a name="l01022"></a>01022         $link[<span class="stringliteral">&#39;title&#39;</span>] = strtr($link[<span class="stringliteral">&#39;title&#39;</span>],array(<span class="charliteral">&#39;&gt;&#39;</span>=&gt;<span class="stringliteral">&#39;&amp;gt;&#39;</span>,<span class="charliteral">&#39;&lt;&#39;</span>=&gt;<span class="stringliteral">&#39;&amp;lt;&#39;</span>,<span class="charliteral">&#39;&quot;&#39;</span>=&gt;<span class="stringliteral">&#39;&amp;quot;&#39;</span>));
<a name="l01023"></a>01023 
<a name="l01024"></a>01024         $ret  = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01025"></a>01025         $ret .= $link[<span class="stringliteral">&#39;pre&#39;</span>];
<a name="l01026"></a>01026         $ret .= <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span>.$link[<span class="stringliteral">&#39;url&#39;</span>].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01027"></a>01027         <span class="keywordflow">if</span>(!empty($link[<span class="stringliteral">&#39;class&#39;</span>]))  $ret .= <span class="stringliteral">&#39; class=&quot;&#39;</span>.$link[<span class="stringliteral">&#39;class&#39;</span>].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01028"></a>01028         <span class="keywordflow">if</span>(!empty($link[<span class="stringliteral">&#39;target&#39;</span>])) $ret .= <span class="stringliteral">&#39; target=&quot;&#39;</span>.$link[<span class="stringliteral">&#39;target&#39;</span>].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01029"></a>01029         <span class="keywordflow">if</span>(!empty($link[<span class="stringliteral">&#39;title&#39;</span>]))  $ret .= <span class="stringliteral">&#39; title=&quot;&#39;</span>.$link[<span class="stringliteral">&#39;title&#39;</span>].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01030"></a>01030         <span class="keywordflow">if</span>(!empty($link[<span class="stringliteral">&#39;style&#39;</span>]))  $ret .= <span class="stringliteral">&#39; style=&quot;&#39;</span>.$link[<span class="stringliteral">&#39;style&#39;</span>].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01031"></a>01031         <span class="keywordflow">if</span>(!empty($link[<span class="stringliteral">&#39;rel&#39;</span>]))    $ret .= <span class="stringliteral">&#39; rel=&quot;&#39;</span>.$link[<span class="stringliteral">&#39;rel&#39;</span>].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01032"></a>01032         <span class="keywordflow">if</span>(!empty($link[<span class="stringliteral">&#39;more&#39;</span>]))   $ret .= <span class="charliteral">&#39; &#39;</span>.$link[<span class="stringliteral">&#39;more&#39;</span>];
<a name="l01033"></a>01033         $ret .= <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l01034"></a>01034         $ret .= $link[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01035"></a>01035         $ret .= <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;
<a name="l01036"></a>01036         $ret .= $link[<span class="stringliteral">&#39;suf&#39;</span>];
<a name="l01037"></a>01037         <span class="keywordflow">return</span> $ret;
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039 
<a name="l01045"></a><a class="code" href="classDoku__Renderer__xhtml.html#a5e078c1ea5ed97c37834686367b05d6e">01045</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#a5e078c1ea5ed97c37834686367b05d6e" title="Renders internal and external media.">_media</a> ($src, $title=NULL, $align=NULL, $width=NULL,
<a name="l01046"></a>01046                       $height=NULL, $cache=NULL, $render = <span class="keyword">true</span>) {
<a name="l01047"></a>01047 
<a name="l01048"></a>01048         $ret = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050         list($ext,$mime,$dl) = mimetype($src);
<a name="l01051"></a>01051         <span class="keywordflow">if</span>(substr($mime,0,5) == <span class="stringliteral">&#39;image&#39;</span>){
<a name="l01052"></a>01052             <span class="comment">// first get the $title</span>
<a name="l01053"></a>01053             <span class="keywordflow">if</span> (!is_null($title)) {
<a name="l01054"></a>01054                 $title  = $this-&gt;_xmlEntities($title);
<a name="l01055"></a>01055             }elseif($ext == <span class="stringliteral">&#39;jpg&#39;</span> || $ext == <span class="stringliteral">&#39;jpeg&#39;</span>){
<a name="l01056"></a>01056                 <span class="comment">//try to use the caption from IPTC/EXIF</span>
<a name="l01057"></a>01057                 require_once(DOKU_INC.<span class="stringliteral">&#39;inc/JpegMeta.php&#39;</span>);
<a name="l01058"></a>01058                 $jpeg =<span class="keyword">new</span> <a class="code" href="classJpegMeta.html" title="JPEG metadata reader/writer.">JpegMeta</a>(mediaFN($src));
<a name="l01059"></a>01059                 <span class="keywordflow">if</span>($jpeg !== <span class="keyword">false</span>) $cap = $jpeg-&gt;getTitle();
<a name="l01060"></a>01060                 <span class="keywordflow">if</span>($cap){
<a name="l01061"></a>01061                     $title = $this-&gt;_xmlEntities($cap);
<a name="l01062"></a>01062                 }
<a name="l01063"></a>01063             }
<a name="l01064"></a>01064             <span class="keywordflow">if</span> (!$render) {
<a name="l01065"></a>01065                 <span class="comment">// if the picture is not supposed to be rendered</span>
<a name="l01066"></a>01066                 <span class="comment">// return the title of the picture</span>
<a name="l01067"></a>01067                 <span class="keywordflow">if</span> (!$title) {
<a name="l01068"></a>01068                     <span class="comment">// just show the sourcename</span>
<a name="l01069"></a>01069                     $title = $this-&gt;_xmlEntities(basename(noNS($src)));
<a name="l01070"></a>01070                 }
<a name="l01071"></a>01071                 <span class="keywordflow">return</span> $title;
<a name="l01072"></a>01072             }
<a name="l01073"></a>01073             <span class="comment">//add image tag</span>
<a name="l01074"></a>01074             $ret .= <span class="stringliteral">&#39;&lt;img src=&quot;&#39;</span>.ml($src,array(<span class="charliteral">&#39;w&#39;</span>=&gt;$width,<span class="charliteral">&#39;h&#39;</span>=&gt;$height,<span class="stringliteral">&#39;cache&#39;</span>=&gt;$cache)).<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01075"></a>01075             $ret .= <span class="stringliteral">&#39; class=&quot;media&#39;</span>.$align.<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077             <span class="comment">// make left/right alignment for no-CSS view work (feeds)</span>
<a name="l01078"></a>01078             <span class="keywordflow">if</span>($align == <span class="stringliteral">&#39;right&#39;</span>) $ret .= <span class="stringliteral">&#39; align=&quot;right&quot;&#39;</span>;
<a name="l01079"></a>01079             <span class="keywordflow">if</span>($align == <span class="stringliteral">&#39;left&#39;</span>)  $ret .= <span class="stringliteral">&#39; align=&quot;left&quot;&#39;</span>;
<a name="l01080"></a>01080 
<a name="l01081"></a>01081             <span class="keywordflow">if</span> ($title) {
<a name="l01082"></a>01082                 $ret .= <span class="stringliteral">&#39; title=&quot;&#39;</span> . $title . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01083"></a>01083                 $ret .= <span class="stringliteral">&#39; alt=&quot;&#39;</span>   . $title .<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01084"></a>01084             }<span class="keywordflow">else</span>{
<a name="l01085"></a>01085                 $ret .= <span class="stringliteral">&#39; alt=&quot;&quot;&#39;</span>;
<a name="l01086"></a>01086             }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088             <span class="keywordflow">if</span> ( !is_null($width) )
<a name="l01089"></a>01089                 $ret .= <span class="stringliteral">&#39; width=&quot;&#39;</span>.$this-&gt;_xmlEntities($width).<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091             <span class="keywordflow">if</span> ( !is_null($height) )
<a name="l01092"></a>01092                 $ret .= <span class="stringliteral">&#39; height=&quot;&#39;</span>.$this-&gt;_xmlEntities($height).<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094             $ret .= <span class="stringliteral">&#39; /&gt;&#39;</span>;
<a name="l01095"></a>01095 
<a name="l01096"></a>01096         }elseif($mime == <span class="stringliteral">&#39;application/x-shockwave-flash&#39;</span>){
<a name="l01097"></a>01097             <span class="keywordflow">if</span> (!$render) {
<a name="l01098"></a>01098                 <span class="comment">// if the flash is not supposed to be rendered</span>
<a name="l01099"></a>01099                 <span class="comment">// return the title of the flash</span>
<a name="l01100"></a>01100                 <span class="keywordflow">if</span> (!$title) {
<a name="l01101"></a>01101                     <span class="comment">// just show the sourcename</span>
<a name="l01102"></a>01102                     $title = basename(noNS($src));
<a name="l01103"></a>01103                 }
<a name="l01104"></a>01104                 <span class="keywordflow">return</span> $this-&gt;_xmlEntities($title);
<a name="l01105"></a>01105             }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107             $att = array();
<a name="l01108"></a>01108             $att[<span class="stringliteral">&#39;class&#39;</span>] = <span class="stringliteral">&quot;media$align&quot;</span>;
<a name="l01109"></a>01109             <span class="keywordflow">if</span>($align == <span class="stringliteral">&#39;right&#39;</span>) $att[<span class="stringliteral">&#39;align&#39;</span>] = <span class="stringliteral">&#39;right&#39;</span>;
<a name="l01110"></a>01110             <span class="keywordflow">if</span>($align == <span class="stringliteral">&#39;left&#39;</span>)  $att[<span class="stringliteral">&#39;align&#39;</span>] = <span class="stringliteral">&#39;left&#39;</span>;
<a name="l01111"></a>01111             $ret .= html_flashobject(ml($src,array(<span class="stringliteral">&#39;cache&#39;</span>=&gt;$cache),<span class="keyword">true</span>,<span class="charliteral">&#39;&amp;&#39;</span>),$width,$height,
<a name="l01112"></a>01112                                      array(<span class="stringliteral">&#39;quality&#39;</span> =&gt; <span class="stringliteral">&#39;high&#39;</span>),
<a name="l01113"></a>01113                                      null,
<a name="l01114"></a>01114                                      $att,
<a name="l01115"></a>01115                                      $this-&gt;_xmlEntities($title));
<a name="l01116"></a>01116         }elseif($title){
<a name="l01117"></a>01117             <span class="comment">// well at least we have a title to display</span>
<a name="l01118"></a>01118             $ret .= $this-&gt;_xmlEntities($title);
<a name="l01119"></a>01119         }<span class="keywordflow">else</span>{
<a name="l01120"></a>01120             <span class="comment">// just show the sourcename</span>
<a name="l01121"></a>01121             $ret .= $this-&gt;_xmlEntities(basename(noNS($src)));
<a name="l01122"></a>01122         }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124         <span class="keywordflow">return</span> $ret;
<a name="l01125"></a>01125     }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     function _xmlEntities($string) {
<a name="l01128"></a>01128         <span class="keywordflow">return</span> htmlspecialchars($string,ENT_QUOTES,<span class="stringliteral">&#39;UTF-8&#39;</span>);
<a name="l01129"></a>01129     }
<a name="l01130"></a>01130 
<a name="l01138"></a><a class="code" href="classDoku__Renderer__xhtml.html#ac1b334f07c4b2a876be90101d10d8c75">01138</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#ac1b334f07c4b2a876be90101d10d8c75" title="Creates a linkid from a headline.">_headerToLink</a>($title,$create=<span class="keyword">false</span>) {
<a name="l01139"></a>01139         <span class="keywordflow">if</span>($create){
<a name="l01140"></a>01140             <span class="keywordflow">return</span> sectionID($title,$this-&gt;headers);
<a name="l01141"></a>01141         }<span class="keywordflow">else</span>{
<a name="l01142"></a>01142             $check = <span class="keyword">false</span>;
<a name="l01143"></a>01143             <span class="keywordflow">return</span> sectionID($title,$check);
<a name="l01144"></a>01144         }
<a name="l01145"></a>01145     }
<a name="l01146"></a>01146 
<a name="l01152"></a><a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7">01152</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#ac3bb5119883bf3cc3e5b0efd34ae32b7" title="Construct a title and handle images in titles.">_getLinkTitle</a>($title, $default, &amp; $isImage, $id=NULL, $linktype=<span class="stringliteral">&#39;content&#39;</span>) {
<a name="l01153"></a>01153         global $conf;
<a name="l01154"></a>01154 
<a name="l01155"></a>01155         $isImage = <span class="keyword">false</span>;
<a name="l01156"></a>01156         <span class="keywordflow">if</span> ( is_array($title) ) {
<a name="l01157"></a>01157             $isImage = <span class="keyword">true</span>;
<a name="l01158"></a>01158             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#aaab03ea5e32040029244188db09b4062" title="Returns an HTML code for images used in link titles.">_imageTitle</a>($title);
<a name="l01159"></a>01159         } elseif ( is_null($title) || trim($title)==<span class="stringliteral">&#39;&#39;</span>) {
<a name="l01160"></a>01160             <span class="keywordflow">if</span> (useHeading($linktype) &amp;&amp; $id) {
<a name="l01161"></a>01161                 $heading = p_get_first_heading($id);
<a name="l01162"></a>01162                 <span class="keywordflow">if</span> ($heading) {
<a name="l01163"></a>01163                     <span class="keywordflow">return</span> $this-&gt;_xmlEntities($heading);
<a name="l01164"></a>01164                 }
<a name="l01165"></a>01165             }
<a name="l01166"></a>01166             <span class="keywordflow">return</span> $this-&gt;_xmlEntities($default);
<a name="l01167"></a>01167         } <span class="keywordflow">else</span> {
<a name="l01168"></a>01168             <span class="keywordflow">return</span> $this-&gt;_xmlEntities($title);
<a name="l01169"></a>01169         }
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171 
<a name="l01178"></a><a class="code" href="classDoku__Renderer__xhtml.html#aaab03ea5e32040029244188db09b4062">01178</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#aaab03ea5e32040029244188db09b4062" title="Returns an HTML code for images used in link titles.">_imageTitle</a>($img) {
<a name="l01179"></a>01179         global $ID;
<a name="l01180"></a>01180 
<a name="l01181"></a>01181         <span class="comment">// some fixes on $img[&#39;src&#39;]</span>
<a name="l01182"></a>01182         <span class="comment">// see internalmedia() and externalmedia()</span>
<a name="l01183"></a>01183         list($img[<span class="stringliteral">&#39;src&#39;</span>],$hash) = explode(<span class="charliteral">&#39;#&#39;</span>,$img[<span class="stringliteral">&#39;src&#39;</span>],2);
<a name="l01184"></a>01184         <span class="keywordflow">if</span> ($img[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;internalmedia&#39;</span>) {
<a name="l01185"></a>01185             resolve_mediaid(getNS($ID),$img[<span class="stringliteral">&#39;src&#39;</span>],$exists);
<a name="l01186"></a>01186         }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#a5e078c1ea5ed97c37834686367b05d6e" title="Renders internal and external media.">_media</a>($img[<span class="stringliteral">&#39;src&#39;</span>],
<a name="l01189"></a>01189                               $img[<span class="stringliteral">&#39;title&#39;</span>],
<a name="l01190"></a>01190                               $img[<span class="stringliteral">&#39;align&#39;</span>],
<a name="l01191"></a>01191                               $img[<span class="stringliteral">&#39;width&#39;</span>],
<a name="l01192"></a>01192                               $img[<span class="stringliteral">&#39;height&#39;</span>],
<a name="l01193"></a>01193                               $img[<span class="stringliteral">&#39;cache&#39;</span>]);
<a name="l01194"></a>01194     }
<a name="l01195"></a>01195 
<a name="l01211"></a><a class="code" href="classDoku__Renderer__xhtml.html#afd9c8049e60e37807d05579c62dddc1a">01211</a>     function <a class="code" href="classDoku__Renderer__xhtml.html#afd9c8049e60e37807d05579c62dddc1a" title="_getMediaLinkConf is a helperfunction to internalmedia() and externalmedia() which...">_getMediaLinkConf</a>($src, $title, $align, $width, $height, $cache, $render)
<a name="l01212"></a>01212     {
<a name="l01213"></a>01213         global $conf;
<a name="l01214"></a>01214 
<a name="l01215"></a>01215         $link = array();
<a name="l01216"></a>01216         $link[<span class="stringliteral">&#39;class&#39;</span>]  = <span class="stringliteral">&#39;media&#39;</span>;
<a name="l01217"></a>01217         $link[<span class="stringliteral">&#39;style&#39;</span>]  = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01218"></a>01218         $link[<span class="stringliteral">&#39;pre&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01219"></a>01219         $link[<span class="stringliteral">&#39;suf&#39;</span>]    = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01220"></a>01220         $link[<span class="stringliteral">&#39;more&#39;</span>]   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01221"></a>01221         $link[<span class="stringliteral">&#39;target&#39;</span>] = $conf[<span class="stringliteral">&#39;target&#39;</span>][<span class="stringliteral">&#39;media&#39;</span>];
<a name="l01222"></a>01222         $link[<span class="stringliteral">&#39;title&#39;</span>]  = $this-&gt;_xmlEntities($src);
<a name="l01223"></a>01223         $link[<span class="stringliteral">&#39;name&#39;</span>]   = $this-&gt;<a class="code" href="classDoku__Renderer__xhtml.html#a5e078c1ea5ed97c37834686367b05d6e" title="Renders internal and external media.">_media</a>($src, $title, $align, $width, $height, $cache, $render);
<a name="l01224"></a>01224 
<a name="l01225"></a>01225         <span class="keywordflow">return</span> $link;
<a name="l01226"></a>01226     }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 }
<a name="l01230"></a>01230 
<a name="l01231"></a>01231 <span class="comment">//Setup VIM: ex: et ts=4 :</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
