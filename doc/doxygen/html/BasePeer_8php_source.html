<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/propel/util/BasePeer.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/propel/util/BasePeer.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> *  $Id: BasePeer.php 1608 2010-03-15 23:09:22Z francois $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information please see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://propel.phpdb.org&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00041"></a><a class="code" href="classBasePeer.html">00041</a> <span class="keyword">class </span><a class="code" href="classBasePeer.html">BasePeer</a>
<a name="l00042"></a>00042 {
<a name="l00043"></a>00043 
<a name="l00045"></a>00045   <span class="keyword">private</span> <span class="keyword">static</span> $mapBuilders = array();
<a name="l00046"></a>00046 
<a name="l00048"></a>00048   <span class="keyword">private</span> <span class="keyword">static</span> $validatorMap = array();
<a name="l00049"></a>00049 
<a name="l00054"></a><a class="code" href="classBasePeer.html#a212cab2dac429cb64b236da762d94a51">00054</a>   <span class="keyword">const</span> <a class="code" href="classBasePeer.html#a212cab2dac429cb64b236da762d94a51" title="phpname type e.g.">TYPE_PHPNAME</a> = <span class="stringliteral">&#39;phpName&#39;</span>;
<a name="l00055"></a>00055 
<a name="l00060"></a><a class="code" href="classBasePeer.html#adba0c3c3aebd535fbbf54b99e500fc6f">00060</a>   <span class="keyword">const</span> <a class="code" href="classBasePeer.html#adba0c3c3aebd535fbbf54b99e500fc6f" title="studlyphpname type e.g.">TYPE_STUDLYPHPNAME</a> = <span class="stringliteral">&#39;studlyPhpName&#39;</span>;
<a name="l00061"></a>00061 
<a name="l00066"></a><a class="code" href="classBasePeer.html#a3eaf6ce024fbc5b53c888ef21a9d7907">00066</a>   <span class="keyword">const</span> <a class="code" href="classBasePeer.html#a3eaf6ce024fbc5b53c888ef21a9d7907" title="column (peer) name type e.g.">TYPE_COLNAME</a> = <span class="stringliteral">&#39;colName&#39;</span>;
<a name="l00067"></a>00067 
<a name="l00072"></a><a class="code" href="classBasePeer.html#aee576443cb3890794716fc37bfc7a715">00072</a>   <span class="keyword">const</span> <a class="code" href="classBasePeer.html#aee576443cb3890794716fc37bfc7a715" title="column fieldname type e.g.">TYPE_FIELDNAME</a> = <span class="stringliteral">&#39;fieldName&#39;</span>;
<a name="l00073"></a>00073 
<a name="l00078"></a><a class="code" href="classBasePeer.html#a431af4194c1d0a9c52901bbecaceba64">00078</a>   <span class="keyword">const</span> <a class="code" href="classBasePeer.html#a431af4194c1d0a9c52901bbecaceba64" title="num type simply the numerical array index, e.g.">TYPE_NUM</a> = <span class="stringliteral">&#39;num&#39;</span>;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080   <span class="keyword">static</span> <span class="keyword">public</span> function getFieldnames ($classname, $type = self::TYPE_PHPNAME) {
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <span class="comment">// TODO we should take care of including the peer class here</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     $peerclass = <span class="stringliteral">&#39;Base&#39;</span> . $classname . <span class="stringliteral">&#39;Peer&#39;</span>; <span class="comment">// TODO is this always true?</span>
<a name="l00085"></a>00085     $callable = array($peerclass, <span class="stringliteral">&#39;getFieldnames&#39;</span>);
<a name="l00086"></a>00086     $args = array($type);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <span class="keywordflow">return</span> call_user_func_array($callable, $args);
<a name="l00089"></a>00089   }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <span class="keyword">static</span> <span class="keyword">public</span> function translateFieldname($classname, $fieldname, $fromType, $toType) {
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">// TODO we should take care of including the peer class here</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     $peerclass = <span class="stringliteral">&#39;Base&#39;</span> . $classname . <span class="stringliteral">&#39;Peer&#39;</span>; <span class="comment">// TODO is this always true?</span>
<a name="l00096"></a>00096     $callable = array($peerclass, <span class="stringliteral">&#39;translateFieldname&#39;</span>);
<a name="l00097"></a>00097     $args = array($fieldname, $fromType, $toType);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="keywordflow">return</span> call_user_func_array($callable, $args);
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101 
<a name="l00115"></a><a class="code" href="classBasePeer.html#a3144df9a5c02dccf0cb136b75c1d7ed2">00115</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#a3144df9a5c02dccf0cb136b75c1d7ed2" title="Method to perform deletes based on values and keys in a Criteria.">doDelete</a>(<a class="code" href="classCriteria.html">Criteria</a> $criteria, <a class="code" href="classPropelPDO.html">PropelPDO</a> $con)
<a name="l00116"></a>00116   {
<a name="l00117"></a>00117     $db = <a class="code" href="classPropel.html#ace7bfbefa3e8c60f4df548e12070af13" title="Returns database adapter for a specific datasource.">Propel::getDB</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00118"></a>00118     $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="comment">// Set up a list of required tables (one DELETE statement will</span>
<a name="l00121"></a>00121     <span class="comment">// be executed per table)</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     $tables_keys = array();
<a name="l00124"></a>00124     <span class="keywordflow">foreach</span> ($criteria as $c) {
<a name="l00125"></a>00125       <span class="keywordflow">foreach</span> ($c-&gt;getAllTables() as $tableName) {
<a name="l00126"></a>00126         $tableName2 = $criteria-&gt;<a class="code" href="classCriteria.html#a0c449eb2b146792a8f92523f71e74aa4" title="Returns the table name associated with an alias.">getTableForAlias</a>($tableName);
<a name="l00127"></a>00127         <span class="keywordflow">if</span> ($tableName2 !== null) {
<a name="l00128"></a>00128           $tables_keys[$tableName2 . <span class="charliteral">&#39; &#39;</span> . $tableName] = <span class="keyword">true</span>;
<a name="l00129"></a>00129         } <span class="keywordflow">else</span> {
<a name="l00130"></a>00130           $tables_keys[$tableName] = <span class="keyword">true</span>;
<a name="l00131"></a>00131         }
<a name="l00132"></a>00132       }
<a name="l00133"></a>00133     } <span class="comment">// foreach criteria-&gt;keys()</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     $affectedRows = 0; <span class="comment">// initialize this in case the next loop has no iterations.</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     $tables = array_keys($tables_keys);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="keywordflow">foreach</span> ($tables as $tableName) {
<a name="l00140"></a>00140 
<a name="l00141"></a>00141       $whereClause = array();
<a name="l00142"></a>00142       $selectParams = array();
<a name="l00143"></a>00143       <span class="keywordflow">foreach</span> ($dbMap-&gt;getTable($tableName)-&gt;getColumns() as $colMap) {
<a name="l00144"></a>00144         $key = $tableName . <span class="charliteral">&#39;.&#39;</span> . $colMap-&gt;getColumnName();
<a name="l00145"></a>00145         <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a2b84a5248427857d7be444531de3e71d" title="Does this Criteria object contain the specified key?">containsKey</a>($key)) {
<a name="l00146"></a>00146           $sb = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00147"></a>00147           $criteria-&gt;<a class="code" href="classCriteria.html#aa39fd5150d9969b4336ca153ba5b657e" title="Method to return criteria related to columns in a table.">getCriterion</a>($key)-&gt;appendPsTo($sb, $selectParams);
<a name="l00148"></a>00148           $whereClause[] = $sb;
<a name="l00149"></a>00149         }
<a name="l00150"></a>00150       }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       <span class="keywordflow">if</span> (empty($whereClause)) {
<a name="l00153"></a>00153         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Cowardly refusing to delete from table $tableName with empty WHERE clause.&quot;</span>);
<a name="l00154"></a>00154       }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156       <span class="comment">// Execute the statement.</span>
<a name="l00157"></a>00157       <span class="keywordflow">try</span> {
<a name="l00158"></a>00158         $sql = <span class="stringliteral">&quot;DELETE FROM &quot;</span> . $tableName . <span class="stringliteral">&quot; WHERE &quot;</span> .  implode(<span class="stringliteral">&quot; AND &quot;</span>, $whereClause);
<a name="l00159"></a>00159         $stmt = $con-&gt;<a class="code" href="classPropelPDO.html#a6b9432e5ce03aedbd33f8a1a1f4cbfba" title="Overrides PDO::prepare() to add query caching support if the PropelPDO::PROPEL_ATTR_CACHE_PREPARES...">prepare</a>($sql);
<a name="l00160"></a>00160         <a class="code" href="classBasePeer.html#a760918603f5ac9bdac091b3e522bf6f4" title="Populates values in a prepared statement.">self::populateStmtValues</a>($stmt, $selectParams, $dbMap, $db);
<a name="l00161"></a>00161         $stmt-&gt;execute();
<a name="l00162"></a>00162         $affectedRows = $stmt-&gt;rowCount();
<a name="l00163"></a>00163       } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00164"></a>00164         <a class="code" href="classPropel.html#ae5a907c0410d2bb63c68953860dbd84a" title="Logs a message If a logger has been configured, the logger will be used, otherwrise...">Propel::log</a>($e-&gt;getMessage(), <a class="code" href="classPropel.html#a2551810662946edba369172a4befc8eb" title="A constant defining &amp;#39;Error conditions&amp;#39; logging level.">Propel::LOG_ERR</a>);
<a name="l00165"></a>00165         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Unable to execute DELETE statement.&quot;</span>,$e);
<a name="l00166"></a>00166       }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     } <span class="comment">// for each table</span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keywordflow">return</span> $affectedRows;
<a name="l00171"></a>00171   }
<a name="l00172"></a>00172 
<a name="l00192"></a><a class="code" href="classBasePeer.html#a2ff81352f58d46b0b987a8841b736c74">00192</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#a2ff81352f58d46b0b987a8841b736c74" title="Method to deletes all contents of specified table.">doDeleteAll</a>($tableName, <a class="code" href="classPropelPDO.html">PropelPDO</a> $con)
<a name="l00193"></a>00193   {
<a name="l00194"></a>00194     <span class="keywordflow">try</span> {
<a name="l00195"></a>00195       $sql = <span class="stringliteral">&quot;DELETE FROM &quot;</span> . $tableName;
<a name="l00196"></a>00196       $stmt = $con-&gt;<a class="code" href="classPropelPDO.html#a6b9432e5ce03aedbd33f8a1a1f4cbfba" title="Overrides PDO::prepare() to add query caching support if the PropelPDO::PROPEL_ATTR_CACHE_PREPARES...">prepare</a>($sql);
<a name="l00197"></a>00197       $stmt-&gt;execute();
<a name="l00198"></a>00198       <span class="keywordflow">return</span> $stmt-&gt;rowCount();
<a name="l00199"></a>00199     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00200"></a>00200       <a class="code" href="classPropel.html#ae5a907c0410d2bb63c68953860dbd84a" title="Logs a message If a logger has been configured, the logger will be used, otherwrise...">Propel::log</a>($e-&gt;getMessage(), <a class="code" href="classPropel.html#a2551810662946edba369172a4befc8eb" title="A constant defining &amp;#39;Error conditions&amp;#39; logging level.">Propel::LOG_ERR</a>);
<a name="l00201"></a>00201       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Unable to perform DELETE ALL operation.&quot;</span>, $e);
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204 
<a name="l00228"></a><a class="code" href="classBasePeer.html#a2dfb3a2d13576eae6698ad86c641bd32">00228</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#a2dfb3a2d13576eae6698ad86c641bd32" title="Method to perform inserts based on values and keys in a Criteria.">doInsert</a>(<a class="code" href="classCriteria.html">Criteria</a> $criteria, <a class="code" href="classPropelPDO.html">PropelPDO</a> $con) {
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="comment">// the primary key</span>
<a name="l00231"></a>00231     $id = null;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     $db = <a class="code" href="classPropel.html#ace7bfbefa3e8c60f4df548e12070af13" title="Returns database adapter for a specific datasource.">Propel::getDB</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     <span class="comment">// Get the table name and method for determining the primary</span>
<a name="l00236"></a>00236     <span class="comment">// key value.</span>
<a name="l00237"></a>00237     $keys = $criteria-&gt;<a class="code" href="classCriteria.html#ae219b2cdfeffc413efc61b88bc7012a1" title="Get the keys for the criteria map.">keys</a>();
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (!empty($keys)) {
<a name="l00239"></a>00239       $tableName = $criteria-&gt;<a class="code" href="classCriteria.html#aa8da43becfa341aab45aa2c6565bb037" title="Method to return a String table name.">getTableName</a>( $keys[0] );
<a name="l00240"></a>00240     } <span class="keywordflow">else</span> {
<a name="l00241"></a>00241       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Database insert attempted without anything specified to insert&quot;</span>);
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00245"></a>00245     $tableMap = $dbMap-&gt;getTable($tableName);
<a name="l00246"></a>00246     $keyInfo = $tableMap-&gt;getPrimaryKeyMethodInfo();
<a name="l00247"></a>00247     $useIdGen = $tableMap-&gt;isUseIdGenerator();
<a name="l00248"></a>00248     <span class="comment">//$keyGen = $con-&gt;getIdGenerator();</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     $pk = self::getPrimaryKey($criteria);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="comment">// only get a new key value if you need to</span>
<a name="l00253"></a>00253     <span class="comment">// the reason is that a primary key might be defined</span>
<a name="l00254"></a>00254     <span class="comment">// but you are still going to set its value. for example:</span>
<a name="l00255"></a>00255     <span class="comment">// a join table where both keys are primary and you are</span>
<a name="l00256"></a>00256     <span class="comment">// setting both columns with your own values</span>
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     <span class="comment">// pk will be null if there is no primary key defined for the table</span>
<a name="l00259"></a>00259     <span class="comment">// we&#39;re inserting into.</span>
<a name="l00260"></a>00260     <span class="keywordflow">if</span> ($pk !== null &amp;&amp; $useIdGen &amp;&amp; !$criteria-&gt;<a class="code" href="classCriteria.html#a624ae50b90c30302b472365e717f1786" title="Does this Criteria object contain the specified key and does it have a value set...">keyContainsValue</a>($pk-&gt;getFullyQualifiedName()) &amp;&amp; $db-&gt;isGetIdBeforeInsert()) {
<a name="l00261"></a>00261       <span class="keywordflow">try</span> {
<a name="l00262"></a>00262         $id = $db-&gt;getId($con, $keyInfo);
<a name="l00263"></a>00263       } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00264"></a>00264         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Unable to get sequence id.&quot;</span>, $e);
<a name="l00265"></a>00265       }
<a name="l00266"></a>00266       $criteria-&gt;<a class="code" href="classCriteria.html#aa8bf7490f63aab161018e147f1000ea4" title="This method adds a new criterion to the list of criterias.">add</a>($pk-&gt;getFullyQualifiedName(), $id);
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="keywordflow">try</span> {
<a name="l00270"></a>00270       $adapter = <a class="code" href="classPropel.html#ace7bfbefa3e8c60f4df548e12070af13" title="Returns database adapter for a specific datasource.">Propel::getDB</a>($criteria-&gt;getDBName());
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       $qualifiedCols = $criteria-&gt;<a class="code" href="classCriteria.html#ae219b2cdfeffc413efc61b88bc7012a1" title="Get the keys for the criteria map.">keys</a>(); <span class="comment">// we need table.column cols when populating values</span>
<a name="l00273"></a>00273       $columns = array(); <span class="comment">// but just &#39;column&#39; cols for the SQL</span>
<a name="l00274"></a>00274       <span class="keywordflow">foreach</span> ($qualifiedCols as $qualifiedCol) {
<a name="l00275"></a>00275         $columns[] = substr($qualifiedCol, strrpos($qualifiedCol, <span class="charliteral">&#39;.&#39;</span>) + 1);
<a name="l00276"></a>00276       }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278       <span class="comment">// add identifiers</span>
<a name="l00279"></a>00279       <span class="keywordflow">if</span> ($adapter-&gt;useQuoteIdentifier()) {
<a name="l00280"></a>00280         $columns = array_map(array($adapter, <span class="stringliteral">&#39;quoteIdentifier&#39;</span>), $columns);
<a name="l00281"></a>00281       }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283       $sql = <span class="stringliteral">&#39;INSERT INTO &#39;</span> . $tableName
<a name="l00284"></a>00284       . <span class="stringliteral">&#39; (&#39;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $columns) . <span class="charliteral">&#39;)&#39;</span>
<a name="l00285"></a>00285       . <span class="stringliteral">&#39; VALUES (&#39;</span>;
<a name="l00286"></a>00286       <span class="comment">// . substr(str_repeat(&quot;?,&quot;, count($columns)), 0, -1) . </span>
<a name="l00287"></a>00287       <span class="keywordflow">for</span>($p=1, $cnt=count($columns); $p &lt;= $cnt; $p++) {
<a name="l00288"></a>00288         $sql .= <span class="stringliteral">&#39;:p&#39;</span>.$p;
<a name="l00289"></a>00289         <span class="keywordflow">if</span> ($p !== $cnt) $sql .= <span class="charliteral">&#39;,&#39;</span>;
<a name="l00290"></a>00290       }
<a name="l00291"></a>00291       $sql .= <span class="charliteral">&#39;)&#39;</span>;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293       $stmt = $con-&gt;<a class="code" href="classPropelPDO.html#a6b9432e5ce03aedbd33f8a1a1f4cbfba" title="Overrides PDO::prepare() to add query caching support if the PropelPDO::PROPEL_ATTR_CACHE_PREPARES...">prepare</a>($sql);
<a name="l00294"></a>00294       <a class="code" href="classBasePeer.html#a760918603f5ac9bdac091b3e522bf6f4" title="Populates values in a prepared statement.">self::populateStmtValues</a>($stmt, self::buildParams($qualifiedCols, $criteria), $dbMap, $db);
<a name="l00295"></a>00295       $stmt-&gt;execute();
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00298"></a>00298       <a class="code" href="classPropel.html#ae5a907c0410d2bb63c68953860dbd84a" title="Logs a message If a logger has been configured, the logger will be used, otherwrise...">Propel::log</a>($e-&gt;getMessage(), <a class="code" href="classPropel.html#a2551810662946edba369172a4befc8eb" title="A constant defining &amp;#39;Error conditions&amp;#39; logging level.">Propel::LOG_ERR</a>);
<a name="l00299"></a>00299       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Unable to execute INSERT statement.&quot;</span>, $e);
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">// If the primary key column is auto-incremented, get the id now.</span>
<a name="l00303"></a>00303     <span class="keywordflow">if</span> ($pk !== null &amp;&amp; $useIdGen &amp;&amp; $db-&gt;isGetIdAfterInsert()) {
<a name="l00304"></a>00304       <span class="keywordflow">try</span> {
<a name="l00305"></a>00305         $id = $db-&gt;getId($con, $keyInfo);
<a name="l00306"></a>00306       } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00307"></a>00307         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Unable to get autoincrement id.&quot;</span>, $e);
<a name="l00308"></a>00308       }
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="keywordflow">return</span> $id;
<a name="l00312"></a>00312   }
<a name="l00313"></a>00313 
<a name="l00335"></a><a class="code" href="classBasePeer.html#ad5b19682c4bafe83e3dce37fbb773dcf">00335</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#ad5b19682c4bafe83e3dce37fbb773dcf" title="Method used to update rows in the DB.">doUpdate</a>(<a class="code" href="classCriteria.html">Criteria</a> $selectCriteria, <a class="code" href="classCriteria.html">Criteria</a> $updateValues, <a class="code" href="classPropelPDO.html">PropelPDO</a> $con) {
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     $db = <a class="code" href="classPropel.html#ace7bfbefa3e8c60f4df548e12070af13" title="Returns database adapter for a specific datasource.">Propel::getDB</a>($selectCriteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00338"></a>00338     $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($selectCriteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="comment">// Get list of required tables, containing all columns</span>
<a name="l00341"></a>00341     $tablesColumns = $selectCriteria-&gt;<a class="code" href="classCriteria.html#a30eab859306b32d4ffc9f9d9838e514c" title="Shortcut method to get an array of columns indexed by table.">getTablesColumns</a>();
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <span class="comment">// we also need the columns for the update SQL</span>
<a name="l00344"></a>00344     $updateTablesColumns = $updateValues-&gt;<a class="code" href="classCriteria.html#a30eab859306b32d4ffc9f9d9838e514c" title="Shortcut method to get an array of columns indexed by table.">getTablesColumns</a>();
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     $affectedRows = 0; <span class="comment">// initialize this in case the next loop has no iterations.</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <span class="keywordflow">foreach</span> ($tablesColumns as $tableName =&gt; $columns) {
<a name="l00349"></a>00349 
<a name="l00350"></a>00350       $whereClause = array();
<a name="l00351"></a>00351       
<a name="l00352"></a>00352       $params = array();
<a name="l00353"></a>00353 
<a name="l00354"></a>00354       $stmt = null;
<a name="l00355"></a>00355       <span class="keywordflow">try</span> {
<a name="l00356"></a>00356 
<a name="l00357"></a>00357         $sql = <span class="stringliteral">&quot;UPDATE &quot;</span> . $tableName . <span class="stringliteral">&quot; SET &quot;</span>;
<a name="l00358"></a>00358         $p = 1;
<a name="l00359"></a>00359         <span class="keywordflow">foreach</span> ($updateTablesColumns[$tableName] as $col) {
<a name="l00360"></a>00360           $updateColumnName = substr($col, strrpos($col, <span class="charliteral">&#39;.&#39;</span>) + 1);
<a name="l00361"></a>00361           <span class="comment">// add identifiers for the actual database?</span>
<a name="l00362"></a>00362           <span class="keywordflow">if</span> ($db-&gt;useQuoteIdentifier()) {
<a name="l00363"></a>00363             $updateColumnName = $db-&gt;quoteIdentifier($updateColumnName);
<a name="l00364"></a>00364           }
<a name="l00365"></a>00365           <span class="keywordflow">if</span> ($updateValues-&gt;<a class="code" href="classCriteria.html#a55bf3de047587f9b3fab0944f6ee7581" title="Method to return a comparison String.">getComparison</a>($col) != <a class="code" href="classCriteria.html#adb2f182ab61127de26766608ae798a40" title="Comparison type for update.">Criteria::CUSTOM_EQUAL</a>) {
<a name="l00366"></a>00366             $sql .= $updateColumnName . <span class="stringliteral">&#39;=:p&#39;</span>.$p++.<span class="stringliteral">&#39;, &#39;</span>;
<a name="l00367"></a>00367           } <span class="keywordflow">else</span> {
<a name="l00368"></a>00368             $param = $updateValues-&gt;<a class="code" href="classCriteria.html#a1b11ce0167f7d7bfaa11e598bfd30d65" title="An alias to getValue() -- exposing a Hashtable-like interface.">get</a>($col);
<a name="l00369"></a>00369             $sql .= $updateColumnName . <span class="stringliteral">&#39; = &#39;</span>;
<a name="l00370"></a>00370             <span class="keywordflow">if</span> (is_array($param)) {
<a name="l00371"></a>00371               <span class="keywordflow">if</span> (isset($param[<span class="stringliteral">&#39;raw&#39;</span>])) {
<a name="l00372"></a>00372                 $raw = $param[<span class="stringliteral">&#39;raw&#39;</span>];
<a name="l00373"></a>00373                 $rawcvt = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00374"></a>00374                 <span class="comment">// parse the $params[&#39;raw&#39;] for ? chars</span>
<a name="l00375"></a>00375                 <span class="keywordflow">for</span>($r=0,$len=strlen($raw); $r &lt; $len; $r++) {
<a name="l00376"></a>00376                   <span class="keywordflow">if</span> ($raw{$r} == <span class="charliteral">&#39;?&#39;</span>) {
<a name="l00377"></a>00377                     $rawcvt .= <span class="stringliteral">&#39;:p&#39;</span>.$p++;
<a name="l00378"></a>00378                   } <span class="keywordflow">else</span> {
<a name="l00379"></a>00379                     $rawcvt .= $raw{$r};
<a name="l00380"></a>00380                   }
<a name="l00381"></a>00381                 }
<a name="l00382"></a>00382                 $sql .= $rawcvt . <span class="stringliteral">&#39;, &#39;</span>;
<a name="l00383"></a>00383               } <span class="keywordflow">else</span> {
<a name="l00384"></a>00384                 $sql .= <span class="stringliteral">&#39;:p&#39;</span>.$p++.<span class="stringliteral">&#39;, &#39;</span>;
<a name="l00385"></a>00385               }
<a name="l00386"></a>00386               <span class="keywordflow">if</span> (isset($param[<span class="stringliteral">&#39;value&#39;</span>])) {
<a name="l00387"></a>00387                 $updateValues-&gt;<a class="code" href="classCriteria.html#a79d5ba185a28b392c75ff67045c3ad9d" title="Overrides Hashtable put, so that this object is returned instead of the value previously...">put</a>($col, $param[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l00388"></a>00388               }
<a name="l00389"></a>00389             } <span class="keywordflow">else</span> {
<a name="l00390"></a>00390               $updateValues-&gt;<a class="code" href="classCriteria.html#ad51b8ccf0097c4b9a31f273b916c4335" title="Remove an object from the criteria.">remove</a>($col);
<a name="l00391"></a>00391               $sql .= $param . <span class="stringliteral">&#39;, &#39;</span>;
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393           }
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395         
<a name="l00396"></a>00396         $params = self::buildParams($updateTablesColumns[$tableName], $updateValues);
<a name="l00397"></a>00397         
<a name="l00398"></a>00398         <span class="keywordflow">foreach</span> ($columns as $colName) {
<a name="l00399"></a>00399           $sb = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00400"></a>00400           $selectCriteria-&gt;<a class="code" href="classCriteria.html#aa39fd5150d9969b4336ca153ba5b657e" title="Method to return criteria related to columns in a table.">getCriterion</a>($colName)-&gt;appendPsTo($sb, $params);
<a name="l00401"></a>00401           $whereClause[] = $sb;
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403       
<a name="l00404"></a>00404         $sql = substr($sql, 0, -2) . <span class="stringliteral">&quot; WHERE &quot;</span> .  implode(<span class="stringliteral">&quot; AND &quot;</span>, $whereClause);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         $stmt = $con-&gt;<a class="code" href="classPropelPDO.html#a6b9432e5ce03aedbd33f8a1a1f4cbfba" title="Overrides PDO::prepare() to add query caching support if the PropelPDO::PROPEL_ATTR_CACHE_PREPARES...">prepare</a>($sql);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <span class="comment">// Replace &#39;:p?&#39; with the actual values</span>
<a name="l00409"></a>00409         <a class="code" href="classBasePeer.html#a760918603f5ac9bdac091b3e522bf6f4" title="Populates values in a prepared statement.">self::populateStmtValues</a>($stmt, $params, $dbMap, $db);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         $stmt-&gt;execute();
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         $affectedRows = $stmt-&gt;rowCount();
<a name="l00414"></a>00414 
<a name="l00415"></a>00415         $stmt = null; <span class="comment">// close</span>
<a name="l00416"></a>00416 
<a name="l00417"></a>00417       } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00418"></a>00418         <span class="keywordflow">if</span> ($stmt) $stmt = null; <span class="comment">// close</span>
<a name="l00419"></a>00419         <a class="code" href="classPropel.html#ae5a907c0410d2bb63c68953860dbd84a" title="Logs a message If a logger has been configured, the logger will be used, otherwrise...">Propel::log</a>($e-&gt;getMessage(), <a class="code" href="classPropel.html#a2551810662946edba369172a4befc8eb" title="A constant defining &amp;#39;Error conditions&amp;#39; logging level.">Propel::LOG_ERR</a>);
<a name="l00420"></a>00420         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;Unable to execute UPDATE statement.&quot;</span>, $e);
<a name="l00421"></a>00421       }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     } <span class="comment">// foreach table in the criteria</span>
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="keywordflow">return</span> $affectedRows;
<a name="l00426"></a>00426   }
<a name="l00427"></a>00427 
<a name="l00437"></a><a class="code" href="classBasePeer.html#add71faab372a37c1822bc73b5c81967a">00437</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#add71faab372a37c1822bc73b5c81967a" title="Executes query build by createSelectSql() and returns the resultset statement.">doSelect</a>(<a class="code" href="classCriteria.html">Criteria</a> $criteria, <a class="code" href="classPropelPDO.html">PropelPDO</a> $con = null)
<a name="l00438"></a>00438   {
<a name="l00439"></a>00439     $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00440"></a>00440     $db = <a class="code" href="classPropel.html#ace7bfbefa3e8c60f4df548e12070af13" title="Returns database adapter for a specific datasource.">Propel::getDB</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <span class="keywordflow">if</span> ($con === null) {
<a name="l00443"></a>00443       $con = <a class="code" href="classPropel.html#ab6935b83a2ef92c702b8aefe90686eae" title="Gets an already-opened PDO connection or opens a new one for passed-in db name.">Propel::getConnection</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>(), <a class="code" href="classPropel.html#a3f9c691463a86eaad09a9a8442d52346" title="Constant used to request a READ connection (applies to replication).">Propel::CONNECTION_READ</a>);
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     $stmt = null;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a8b032765b8c379f6837d55057625030e" title="Whether the sql command specified by this criteria must be wrapped in a transaction...">isUseTransaction</a>()) $con-&gt;beginTransaction();
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <span class="keywordflow">try</span> {
<a name="l00451"></a>00451 
<a name="l00452"></a>00452       $params = array();
<a name="l00453"></a>00453       $sql = <a class="code" href="classBasePeer.html#a48d82cfb4e10a1314b114d0c5e0a5898" title="Method to create an SQL query based on values in a Criteria.">self::createSelectSql</a>($criteria, $params);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       $stmt = $con-&gt;prepare($sql);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <a class="code" href="classBasePeer.html#a760918603f5ac9bdac091b3e522bf6f4" title="Populates values in a prepared statement.">self::populateStmtValues</a>($stmt, $params, $dbMap, $db);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459       $stmt-&gt;execute();
<a name="l00460"></a>00460 
<a name="l00461"></a>00461       <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a8b032765b8c379f6837d55057625030e" title="Whether the sql command specified by this criteria must be wrapped in a transaction...">isUseTransaction</a>()) $con-&gt;commit();
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00464"></a>00464       <span class="keywordflow">if</span> ($stmt) $stmt = null; <span class="comment">// close</span>
<a name="l00465"></a>00465       <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a8b032765b8c379f6837d55057625030e" title="Whether the sql command specified by this criteria must be wrapped in a transaction...">isUseTransaction</a>()) $con-&gt;rollBack();
<a name="l00466"></a>00466       <a class="code" href="classPropel.html#ae5a907c0410d2bb63c68953860dbd84a" title="Logs a message If a logger has been configured, the logger will be used, otherwrise...">Propel::log</a>($e-&gt;getMessage(), <a class="code" href="classPropel.html#a2551810662946edba369172a4befc8eb" title="A constant defining &amp;#39;Error conditions&amp;#39; logging level.">Propel::LOG_ERR</a>);
<a name="l00467"></a>00467       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>($e);
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="keywordflow">return</span> $stmt;
<a name="l00471"></a>00471   }
<a name="l00472"></a>00472 
<a name="l00483"></a><a class="code" href="classBasePeer.html#aa8dec489b4b8a2b02a26b0ecae9cc808">00483</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#aa8dec489b4b8a2b02a26b0ecae9cc808" title="Executes a COUNT query using either a simple SQL rewrite or, for more complex queries...">doCount</a>(<a class="code" href="classCriteria.html">Criteria</a> $criteria, <a class="code" href="classPropelPDO.html">PropelPDO</a> $con = null)
<a name="l00484"></a>00484   {
<a name="l00485"></a>00485     $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00486"></a>00486     $db = <a class="code" href="classPropel.html#ace7bfbefa3e8c60f4df548e12070af13" title="Returns database adapter for a specific datasource.">Propel::getDB</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="keywordflow">if</span> ($con === null) {
<a name="l00489"></a>00489       $con = <a class="code" href="classPropel.html#ab6935b83a2ef92c702b8aefe90686eae" title="Gets an already-opened PDO connection or opens a new one for passed-in db name.">Propel::getConnection</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>(), <a class="code" href="classPropel.html#a3f9c691463a86eaad09a9a8442d52346" title="Constant used to request a READ connection (applies to replication).">Propel::CONNECTION_READ</a>);
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     $stmt = null;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a8b032765b8c379f6837d55057625030e" title="Whether the sql command specified by this criteria must be wrapped in a transaction...">isUseTransaction</a>()) $con-&gt;beginTransaction();
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     $needsComplexCount = ($criteria-&gt;<a class="code" href="classCriteria.html#a79113f49ba971d4a8e7bdbf15baa0f7d" title="Get group by columns.">getGroupByColumns</a>() || $criteria-&gt;<a class="code" href="classCriteria.html#aa020aa762a7543d836decfb7f65ffb51" title="Get offset.">getOffset</a>()
<a name="l00497"></a>00497                 || $criteria-&gt;<a class="code" href="classCriteria.html#adf99de554949344fd05b0c8ef0443475" title="Get limit.">getLimit</a>() || $criteria-&gt;<a class="code" href="classCriteria.html#a0a217beeb41a7cf782a11925446216bc" title="Get Having Criterion.">getHaving</a>() || in_array(<a class="code" href="classCriteria.html#a373ce3a66c8bb2f6e1f89e78fe74cb73" title="Comparison type.">Criteria::DISTINCT</a>, $criteria-&gt;<a class="code" href="classCriteria.html#a52c991d4f5b0a502fb6b4ec9021538a1" title="Get select modifiers.">getSelectModifiers</a>()));
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="keywordflow">try</span> {
<a name="l00500"></a>00500 
<a name="l00501"></a>00501       $params = array();
<a name="l00502"></a>00502 
<a name="l00503"></a>00503       <span class="keywordflow">if</span> ($needsComplexCount) {
<a name="l00504"></a>00504         <span class="keywordflow">if</span> (self::needsSelectAliases($criteria)) {
<a name="l00505"></a>00505           <a class="code" href="classBasePeer.html#a30c72609e0a1dcd03ed2c94849282323" title="Ensures uniqueness of select column names by turning them all into aliases This is...">self::turnSelectColumnsToAliases</a>($criteria);
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507         $selectSql = <a class="code" href="classBasePeer.html#a48d82cfb4e10a1314b114d0c5e0a5898" title="Method to create an SQL query based on values in a Criteria.">self::createSelectSql</a>($criteria, $params);
<a name="l00508"></a>00508         $sql = <span class="stringliteral">&#39;SELECT COUNT(*) FROM (&#39;</span> . $selectSql . <span class="stringliteral">&#39;) AS propelmatch4cnt&#39;</span>;
<a name="l00509"></a>00509       } <span class="keywordflow">else</span> {
<a name="l00510"></a>00510         <span class="comment">// Replace SELECT columns with COUNT(*)</span>
<a name="l00511"></a>00511         $criteria-&gt;<a class="code" href="classCriteria.html#ac312017c05abb31d4f5f5b4c1a467f4f" title="Clears current select columns.">clearSelectColumns</a>()-&gt;addSelectColumn(<span class="stringliteral">&#39;COUNT(*)&#39;</span>);
<a name="l00512"></a>00512         $sql = <a class="code" href="classBasePeer.html#a48d82cfb4e10a1314b114d0c5e0a5898" title="Method to create an SQL query based on values in a Criteria.">self::createSelectSql</a>($criteria, $params);
<a name="l00513"></a>00513       }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515       $stmt = $con-&gt;prepare($sql);
<a name="l00516"></a>00516       <a class="code" href="classBasePeer.html#a760918603f5ac9bdac091b3e522bf6f4" title="Populates values in a prepared statement.">self::populateStmtValues</a>($stmt, $params, $dbMap, $db);
<a name="l00517"></a>00517       $stmt-&gt;execute();
<a name="l00518"></a>00518 
<a name="l00519"></a>00519       <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a8b032765b8c379f6837d55057625030e" title="Whether the sql command specified by this criteria must be wrapped in a transaction...">isUseTransaction</a>()) $con-&gt;commit();
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00522"></a>00522       <span class="keywordflow">if</span> ($stmt) $stmt = null; <span class="comment">// close</span>
<a name="l00523"></a>00523       <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a8b032765b8c379f6837d55057625030e" title="Whether the sql command specified by this criteria must be wrapped in a transaction...">isUseTransaction</a>()) $con-&gt;rollBack();
<a name="l00524"></a>00524       <a class="code" href="classPropel.html#ae5a907c0410d2bb63c68953860dbd84a" title="Logs a message If a logger has been configured, the logger will be used, otherwrise...">Propel::log</a>($e-&gt;getMessage(), <a class="code" href="classPropel.html#a2551810662946edba369172a4befc8eb" title="A constant defining &amp;#39;Error conditions&amp;#39; logging level.">Propel::LOG_ERR</a>);
<a name="l00525"></a>00525       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>($e);
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     <span class="keywordflow">return</span> $stmt;
<a name="l00529"></a>00529   }
<a name="l00530"></a>00530 
<a name="l00551"></a><a class="code" href="classBasePeer.html#a760918603f5ac9bdac091b3e522bf6f4">00551</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#a760918603f5ac9bdac091b3e522bf6f4" title="Populates values in a prepared statement.">populateStmtValues</a>(PDOStatement $stmt, array $params, <a class="code" href="classDatabaseMap.html">DatabaseMap</a> $dbMap, <a class="code" href="classDBAdapter.html">DBAdapter</a> $db)
<a name="l00552"></a>00552   {
<a name="l00553"></a>00553     $i = 1;
<a name="l00554"></a>00554     <span class="keywordflow">foreach</span> ($params as $param) {
<a name="l00555"></a>00555       $tableName = $param[<span class="stringliteral">&#39;table&#39;</span>];
<a name="l00556"></a>00556       $columnName = $param[<span class="stringliteral">&#39;column&#39;</span>];
<a name="l00557"></a>00557       $value = $param[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l00558"></a>00558 
<a name="l00559"></a>00559       <span class="keywordflow">if</span> ($value === null) {
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         $stmt-&gt;bindValue(<span class="stringliteral">&#39;:p&#39;</span>.$i++, null, PDO::PARAM_NULL);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563       } elseif (isset($tableName) ) {
<a name="l00564"></a>00564 
<a name="l00565"></a>00565         $cMap = $dbMap-&gt;<a class="code" href="classDatabaseMap.html#a23cc213079f51a97fdd869cc40e76171" title="Get a TableMap for the table by name.">getTable</a>($tableName)-&gt;getColumn($columnName);
<a name="l00566"></a>00566         $type = $cMap-&gt;getType();
<a name="l00567"></a>00567         $pdoType = $cMap-&gt;getPdoType();
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         <span class="comment">// FIXME - This is a temporary hack to get around apparent bugs w/ PDO+MYSQL</span>
<a name="l00570"></a>00570         <span class="comment">// See http://pecl.php.net/bugs/bug.php?id=9919</span>
<a name="l00571"></a>00571         <span class="keywordflow">if</span> ($pdoType == PDO::PARAM_BOOL &amp;&amp; $db instanceof <a class="code" href="classDBMySQL.html">DBMySQL</a>) {
<a name="l00572"></a>00572           $value = (int) $value;
<a name="l00573"></a>00573           $pdoType = PDO::PARAM_INT;
<a name="l00574"></a>00574         } elseif (is_numeric($value) &amp;&amp; $cMap-&gt;isEpochTemporal()) { <span class="comment">// it&#39;s a timestamp that needs to be formatted</span>
<a name="l00575"></a>00575           <span class="keywordflow">if</span> ($type == PropelColumnTypes::TIMESTAMP) {
<a name="l00576"></a>00576             $value = date($db-&gt;<a class="code" href="classDBAdapter.html#a6c54754717f40f465a0abe521e6d1b4e" title="Returns timestamp formatter string for use in date() function.">getTimestampFormatter</a>(), $value);
<a name="l00577"></a>00577           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($type == PropelColumnTypes::DATE) {
<a name="l00578"></a>00578             $value = date($db-&gt;<a class="code" href="classDBAdapter.html#aec89122f9910a7c61a12c7e3906db5c6" title="Returns date formatter string for use in date() function.">getDateFormatter</a>(), $value);
<a name="l00579"></a>00579           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($type == PropelColumnTypes::TIME) {
<a name="l00580"></a>00580             $value = date($db-&gt;<a class="code" href="classDBAdapter.html#ad87f035f1eb8b4065c758cc583501a21" title="Returns time formatter string for use in date() function.">getTimeFormatter</a>(), $value);
<a name="l00581"></a>00581           }
<a name="l00582"></a>00582         } elseif ($value instanceof DateTime &amp;&amp; $cMap-&gt;isTemporal()) { <span class="comment">// it&#39;s a timestamp that needs to be formatted</span>
<a name="l00583"></a>00583           <span class="keywordflow">if</span> ($type == PropelColumnTypes::TIMESTAMP || $type == PropelColumnTypes::BU_TIMESTAMP) {
<a name="l00584"></a>00584             $value = $value-&gt;format($db-&gt;<a class="code" href="classDBAdapter.html#a6c54754717f40f465a0abe521e6d1b4e" title="Returns timestamp formatter string for use in date() function.">getTimestampFormatter</a>());
<a name="l00585"></a>00585           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($type == PropelColumnTypes::DATE || $type == PropelColumnTypes::BU_DATE) {
<a name="l00586"></a>00586             $value = $value-&gt;format($db-&gt;<a class="code" href="classDBAdapter.html#aec89122f9910a7c61a12c7e3906db5c6" title="Returns date formatter string for use in date() function.">getDateFormatter</a>());
<a name="l00587"></a>00587           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($type == PropelColumnTypes::TIME) {
<a name="l00588"></a>00588             $value = $value-&gt;format($db-&gt;<a class="code" href="classDBAdapter.html#ad87f035f1eb8b4065c758cc583501a21" title="Returns time formatter string for use in date() function.">getTimeFormatter</a>());
<a name="l00589"></a>00589           }
<a name="l00590"></a>00590         } elseif (is_resource($value) &amp;&amp; $cMap-&gt;isLob()) {
<a name="l00591"></a>00591           <span class="comment">// we always need to make sure that the stream is rewound, otherwise nothing will</span>
<a name="l00592"></a>00592           <span class="comment">// get written to database.</span>
<a name="l00593"></a>00593           rewind($value);
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         $stmt-&gt;bindValue(<span class="stringliteral">&#39;:p&#39;</span>.$i++, $value, $pdoType);
<a name="l00597"></a>00597       } <span class="keywordflow">else</span> {
<a name="l00598"></a>00598         $stmt-&gt;bindValue(<span class="stringliteral">&#39;:p&#39;</span>.$i++, $value);
<a name="l00599"></a>00599       }
<a name="l00600"></a>00600     } <span class="comment">// foreach</span>
<a name="l00601"></a>00601   }
<a name="l00602"></a>00602 
<a name="l00610"></a><a class="code" href="classBasePeer.html#add43dfef57c8a182a6bd2e6a3de72153">00610</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#add43dfef57c8a182a6bd2e6a3de72153" title="Applies any validators that were defined in the schema to the specified columns.">doValidate</a>($dbName, $tableName, $columns)
<a name="l00611"></a>00611   {
<a name="l00612"></a>00612     $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($dbName);
<a name="l00613"></a>00613     $tableMap = $dbMap-&gt;getTable($tableName);
<a name="l00614"></a>00614     $failureMap = array(); <span class="comment">// map of ValidationFailed objects</span>
<a name="l00615"></a>00615     <span class="keywordflow">foreach</span> ($columns as $colName =&gt; $colValue) {
<a name="l00616"></a>00616       <span class="keywordflow">if</span> ($tableMap-&gt;containsColumn($colName)) {
<a name="l00617"></a>00617         $col = $tableMap-&gt;getColumn($colName);
<a name="l00618"></a>00618         <span class="keywordflow">foreach</span> ($col-&gt;getValidators() as $validatorMap) {
<a name="l00619"></a>00619           $validator = <a class="code" href="classBasePeer.html#abd09dcc291251fee62f9d72d539e7cf3" title="This function searches for the given validator $name under propel/validator/$name...">BasePeer::getValidator</a>($validatorMap-&gt;getClass());
<a name="l00620"></a>00620           <span class="keywordflow">if</span> ($validator &amp;&amp; ($col-&gt;isNotNull() || $colValue !== null) &amp;&amp; $validator-&gt;isValid($validatorMap, $colValue) === <span class="keyword">false</span>) {
<a name="l00621"></a>00621             <span class="keywordflow">if</span> (!isset($failureMap[$colName])) { <span class="comment">// for now we do one ValidationFailed per column, not per rule</span>
<a name="l00622"></a>00622               $failureMap[$colName] = <span class="keyword">new</span> <a class="code" href="classValidationFailed.html">ValidationFailed</a>($colName, $validatorMap-&gt;getMessage(), $validator);
<a name="l00623"></a>00623             }
<a name="l00624"></a>00624           }
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626       }
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628     <span class="keywordflow">return</span> (!empty($failureMap) ? $failureMap : <span class="keyword">true</span>);
<a name="l00629"></a>00629   }
<a name="l00630"></a>00630 
<a name="l00640"></a>00640   <span class="keyword">private</span> <span class="keyword">static</span> function getPrimaryKey(<a class="code" href="classCriteria.html">Criteria</a> $criteria)
<a name="l00641"></a>00641   {
<a name="l00642"></a>00642     <span class="comment">// Assume all the keys are for the same table.</span>
<a name="l00643"></a>00643     $keys = $criteria-&gt;<a class="code" href="classCriteria.html#ae219b2cdfeffc413efc61b88bc7012a1" title="Get the keys for the criteria map.">keys</a>();
<a name="l00644"></a>00644     $key = $keys[0];
<a name="l00645"></a>00645     $table = $criteria-&gt;<a class="code" href="classCriteria.html#aa8da43becfa341aab45aa2c6565bb037" title="Method to return a String table name.">getTableName</a>($key);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     $pk = null;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (!empty($table)) {
<a name="l00650"></a>00650 
<a name="l00651"></a>00651       $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00652"></a>00652 
<a name="l00653"></a>00653       <span class="keywordflow">if</span> ($dbMap === null) {
<a name="l00654"></a>00654         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;\$dbMap is null&quot;</span>);
<a name="l00655"></a>00655       }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657       <span class="keywordflow">if</span> ($dbMap-&gt;getTable($table) === null) {
<a name="l00658"></a>00658         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classPropelException.html">PropelException</a>(<span class="stringliteral">&quot;\$dbMap-&gt;getTable() is null&quot;</span>);
<a name="l00659"></a>00659       }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       $columns = $dbMap-&gt;getTable($table)-&gt;getColumns();
<a name="l00662"></a>00662       <span class="keywordflow">foreach</span> (array_keys($columns) as $key) {
<a name="l00663"></a>00663         <span class="keywordflow">if</span> ($columns[$key]-&gt;isPrimaryKey()) {
<a name="l00664"></a>00664           $pk = $columns[$key];
<a name="l00665"></a>00665           <span class="keywordflow">break</span>;
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667       }
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     <span class="keywordflow">return</span> $pk;
<a name="l00670"></a>00670   }
<a name="l00671"></a>00671 
<a name="l00677"></a><a class="code" href="classBasePeer.html#af4e08d0c4f8266e5497388c7c1c2301d">00677</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#af4e08d0c4f8266e5497388c7c1c2301d" title="Checks whether the Criteria needs to use column aliasing This is implemented in a...">needsSelectAliases</a>(<a class="code" href="classCriteria.html">Criteria</a> $criteria)
<a name="l00678"></a>00678   {
<a name="l00679"></a>00679     $columnNames = array();
<a name="l00680"></a>00680     <span class="keywordflow">foreach</span> ($criteria-&gt;<a class="code" href="classCriteria.html#ab8296c5cd2579490b7e754ecd233f6dc" title="Get select columns.">getSelectColumns</a>() as $fullyQualifiedColumnName) {
<a name="l00681"></a>00681       <span class="keywordflow">if</span> ($pos = strrpos($fullyQualifiedColumnName, <span class="charliteral">&#39;.&#39;</span>)) {
<a name="l00682"></a>00682         $columnName = substr($fullyQualifiedColumnName, $pos);
<a name="l00683"></a>00683         <span class="keywordflow">if</span> (isset($columnNames[$columnName])) {
<a name="l00684"></a>00684           <span class="comment">// more than one column with the same name, so aliasing is required</span>
<a name="l00685"></a>00685           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00686"></a>00686         }
<a name="l00687"></a>00687         $columnNames[$columnName] = <span class="keyword">true</span>;
<a name="l00688"></a>00688       }
<a name="l00689"></a>00689     }
<a name="l00690"></a>00690     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00691"></a>00691   }
<a name="l00692"></a>00692   
<a name="l00702"></a><a class="code" href="classBasePeer.html#a30c72609e0a1dcd03ed2c94849282323">00702</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#a30c72609e0a1dcd03ed2c94849282323" title="Ensures uniqueness of select column names by turning them all into aliases This is...">turnSelectColumnsToAliases</a>(<a class="code" href="classCriteria.html">Criteria</a> $criteria)
<a name="l00703"></a>00703   {
<a name="l00704"></a>00704     $selectColumns = $criteria-&gt;<a class="code" href="classCriteria.html#ab8296c5cd2579490b7e754ecd233f6dc" title="Get select columns.">getSelectColumns</a>();
<a name="l00705"></a>00705     <span class="comment">// clearSelectColumns also clears the aliases, so get them too</span>
<a name="l00706"></a>00706     $asColumns = $criteria-&gt;<a class="code" href="classCriteria.html#a09f5b10ce2f850e68335e5c4b6586701" title="Get the column aliases.">getAsColumns</a>();
<a name="l00707"></a>00707     $criteria-&gt;<a class="code" href="classCriteria.html#ac312017c05abb31d4f5f5b4c1a467f4f" title="Clears current select columns.">clearSelectColumns</a>();
<a name="l00708"></a>00708     $columnAliases = $asColumns;
<a name="l00709"></a>00709     <span class="comment">// add the select columns back</span>
<a name="l00710"></a>00710     <span class="keywordflow">foreach</span> ($selectColumns as $clause) {
<a name="l00711"></a>00711       <span class="comment">// Generate a unique alias</span>
<a name="l00712"></a>00712       $baseAlias = preg_replace(<span class="stringliteral">&#39;/\W/&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $clause);
<a name="l00713"></a>00713       $alias = $baseAlias;
<a name="l00714"></a>00714       <span class="comment">// If it already exists, add a unique suffix</span>
<a name="l00715"></a>00715       $i = 0;
<a name="l00716"></a>00716       <span class="keywordflow">while</span> (isset($columnAliases[$alias])) {
<a name="l00717"></a>00717         $i++;
<a name="l00718"></a>00718         $alias = $baseAlias . <span class="charliteral">&#39;_&#39;</span> . $i;
<a name="l00719"></a>00719       }
<a name="l00720"></a>00720       <span class="comment">// Add it as an alias</span>
<a name="l00721"></a>00721       $criteria-&gt;<a class="code" href="classCriteria.html#a76b32faf9693faa7037a7276e24f2119" title="Add an AS clause to the select columns.">addAsColumn</a>($alias, $clause);
<a name="l00722"></a>00722       $columnAliases[$alias] = $clause;
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724     <span class="comment">// Add the aliases back, don&#39;t modify them</span>
<a name="l00725"></a>00725     <span class="keywordflow">foreach</span> ($asColumns as $name =&gt; $clause) {
<a name="l00726"></a>00726       $criteria-&gt;<a class="code" href="classCriteria.html#a76b32faf9693faa7037a7276e24f2119" title="Add an AS clause to the select columns.">addAsColumn</a>($name, $clause);
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728     
<a name="l00729"></a>00729     <span class="keywordflow">return</span> $criteria;
<a name="l00730"></a>00730   }
<a name="l00731"></a>00731   
<a name="l00745"></a><a class="code" href="classBasePeer.html#a48d82cfb4e10a1314b114d0c5e0a5898">00745</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#a48d82cfb4e10a1314b114d0c5e0a5898" title="Method to create an SQL query based on values in a Criteria.">createSelectSql</a>(<a class="code" href="classCriteria.html">Criteria</a> $criteria, &amp;$params)
<a name="l00746"></a>00746   {
<a name="l00747"></a>00747     $db = <a class="code" href="classPropel.html#ace7bfbefa3e8c60f4df548e12070af13" title="Returns database adapter for a specific datasource.">Propel::getDB</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00748"></a>00748     $dbMap = <a class="code" href="classPropel.html#aaf2d1d009e8bb56075cbc3e8ec7c92bf" title="Returns the database map information.">Propel::getDatabaseMap</a>($criteria-&gt;<a class="code" href="classCriteria.html#a353ea25d84db2f2b9f2fb34d1bafb631" title="Get the Database(Map) name.">getDbName</a>());
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     <span class="comment">// redundant definition $selectModifiers = array();</span>
<a name="l00751"></a>00751     $selectClause = array();
<a name="l00752"></a>00752     $fromClause = array();
<a name="l00753"></a>00753     $joinClause = array();
<a name="l00754"></a>00754     $joinTables = array();
<a name="l00755"></a>00755     $whereClause = array();
<a name="l00756"></a>00756     $orderByClause = array();
<a name="l00757"></a>00757     <span class="comment">// redundant definition $groupByClause = array();</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     $orderBy = $criteria-&gt;<a class="code" href="classCriteria.html#a3a310d4ac459b0055409df675f77704b" title="Get order by columns.">getOrderByColumns</a>();
<a name="l00760"></a>00760     $groupBy = $criteria-&gt;<a class="code" href="classCriteria.html#a79113f49ba971d4a8e7bdbf15baa0f7d" title="Get group by columns.">getGroupByColumns</a>();
<a name="l00761"></a>00761     $ignoreCase = $criteria-&gt;<a class="code" href="classCriteria.html#a9a5cc610b8616c3536b6dff30b157a04" title="Is ignore case on or off?">isIgnoreCase</a>();
<a name="l00762"></a>00762     $select = $criteria-&gt;<a class="code" href="classCriteria.html#ab8296c5cd2579490b7e754ecd233f6dc" title="Get select columns.">getSelectColumns</a>();
<a name="l00763"></a>00763     $aliases = $criteria-&gt;<a class="code" href="classCriteria.html#a09f5b10ce2f850e68335e5c4b6586701" title="Get the column aliases.">getAsColumns</a>();
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="comment">// simple copy</span>
<a name="l00766"></a>00766     $selectModifiers = $criteria-&gt;<a class="code" href="classCriteria.html#a52c991d4f5b0a502fb6b4ec9021538a1" title="Get select modifiers.">getSelectModifiers</a>();
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     <span class="comment">// get selected columns</span>
<a name="l00769"></a>00769     <span class="keywordflow">foreach</span> ($select as $columnName) {
<a name="l00770"></a>00770 
<a name="l00771"></a>00771       <span class="comment">// expect every column to be of &quot;table.column&quot; formation</span>
<a name="l00772"></a>00772       <span class="comment">// it could be a function:  e.g. MAX(books.price)</span>
<a name="l00773"></a>00773 
<a name="l00774"></a>00774       $tableName = null;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776       $selectClause[] = $columnName; <span class="comment">// the full column name: e.g. MAX(books.price)</span>
<a name="l00777"></a>00777 
<a name="l00778"></a>00778       $parenPos = strrpos($columnName, <span class="charliteral">&#39;(&#39;</span>);
<a name="l00779"></a>00779       $dotPos = strrpos($columnName, <span class="charliteral">&#39;.&#39;</span>, ($parenPos !== <span class="keyword">false</span> ? $parenPos : 0));
<a name="l00780"></a>00780 
<a name="l00781"></a>00781       <span class="comment">// [HL] I think we really only want to worry about adding stuff to</span>
<a name="l00782"></a>00782       <span class="comment">// the fromClause if this function has a TABLE.COLUMN in it at all.</span>
<a name="l00783"></a>00783       <span class="comment">// e.g. COUNT(*) should not need this treatment -- or there needs to</span>
<a name="l00784"></a>00784       <span class="comment">// be special treatment for &#39;*&#39;</span>
<a name="l00785"></a>00785       <span class="keywordflow">if</span> ($dotPos !== <span class="keyword">false</span>) {
<a name="l00786"></a>00786 
<a name="l00787"></a>00787         <span class="keywordflow">if</span> ($parenPos === <span class="keyword">false</span>) { <span class="comment">// table.column</span>
<a name="l00788"></a>00788           $tableName = substr($columnName, 0, $dotPos);
<a name="l00789"></a>00789         } <span class="keywordflow">else</span> { <span class="comment">// FUNC(table.column)</span>
<a name="l00790"></a>00790           $tableName = substr($columnName, $parenPos + 1, $dotPos - ($parenPos + 1));
<a name="l00791"></a>00791           <span class="comment">// functions may contain qualifiers so only take the last</span>
<a name="l00792"></a>00792           <span class="comment">// word as the table name.</span>
<a name="l00793"></a>00793           <span class="comment">// COUNT(DISTINCT books.price)</span>
<a name="l00794"></a>00794           $lastSpace = strpos($tableName, <span class="charliteral">&#39; &#39;</span>);
<a name="l00795"></a>00795           <span class="keywordflow">if</span> ($lastSpace !== <span class="keyword">false</span>) { <span class="comment">// COUNT(DISTINCT books.price)</span>
<a name="l00796"></a>00796             $tableName = substr($tableName, $lastSpace + 1);
<a name="l00797"></a>00797           }
<a name="l00798"></a>00798         }
<a name="l00799"></a>00799         $tableName2 = $criteria-&gt;<a class="code" href="classCriteria.html#a0c449eb2b146792a8f92523f71e74aa4" title="Returns the table name associated with an alias.">getTableForAlias</a>($tableName);
<a name="l00800"></a>00800         <span class="keywordflow">if</span> ($tableName2 !== null) {
<a name="l00801"></a>00801           $fromClause[] = $tableName2 . <span class="charliteral">&#39; &#39;</span> . $tableName;
<a name="l00802"></a>00802         } <span class="keywordflow">else</span> {
<a name="l00803"></a>00803           $fromClause[] = $tableName;
<a name="l00804"></a>00804         }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806       } <span class="comment">// if $dotPost !== null</span>
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="comment">// set the aliases</span>
<a name="l00810"></a>00810     <span class="keywordflow">foreach</span> ($aliases as $alias =&gt; $col) {
<a name="l00811"></a>00811       $selectClause[] = $col . <span class="stringliteral">&quot; AS &quot;</span> . $alias;
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814     <span class="comment">// add the criteria to WHERE clause</span>
<a name="l00815"></a>00815     <span class="comment">// this will also add the table names to the FROM clause if they are not already</span>
<a name="l00816"></a>00816     <span class="comment">// invluded via a LEFT JOIN</span>
<a name="l00817"></a>00817     <span class="keywordflow">foreach</span> ($criteria-&gt;<a class="code" href="classCriteria.html#ae219b2cdfeffc413efc61b88bc7012a1" title="Get the keys for the criteria map.">keys</a>() as $key) {
<a name="l00818"></a>00818 
<a name="l00819"></a>00819       $criterion = $criteria-&gt;<a class="code" href="classCriteria.html#aa39fd5150d9969b4336ca153ba5b657e" title="Method to return criteria related to columns in a table.">getCriterion</a>($key);
<a name="l00820"></a>00820       $someCriteria = $criterion-&gt;getAttachedCriterion();
<a name="l00821"></a>00821       $someCriteriaLength = count($someCriteria);
<a name="l00822"></a>00822       $table = null;
<a name="l00823"></a>00823       <span class="keywordflow">for</span> ($i=0; $i &lt; $someCriteriaLength; $i++) {
<a name="l00824"></a>00824         $tableName = $someCriteria[$i]-&gt;getTable();
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         $table = $criteria-&gt;<a class="code" href="classCriteria.html#a0c449eb2b146792a8f92523f71e74aa4" title="Returns the table name associated with an alias.">getTableForAlias</a>($tableName);
<a name="l00827"></a>00827         <span class="keywordflow">if</span> ($table !== null) {
<a name="l00828"></a>00828           $fromClause[] = $table . <span class="charliteral">&#39; &#39;</span> . $tableName;
<a name="l00829"></a>00829         } <span class="keywordflow">else</span> {
<a name="l00830"></a>00830           $fromClause[] = $tableName;
<a name="l00831"></a>00831           $table = $tableName;
<a name="l00832"></a>00832         }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834         $ignoreCase =
<a name="l00835"></a>00835         (($criteria-&gt;<a class="code" href="classCriteria.html#a9a5cc610b8616c3536b6dff30b157a04" title="Is ignore case on or off?">isIgnoreCase</a>()
<a name="l00836"></a>00836         || $someCriteria[$i]-&gt;isIgnoreCase())
<a name="l00837"></a>00837         &amp;&amp; (strpos($dbMap-&gt;getTable($table)-&gt;getColumn($someCriteria[$i]-&gt;getColumn())-&gt;getType(), <span class="stringliteral">&quot;VARCHAR&quot;</span>) !== <span class="keyword">false</span>)
<a name="l00838"></a>00838         );
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         $someCriteria[$i]-&gt;setIgnoreCase($ignoreCase);
<a name="l00841"></a>00841       }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843       $criterion-&gt;setDB($db);
<a name="l00844"></a>00844 
<a name="l00845"></a>00845       $sb = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00846"></a>00846       $criterion-&gt;appendPsTo($sb, $params);
<a name="l00847"></a>00847       $whereClause[] = $sb;
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850     <span class="comment">// Handle joins</span>
<a name="l00851"></a>00851     <span class="comment">// joins with a null join type will be added to the FROM clause and the condition added to the WHERE clause.</span>
<a name="l00852"></a>00852     <span class="comment">// joins of a specified type: the LEFT side will be added to the fromClause and the RIGHT to the joinClause</span>
<a name="l00853"></a>00853     <span class="keywordflow">foreach</span> ((array) $criteria-&gt;<a class="code" href="classCriteria.html#a19697b338e8c62e50d6a8ef3eab97633" title="Get the array of Joins.">getJoins</a>() as $join) { 
<a name="l00854"></a>00854       <span class="comment">// The join might have been established using an alias name</span>
<a name="l00855"></a>00855       $leftTable = $join-&gt;getLeftTableName();
<a name="l00856"></a>00856       $leftTableAlias = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00857"></a>00857       <span class="keywordflow">if</span> ($realTable = $criteria-&gt;<a class="code" href="classCriteria.html#a0c449eb2b146792a8f92523f71e74aa4" title="Returns the table name associated with an alias.">getTableForAlias</a>($leftTable)) {
<a name="l00858"></a>00858         $leftTableAlias = <span class="stringliteral">&quot; $leftTable&quot;</span>;
<a name="l00859"></a>00859         $leftTable = $realTable;
<a name="l00860"></a>00860       }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862       $rightTable = $join-&gt;getRightTableName();
<a name="l00863"></a>00863       $rightTableAlias = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00864"></a>00864       <span class="keywordflow">if</span> ($realTable = $criteria-&gt;<a class="code" href="classCriteria.html#a0c449eb2b146792a8f92523f71e74aa4" title="Returns the table name associated with an alias.">getTableForAlias</a>($rightTable)) {
<a name="l00865"></a>00865         $rightTableAlias = <span class="stringliteral">&quot; $rightTable&quot;</span>;
<a name="l00866"></a>00866         $rightTable = $realTable;
<a name="l00867"></a>00867       }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869       <span class="comment">// determine if casing is relevant.</span>
<a name="l00870"></a>00870       <span class="keywordflow">if</span> ($ignoreCase = $criteria-&gt;<a class="code" href="classCriteria.html#a9a5cc610b8616c3536b6dff30b157a04" title="Is ignore case on or off?">isIgnoreCase</a>()) {
<a name="l00871"></a>00871         $leftColType = $dbMap-&gt;getTable($leftTable)-&gt;getColumn($join-&gt;getLeftColumnName())-&gt;getType();
<a name="l00872"></a>00872         $rightColType = $dbMap-&gt;getTable($rightTable)-&gt;getColumn($join-&gt;getRightColumnName())-&gt;getType();
<a name="l00873"></a>00873         $ignoreCase = ($leftColType == <span class="stringliteral">&#39;string&#39;</span> || $rightColType == <span class="stringliteral">&#39;string&#39;</span>);
<a name="l00874"></a>00874       }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876       <span class="comment">// build the condition</span>
<a name="l00877"></a>00877       $condition = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00878"></a>00878       <span class="keywordflow">foreach</span> ($join-&gt;getConditions() as $index =&gt; $conditionDesc)
<a name="l00879"></a>00879       {
<a name="l00880"></a>00880         <span class="keywordflow">if</span> ($ignoreCase) {
<a name="l00881"></a>00881           $condition .= $db-&gt;ignoreCase($conditionDesc[<span class="stringliteral">&#39;left&#39;</span>]) . $conditionDesc[<span class="stringliteral">&#39;operator&#39;</span>] . $db-&gt;ignoreCase($conditionDesc[<span class="stringliteral">&#39;right&#39;</span>]);
<a name="l00882"></a>00882         } <span class="keywordflow">else</span> {
<a name="l00883"></a>00883           $condition .= implode($conditionDesc);
<a name="l00884"></a>00884         }
<a name="l00885"></a>00885         <span class="keywordflow">if</span> ($index + 1 &lt; $join-&gt;countConditions()) {
<a name="l00886"></a>00886           $condition .= <span class="stringliteral">&#39; AND &#39;</span>;
<a name="l00887"></a>00887         }
<a name="l00888"></a>00888       }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890       <span class="comment">// add &#39;em to the queues..</span>
<a name="l00891"></a>00891       <span class="keywordflow">if</span> ($joinType = $join-&gt;getJoinType()) {
<a name="l00892"></a>00892         <span class="comment">// real join</span>
<a name="l00893"></a>00893         <span class="keywordflow">if</span> (!$fromClause) {
<a name="l00894"></a>00894           $fromClause[] = $leftTable . $leftTableAlias;
<a name="l00895"></a>00895         }
<a name="l00896"></a>00896         $joinTables[] = $rightTable . $rightTableAlias;
<a name="l00897"></a>00897         $joinClause[] = $join-&gt;getJoinType() . <span class="charliteral">&#39; &#39;</span> . $rightTable . $rightTableAlias . <span class="stringliteral">&quot; ON ($condition)&quot;</span>;
<a name="l00898"></a>00898       } <span class="keywordflow">else</span> {
<a name="l00899"></a>00899         <span class="comment">// implicit join, translates to a where</span>
<a name="l00900"></a>00900         $fromClause[] = $leftTable . $leftTableAlias;
<a name="l00901"></a>00901         $fromClause[] = $rightTable . $rightTableAlias;
<a name="l00902"></a>00902         $whereClause[] = $condition;
<a name="l00903"></a>00903       }
<a name="l00904"></a>00904     }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906     <span class="comment">// Unique from clause elements</span>
<a name="l00907"></a>00907     $fromClause = array_unique($fromClause);
<a name="l00908"></a>00908     $fromClause = array_diff($fromClause, array(<span class="stringliteral">&#39;&#39;</span>));
<a name="l00909"></a>00909     
<a name="l00910"></a>00910     <span class="comment">// tables should not exist in both the from and join clauses</span>
<a name="l00911"></a>00911     <span class="keywordflow">if</span> ($joinTables &amp;&amp; $fromClause) {
<a name="l00912"></a>00912       <span class="keywordflow">foreach</span> ($fromClause as $fi =&gt; $ftable) {
<a name="l00913"></a>00913         <span class="keywordflow">if</span> (in_array($ftable, $joinTables)) {
<a name="l00914"></a>00914           unset($fromClause[$fi]);
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916       }
<a name="l00917"></a>00917     }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     <span class="comment">// Add the GROUP BY columns</span>
<a name="l00920"></a>00920     $groupByClause = $groupBy;
<a name="l00921"></a>00921 
<a name="l00922"></a>00922     $having = $criteria-&gt;<a class="code" href="classCriteria.html#a0a217beeb41a7cf782a11925446216bc" title="Get Having Criterion.">getHaving</a>();
<a name="l00923"></a>00923     $havingString = null;
<a name="l00924"></a>00924     <span class="keywordflow">if</span> ($having !== null) {
<a name="l00925"></a>00925       $sb = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00926"></a>00926       $having-&gt;appendPsTo($sb, $params);
<a name="l00927"></a>00927       $havingString = $sb;
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     <span class="keywordflow">if</span> (!empty($orderBy)) {
<a name="l00931"></a>00931 
<a name="l00932"></a>00932       <span class="keywordflow">foreach</span> ($orderBy as $orderByColumn) {
<a name="l00933"></a>00933 
<a name="l00934"></a>00934         <span class="comment">// Add function expression as-is.</span>
<a name="l00935"></a>00935 
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (strpos($orderByColumn, <span class="charliteral">&#39;(&#39;</span>) !== <span class="keyword">false</span>) {
<a name="l00937"></a>00937           $orderByClause[] = $orderByColumn;
<a name="l00938"></a>00938           <span class="keywordflow">continue</span>;
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         <span class="comment">// Split orderByColumn (i.e. &quot;table.column DESC&quot;)</span>
<a name="l00942"></a>00942 
<a name="l00943"></a>00943         $dotPos = strrpos($orderByColumn, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00944"></a>00944 
<a name="l00945"></a>00945         <span class="keywordflow">if</span> ($dotPos !== <span class="keyword">false</span>) {
<a name="l00946"></a>00946           $tableName = substr($orderByColumn, 0, $dotPos);
<a name="l00947"></a>00947           $columnName = substr($orderByColumn, $dotPos+1);
<a name="l00948"></a>00948         }
<a name="l00949"></a>00949         <span class="keywordflow">else</span> {
<a name="l00950"></a>00950           $tableName = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00951"></a>00951           $columnName = $orderByColumn;
<a name="l00952"></a>00952         }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954         $spacePos = strpos($columnName, <span class="charliteral">&#39; &#39;</span>);
<a name="l00955"></a>00955 
<a name="l00956"></a>00956         <span class="keywordflow">if</span> ($spacePos !== <span class="keyword">false</span>) {
<a name="l00957"></a>00957           $direction = substr($columnName, $spacePos);
<a name="l00958"></a>00958           $columnName = substr($columnName, 0, $spacePos);
<a name="l00959"></a>00959         }
<a name="l00960"></a>00960         <span class="keywordflow">else</span> {
<a name="l00961"></a>00961           $direction = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964         $tableAlias = $tableName;
<a name="l00965"></a>00965         <span class="keywordflow">if</span> ($aliasTableName = $criteria-&gt;<a class="code" href="classCriteria.html#a0c449eb2b146792a8f92523f71e74aa4" title="Returns the table name associated with an alias.">getTableForAlias</a>($tableName)) {
<a name="l00966"></a>00966           $tableName = $aliasTableName;
<a name="l00967"></a>00967         }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969         $columnAlias = $columnName;
<a name="l00970"></a>00970         <span class="keywordflow">if</span> ($asColumnName = $criteria-&gt;<a class="code" href="classCriteria.html#a47757724855f1ae5f98d740c74c8faa4" title="Returns the column name associated with an alias (AS-column).">getColumnForAs</a>($columnName)) {
<a name="l00971"></a>00971           $columnName = $asColumnName;
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974         $column = $tableName ? $dbMap-&gt;getTable($tableName)-&gt;getColumn($columnName) : null;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976         <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#a9a5cc610b8616c3536b6dff30b157a04" title="Is ignore case on or off?">isIgnoreCase</a>() &amp;&amp; $column &amp;&amp; $column-&gt;isText()) {
<a name="l00977"></a>00977           $orderByClause[] = $db-&gt;ignoreCaseInOrderBy(<span class="stringliteral">&quot;$tableAlias.$columnAlias&quot;</span>) . $direction;
<a name="l00978"></a>00978           $selectClause[] = $db-&gt;ignoreCaseInOrderBy(<span class="stringliteral">&quot;$tableAlias.$columnAlias&quot;</span>);
<a name="l00979"></a>00979         } <span class="keywordflow">else</span> {
<a name="l00980"></a>00980           $orderByClause[] = $orderByColumn;
<a name="l00981"></a>00981         }
<a name="l00982"></a>00982       }
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (empty($fromClause) &amp;&amp; $criteria-&gt;<a class="code" href="classCriteria.html#ab6cfbdd8fea6b4284718586b45aa440d" title="Get the primary table for this Criteria.">getPrimaryTableName</a>()) {
<a name="l00986"></a>00986       $fromClause[] = $criteria-&gt;<a class="code" href="classCriteria.html#ab6cfbdd8fea6b4284718586b45aa440d" title="Get the primary table for this Criteria.">getPrimaryTableName</a>();
<a name="l00987"></a>00987     }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989     <span class="comment">// from / join tables quoten if it is necessary</span>
<a name="l00990"></a>00990     <span class="keywordflow">if</span> ($db-&gt;useQuoteIdentifier()) {
<a name="l00991"></a>00991       $fromClause = array_map(array($db, <span class="stringliteral">&#39;quoteIdentifierTable&#39;</span>), $fromClause);
<a name="l00992"></a>00992       $joinClause = $joinClause ? $joinClause : array_map(array($db, <span class="stringliteral">&#39;quoteIdentifierTable&#39;</span>), $joinClause);
<a name="l00993"></a>00993     }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <span class="comment">// build from-clause</span>
<a name="l00996"></a>00996     $from = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00997"></a>00997     <span class="keywordflow">if</span> (!empty($joinClause) &amp;&amp; count($fromClause) &gt; 1) {
<a name="l00998"></a>00998       $from .= implode(<span class="stringliteral">&quot; CROSS JOIN &quot;</span>, $fromClause);
<a name="l00999"></a>00999     } <span class="keywordflow">else</span> {
<a name="l01000"></a>01000       $from .= implode(<span class="stringliteral">&quot;, &quot;</span>, $fromClause);
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002     
<a name="l01003"></a>01003     $from .= $joinClause ? <span class="charliteral">&#39; &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $joinClause) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <span class="comment">// Build the SQL from the arrays we compiled</span>
<a name="l01006"></a>01006     $sql =  <span class="stringliteral">&quot;SELECT &quot;</span>
<a name="l01007"></a>01007     .($selectModifiers ? implode(<span class="stringliteral">&quot; &quot;</span>, $selectModifiers) . <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01008"></a>01008     .implode(<span class="stringliteral">&quot;, &quot;</span>, $selectClause)
<a name="l01009"></a>01009     .<span class="stringliteral">&quot; FROM &quot;</span>  . $from
<a name="l01010"></a>01010     .($whereClause ? <span class="stringliteral">&quot; WHERE &quot;</span>.implode(<span class="stringliteral">&quot; AND &quot;</span>, $whereClause) : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01011"></a>01011     .($groupByClause ? <span class="stringliteral">&quot; GROUP BY &quot;</span>.implode(<span class="stringliteral">&quot;,&quot;</span>, $groupByClause) : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01012"></a>01012     .($havingString ? <span class="stringliteral">&quot; HAVING &quot;</span>.$havingString : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01013"></a>01013     .($orderByClause ? <span class="stringliteral">&quot; ORDER BY &quot;</span>.implode(<span class="stringliteral">&quot;,&quot;</span>, $orderByClause) : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     <span class="comment">// APPLY OFFSET &amp; LIMIT to the query.</span>
<a name="l01016"></a>01016     <span class="keywordflow">if</span> ($criteria-&gt;<a class="code" href="classCriteria.html#adf99de554949344fd05b0c8ef0443475" title="Get limit.">getLimit</a>() || $criteria-&gt;<a class="code" href="classCriteria.html#aa020aa762a7543d836decfb7f65ffb51" title="Get offset.">getOffset</a>()) {
<a name="l01017"></a>01017       $db-&gt;applyLimit($sql, $criteria-&gt;<a class="code" href="classCriteria.html#aa020aa762a7543d836decfb7f65ffb51" title="Get offset.">getOffset</a>(), $criteria-&gt;<a class="code" href="classCriteria.html#adf99de554949344fd05b0c8ef0443475" title="Get limit.">getLimit</a>());
<a name="l01018"></a>01018     }
<a name="l01019"></a>01019 
<a name="l01020"></a>01020     <span class="keywordflow">return</span> $sql;
<a name="l01021"></a>01021   }
<a name="l01022"></a>01022 
<a name="l01030"></a>01030   <span class="keyword">private</span> <span class="keyword">static</span> function buildParams($columns, <a class="code" href="classCriteria.html">Criteria</a> $values)
<a name="l01031"></a>01031   {
<a name="l01032"></a>01032     $params = array();
<a name="l01033"></a>01033     <span class="keywordflow">foreach</span> ($columns as $key) {
<a name="l01034"></a>01034       <span class="keywordflow">if</span> ($values-&gt;<a class="code" href="classCriteria.html#a2b84a5248427857d7be444531de3e71d" title="Does this Criteria object contain the specified key?">containsKey</a>($key)) {
<a name="l01035"></a>01035         $crit = $values-&gt;<a class="code" href="classCriteria.html#aa39fd5150d9969b4336ca153ba5b657e" title="Method to return criteria related to columns in a table.">getCriterion</a>($key);
<a name="l01036"></a>01036         $params[] = array(<span class="stringliteral">&#39;column&#39;</span> =&gt; $crit-&gt;getColumn(), <span class="stringliteral">&#39;table&#39;</span> =&gt; $crit-&gt;getTable(), <span class="stringliteral">&#39;value&#39;</span> =&gt; $crit-&gt;getValue());
<a name="l01037"></a>01037       }
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039     <span class="keywordflow">return</span> $params;
<a name="l01040"></a>01040   }
<a name="l01041"></a>01041 
<a name="l01049"></a><a class="code" href="classBasePeer.html#abd09dcc291251fee62f9d72d539e7cf3">01049</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classBasePeer.html#abd09dcc291251fee62f9d72d539e7cf3" title="This function searches for the given validator $name under propel/validator/$name...">getValidator</a>($classname)
<a name="l01050"></a>01050   {
<a name="l01051"></a>01051     <span class="keywordflow">try</span> {
<a name="l01052"></a>01052       $v = isset(self::$validatorMap[$classname]) ? self::$validatorMap[$classname] : null;
<a name="l01053"></a>01053       <span class="keywordflow">if</span> ($v === null) {
<a name="l01054"></a>01054         $cls = <a class="code" href="classPropel.html#abc42a5ef45f7d052a1ce0ec8e369562f" title="Include once a file specified in DOT notation and reutrn unqualified clasname.">Propel::importClass</a>($classname);
<a name="l01055"></a>01055         $v = <span class="keyword">new</span> $cls();
<a name="l01056"></a>01056         self::$validatorMap[$classname] = $v;
<a name="l01057"></a>01057       }
<a name="l01058"></a>01058       <span class="keywordflow">return</span> $v;
<a name="l01059"></a>01059     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l01060"></a>01060       <a class="code" href="classPropel.html#ae5a907c0410d2bb63c68953860dbd84a" title="Logs a message If a logger has been configured, the logger will be used, otherwrise...">Propel::log</a>(<span class="stringliteral">&quot;BasePeer::getValidator(): failed trying to instantiate &quot;</span> . $classname . <span class="stringliteral">&quot;: &quot;</span>.$e-&gt;getMessage(), <a class="code" href="classPropel.html#a2551810662946edba369172a4befc8eb" title="A constant defining &amp;#39;Error conditions&amp;#39; logging level.">Propel::LOG_ERR</a>);
<a name="l01061"></a>01061     }
<a name="l01062"></a>01062   }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
