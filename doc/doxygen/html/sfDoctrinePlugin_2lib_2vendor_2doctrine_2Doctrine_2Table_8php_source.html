<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Table.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Table.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> *  $Id: Table.php 7681 2010-08-24 15:55:34Z jwage $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information, see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://www.doctrine-project.org&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00037"></a><a class="code" href="classDoctrine__Table.html">00037</a> <span class="keyword">class </span><a class="code" href="classDoctrine__Table.html">Doctrine_Table</a> <span class="keyword">extends</span> <a class="code" href="classDoctrine__Configurable.html">Doctrine_Configurable</a> implements Countable
<a name="l00038"></a>00038 {
<a name="l00042"></a>00042     <span class="keyword">protected</span> $_data             = array();
<a name="l00043"></a>00043 
<a name="l00047"></a>00047     <span class="keyword">protected</span> $_identifier = array();
<a name="l00048"></a>00048 
<a name="l00053"></a>00053     <span class="keyword">protected</span> $_identifierType;
<a name="l00054"></a>00054 
<a name="l00058"></a>00058     <span class="keyword">protected</span> $_conn;
<a name="l00059"></a>00059 
<a name="l00063"></a>00063     <span class="keyword">protected</span> $_identityMap        = array();
<a name="l00064"></a>00064 
<a name="l00068"></a>00068     <span class="keyword">protected</span> $_repository;
<a name="l00069"></a>00069 
<a name="l00085"></a>00085     <span class="keyword">protected</span> $_columns          = array();
<a name="l00086"></a>00086 
<a name="l00092"></a><a class="code" href="classDoctrine__Table.html#ae378c37ce13852aed3a6f318622f82dc">00092</a>     <span class="keyword">protected</span> <a class="code" href="classDoctrine__Table.html#ae378c37ce13852aed3a6f318622f82dc" title="Array of unique sets of fields.">$_uniques</a> = array();
<a name="l00093"></a>00093 
<a name="l00100"></a>00100     <span class="keyword">protected</span> $_fieldNames    = array();
<a name="l00101"></a>00101 
<a name="l00109"></a>00109     <span class="keyword">protected</span> $_columnNames = array();
<a name="l00110"></a>00110 
<a name="l00115"></a>00115     <span class="keyword">protected</span> $columnCount;
<a name="l00116"></a>00116 
<a name="l00120"></a>00120     <span class="keyword">protected</span> $hasDefaultValues;
<a name="l00121"></a>00121 
<a name="l00165"></a>00165     <span class="keyword">protected</span> $_options      = array(<span class="stringliteral">&#39;name&#39;</span>           =&gt; null,
<a name="l00166"></a>00166                                      <span class="stringliteral">&#39;tableName&#39;</span>      =&gt; null,
<a name="l00167"></a>00167                                      <span class="stringliteral">&#39;sequenceName&#39;</span>   =&gt; null,
<a name="l00168"></a>00168                                      <span class="stringliteral">&#39;inheritanceMap&#39;</span> =&gt; array(),
<a name="l00169"></a>00169                                      <span class="stringliteral">&#39;enumMap&#39;</span>        =&gt; array(),
<a name="l00170"></a>00170                                      <span class="stringliteral">&#39;type&#39;</span>           =&gt; null,
<a name="l00171"></a>00171                                      <span class="stringliteral">&#39;charset&#39;</span>        =&gt; null,
<a name="l00172"></a>00172                                      <span class="stringliteral">&#39;collate&#39;</span>        =&gt; null,
<a name="l00173"></a>00173                                      <span class="stringliteral">&#39;treeImpl&#39;</span>       =&gt; null,
<a name="l00174"></a>00174                                      <span class="stringliteral">&#39;treeOptions&#39;</span>    =&gt; array(),
<a name="l00175"></a>00175                                      <span class="stringliteral">&#39;indexes&#39;</span>        =&gt; array(),
<a name="l00176"></a>00176                                      <span class="stringliteral">&#39;parents&#39;</span>        =&gt; array(),
<a name="l00177"></a>00177                                      <span class="stringliteral">&#39;joinedParents&#39;</span>  =&gt; array(),
<a name="l00178"></a>00178                                      <span class="stringliteral">&#39;queryParts&#39;</span>     =&gt; array(),
<a name="l00179"></a>00179                                      <span class="stringliteral">&#39;versioning&#39;</span>     =&gt; null,
<a name="l00180"></a>00180                                      <span class="stringliteral">&#39;subclasses&#39;</span>     =&gt; array(),
<a name="l00181"></a>00181                                      <span class="stringliteral">&#39;orderBy&#39;</span>        =&gt; null
<a name="l00182"></a>00182                                      );
<a name="l00183"></a>00183 
<a name="l00187"></a>00187     <span class="keyword">protected</span> $_tree;
<a name="l00188"></a>00188 
<a name="l00192"></a>00192     <span class="keyword">protected</span> $_parser;
<a name="l00193"></a>00193 
<a name="l00198"></a>00198     <span class="keyword">protected</span> $_templates   = array();
<a name="l00199"></a>00199 
<a name="l00204"></a>00204     <span class="keyword">protected</span> $_filters     = array();
<a name="l00205"></a>00205 
<a name="l00210"></a>00210     <span class="keyword">protected</span> $_generators     = array();
<a name="l00211"></a>00211 
<a name="l00218"></a>00218     <span class="keyword">protected</span> $_generator;
<a name="l00219"></a>00219 
<a name="l00223"></a>00223     <span class="keyword">protected</span> $_invokedMethods = array();
<a name="l00224"></a>00224 
<a name="l00228"></a>00228     <span class="keyword">protected</span> $record;
<a name="l00229"></a>00229 
<a name="l00238"></a><a class="code" href="classDoctrine__Table.html#ab73f0102dbd808aa24778cb1fecbe2f5">00238</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ab73f0102dbd808aa24778cb1fecbe2f5" title="the constructor">__construct</a>($name, <a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $conn, $initDefinition = <span class="keyword">false</span>)
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240         $this-&gt;_conn = $conn;
<a name="l00241"></a>00241         $this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>] = $name;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a0efe50bf2b19bced9a54e2804c07dcc7" title="sets a parent for this configurable component the parent must be configurable component...">setParent</a>($this-&gt;_conn);
<a name="l00244"></a>00244         $this-&gt;_conn-&gt;addTable($this);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         $this-&gt;_parser = <span class="keyword">new</span> <a class="code" href="classDoctrine__Relation__Parser.html">Doctrine_Relation_Parser</a>($this);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <span class="keywordflow">if</span> ($charset = $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_DEFAULT_TABLE_CHARSET)) {
<a name="l00249"></a>00249             $this-&gt;_options[<span class="stringliteral">&#39;charset&#39;</span>] = $charset;
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251         <span class="keywordflow">if</span> ($collate = $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_DEFAULT_TABLE_COLLATE)) {
<a name="l00252"></a>00252             $this-&gt;_options[<span class="stringliteral">&#39;collate&#39;</span>] = $collate;
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255         <span class="keywordflow">if</span> ($initDefinition) {
<a name="l00256"></a>00256             $this-&gt;record = $this-&gt;<a class="code" href="classDoctrine__Table.html#a17ed7c6361ab4665ebbd2b27e89a2347" title="Initializes the in-memory table definition.">initDefinition</a>();
<a name="l00257"></a>00257 
<a name="l00258"></a>00258             $this-&gt;<a class="code" href="classDoctrine__Table.html#aa41a38b66ffb3045d00454d47a1c5626" title="Initializes the primary key.">initIdentifier</a>();
<a name="l00259"></a>00259 
<a name="l00260"></a>00260             $this-&gt;record-&gt;setUp();
<a name="l00261"></a>00261 
<a name="l00262"></a>00262             <span class="comment">// if tree, set up tree</span>
<a name="l00263"></a>00263             <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#a77db9a552fcbb2c9223a7944b14996bc" title="Determines if table acts as tree.">isTree</a>()) {
<a name="l00264"></a>00264                 $this-&gt;<a class="code" href="classDoctrine__Table.html#abcf0a605a76e57ff65108be64d6f9894" title="Gets associated tree.">getTree</a>()-&gt;setUp();
<a name="l00265"></a>00265             }
<a name="l00266"></a>00266         } <span class="keywordflow">else</span> {
<a name="l00267"></a>00267             <span class="keywordflow">if</span> ( ! isset($this-&gt;_options[<span class="stringliteral">&#39;tableName&#39;</span>])) {
<a name="l00268"></a>00268                 $this-&gt;<a class="code" href="classDoctrine__Table.html#a1f832433d9f3400dd13958a89a9c6c1c" title="sets the table name in the schema definition.">setTableName</a>(<a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>]));
<a name="l00269"></a>00269             }
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         $this-&gt;_filters[]  = <span class="keyword">new</span> <a class="code" href="classDoctrine__Record__Filter__Standard.html">Doctrine_Record_Filter_Standard</a>();
<a name="l00273"></a>00273         $this-&gt;_repository = <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Repository.html">Doctrine_Table_Repository</a>($this);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         $this-&gt;<a class="code" href="classDoctrine__Table.html#ac5a738f21446a81e30e8975edc8a837c" title="Construct template method.">construct</a>();
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 
<a name="l00287"></a><a class="code" href="classDoctrine__Table.html#ac5a738f21446a81e30e8975edc8a837c">00287</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ac5a738f21446a81e30e8975edc8a837c" title="Construct template method.">construct</a>()
<a name="l00288"></a>00288     { }
<a name="l00289"></a>00289 
<a name="l00295"></a><a class="code" href="classDoctrine__Table.html#a17ed7c6361ab4665ebbd2b27e89a2347">00295</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a17ed7c6361ab4665ebbd2b27e89a2347" title="Initializes the in-memory table definition.">initDefinition</a>()
<a name="l00296"></a>00296     {
<a name="l00297"></a>00297         $name = $this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00298"></a>00298         <span class="keywordflow">if</span> ( ! class_exists($name) || empty($name)) {
<a name="l00299"></a>00299             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Exception.html">Doctrine_Exception</a>(<span class="stringliteral">&quot;Couldn&#39;t find class &quot;</span> . $name);
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301         $record = <span class="keyword">new</span> $name($this);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         $names = array();
<a name="l00304"></a>00304 
<a name="l00305"></a>00305         $class = $name;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="comment">// get parent classes</span>
<a name="l00308"></a>00308 
<a name="l00309"></a>00309         <span class="keywordflow">do</span> {
<a name="l00310"></a>00310             <span class="keywordflow">if</span> ($class === <span class="stringliteral">&#39;Doctrine_Record&#39;</span>) {
<a name="l00311"></a>00311                 <span class="keywordflow">break</span>;
<a name="l00312"></a>00312             }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314             $name = $class;
<a name="l00315"></a>00315             $names[] = $name;
<a name="l00316"></a>00316         } <span class="keywordflow">while</span> ($class = get_parent_class($class));
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <span class="keywordflow">if</span> ($class === <span class="keyword">false</span>) {
<a name="l00319"></a>00319             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Class &quot;&#39;</span> . $name . <span class="stringliteral">&#39;&quot; must be a child class of Doctrine_Record&#39;</span>);
<a name="l00320"></a>00320         }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322         <span class="comment">// reverse names</span>
<a name="l00323"></a>00323         $names = array_reverse($names);
<a name="l00324"></a>00324         <span class="comment">// save parents</span>
<a name="l00325"></a>00325         array_pop($names);
<a name="l00326"></a>00326         $this-&gt;_options[<span class="stringliteral">&#39;parents&#39;</span>] = $names;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <span class="comment">// create database table</span>
<a name="l00329"></a>00329         <span class="keywordflow">if</span> (method_exists($record, <span class="stringliteral">&#39;setTableDefinition&#39;</span>)) {
<a name="l00330"></a>00330             $record-&gt;setTableDefinition();
<a name="l00331"></a>00331             <span class="comment">// get the declaring class of setTableDefinition method</span>
<a name="l00332"></a>00332             $method = <span class="keyword">new</span> ReflectionMethod($this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>], <span class="stringliteral">&#39;setTableDefinition&#39;</span>);
<a name="l00333"></a>00333             $class = $method-&gt;getDeclaringClass();
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         } <span class="keywordflow">else</span> {
<a name="l00336"></a>00336             $class = <span class="keyword">new</span> ReflectionClass($class);
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         $this-&gt;_options[<span class="stringliteral">&#39;joinedParents&#39;</span>] = array();
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="keywordflow">foreach</span> (array_reverse($this-&gt;_options[<span class="stringliteral">&#39;parents&#39;</span>]) as $parent) {
<a name="l00342"></a>00342 
<a name="l00343"></a>00343             <span class="keywordflow">if</span> ($parent === $class-&gt;getName()) {
<a name="l00344"></a>00344                 <span class="keywordflow">continue</span>;
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346             $ref = <span class="keyword">new</span> ReflectionClass($parent);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348             <span class="keywordflow">if</span> ($ref-&gt;isAbstract() || ! $class-&gt;isSubClassOf($parent)) {
<a name="l00349"></a>00349                 <span class="keywordflow">continue</span>;
<a name="l00350"></a>00350             }
<a name="l00351"></a>00351             $parentTable = $this-&gt;_conn-&gt;getTable($parent);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353             $found = <span class="keyword">false</span>;
<a name="l00354"></a>00354             $parentColumns = $parentTable-&gt;getColumns();
<a name="l00355"></a>00355 
<a name="l00356"></a>00356             <span class="keywordflow">foreach</span> ($parentColumns as $columnName =&gt; $definition) {
<a name="l00357"></a>00357                 <span class="keywordflow">if</span> ( ! isset($definition[<span class="stringliteral">&#39;primary&#39;</span>]) || $definition[<span class="stringliteral">&#39;primary&#39;</span>] === <span class="keyword">false</span>) {
<a name="l00358"></a>00358                     <span class="keywordflow">if</span> (isset($this-&gt;_columns[$columnName])) {
<a name="l00359"></a>00359                         $found = <span class="keyword">true</span>;
<a name="l00360"></a>00360                         <span class="keywordflow">break</span>;
<a name="l00361"></a>00361                     } <span class="keywordflow">else</span> {
<a name="l00362"></a>00362                         <span class="keywordflow">if</span> ( ! isset($parentColumns[$columnName][<span class="stringliteral">&#39;owner&#39;</span>])) {
<a name="l00363"></a>00363                             $parentColumns[$columnName][<span class="stringliteral">&#39;owner&#39;</span>] = $parentTable-&gt;getComponentName();
<a name="l00364"></a>00364                         }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366                         $this-&gt;_options[<span class="stringliteral">&#39;joinedParents&#39;</span>][] = $parentColumns[$columnName][<span class="stringliteral">&#39;owner&#39;</span>];
<a name="l00367"></a>00367                     }
<a name="l00368"></a>00368                 } <span class="keywordflow">else</span> {
<a name="l00369"></a>00369                     unset($parentColumns[$columnName]);
<a name="l00370"></a>00370                 }
<a name="l00371"></a>00371             }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373             <span class="keywordflow">if</span> ($found) {
<a name="l00374"></a>00374                 <span class="keywordflow">continue</span>;
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377             <span class="keywordflow">foreach</span> ($parentColumns as $columnName =&gt; $definition) {
<a name="l00378"></a>00378                 $fullName = $columnName . <span class="stringliteral">&#39; as &#39;</span> . $parentTable-&gt;getFieldName($columnName);
<a name="l00379"></a>00379                 $this-&gt;<a class="code" href="classDoctrine__Table.html#aa316ff09c71edae73ef5e3b10df310b2" title="Adds a column to the schema.">setColumn</a>($fullName, $definition[<span class="stringliteral">&#39;type&#39;</span>], $definition[<span class="stringliteral">&#39;length&#39;</span>], $definition, <span class="keyword">true</span>);
<a name="l00380"></a>00380             }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382             <span class="keywordflow">break</span>;
<a name="l00383"></a>00383         }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385         $this-&gt;_options[<span class="stringliteral">&#39;joinedParents&#39;</span>] = array_values(array_unique($this-&gt;_options[<span class="stringliteral">&#39;joinedParents&#39;</span>]));
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         $this-&gt;_options[<span class="stringliteral">&#39;declaringClass&#39;</span>] = $class;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="comment">// set the table definition for the given tree implementation</span>
<a name="l00390"></a>00390         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#a77db9a552fcbb2c9223a7944b14996bc" title="Determines if table acts as tree.">isTree</a>()) {
<a name="l00391"></a>00391             $this-&gt;<a class="code" href="classDoctrine__Table.html#abcf0a605a76e57ff65108be64d6f9894" title="Gets associated tree.">getTree</a>()-&gt;setTableDefinition();
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         $this-&gt;columnCount = <a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>($this-&gt;_columns);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         <span class="keywordflow">if</span> ( ! isset($this-&gt;_options[<span class="stringliteral">&#39;tableName&#39;</span>])) {
<a name="l00397"></a>00397             $this-&gt;<a class="code" href="classDoctrine__Table.html#a1f832433d9f3400dd13958a89a9c6c1c" title="sets the table name in the schema definition.">setTableName</a>(<a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($class-&gt;getName()));
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         <span class="keywordflow">return</span> $record;
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402 
<a name="l00412"></a><a class="code" href="classDoctrine__Table.html#aa41a38b66ffb3045d00454d47a1c5626">00412</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aa41a38b66ffb3045d00454d47a1c5626" title="Initializes the primary key.">initIdentifier</a>()
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414         <span class="keywordflow">switch</span> (<a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>($this-&gt;_identifier)) {
<a name="l00415"></a>00415             <span class="keywordflow">case</span> 0:
<a name="l00416"></a>00416                 <span class="keywordflow">if</span> ( ! empty($this-&gt;_options[<span class="stringliteral">&#39;joinedParents&#39;</span>])) {
<a name="l00417"></a>00417                     $root = current($this-&gt;_options[<span class="stringliteral">&#39;joinedParents&#39;</span>]);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419                     $table = $this-&gt;_conn-&gt;getTable($root);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421                     $this-&gt;_identifier = $table-&gt;getIdentifier();
<a name="l00422"></a>00422 
<a name="l00423"></a>00423                     $this-&gt;_identifierType = ($table-&gt;getIdentifierType() !== <a class="code" href="classDoctrine__Core.html#a88d2c2bc37e0c74fd50b6990546ecafd" title="IDENTIFIER_AUTOINC.">Doctrine_Core::IDENTIFIER_AUTOINC</a>)
<a name="l00424"></a>00424                                             ? $table-&gt;getIdentifierType() : <a class="code" href="classDoctrine__Core.html#a9589253eb371da8a5d500431e5a2b1ad" title="IDENTIFIER_NATURAL.">Doctrine_Core::IDENTIFIER_NATURAL</a>;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426                     <span class="comment">// add all inherited primary keys</span>
<a name="l00427"></a>00427                     <span class="keywordflow">foreach</span> ((array) $this-&gt;_identifier as $id) {
<a name="l00428"></a>00428                         $definition = $table-&gt;getDefinitionOf($id);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                         <span class="comment">// inherited primary keys shouldn&#39;t contain autoinc</span>
<a name="l00431"></a>00431                         <span class="comment">// and sequence definitions</span>
<a name="l00432"></a>00432                         unset($definition[<span class="stringliteral">&#39;autoincrement&#39;</span>]);
<a name="l00433"></a>00433                         unset($definition[<span class="stringliteral">&#39;sequence&#39;</span>]);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435                         <span class="comment">// add the inherited primary key column</span>
<a name="l00436"></a>00436                         $fullName = $id . <span class="stringliteral">&#39; as &#39;</span> . $table-&gt;getFieldName($id);
<a name="l00437"></a>00437                         $this-&gt;<a class="code" href="classDoctrine__Table.html#aa316ff09c71edae73ef5e3b10df310b2" title="Adds a column to the schema.">setColumn</a>($fullName, $definition[<span class="stringliteral">&#39;type&#39;</span>], $definition[<span class="stringliteral">&#39;length&#39;</span>],
<a name="l00438"></a>00438                                 $definition, <span class="keyword">true</span>);
<a name="l00439"></a>00439                     }
<a name="l00440"></a>00440                 } <span class="keywordflow">else</span> {
<a name="l00441"></a>00441                     $identifierOptions = $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_DEFAULT_IDENTIFIER_OPTIONS);
<a name="l00442"></a>00442                     $name = (isset($identifierOptions[<span class="stringliteral">&#39;name&#39;</span>]) &amp;&amp; $identifierOptions[<span class="stringliteral">&#39;name&#39;</span>]) ? $identifierOptions[<span class="stringliteral">&#39;name&#39;</span>]:<span class="stringliteral">&#39;id&#39;</span>;
<a name="l00443"></a>00443                     $name = sprintf($name, $this-&gt;<a class="code" href="classDoctrine__Table.html#ae8473c14e9ccaeb44e3cf037a8a93373" title="Gets the table name in the db.">getTableName</a>());
<a name="l00444"></a>00444 
<a name="l00445"></a>00445                     $definition = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; (isset($identifierOptions[<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; $identifierOptions[<span class="stringliteral">&#39;type&#39;</span>]) ? $identifierOptions[<span class="stringliteral">&#39;type&#39;</span>]:<span class="stringliteral">&#39;integer&#39;</span>,
<a name="l00446"></a>00446                                         <span class="stringliteral">&#39;length&#39;</span> =&gt; (isset($identifierOptions[<span class="stringliteral">&#39;length&#39;</span>]) &amp;&amp; $identifierOptions[<span class="stringliteral">&#39;length&#39;</span>]) ? $identifierOptions[<span class="stringliteral">&#39;length&#39;</span>]:8,
<a name="l00447"></a>00447                                         <span class="stringliteral">&#39;autoincrement&#39;</span> =&gt; isset($identifierOptions[<span class="stringliteral">&#39;autoincrement&#39;</span>]) ? $identifierOptions[<span class="stringliteral">&#39;autoincrement&#39;</span>]:<span class="keyword">true</span>,
<a name="l00448"></a>00448                                         <span class="stringliteral">&#39;primary&#39;</span> =&gt; isset($identifierOptions[<span class="stringliteral">&#39;primary&#39;</span>]) ? $identifierOptions[<span class="stringliteral">&#39;primary&#39;</span>]:<span class="keyword">true</span>);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450                     unset($identifierOptions[<span class="stringliteral">&#39;name&#39;</span>], $identifierOptions[<span class="stringliteral">&#39;type&#39;</span>], $identifierOptions[<span class="stringliteral">&#39;length&#39;</span>]);
<a name="l00451"></a>00451                     <span class="keywordflow">foreach</span> ($identifierOptions as $key =&gt; $value) {
<a name="l00452"></a>00452                         <span class="keywordflow">if</span> ( ! isset($definition[$key]) || ! $definition[$key]) {
<a name="l00453"></a>00453                             $definition[$key] = $value;
<a name="l00454"></a>00454                         }
<a name="l00455"></a>00455                     }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                     $this-&gt;<a class="code" href="classDoctrine__Table.html#aa316ff09c71edae73ef5e3b10df310b2" title="Adds a column to the schema.">setColumn</a>($name, $definition[<span class="stringliteral">&#39;type&#39;</span>], $definition[<span class="stringliteral">&#39;length&#39;</span>], $definition, <span class="keyword">true</span>);
<a name="l00458"></a>00458                     $this-&gt;_identifier = $name;
<a name="l00459"></a>00459                     $this-&gt;_identifierType = <a class="code" href="classDoctrine__Core.html#a88d2c2bc37e0c74fd50b6990546ecafd" title="IDENTIFIER_AUTOINC.">Doctrine_Core::IDENTIFIER_AUTOINC</a>;
<a name="l00460"></a>00460                 }
<a name="l00461"></a>00461                 $this-&gt;columnCount++;
<a name="l00462"></a>00462                 <span class="keywordflow">break</span>;
<a name="l00463"></a>00463             <span class="keywordflow">case</span> 1:
<a name="l00464"></a>00464                 <span class="keywordflow">foreach</span> ($this-&gt;_identifier as $pk) {
<a name="l00465"></a>00465                     $e = $this-&gt;<a class="code" href="classDoctrine__Table.html#ae797bc1921f7f405ea1b9ef88bb281c0" title="Retrieves the definition of a field.">getDefinitionOf</a>($pk);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467                     $found = <span class="keyword">false</span>;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469                     <span class="keywordflow">foreach</span> ($e as $option =&gt; $value) {
<a name="l00470"></a>00470                         <span class="keywordflow">if</span> ($found) {
<a name="l00471"></a>00471                             <span class="keywordflow">break</span>;
<a name="l00472"></a>00472                         }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474                         $e2 = explode(<span class="charliteral">&#39;:&#39;</span>, $option);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476                         <span class="keywordflow">switch</span> (strtolower($e2[0])) {
<a name="l00477"></a>00477                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;autoincrement&#39;</span>:
<a name="l00478"></a>00478                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;autoinc&#39;</span>:
<a name="l00479"></a>00479                                 <span class="keywordflow">if</span> ($value !== <span class="keyword">false</span>) {
<a name="l00480"></a>00480                                     $this-&gt;_identifierType = <a class="code" href="classDoctrine__Core.html#a88d2c2bc37e0c74fd50b6990546ecafd" title="IDENTIFIER_AUTOINC.">Doctrine_Core::IDENTIFIER_AUTOINC</a>;
<a name="l00481"></a>00481                                     $found = <span class="keyword">true</span>;
<a name="l00482"></a>00482                                 }
<a name="l00483"></a>00483                                 <span class="keywordflow">break</span>;
<a name="l00484"></a>00484                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;seq&#39;</span>:
<a name="l00485"></a>00485                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;sequence&#39;</span>:
<a name="l00486"></a>00486                                 $this-&gt;_identifierType = <a class="code" href="classDoctrine__Core.html#acdd60dfc598a1d5b53b0a1bef049e50f" title="IDENTIFIER_SEQUENCE.">Doctrine_Core::IDENTIFIER_SEQUENCE</a>;
<a name="l00487"></a>00487                                 $found = <span class="keyword">true</span>;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489                                 <span class="keywordflow">if</span> (is_string($value)) {
<a name="l00490"></a>00490                                     $this-&gt;_options[<span class="stringliteral">&#39;sequenceName&#39;</span>] = $value;
<a name="l00491"></a>00491                                 } <span class="keywordflow">else</span> {
<a name="l00492"></a>00492                                     <span class="keywordflow">if</span> (($sequence = $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_DEFAULT_SEQUENCE)) !== null) {
<a name="l00493"></a>00493                                         $this-&gt;_options[<span class="stringliteral">&#39;sequenceName&#39;</span>] = $sequence;
<a name="l00494"></a>00494                                     } <span class="keywordflow">else</span> {
<a name="l00495"></a>00495                                         $this-&gt;_options[<span class="stringliteral">&#39;sequenceName&#39;</span>] = $this-&gt;_conn-&gt;formatter-&gt;getSequenceName($this-&gt;_options[<span class="stringliteral">&#39;tableName&#39;</span>]);
<a name="l00496"></a>00496                                     }
<a name="l00497"></a>00497                                 }
<a name="l00498"></a>00498                                 <span class="keywordflow">break</span>;
<a name="l00499"></a>00499                         }
<a name="l00500"></a>00500                     }
<a name="l00501"></a>00501                     <span class="keywordflow">if</span> ( ! isset($this-&gt;_identifierType)) {
<a name="l00502"></a>00502                         $this-&gt;_identifierType = <a class="code" href="classDoctrine__Core.html#a9589253eb371da8a5d500431e5a2b1ad" title="IDENTIFIER_NATURAL.">Doctrine_Core::IDENTIFIER_NATURAL</a>;
<a name="l00503"></a>00503                     }
<a name="l00504"></a>00504                 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506                 $this-&gt;_identifier = $pk;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508                 <span class="keywordflow">break</span>;
<a name="l00509"></a>00509             <span class="keywordflow">default</span>:
<a name="l00510"></a>00510                 $this-&gt;_identifierType = <a class="code" href="classDoctrine__Core.html#ae200dec4ee5f87857561890e4b21a38c" title="IDENTIFIER_COMPOSITE.">Doctrine_Core::IDENTIFIER_COMPOSITE</a>;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513 
<a name="l00523"></a><a class="code" href="classDoctrine__Table.html#a2112e52958ecfa654cc6671e7430fba8">00523</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a2112e52958ecfa654cc6671e7430fba8" title="Gets the owner of a column.">getColumnOwner</a>($columnName)
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525         <span class="keywordflow">if</span> (isset($this-&gt;_columns[$columnName][<span class="stringliteral">&#39;owner&#39;</span>])) {
<a name="l00526"></a>00526             <span class="keywordflow">return</span> $this-&gt;_columns[$columnName][<span class="stringliteral">&#39;owner&#39;</span>];
<a name="l00527"></a>00527         } <span class="keywordflow">else</span> {
<a name="l00528"></a>00528             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>();
<a name="l00529"></a>00529         }
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 
<a name="l00542"></a><a class="code" href="classDoctrine__Table.html#ad04a37eae8f3b0fb0299b101fe381c4f">00542</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ad04a37eae8f3b0fb0299b101fe381c4f" title="Gets the record instance for this table.">getRecordInstance</a>()
<a name="l00543"></a>00543     {
<a name="l00544"></a>00544         <span class="keywordflow">if</span> ( ! $this-&gt;record) {
<a name="l00545"></a>00545             $this-&gt;record = <span class="keyword">new</span> $this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547         <span class="keywordflow">return</span> $this-&gt;record;
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549 
<a name="l00556"></a><a class="code" href="classDoctrine__Table.html#a02b942111548cc059f8ab2ca962e5fc7">00556</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a02b942111548cc059f8ab2ca962e5fc7" title="Checks whether a column is inherited from a component further up in the hierarchy...">isInheritedColumn</a>($columnName)
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558         <span class="keywordflow">return</span> (isset($this-&gt;_columns[$columnName][<span class="stringliteral">&#39;owner&#39;</span>]));
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560 
<a name="l00570"></a><a class="code" href="classDoctrine__Table.html#a14f868d55841a69af92c8a7f6866d0eb">00570</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a14f868d55841a69af92c8a7f6866d0eb" title="Checks whether a field is in the primary key.">isIdentifier</a>($fieldName)
<a name="l00571"></a>00571     {
<a name="l00572"></a>00572         <span class="keywordflow">return</span> ($fieldName === $this-&gt;<a class="code" href="classDoctrine__Table.html#a237c5d8e62bd6f88f72fa94c88999a5a" title="Returns the definition of the identifier key.">getIdentifier</a>() ||
<a name="l00573"></a>00573                 in_array($fieldName, (array) $this-&gt;<a class="code" href="classDoctrine__Table.html#a237c5d8e62bd6f88f72fa94c88999a5a" title="Returns the definition of the identifier key.">getIdentifier</a>()));
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575 
<a name="l00585"></a><a class="code" href="classDoctrine__Table.html#ab9d8d0eec60cc4ef21c2c4e4bc127b0f">00585</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ab9d8d0eec60cc4ef21c2c4e4bc127b0f" title="Checks whether a field identifier is of type autoincrement.">isIdentifierAutoincrement</a>()
<a name="l00586"></a>00586     {
<a name="l00587"></a>00587         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a521c7457c7df1b70d8223922df1d6afd" title="Retrieves the type of primary key.">getIdentifierType</a>() === <a class="code" href="classDoctrine__Core.html#a88d2c2bc37e0c74fd50b6990546ecafd" title="IDENTIFIER_AUTOINC.">Doctrine_Core::IDENTIFIER_AUTOINC</a>;
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00596"></a><a class="code" href="classDoctrine__Table.html#ae12b4c2dabc4be1362e8353caf62e9f0">00596</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ae12b4c2dabc4be1362e8353caf62e9f0" title="Checks whether a field identifier is a composite key.">isIdentifierComposite</a>()
<a name="l00597"></a>00597     {
<a name="l00598"></a>00598         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a521c7457c7df1b70d8223922df1d6afd" title="Retrieves the type of primary key.">getIdentifierType</a>() === <a class="code" href="classDoctrine__Core.html#ae200dec4ee5f87857561890e4b21a38c" title="IDENTIFIER_COMPOSITE.">Doctrine_Core::IDENTIFIER_COMPOSITE</a>;
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00607"></a><a class="code" href="classDoctrine__Table.html#a73497fdc580ec6e79feb91be30bc6c83">00607</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a73497fdc580ec6e79feb91be30bc6c83" title="getMethodOwner">getMethodOwner</a>($method)
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609         <span class="keywordflow">return</span> (isset($this-&gt;_invokedMethods[$method])) ?
<a name="l00610"></a>00610                       $this-&gt;_invokedMethods[$method] : <span class="keyword">false</span>;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612 
<a name="l00619"></a><a class="code" href="classDoctrine__Table.html#acfe0b7554a6615cd0b41faf7baa8152a">00619</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#acfe0b7554a6615cd0b41faf7baa8152a" title="setMethodOwner">setMethodOwner</a>($method, $class)
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621         $this-&gt;_invokedMethods[$method] = $class;
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623 
<a name="l00635"></a><a class="code" href="classDoctrine__Table.html#ada5264d4c8defdbf041672f698d69161">00635</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ada5264d4c8defdbf041672f698d69161" title="Exports this table to database based on the schema definition.">export</a>()
<a name="l00636"></a>00636     {
<a name="l00637"></a>00637         $this-&gt;_conn-&gt;export-&gt;exportTable($this);
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639 
<a name="l00650"></a><a class="code" href="classDoctrine__Table.html#a96af311f8b16e09717441a9abe0eb1f3">00650</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a96af311f8b16e09717441a9abe0eb1f3" title="Returns an exportable representation of this object.">getExportableFormat</a>($parseForeignKeys = <span class="keyword">true</span>)
<a name="l00651"></a>00651     {
<a name="l00652"></a>00652         $columns = array();
<a name="l00653"></a>00653         $primary = array();
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#aeba25b1d3e85cf8c5846310e73f7dc5d" title="Retrieves all columns of the table.">getColumns</a>() as $name =&gt; $definition) {
<a name="l00656"></a>00656 
<a name="l00657"></a>00657             <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;owner&#39;</span>])) {
<a name="l00658"></a>00658                 <span class="keywordflow">continue</span>;
<a name="l00659"></a>00659             }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661             <span class="keywordflow">switch</span> ($definition[<span class="stringliteral">&#39;type&#39;</span>]) {
<a name="l00662"></a>00662                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;boolean&#39;</span>:
<a name="l00663"></a>00663                     <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;default&#39;</span>])) {
<a name="l00664"></a>00664                         $definition[<span class="stringliteral">&#39;default&#39;</span>] = $this-&gt;<a class="code" href="classDoctrine__Table.html#a312ec34fe98f7041b583535e6f34c941" title="Returns the connection associated with this table (if any).">getConnection</a>()-&gt;convertBooleans($definition[<span class="stringliteral">&#39;default&#39;</span>]);
<a name="l00665"></a>00665                     }
<a name="l00666"></a>00666                     <span class="keywordflow">break</span>;
<a name="l00667"></a>00667             }
<a name="l00668"></a>00668             $columns[$name] = $definition;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670             <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;primary&#39;</span>]) &amp;&amp; $definition[<span class="stringliteral">&#39;primary&#39;</span>]) {
<a name="l00671"></a>00671                 $primary[] = $name;
<a name="l00672"></a>00672             }
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         $options[<span class="stringliteral">&#39;foreignKeys&#39;</span>] = isset($this-&gt;_options[<span class="stringliteral">&#39;foreignKeys&#39;</span>]) ?
<a name="l00676"></a>00676                 $this-&gt;_options[<span class="stringliteral">&#39;foreignKeys&#39;</span>] : array();
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         <span class="keywordflow">if</span> ($parseForeignKeys &amp;&amp; $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_EXPORT) &amp; <a class="code" href="classDoctrine__Core.html#a5b961239165033f0e1fc57906f27e9e6" title="EXPORT_CONSTRAINTS.">Doctrine_Core::EXPORT_CONSTRAINTS</a>) {
<a name="l00679"></a>00679 
<a name="l00680"></a>00680             $constraints = array();
<a name="l00681"></a>00681 
<a name="l00682"></a>00682             $emptyIntegrity = array(<span class="stringliteral">&#39;onUpdate&#39;</span> =&gt; null,
<a name="l00683"></a>00683                                     <span class="stringliteral">&#39;onDelete&#39;</span> =&gt; null);
<a name="l00684"></a>00684 
<a name="l00685"></a>00685             <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#a6cd69530d1da1ee41a3f8a106d507c32" title="Retrieves all relation objects defined on this table.">getRelations</a>() as $name =&gt; $relation) {
<a name="l00686"></a>00686                 $fk = $relation-&gt;toArray();
<a name="l00687"></a>00687                 $fk[<span class="stringliteral">&#39;foreignTable&#39;</span>] = $relation-&gt;getTable()-&gt;getTableName();
<a name="l00688"></a>00688 
<a name="l00689"></a>00689                 <span class="comment">// do not touch tables that have EXPORT_NONE attribute</span>
<a name="l00690"></a>00690                 <span class="keywordflow">if</span> ($relation-&gt;getTable()-&gt;getAttribute(Doctrine_Core::ATTR_EXPORT) === <a class="code" href="classDoctrine__Core.html#a034a240a4b6c4e832989bd04e50b885b" title="EXPORT CONSTANTS.">Doctrine_Core::EXPORT_NONE</a>) {
<a name="l00691"></a>00691                     <span class="keywordflow">continue</span>;
<a name="l00692"></a>00692                 }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694                 <span class="keywordflow">if</span> ($relation-&gt;getTable() === $this &amp;&amp; in_array($relation-&gt;getLocal(), $primary)) {
<a name="l00695"></a>00695                     <span class="keywordflow">if</span> ($relation-&gt;hasConstraint()) {
<a name="l00696"></a>00696                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&quot;Badly constructed integrity constraints. Cannot define constraint of different fields in the same table.&quot;</span>);
<a name="l00697"></a>00697                     }
<a name="l00698"></a>00698                     <span class="keywordflow">continue</span>;
<a name="l00699"></a>00699                 }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701                 $integrity = array(<span class="stringliteral">&#39;onUpdate&#39;</span> =&gt; $fk[<span class="stringliteral">&#39;onUpdate&#39;</span>],
<a name="l00702"></a>00702                                    <span class="stringliteral">&#39;onDelete&#39;</span> =&gt; $fk[<span class="stringliteral">&#39;onDelete&#39;</span>]);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704                 $fkName = $relation-&gt;getForeignKeyName();
<a name="l00705"></a>00705 
<a name="l00706"></a>00706                 <span class="keywordflow">if</span> ($relation instanceof <a class="code" href="classDoctrine__Relation__LocalKey.html">Doctrine_Relation_LocalKey</a>) {
<a name="l00707"></a>00707                     $def = array(<span class="stringliteral">&#39;name&#39;</span>         =&gt; $fkName,
<a name="l00708"></a>00708                                  <span class="stringliteral">&#39;local&#39;</span>        =&gt; $relation-&gt;getLocalColumnName(),
<a name="l00709"></a>00709                                  <span class="stringliteral">&#39;foreign&#39;</span>      =&gt; $relation-&gt;getForeignColumnName(),
<a name="l00710"></a>00710                                  <span class="stringliteral">&#39;foreignTable&#39;</span> =&gt; $relation-&gt;getTable()-&gt;getTableName());
<a name="l00711"></a>00711 
<a name="l00712"></a>00712                     <span class="keywordflow">if</span> ($integrity !== $emptyIntegrity) {
<a name="l00713"></a>00713                         $def = array_merge($def, $integrity);
<a name="l00714"></a>00714                     }
<a name="l00715"></a>00715                     <span class="keywordflow">if</span> (($key = $this-&gt;<a class="code" href="classDoctrine__Table.html#ad5a5e04c23ab00f3124738b103dd2458" title="Check if a foreign definition already exists in the fks array for a foreign table...">_checkForeignKeyExists</a>($def, $options[<span class="stringliteral">&#39;foreignKeys&#39;</span>])) === <span class="keyword">false</span>) {
<a name="l00716"></a>00716                         $options[<span class="stringliteral">&#39;foreignKeys&#39;</span>][$fkName] = $def;
<a name="l00717"></a>00717                     } <span class="keywordflow">else</span> {
<a name="l00718"></a>00718                         unset($def[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l00719"></a>00719                         $options[<span class="stringliteral">&#39;foreignKeys&#39;</span>][$key] = array_merge($options[<span class="stringliteral">&#39;foreignKeys&#39;</span>][$key], $def);
<a name="l00720"></a>00720                     }
<a name="l00721"></a>00721                 }
<a name="l00722"></a>00722             }
<a name="l00723"></a>00723         }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         $options[<span class="stringliteral">&#39;primary&#39;</span>] = $primary;
<a name="l00726"></a>00726 
<a name="l00727"></a>00727         <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;tableName&#39;</span> =&gt; $this-&gt;<a class="code" href="classDoctrine__Table.html#a98b834ff1ef11b76ba50747f2ff22607" title="Returns the value of a given option.">getOption</a>(<span class="stringliteral">&#39;tableName&#39;</span>),
<a name="l00728"></a>00728                      <span class="stringliteral">&#39;columns&#39;</span>   =&gt; $columns,
<a name="l00729"></a>00729                      <span class="stringliteral">&#39;options&#39;</span>   =&gt; array_merge($this-&gt;<a class="code" href="classDoctrine__Table.html#a4ace143a353caddab2af2769d33e261f" title="Retrieves all options of this table and the associated values.">getOptions</a>(), $options));
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731 
<a name="l00740"></a><a class="code" href="classDoctrine__Table.html#ad5a5e04c23ab00f3124738b103dd2458">00740</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Table.html#ad5a5e04c23ab00f3124738b103dd2458" title="Check if a foreign definition already exists in the fks array for a foreign table...">_checkForeignKeyExists</a>($def, $foreignKeys)
<a name="l00741"></a>00741     {
<a name="l00742"></a>00742         <span class="keywordflow">foreach</span> ($foreignKeys as $key =&gt; $foreignKey) {
<a name="l00743"></a>00743             <span class="keywordflow">if</span> ($def[<span class="stringliteral">&#39;local&#39;</span>] == $foreignKey[<span class="stringliteral">&#39;local&#39;</span>] &amp;&amp; $def[<span class="stringliteral">&#39;foreign&#39;</span>] == $foreignKey[<span class="stringliteral">&#39;foreign&#39;</span>] &amp;&amp; $def[<span class="stringliteral">&#39;foreignTable&#39;</span>] == $foreignKey[<span class="stringliteral">&#39;foreignTable&#39;</span>]) {
<a name="l00744"></a>00744                 <span class="keywordflow">return</span> $key;
<a name="l00745"></a>00745             }
<a name="l00746"></a>00746         }
<a name="l00747"></a>00747         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00748"></a>00748     }
<a name="l00749"></a>00749 
<a name="l00755"></a><a class="code" href="classDoctrine__Table.html#a81f35ae974008023a037fca9f620f55a">00755</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a81f35ae974008023a037fca9f620f55a" title="Retrieves the relation parser associated with this table.">getRelationParser</a>()
<a name="l00756"></a>00756     {
<a name="l00757"></a>00757         <span class="keywordflow">return</span> $this-&gt;_parser;
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759 
<a name="l00773"></a><a class="code" href="classDoctrine__Table.html#ad04618fcf3ec148e4ae2b725b526ed06">00773</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ad04618fcf3ec148e4ae2b725b526ed06" title="Magic method for accessing to object properties.">__get</a>($option)
<a name="l00774"></a>00774     {
<a name="l00775"></a>00775         <span class="keywordflow">if</span> (isset($this-&gt;_options[$option])) {
<a name="l00776"></a>00776             <span class="keywordflow">return</span> $this-&gt;_options[$option];
<a name="l00777"></a>00777         }
<a name="l00778"></a>00778         <span class="keywordflow">return</span> null;
<a name="l00779"></a>00779     }
<a name="l00780"></a>00780 
<a name="l00793"></a><a class="code" href="classDoctrine__Table.html#a8ad25da2ff39f52fa75c3390c858a293">00793</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a8ad25da2ff39f52fa75c3390c858a293" title="Magic method for testing object properties existence.">__isset</a>($option)
<a name="l00794"></a>00794     {
<a name="l00795"></a>00795         <span class="keywordflow">return</span> isset($this-&gt;_options[$option]);
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797 
<a name="l00803"></a><a class="code" href="classDoctrine__Table.html#a4ace143a353caddab2af2769d33e261f">00803</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a4ace143a353caddab2af2769d33e261f" title="Retrieves all options of this table and the associated values.">getOptions</a>()
<a name="l00804"></a>00804     {
<a name="l00805"></a>00805         <span class="keywordflow">return</span> $this-&gt;_options;
<a name="l00806"></a>00806     }
<a name="l00807"></a>00807 
<a name="l00817"></a><a class="code" href="classDoctrine__Table.html#a09f77e6ea8c9bcdced800ea44b579610">00817</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a09f77e6ea8c9bcdced800ea44b579610" title="Sets all the options.">setOptions</a>($options)
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819         <span class="keywordflow">foreach</span> ($options as $key =&gt; $value) {
<a name="l00820"></a>00820             $this-&gt;<a class="code" href="classDoctrine__Table.html#ab865b0ff2cfbc786d02a71ad1c6abc3d" title="Sets an option for the table.">setOption</a>($key, $value);
<a name="l00821"></a>00821         }
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823 
<a name="l00833"></a><a class="code" href="classDoctrine__Table.html#a854a0ebb448c3f5b4a41a0e5571c07a8">00833</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a854a0ebb448c3f5b4a41a0e5571c07a8" title="Adds a foreignKey to the table in-memory definition.">addForeignKey</a>(array $definition)
<a name="l00834"></a>00834     {
<a name="l00835"></a>00835         $this-&gt;_options[<span class="stringliteral">&#39;foreignKeys&#39;</span>][] = $definition;
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837 
<a name="l00850"></a><a class="code" href="classDoctrine__Table.html#aca875726ab6db0f6c44e1604ccab14cb">00850</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aca875726ab6db0f6c44e1604ccab14cb" title="Adds a check constraint to the table in-memory definition.">addCheckConstraint</a>($definition, $name)
<a name="l00851"></a>00851     {
<a name="l00852"></a>00852         <span class="keywordflow">if</span> (is_string($name)) {
<a name="l00853"></a>00853             $this-&gt;_options[<span class="stringliteral">&#39;checks&#39;</span>][$name] = $definition;
<a name="l00854"></a>00854         } <span class="keywordflow">else</span> {
<a name="l00855"></a>00855             $this-&gt;_options[<span class="stringliteral">&#39;checks&#39;</span>][] = $definition;
<a name="l00856"></a>00856         }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         <span class="keywordflow">return</span> $this;
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860 
<a name="l00871"></a><a class="code" href="classDoctrine__Table.html#a5149a221d80e585b897cde52a308830a">00871</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a5149a221d80e585b897cde52a308830a" title="Adds an index to this table in-memory definition.">addIndex</a>($index, array $definition)
<a name="l00872"></a>00872     {
<a name="l00873"></a>00873         <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;fields&#39;</span>])) {
<a name="l00874"></a>00874             <span class="keywordflow">foreach</span> ((array) $definition[<span class="stringliteral">&#39;fields&#39;</span>] as $key =&gt; $field) {
<a name="l00875"></a>00875                 <span class="keywordflow">if</span> (is_numeric($key)) {
<a name="l00876"></a>00876                     $definition[<span class="stringliteral">&#39;fields&#39;</span>][$key] = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($field);
<a name="l00877"></a>00877                 } <span class="keywordflow">else</span> {
<a name="l00878"></a>00878                     $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($key);
<a name="l00879"></a>00879 
<a name="l00880"></a>00880                     unset($definition[<span class="stringliteral">&#39;fields&#39;</span>][$key]);
<a name="l00881"></a>00881 
<a name="l00882"></a>00882                     $definition[<span class="stringliteral">&#39;fields&#39;</span>][$columnName] = $field;
<a name="l00883"></a>00883                 }
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885         }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887         $this-&gt;_options[<span class="stringliteral">&#39;indexes&#39;</span>][$index] = $definition;
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889 
<a name="l00898"></a><a class="code" href="classDoctrine__Table.html#a7a333d8ea274db53eb3b6f6284fe831a">00898</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a7a333d8ea274db53eb3b6f6284fe831a" title="Retrieves an index definition.">getIndex</a>($index)
<a name="l00899"></a>00899     {
<a name="l00900"></a>00900         <span class="keywordflow">if</span> (isset($this-&gt;_options[<span class="stringliteral">&#39;indexes&#39;</span>][$index])) {
<a name="l00901"></a>00901             <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;indexes&#39;</span>][$index];
<a name="l00902"></a>00902         }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906 
<a name="l00919"></a><a class="code" href="classDoctrine__Table.html#a0043552ac9966edb6293c76d3406a2e6">00919</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a0043552ac9966edb6293c76d3406a2e6" title="Defines a n-uple of fields that must be unique for every record.">unique</a>($fields, $options = array(), $createdUniqueIndex = <span class="keyword">true</span>)
<a name="l00920"></a>00920     {
<a name="l00921"></a>00921         <span class="keywordflow">if</span> ($createdUniqueIndex) {
<a name="l00922"></a>00922             $name = implode(<span class="charliteral">&#39;_&#39;</span>, $fields) . <span class="stringliteral">&#39;_unqidx&#39;</span>;
<a name="l00923"></a>00923             $definition = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;unique&#39;</span>, <span class="stringliteral">&#39;fields&#39;</span> =&gt; $fields);
<a name="l00924"></a>00924             $this-&gt;<a class="code" href="classDoctrine__Table.html#a5149a221d80e585b897cde52a308830a" title="Adds an index to this table in-memory definition.">addIndex</a>($name, $definition);
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927         $this-&gt;_uniques[] = array($fields, $options);
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929 
<a name="l00943"></a><a class="code" href="classDoctrine__Table.html#a5b31bcce49467c36f155cbee8e826308">00943</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a5b31bcce49467c36f155cbee8e826308" title="Adds a relation to the table.">bind</a>($args, $type)
<a name="l00944"></a>00944     {
<a name="l00945"></a>00945         $options = ( ! isset($args[1])) ? array() : $args[1];
<a name="l00946"></a>00946         $options[<span class="stringliteral">&#39;type&#39;</span>] = $type;
<a name="l00947"></a>00947 
<a name="l00948"></a>00948         $this-&gt;_parser-&gt;bind($args[0], $options);
<a name="l00949"></a>00949     }
<a name="l00950"></a>00950 
<a name="l00959"></a><a class="code" href="classDoctrine__Table.html#a67a582be6f4f37fbf2e289a4245def3b">00959</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a67a582be6f4f37fbf2e289a4245def3b" title="Binds One-to-One aggregate relation.">hasOne</a>()
<a name="l00960"></a>00960     {
<a name="l00961"></a>00961         $this-&gt;<a class="code" href="classDoctrine__Table.html#a5b31bcce49467c36f155cbee8e826308" title="Adds a relation to the table.">bind</a>(func_get_args(), <a class="code" href="classDoctrine__Relation.html#ad1d58e954205119e9796bec18d516970" title="RELATION CONSTANTS.">Doctrine_Relation::ONE</a>);
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963 
<a name="l00972"></a><a class="code" href="classDoctrine__Table.html#a57d1e31846f1e2b70844d70a795b6a60">00972</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a57d1e31846f1e2b70844d70a795b6a60" title="Binds One-to-Many / Many-to-Many aggregate relation.">hasMany</a>()
<a name="l00973"></a>00973     {
<a name="l00974"></a>00974         $this-&gt;<a class="code" href="classDoctrine__Table.html#a5b31bcce49467c36f155cbee8e826308" title="Adds a relation to the table.">bind</a>(func_get_args(), <a class="code" href="classDoctrine__Relation.html#a9cf5a7937bfa222693f99ce4b2b22864" title="constant for MANY_TO_MANY and ONE_TO_MANY relationships">Doctrine_Relation::MANY</a>);
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976 
<a name="l00988"></a><a class="code" href="classDoctrine__Table.html#a7aff385bdc2c2ef3f828ad0e32d90fc2">00988</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a7aff385bdc2c2ef3f828ad0e32d90fc2" title="Tests if a relation exists.">hasRelation</a>($alias)
<a name="l00989"></a>00989     {
<a name="l00990"></a>00990         <span class="keywordflow">return</span> $this-&gt;_parser-&gt;hasRelation($alias);
<a name="l00991"></a>00991     }
<a name="l00992"></a>00992 
<a name="l00999"></a><a class="code" href="classDoctrine__Table.html#a67a92d6dbdc6c57ca3b1f42d31200652">00999</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a67a92d6dbdc6c57ca3b1f42d31200652" title="Retrieves a relation object for this component.">getRelation</a>($alias, $recursive = <span class="keyword">true</span>)
<a name="l01000"></a>01000     {
<a name="l01001"></a>01001         <span class="keywordflow">return</span> $this-&gt;_parser-&gt;getRelation($alias, $recursive);
<a name="l01002"></a>01002     }
<a name="l01003"></a>01003 
<a name="l01009"></a><a class="code" href="classDoctrine__Table.html#a6cd69530d1da1ee41a3f8a106d507c32">01009</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a6cd69530d1da1ee41a3f8a106d507c32" title="Retrieves all relation objects defined on this table.">getRelations</a>()
<a name="l01010"></a>01010     {
<a name="l01011"></a>01011         <span class="keywordflow">return</span> $this-&gt;_parser-&gt;getRelations();
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013 
<a name="l01028"></a><a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169">01028</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>($alias = <span class="stringliteral">&#39;&#39;</span>)
<a name="l01029"></a>01029     {
<a name="l01030"></a>01030         <span class="keywordflow">if</span> ( ! empty($alias)) {
<a name="l01031"></a>01031             $alias = <span class="charliteral">&#39; &#39;</span> . trim($alias);
<a name="l01032"></a>01032         }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034         $class = $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_QUERY_CLASS);
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         <span class="keywordflow">return</span> <a class="code" href="classDoctrine__Table.html#a79a249541e1a69d6d9cb9328d6fc6d4f" title="Creates a new record.">Doctrine_Query::create</a>(null, $class)
<a name="l01037"></a>01037             -&gt;from($this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>() . $alias);
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039 
<a name="l01045"></a><a class="code" href="classDoctrine__Table.html#af5753e696ec86f30632f352e195f5a82">01045</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#af5753e696ec86f30632f352e195f5a82" title="Gets the internal record repository.">getRepository</a>()
<a name="l01046"></a>01046     {
<a name="l01047"></a>01047         <span class="keywordflow">return</span> $this-&gt;_repository;
<a name="l01048"></a>01048     }
<a name="l01049"></a>01049 
<a name="l01061"></a><a class="code" href="classDoctrine__Table.html#ab865b0ff2cfbc786d02a71ad1c6abc3d">01061</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ab865b0ff2cfbc786d02a71ad1c6abc3d" title="Sets an option for the table.">setOption</a>($name, $value)
<a name="l01062"></a>01062     {
<a name="l01063"></a>01063         <span class="keywordflow">switch</span> ($name) {
<a name="l01064"></a>01064             <span class="keywordflow">case</span> <span class="stringliteral">&#39;name&#39;</span>:
<a name="l01065"></a>01065             <span class="keywordflow">case</span> <span class="stringliteral">&#39;tableName&#39;</span>:
<a name="l01066"></a>01066                 <span class="keywordflow">break</span>;
<a name="l01067"></a>01067             <span class="keywordflow">case</span> <span class="stringliteral">&#39;enumMap&#39;</span>:
<a name="l01068"></a>01068             <span class="keywordflow">case</span> <span class="stringliteral">&#39;inheritanceMap&#39;</span>:
<a name="l01069"></a>01069             <span class="keywordflow">case</span> <span class="stringliteral">&#39;index&#39;</span>:
<a name="l01070"></a>01070             <span class="keywordflow">case</span> <span class="stringliteral">&#39;treeOptions&#39;</span>:
<a name="l01071"></a>01071                 <span class="keywordflow">if</span> ( ! is_array($value)) {
<a name="l01072"></a>01072                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>($name . <span class="stringliteral">&#39; should be an array.&#39;</span>);
<a name="l01073"></a>01073                 }
<a name="l01074"></a>01074                 <span class="keywordflow">break</span>;
<a name="l01075"></a>01075         }
<a name="l01076"></a>01076         $this-&gt;_options[$name] = $value;
<a name="l01077"></a>01077     }
<a name="l01078"></a>01078 
<a name="l01086"></a><a class="code" href="classDoctrine__Table.html#a98b834ff1ef11b76ba50747f2ff22607">01086</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a98b834ff1ef11b76ba50747f2ff22607" title="Returns the value of a given option.">getOption</a>($name)
<a name="l01087"></a>01087     {
<a name="l01088"></a>01088         <span class="keywordflow">if</span> (isset($this-&gt;_options[$name])) {
<a name="l01089"></a>01089             <span class="keywordflow">return</span> $this-&gt;_options[$name];
<a name="l01090"></a>01090         }
<a name="l01091"></a>01091         <span class="keywordflow">return</span> null;
<a name="l01092"></a>01092     }
<a name="l01093"></a>01093 
<a name="l01094"></a>01094 
<a name="l01102"></a><a class="code" href="classDoctrine__Table.html#a015373066137bcc6b39da90c50c43776">01102</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a015373066137bcc6b39da90c50c43776" title="Get the table orderby statement.">getOrderByStatement</a>($alias = null, $columnNames = <span class="keyword">false</span>)
<a name="l01103"></a>01103     {
<a name="l01104"></a>01104         <span class="keywordflow">if</span> (isset($this-&gt;_options[<span class="stringliteral">&#39;orderBy&#39;</span>])) {
<a name="l01105"></a>01105             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a03f30b9c96cc70cc2d883a7e2f9763cc" title="Process an order by statement to be prefixed with the passed alias and field names...">processOrderBy</a>($alias, $this-&gt;_options[<span class="stringliteral">&#39;orderBy&#39;</span>]);
<a name="l01106"></a>01106         }
<a name="l01107"></a>01107     }
<a name="l01108"></a>01108 
<a name="l01118"></a><a class="code" href="classDoctrine__Table.html#a03f30b9c96cc70cc2d883a7e2f9763cc">01118</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a03f30b9c96cc70cc2d883a7e2f9763cc" title="Process an order by statement to be prefixed with the passed alias and field names...">processOrderBy</a>($alias, $orderBy, $columnNames = <span class="keyword">false</span>)
<a name="l01119"></a>01119     {
<a name="l01120"></a>01120         <span class="keywordflow">if</span> ( ! $alias) {
<a name="l01121"></a>01121            $alias = $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>();
<a name="l01122"></a>01122         }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124         <span class="keywordflow">if</span> ( ! is_array($orderBy)) {
<a name="l01125"></a>01125             $e1 = explode(<span class="charliteral">&#39;,&#39;</span>, $orderBy);
<a name="l01126"></a>01126         } <span class="keywordflow">else</span> {
<a name="l01127"></a>01127             $e1 = $orderBy;
<a name="l01128"></a>01128         }
<a name="l01129"></a>01129         $e1 = array_map(<span class="stringliteral">&#39;trim&#39;</span>, $e1);
<a name="l01130"></a>01130         <span class="keywordflow">foreach</span> ($e1 as $k =&gt; $v) {
<a name="l01131"></a>01131             $e2 = explode(<span class="charliteral">&#39; &#39;</span>, $v);
<a name="l01132"></a>01132             <span class="keywordflow">if</span> ($columnNames) {
<a name="l01133"></a>01133                 $e2[0] = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($e2[0]);
<a name="l01134"></a>01134             }
<a name="l01135"></a>01135             <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#ab30b1e56e3e863cc96221ad57094e1ef" title="Finds out whether the table definition has a given field.">hasField</a>($this-&gt;<a class="code" href="classDoctrine__Table.html#adc179ffd646222b7b24b39c038c7edcb" title="Returns a column alias for a column name.">getFieldName</a>($e2[0]))) {
<a name="l01136"></a>01136                 $e1[$k] = $alias . <span class="charliteral">&#39;.&#39;</span> . $e2[0];
<a name="l01137"></a>01137             } <span class="keywordflow">else</span> {
<a name="l01138"></a>01138                 $e1[$k] = $e2[0];
<a name="l01139"></a>01139             }
<a name="l01140"></a>01140             <span class="keywordflow">if</span> (isset($e2[1])) {
<a name="l01141"></a>01141                 $e1[$k] .=  <span class="charliteral">&#39; &#39;</span> . $e2[1];
<a name="l01142"></a>01142             }
<a name="l01143"></a>01143         }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145         <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>, $e1);
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147 
<a name="l01157"></a><a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23">01157</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName)
<a name="l01158"></a>01158     {
<a name="l01159"></a>01159         <span class="comment">// FIX ME: This is being used in places where an array is passed, but it should not be an array</span>
<a name="l01160"></a>01160         <span class="comment">// For example in places where Doctrine should support composite foreign/primary keys</span>
<a name="l01161"></a>01161         $fieldName = is_array($fieldName) ? $fieldName[0]:$fieldName;
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         <span class="keywordflow">if</span> (isset($this-&gt;_columnNames[$fieldName])) {
<a name="l01164"></a>01164             <span class="keywordflow">return</span> $this-&gt;_columnNames[$fieldName];
<a name="l01165"></a>01165         }
<a name="l01166"></a>01166 
<a name="l01167"></a>01167         <span class="keywordflow">return</span> strtolower($fieldName);
<a name="l01168"></a>01168     }
<a name="l01169"></a>01169 
<a name="l01176"></a><a class="code" href="classDoctrine__Table.html#a547ebe74ed9a4e0dc6cf3e051f4c9ba7">01176</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a547ebe74ed9a4e0dc6cf3e051f4c9ba7" title="Retrieves a column definition from this table schema.">getColumnDefinition</a>($columnName)
<a name="l01177"></a>01177     {
<a name="l01178"></a>01178         <span class="keywordflow">if</span> ( ! isset($this-&gt;_columns[$columnName])) {
<a name="l01179"></a>01179             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01180"></a>01180         }
<a name="l01181"></a>01181         <span class="keywordflow">return</span> $this-&gt;_columns[$columnName];
<a name="l01182"></a>01182     }
<a name="l01183"></a>01183 
<a name="l01192"></a><a class="code" href="classDoctrine__Table.html#adc179ffd646222b7b24b39c038c7edcb">01192</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#adc179ffd646222b7b24b39c038c7edcb" title="Returns a column alias for a column name.">getFieldName</a>($columnName)
<a name="l01193"></a>01193     {
<a name="l01194"></a>01194         <span class="keywordflow">if</span> (isset($this-&gt;_fieldNames[$columnName])) {
<a name="l01195"></a>01195             <span class="keywordflow">return</span> $this-&gt;_fieldNames[$columnName];
<a name="l01196"></a>01196         }
<a name="l01197"></a>01197         <span class="keywordflow">return</span> $columnName;
<a name="l01198"></a>01198     }
<a name="l01199"></a>01199 
<a name="l01218"></a><a class="code" href="classDoctrine__Table.html#ac6646166369caf8b23ae5ee871991bd4">01218</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ac6646166369caf8b23ae5ee871991bd4" title="Customize the array of options for a column or multiple columns.">setColumnOptions</a>($columnName, array $options)
<a name="l01219"></a>01219     {
<a name="l01220"></a>01220         <span class="keywordflow">if</span> (is_array($columnName)) {
<a name="l01221"></a>01221             <span class="keywordflow">foreach</span> ($columnName as $name) {
<a name="l01222"></a>01222                 $this-&gt;<a class="code" href="classDoctrine__Table.html#ac6646166369caf8b23ae5ee871991bd4" title="Customize the array of options for a column or multiple columns.">setColumnOptions</a>($name, $options);
<a name="l01223"></a>01223             }
<a name="l01224"></a>01224         } <span class="keywordflow">else</span> {
<a name="l01225"></a>01225             <span class="keywordflow">foreach</span> ($options as $option =&gt; $value) {
<a name="l01226"></a>01226                 $this-&gt;<a class="code" href="classDoctrine__Table.html#a9e1c9ec69933b099bd0856ff882b9ee4" title="Set an individual column option.">setColumnOption</a>($columnName, $option, $value);
<a name="l01227"></a>01227             }
<a name="l01228"></a>01228         }
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230 
<a name="l01239"></a><a class="code" href="classDoctrine__Table.html#a9e1c9ec69933b099bd0856ff882b9ee4">01239</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a9e1c9ec69933b099bd0856ff882b9ee4" title="Set an individual column option.">setColumnOption</a>($columnName, $option, $value)
<a name="l01240"></a>01240     {
<a name="l01241"></a>01241         <span class="keywordflow">if</span> ($option == <span class="stringliteral">&#39;primary&#39;</span>) {
<a name="l01242"></a>01242             <span class="keywordflow">if</span> (isset($this-&gt;_identifier)) {
<a name="l01243"></a>01243                 $this-&gt;_identifier = (array) $this-&gt;_identifier;
<a name="l01244"></a>01244             }
<a name="l01245"></a>01245 
<a name="l01246"></a>01246             <span class="keywordflow">if</span> ($value &amp;&amp;  ! in_array($columnName, $this-&gt;_identifier)) {
<a name="l01247"></a>01247                 $this-&gt;_identifier[] = $columnName;
<a name="l01248"></a>01248             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!$value &amp;&amp; in_array($columnName, $this-&gt;_identifier)) {
<a name="l01249"></a>01249                 $key = array_search($columnName, $this-&gt;_identifier);
<a name="l01250"></a>01250                 unset($this-&gt;_identifier[$key]);
<a name="l01251"></a>01251             }
<a name="l01252"></a>01252         }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254         $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($columnName);
<a name="l01255"></a>01255         $this-&gt;_columns[$columnName][$option] = $value;
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257 
<a name="l01264"></a><a class="code" href="classDoctrine__Table.html#a11516e29eeacd84623310f5d67ce1733">01264</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a11516e29eeacd84623310f5d67ce1733" title="Set multiple column definitions at once.">setColumns</a>(array $definitions)
<a name="l01265"></a>01265     {
<a name="l01266"></a>01266         <span class="keywordflow">foreach</span> ($definitions as $name =&gt; $options) {
<a name="l01267"></a>01267             $this-&gt;<a class="code" href="classDoctrine__Table.html#aa316ff09c71edae73ef5e3b10df310b2" title="Adds a column to the schema.">setColumn</a>($name, $options[<span class="stringliteral">&#39;type&#39;</span>], $options[<span class="stringliteral">&#39;length&#39;</span>], $options);
<a name="l01268"></a>01268         }
<a name="l01269"></a>01269     }
<a name="l01270"></a>01270 
<a name="l01286"></a><a class="code" href="classDoctrine__Table.html#aa316ff09c71edae73ef5e3b10df310b2">01286</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aa316ff09c71edae73ef5e3b10df310b2" title="Adds a column to the schema.">setColumn</a>($name, $type = null, $length = null, $options = array(), $prepend = <span class="keyword">false</span>)
<a name="l01287"></a>01287     {
<a name="l01288"></a>01288         <span class="keywordflow">if</span> (is_string($options)) {
<a name="l01289"></a>01289             $options = explode(<span class="charliteral">&#39;|&#39;</span>, $options);
<a name="l01290"></a>01290         }
<a name="l01291"></a>01291 
<a name="l01292"></a>01292         <span class="keywordflow">foreach</span> ($options as $k =&gt; $option) {
<a name="l01293"></a>01293             <span class="keywordflow">if</span> (is_numeric($k)) {
<a name="l01294"></a>01294                 <span class="keywordflow">if</span> ( ! empty($option)) {
<a name="l01295"></a>01295                     $options[$option] = <span class="keyword">true</span>;
<a name="l01296"></a>01296                 }
<a name="l01297"></a>01297                 unset($options[$k]);
<a name="l01298"></a>01298             }
<a name="l01299"></a>01299         }
<a name="l01300"></a>01300 
<a name="l01301"></a>01301         <span class="comment">// extract column name &amp; field name</span>
<a name="l01302"></a>01302         <span class="keywordflow">if</span> (stripos($name, <span class="stringliteral">&#39; as &#39;</span>))
<a name="l01303"></a>01303         {
<a name="l01304"></a>01304             <span class="keywordflow">if</span> (strpos($name, <span class="stringliteral">&#39; as &#39;</span>)) {
<a name="l01305"></a>01305                 $parts = explode(<span class="stringliteral">&#39; as &#39;</span>, $name);
<a name="l01306"></a>01306             } <span class="keywordflow">else</span> {
<a name="l01307"></a>01307                 $parts = explode(<span class="stringliteral">&#39; AS &#39;</span>, $name);
<a name="l01308"></a>01308             }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310             <span class="keywordflow">if</span> (<a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>($parts) &gt; 1) {
<a name="l01311"></a>01311                 $fieldName = $parts[1];
<a name="l01312"></a>01312             } <span class="keywordflow">else</span> {
<a name="l01313"></a>01313                 $fieldName = $parts[0];
<a name="l01314"></a>01314             }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316             $name = strtolower($parts[0]);
<a name="l01317"></a>01317         } <span class="keywordflow">else</span> {
<a name="l01318"></a>01318             $fieldName = $name;
<a name="l01319"></a>01319             $name = strtolower($name);
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322         $name = trim($name);
<a name="l01323"></a>01323         $fieldName = trim($fieldName);
<a name="l01324"></a>01324 
<a name="l01325"></a>01325         <span class="keywordflow">if</span> ($prepend) {
<a name="l01326"></a>01326             $this-&gt;_columnNames = array_merge(array($fieldName =&gt; $name), $this-&gt;_columnNames);
<a name="l01327"></a>01327             $this-&gt;_fieldNames = array_merge(array($name =&gt; $fieldName), $this-&gt;_fieldNames);
<a name="l01328"></a>01328         } <span class="keywordflow">else</span> {
<a name="l01329"></a>01329             $this-&gt;_columnNames[$fieldName] = $name;
<a name="l01330"></a>01330             $this-&gt;_fieldNames[$name] = $fieldName;
<a name="l01331"></a>01331         }
<a name="l01332"></a>01332 
<a name="l01333"></a>01333         $defaultOptions = $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_DEFAULT_COLUMN_OPTIONS);
<a name="l01334"></a>01334 
<a name="l01335"></a>01335         <span class="keywordflow">if</span> (isset($defaultOptions[<span class="stringliteral">&#39;length&#39;</span>]) &amp;&amp; $defaultOptions[<span class="stringliteral">&#39;length&#39;</span>] &amp;&amp; $length == null) {
<a name="l01336"></a>01336             $length = $defaultOptions[<span class="stringliteral">&#39;length&#39;</span>];
<a name="l01337"></a>01337         }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339         <span class="keywordflow">if</span> ($length == null) {
<a name="l01340"></a>01340             <span class="keywordflow">switch</span> ($type) {
<a name="l01341"></a>01341                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;integer&#39;</span>:
<a name="l01342"></a>01342                     $length = 8;
<a name="l01343"></a>01343                 <span class="keywordflow">break</span>;
<a name="l01344"></a>01344                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;decimal&#39;</span>:
<a name="l01345"></a>01345                     $length = 18;
<a name="l01346"></a>01346                 <span class="keywordflow">break</span>;
<a name="l01347"></a>01347                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;string&#39;</span>:
<a name="l01348"></a>01348                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;clob&#39;</span>:
<a name="l01349"></a>01349                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;float&#39;</span>:
<a name="l01350"></a>01350                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;integer&#39;</span>:
<a name="l01351"></a>01351                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;array&#39;</span>:
<a name="l01352"></a>01352                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;object&#39;</span>:
<a name="l01353"></a>01353                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;blob&#39;</span>:
<a name="l01354"></a>01354                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;gzip&#39;</span>:
<a name="l01355"></a>01355                     <span class="comment">//$length = 2147483647;</span>
<a name="l01356"></a>01356 
<a name="l01357"></a>01357                     <span class="comment">//All the DataDict driver classes have work-arounds to deal</span>
<a name="l01358"></a>01358                     <span class="comment">//with unset lengths.</span>
<a name="l01359"></a>01359                     $length = null;
<a name="l01360"></a>01360                 <span class="keywordflow">break</span>;
<a name="l01361"></a>01361                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;boolean&#39;</span>:
<a name="l01362"></a>01362                     $length = 1;
<a name="l01363"></a>01363                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;date&#39;</span>:
<a name="l01364"></a>01364                     <span class="comment">// YYYY-MM-DD ISO 8601</span>
<a name="l01365"></a>01365                     $length = 10;
<a name="l01366"></a>01366                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;time&#39;</span>:
<a name="l01367"></a>01367                     <span class="comment">// HH:NN:SS+00:00 ISO 8601</span>
<a name="l01368"></a>01368                     $length = 14;
<a name="l01369"></a>01369                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;timestamp&#39;</span>:
<a name="l01370"></a>01370                     <span class="comment">// YYYY-MM-DDTHH:MM:SS+00:00 ISO 8601</span>
<a name="l01371"></a>01371                     $length = 25;
<a name="l01372"></a>01372             }
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374 
<a name="l01375"></a>01375         $options[<span class="stringliteral">&#39;type&#39;</span>] = $type;
<a name="l01376"></a>01376         $options[<span class="stringliteral">&#39;length&#39;</span>] = $length;
<a name="l01377"></a>01377         
<a name="l01378"></a>01378         <span class="keywordflow">if</span> (strtolower($fieldName) != $name) {
<a name="l01379"></a>01379             $options[<span class="stringliteral">&#39;alias&#39;</span>] = $fieldName;
<a name="l01380"></a>01380         }
<a name="l01381"></a>01381 
<a name="l01382"></a>01382         <span class="keywordflow">foreach</span> ($defaultOptions as $key =&gt; $value) {
<a name="l01383"></a>01383             <span class="keywordflow">if</span> ( ! array_key_exists($key, $options) || is_null($options[$key])) {
<a name="l01384"></a>01384                 $options[$key] = $value;
<a name="l01385"></a>01385             }
<a name="l01386"></a>01386         }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388         <span class="keywordflow">if</span> ($prepend) {
<a name="l01389"></a>01389             $this-&gt;_columns = array_merge(array($name =&gt; $options), $this-&gt;_columns);
<a name="l01390"></a>01390         } <span class="keywordflow">else</span> {
<a name="l01391"></a>01391             $this-&gt;_columns[$name] = $options;
<a name="l01392"></a>01392         }
<a name="l01393"></a>01393 
<a name="l01394"></a>01394         <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;primary&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;primary&#39;</span>]) {
<a name="l01395"></a>01395             <span class="keywordflow">if</span> (isset($this-&gt;_identifier)) {
<a name="l01396"></a>01396                 $this-&gt;_identifier = (array) $this-&gt;_identifier;
<a name="l01397"></a>01397             }
<a name="l01398"></a>01398             <span class="keywordflow">if</span> ( ! in_array($fieldName, $this-&gt;_identifier)) {
<a name="l01399"></a>01399                 $this-&gt;_identifier[] = $fieldName;
<a name="l01400"></a>01400             }
<a name="l01401"></a>01401         }
<a name="l01402"></a>01402         <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;default&#39;</span>])) {
<a name="l01403"></a>01403             $this-&gt;<a class="code" href="classDoctrine__Table.html#aa04e32db0103c1c4706be92efc270364" title="Finds out whether this table has default values for columns.">hasDefaultValues</a> = <span class="keyword">true</span>;
<a name="l01404"></a>01404         }
<a name="l01405"></a>01405     }
<a name="l01406"></a>01406 
<a name="l01412"></a><a class="code" href="classDoctrine__Table.html#aa04e32db0103c1c4706be92efc270364">01412</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aa04e32db0103c1c4706be92efc270364" title="Finds out whether this table has default values for columns.">hasDefaultValues</a>()
<a name="l01413"></a>01413     {
<a name="l01414"></a>01414         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#aa04e32db0103c1c4706be92efc270364" title="Finds out whether this table has default values for columns.">hasDefaultValues</a>;
<a name="l01415"></a>01415     }
<a name="l01416"></a>01416 
<a name="l01423"></a><a class="code" href="classDoctrine__Table.html#ad009cc3ce185ed342d0b3ff86d599e7b">01423</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ad009cc3ce185ed342d0b3ff86d599e7b" title="Retrieves the default value (if any) for a given column.">getDefaultValueOf</a>($fieldName)
<a name="l01424"></a>01424     {
<a name="l01425"></a>01425         $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName);
<a name="l01426"></a>01426         <span class="keywordflow">if</span> ( ! isset($this-&gt;_columns[$columnName])) {
<a name="l01427"></a>01427             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&quot;Couldn&#39;t get default value. Column &quot;</span>.$columnName.<span class="stringliteral">&quot; doesn&#39;t exist.&quot;</span>);
<a name="l01428"></a>01428         }
<a name="l01429"></a>01429         <span class="keywordflow">if</span> (isset($this-&gt;_columns[$columnName][<span class="stringliteral">&#39;default&#39;</span>])) {
<a name="l01430"></a>01430             <span class="keywordflow">return</span> $this-&gt;_columns[$columnName][<span class="stringliteral">&#39;default&#39;</span>];
<a name="l01431"></a>01431         } <span class="keywordflow">else</span> {
<a name="l01432"></a>01432             <span class="keywordflow">return</span> null;
<a name="l01433"></a>01433         }
<a name="l01434"></a>01434     }
<a name="l01435"></a>01435 
<a name="l01440"></a><a class="code" href="classDoctrine__Table.html#a237c5d8e62bd6f88f72fa94c88999a5a">01440</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a237c5d8e62bd6f88f72fa94c88999a5a" title="Returns the definition of the identifier key.">getIdentifier</a>()
<a name="l01441"></a>01441     {
<a name="l01442"></a>01442         <span class="keywordflow">return</span> $this-&gt;_identifier;
<a name="l01443"></a>01443     }
<a name="l01444"></a>01444 
<a name="l01452"></a><a class="code" href="classDoctrine__Table.html#a521c7457c7df1b70d8223922df1d6afd">01452</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a521c7457c7df1b70d8223922df1d6afd" title="Retrieves the type of primary key.">getIdentifierType</a>()
<a name="l01453"></a>01453     {
<a name="l01454"></a>01454         <span class="keywordflow">return</span> $this-&gt;_identifierType;
<a name="l01455"></a>01455     }
<a name="l01456"></a>01456 
<a name="l01462"></a><a class="code" href="classDoctrine__Table.html#a4af3b17b0687e6733fef86f50d6c35e9">01462</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a4af3b17b0687e6733fef86f50d6c35e9" title="Finds out whether the table definition contains a given column.">hasColumn</a>($columnName)
<a name="l01463"></a>01463     {
<a name="l01464"></a>01464         <span class="keywordflow">return</span> isset($this-&gt;_columns[strtolower($columnName)]);
<a name="l01465"></a>01465     }
<a name="l01466"></a>01466 
<a name="l01475"></a><a class="code" href="classDoctrine__Table.html#ab30b1e56e3e863cc96221ad57094e1ef">01475</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ab30b1e56e3e863cc96221ad57094e1ef" title="Finds out whether the table definition has a given field.">hasField</a>($fieldName)
<a name="l01476"></a>01476     {
<a name="l01477"></a>01477         <span class="keywordflow">return</span> isset($this-&gt;_columnNames[$fieldName]);
<a name="l01478"></a>01478     }
<a name="l01479"></a>01479 
<a name="l01489"></a><a class="code" href="classDoctrine__Table.html#a47bf3bf046ab399acc59e27ba12e582d">01489</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a47bf3bf046ab399acc59e27ba12e582d" title="Sets the default connection for this table.">setConnection</a>(<a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $conn)
<a name="l01490"></a>01490     {
<a name="l01491"></a>01491         $this-&gt;_conn = $conn;
<a name="l01492"></a>01492 
<a name="l01493"></a>01493         $this-&gt;<a class="code" href="classDoctrine__Configurable.html#a0efe50bf2b19bced9a54e2804c07dcc7" title="sets a parent for this configurable component the parent must be configurable component...">setParent</a>($this-&gt;_conn);
<a name="l01494"></a>01494 
<a name="l01495"></a>01495         <span class="keywordflow">return</span> $this;
<a name="l01496"></a>01496     }
<a name="l01497"></a>01497 
<a name="l01503"></a><a class="code" href="classDoctrine__Table.html#a312ec34fe98f7041b583535e6f34c941">01503</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a312ec34fe98f7041b583535e6f34c941" title="Returns the connection associated with this table (if any).">getConnection</a>()
<a name="l01504"></a>01504     {
<a name="l01505"></a>01505         <span class="keywordflow">return</span> $this-&gt;_conn;
<a name="l01506"></a>01506     }
<a name="l01507"></a>01507 
<a name="l01522"></a><a class="code" href="classDoctrine__Table.html#a79a249541e1a69d6d9cb9328d6fc6d4f">01522</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a79a249541e1a69d6d9cb9328d6fc6d4f" title="Creates a new record.">create</a>(array $array = array())
<a name="l01523"></a>01523     {
<a name="l01524"></a>01524         $record = <span class="keyword">new</span> $this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>]($this, <span class="keyword">true</span>);
<a name="l01525"></a>01525         $record-&gt;fromArray($array);
<a name="l01526"></a>01526 
<a name="l01527"></a>01527         <span class="keywordflow">return</span> $record;
<a name="l01528"></a>01528     }
<a name="l01529"></a>01529 
<a name="l01539"></a><a class="code" href="classDoctrine__Table.html#a304054dd5220a595b2050bf562e7dc2e">01539</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a304054dd5220a595b2050bf562e7dc2e" title="Adds a named query in the query registry.">addNamedQuery</a>($queryKey, $query)
<a name="l01540"></a>01540     {
<a name="l01541"></a>01541         $registry = <a class="code" href="classDoctrine__Manager.html#a0f1f11c9be78468eed7768f4130aac2e" title="Returns an instance of this class (this class uses the singleton pattern).">Doctrine_Manager::getInstance</a>()-&gt;getQueryRegistry();
<a name="l01542"></a>01542         $registry-&gt;add($this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>() . <span class="charliteral">&#39;/&#39;</span> . $queryKey, $query);
<a name="l01543"></a>01543     }
<a name="l01544"></a>01544 
<a name="l01554"></a><a class="code" href="classDoctrine__Table.html#a8557715679fc805dbe1292d28c9ab05f">01554</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a8557715679fc805dbe1292d28c9ab05f" title="Creates a named query from one in the query registry.">createNamedQuery</a>($queryKey)
<a name="l01555"></a>01555     {
<a name="l01556"></a>01556         $queryRegistry = <a class="code" href="classDoctrine__Manager.html#a0f1f11c9be78468eed7768f4130aac2e" title="Returns an instance of this class (this class uses the singleton pattern).">Doctrine_Manager::getInstance</a>()-&gt;getQueryRegistry();
<a name="l01557"></a>01557 
<a name="l01558"></a>01558         <span class="keywordflow">if</span> (strpos($queryKey, <span class="charliteral">&#39;/&#39;</span>) !== <span class="keyword">false</span>) {
<a name="l01559"></a>01559             $e = explode(<span class="charliteral">&#39;/&#39;</span>, $queryKey);
<a name="l01560"></a>01560 
<a name="l01561"></a>01561             <span class="keywordflow">return</span> $queryRegistry-&gt;get($e[1], $e[0]);
<a name="l01562"></a>01562         }
<a name="l01563"></a>01563 
<a name="l01564"></a>01564         <span class="keywordflow">return</span> $queryRegistry-&gt;get($queryKey, $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>());
<a name="l01565"></a>01565     }
<a name="l01566"></a>01566 
<a name="l01584"></a><a class="code" href="classDoctrine__Table.html#a8baca493e291574916a9f953df852ea6">01584</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a8baca493e291574916a9f953df852ea6" title="Finds a record by its identifier.">find</a>()
<a name="l01585"></a>01585     {
<a name="l01586"></a>01586         $num_args = func_num_args();
<a name="l01587"></a>01587 
<a name="l01588"></a>01588         <span class="comment">// Named Query or IDs</span>
<a name="l01589"></a>01589         $name = func_get_arg(0);
<a name="l01590"></a>01590 
<a name="l01591"></a>01591         <span class="keywordflow">if</span> (is_null($name)) {
<a name="l01592"></a>01592             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01593"></a>01593         }
<a name="l01594"></a>01594 
<a name="l01595"></a>01595         $ns = $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>();
<a name="l01596"></a>01596         $m = $name;
<a name="l01597"></a>01597 
<a name="l01598"></a>01598         <span class="comment">// Check for possible cross-access</span>
<a name="l01599"></a>01599         <span class="keywordflow">if</span> ( ! is_array($name) &amp;&amp; strpos($name, <span class="charliteral">&#39;/&#39;</span>) !== <span class="keyword">false</span>) {
<a name="l01600"></a>01600             list($ns, $m) = explode(<span class="charliteral">&#39;/&#39;</span>, $name);
<a name="l01601"></a>01601         }
<a name="l01602"></a>01602 
<a name="l01603"></a>01603         <span class="comment">// Define query to be used</span>
<a name="l01604"></a>01604         <span class="keywordflow">if</span> (
<a name="l01605"></a>01605             ! is_array($name) &amp;&amp;
<a name="l01606"></a>01606             <a class="code" href="classDoctrine__Manager.html#a0f1f11c9be78468eed7768f4130aac2e" title="Returns an instance of this class (this class uses the singleton pattern).">Doctrine_Manager::getInstance</a>()-&gt;getQueryRegistry()-&gt;has($m, $ns)
<a name="l01607"></a>01607         ) {
<a name="l01608"></a>01608             <span class="comment">// We&#39;re dealing with a named query</span>
<a name="l01609"></a>01609             $q = $this-&gt;<a class="code" href="classDoctrine__Table.html#a8557715679fc805dbe1292d28c9ab05f" title="Creates a named query from one in the query registry.">createNamedQuery</a>($name);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611             <span class="comment">// Parameters construction</span>
<a name="l01612"></a>01612             $params = ($num_args &gt;= 2) ? func_get_arg(1) : array();
<a name="l01613"></a>01613 
<a name="l01614"></a>01614             <span class="comment">// Hydration mode</span>
<a name="l01615"></a>01615             $hydrationMode = ($num_args == 3) ? func_get_arg(2) : null;
<a name="l01616"></a>01616 
<a name="l01617"></a>01617             <span class="comment">// Executing query</span>
<a name="l01618"></a>01618             $res = $q-&gt;execute($params, $hydrationMode);
<a name="l01619"></a>01619         } <span class="keywordflow">else</span> {
<a name="l01620"></a>01620             <span class="comment">// We&#39;re passing a single ID or an array of IDs</span>
<a name="l01621"></a>01621             $q = $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>(<span class="stringliteral">&#39;dctrn_find&#39;</span>)
<a name="l01622"></a>01622                 -&gt;where(<span class="stringliteral">&#39;dctrn_find.&#39;</span> . implode(<span class="stringliteral">&#39; = ? AND dctrn_find.&#39;</span>, (array) $this-&gt;<a class="code" href="classDoctrine__Table.html#a237c5d8e62bd6f88f72fa94c88999a5a" title="Returns the definition of the identifier key.">getIdentifier</a>()) . <span class="stringliteral">&#39; = ?&#39;</span>)
<a name="l01623"></a>01623                 -&gt;limit(1);
<a name="l01624"></a>01624 
<a name="l01625"></a>01625             <span class="comment">// Parameters construction</span>
<a name="l01626"></a>01626             $params = is_array($name) ? array_values($name) : array($name);
<a name="l01627"></a>01627 
<a name="l01628"></a>01628             <span class="comment">// Hydration mode</span>
<a name="l01629"></a>01629             $hydrationMode = ($num_args == 2) ? func_get_arg(1) : null;
<a name="l01630"></a>01630 
<a name="l01631"></a>01631             <span class="comment">// Executing query</span>
<a name="l01632"></a>01632             $res = $q-&gt;fetchOne($params, $hydrationMode);
<a name="l01633"></a>01633         }
<a name="l01634"></a>01634 
<a name="l01635"></a>01635         $q-&gt;free();
<a name="l01636"></a>01636 
<a name="l01637"></a>01637         <span class="keywordflow">return</span> $res;
<a name="l01638"></a>01638     }
<a name="l01639"></a>01639 
<a name="l01646"></a><a class="code" href="classDoctrine__Table.html#a31fbffe0aae49d1458d1b52262f48bc8">01646</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a31fbffe0aae49d1458d1b52262f48bc8" title="Retrieves all the records stored in this table.">findAll</a>($hydrationMode = null)
<a name="l01647"></a>01647     {
<a name="l01648"></a>01648         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>(<span class="stringliteral">&#39;dctrn_find&#39;</span>)
<a name="l01649"></a>01649             -&gt;execute(array(), $hydrationMode);
<a name="l01650"></a>01650     }
<a name="l01651"></a>01651 
<a name="l01663"></a><a class="code" href="classDoctrine__Table.html#aaf310fbce8f24a1fff315e8b4056d385">01663</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aaf310fbce8f24a1fff315e8b4056d385" title="Finds records in this table with a given SQL where clause.">findBySql</a>($dql, $params = array(), $hydrationMode = null)
<a name="l01664"></a>01664     {
<a name="l01665"></a>01665         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>(<span class="stringliteral">&#39;dctrn_find&#39;</span>)
<a name="l01666"></a>01666             -&gt;where($dql)-&gt;execute($params, $hydrationMode);
<a name="l01667"></a>01667     }
<a name="l01668"></a>01668 
<a name="l01677"></a><a class="code" href="classDoctrine__Table.html#aed78e310eeda42157cfc01af7ba6ee59">01677</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aed78e310eeda42157cfc01af7ba6ee59" title="Finds records in this table with a given DQL where clause.">findByDql</a>($dql, $params = array(), $hydrationMode = null)
<a name="l01678"></a>01678     {
<a name="l01679"></a>01679         $parser = $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>();
<a name="l01680"></a>01680         $query = <span class="stringliteral">&#39;FROM &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>() . <span class="stringliteral">&#39; dctrn_find WHERE &#39;</span> . $dql;
<a name="l01681"></a>01681 
<a name="l01682"></a>01682         <span class="keywordflow">return</span> $parser-&gt;query($query, $params, $hydrationMode);
<a name="l01683"></a>01683     }
<a name="l01684"></a>01684 
<a name="l01693"></a><a class="code" href="classDoctrine__Table.html#ae31c39e2359db4e48eca85751137b49d">01693</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ae31c39e2359db4e48eca85751137b49d" title="Find records basing on a field.">findBy</a>($fieldName, $value, $hydrationMode = null)
<a name="l01694"></a>01694     {
<a name="l01695"></a>01695         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>(<span class="stringliteral">&#39;dctrn_find&#39;</span>)
<a name="l01696"></a>01696             -&gt;where($this-&gt;buildFindByWhere($fieldName), (array) $value)
<a name="l01697"></a>01697             -&gt;execute(array(), $hydrationMode);
<a name="l01698"></a>01698     }
<a name="l01699"></a>01699 
<a name="l01708"></a><a class="code" href="classDoctrine__Table.html#a343fc93e9a2892f05a873edbf28a6912">01708</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a343fc93e9a2892f05a873edbf28a6912" title="Finds the first record that satisfy the clause.">findOneBy</a>($fieldName, $value, $hydrationMode = null)
<a name="l01709"></a>01709     {
<a name="l01710"></a>01710         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>(<span class="stringliteral">&#39;dctrn_find&#39;</span>)
<a name="l01711"></a>01711             -&gt;where($this-&gt;buildFindByWhere($fieldName), (array) $value)
<a name="l01712"></a>01712             -&gt;limit(1)
<a name="l01713"></a>01713             -&gt;fetchOne(array(), $hydrationMode);
<a name="l01714"></a>01714     }
<a name="l01715"></a>01715 
<a name="l01728"></a><a class="code" href="classDoctrine__Table.html#ac50fbade31f0159b08aad806630745d9">01728</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ac50fbade31f0159b08aad806630745d9" title="Finds result of a named query.">execute</a>($queryKey, $params = array(), $hydrationMode = <a class="code" href="classDoctrine__Core.html#a56801dd8a24bb6f44afc2ba1dd0a0ba1" title="HYDRATION CONSTANTS.">Doctrine_Core::HYDRATE_RECORD</a>)
<a name="l01729"></a>01729     {
<a name="l01730"></a>01730         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a8557715679fc805dbe1292d28c9ab05f" title="Creates a named query from one in the query registry.">createNamedQuery</a>($queryKey)-&gt;execute($params, $hydrationMode);
<a name="l01731"></a>01731     }
<a name="l01732"></a>01732 
<a name="l01745"></a><a class="code" href="classDoctrine__Table.html#af7dd9a5678ee6b38631b53f0bf96f42b">01745</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#af7dd9a5678ee6b38631b53f0bf96f42b" title="Fetches one record with a named query.">executeOne</a>($queryKey, $params = array(), $hydrationMode = <a class="code" href="classDoctrine__Core.html#a56801dd8a24bb6f44afc2ba1dd0a0ba1" title="HYDRATION CONSTANTS.">Doctrine_Core::HYDRATE_RECORD</a>)
<a name="l01746"></a>01746     {
<a name="l01747"></a>01747         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a8557715679fc805dbe1292d28c9ab05f" title="Creates a named query from one in the query registry.">createNamedQuery</a>($queryKey)-&gt;fetchOne($params, $hydrationMode);
<a name="l01748"></a>01748     }
<a name="l01749"></a>01749 
<a name="l01758"></a><a class="code" href="classDoctrine__Table.html#a5ed294225a11f8940e80dfec3d8d16ca">01758</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a5ed294225a11f8940e80dfec3d8d16ca" title="Clears the first level cache (identityMap).">clear</a>()
<a name="l01759"></a>01759     {
<a name="l01760"></a>01760         $this-&gt;_identityMap = array();
<a name="l01761"></a>01761     }
<a name="l01762"></a>01762 
<a name="l01773"></a><a class="code" href="classDoctrine__Table.html#a280831d1e87027e00ecc08e0812ea1a3">01773</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a280831d1e87027e00ecc08e0812ea1a3" title="Adds a record to the first level cache (identity map).">addRecord</a>(<a class="code" href="classDoctrine__Record.html">Doctrine_Record</a> $record)
<a name="l01774"></a>01774     {
<a name="l01775"></a>01775         $id = implode(<span class="charliteral">&#39; &#39;</span>, $record-&gt;<a class="code" href="classDoctrine__Record.html#a1b8c616718db1bc876e18b2fe4fea335" title="returns the primary keys of this object">identifier</a>());
<a name="l01776"></a>01776 
<a name="l01777"></a>01777         <span class="keywordflow">if</span> (isset($this-&gt;_identityMap[$id])) {
<a name="l01778"></a>01778             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01779"></a>01779         }
<a name="l01780"></a>01780 
<a name="l01781"></a>01781         $this-&gt;_identityMap[$id] = $record;
<a name="l01782"></a>01782 
<a name="l01783"></a>01783         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01784"></a>01784     }
<a name="l01785"></a>01785 
<a name="l01796"></a><a class="code" href="classDoctrine__Table.html#a2ff13d83e1d7790f5ddfcf927e8e74b9">01796</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a2ff13d83e1d7790f5ddfcf927e8e74b9" title="Removes a record from the identity map.">removeRecord</a>(<a class="code" href="classDoctrine__Record.html">Doctrine_Record</a> $record)
<a name="l01797"></a>01797     {
<a name="l01798"></a>01798         $id = implode(<span class="charliteral">&#39; &#39;</span>, $record-&gt;<a class="code" href="classDoctrine__Record.html#a1b8c616718db1bc876e18b2fe4fea335" title="returns the primary keys of this object">identifier</a>());
<a name="l01799"></a>01799 
<a name="l01800"></a>01800         <span class="keywordflow">if</span> (isset($this-&gt;_identityMap[$id])) {
<a name="l01801"></a>01801             unset($this-&gt;_identityMap[$id]);
<a name="l01802"></a>01802             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01803"></a>01803         }
<a name="l01804"></a>01804 
<a name="l01805"></a>01805         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01806"></a>01806     }
<a name="l01807"></a>01807 
<a name="l01816"></a><a class="code" href="classDoctrine__Table.html#a12eeb103abc3969ed37ce91fffcc39cb">01816</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a12eeb103abc3969ed37ce91fffcc39cb" title="Returns a new record.">getRecord</a>()
<a name="l01817"></a>01817     {
<a name="l01818"></a>01818         <span class="keywordflow">if</span> ( ! empty($this-&gt;_data)) {
<a name="l01819"></a>01819             $identifierFieldNames = $this-&gt;<a class="code" href="classDoctrine__Table.html#a237c5d8e62bd6f88f72fa94c88999a5a" title="Returns the definition of the identifier key.">getIdentifier</a>();
<a name="l01820"></a>01820 
<a name="l01821"></a>01821             <span class="keywordflow">if</span> ( ! is_array($identifierFieldNames)) {
<a name="l01822"></a>01822                 $identifierFieldNames = array($identifierFieldNames);
<a name="l01823"></a>01823             }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825             $found = <span class="keyword">false</span>;
<a name="l01826"></a>01826             <span class="keywordflow">foreach</span> ($identifierFieldNames as $fieldName) {
<a name="l01827"></a>01827                 <span class="keywordflow">if</span> ( ! isset($this-&gt;_data[$fieldName])) {
<a name="l01828"></a>01828                     <span class="comment">// primary key column not found return new record</span>
<a name="l01829"></a>01829                     $found = <span class="keyword">true</span>;
<a name="l01830"></a>01830                     <span class="keywordflow">break</span>;
<a name="l01831"></a>01831                 }
<a name="l01832"></a>01832                 $id[] = $this-&gt;_data[$fieldName];
<a name="l01833"></a>01833             }
<a name="l01834"></a>01834 
<a name="l01835"></a>01835             <span class="keywordflow">if</span> ($found) {
<a name="l01836"></a>01836                 $recordName = $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>();
<a name="l01837"></a>01837                 $record = <span class="keyword">new</span> $recordName($this, <span class="keyword">true</span>);
<a name="l01838"></a>01838                 $this-&gt;_data = array();
<a name="l01839"></a>01839                 <span class="keywordflow">return</span> $record;
<a name="l01840"></a>01840             }
<a name="l01841"></a>01841 
<a name="l01842"></a>01842             $id = implode(<span class="charliteral">&#39; &#39;</span>, $id);
<a name="l01843"></a>01843 
<a name="l01844"></a>01844             <span class="keywordflow">if</span> (isset($this-&gt;_identityMap[$id])) {
<a name="l01845"></a>01845                 $record = $this-&gt;_identityMap[$id];
<a name="l01846"></a>01846                 <span class="keywordflow">if</span> ($record-&gt;getTable()-&gt;getAttribute(Doctrine_Core::ATTR_HYDRATE_OVERWRITE)) {
<a name="l01847"></a>01847                     $record-&gt;hydrate($this-&gt;_data);
<a name="l01848"></a>01848                     <span class="keywordflow">if</span> ($record-&gt;state() == <a class="code" href="classDoctrine__Record.html#a93fa612c92a5f50cad13a5ebdf1cedaa" title="PROXY STATE a Doctrine_Record is in proxy state when its properties are not fully...">Doctrine_Record::STATE_PROXY</a>) {
<a name="l01849"></a>01849                         <span class="keywordflow">if</span> (!$record-&gt;isInProxyState()) {
<a name="l01850"></a>01850                             $record-&gt;state(<a class="code" href="classDoctrine__Record.html#a41d73c0221c2218272f88d4ebc7f8e71" title="CLEAN STATE a Doctrine_Record is in clean state when all of its properties are loaded...">Doctrine_Record::STATE_CLEAN</a>);
<a name="l01851"></a>01851                         }
<a name="l01852"></a>01852                     }
<a name="l01853"></a>01853                 } <span class="keywordflow">else</span> {
<a name="l01854"></a>01854                     $record-&gt;hydrate($this-&gt;_data, <span class="keyword">false</span>);
<a name="l01855"></a>01855                 }
<a name="l01856"></a>01856             } <span class="keywordflow">else</span> {
<a name="l01857"></a>01857                 $recordName = $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>();
<a name="l01858"></a>01858                 $record = <span class="keyword">new</span> $recordName($this);
<a name="l01859"></a>01859                 $this-&gt;_identityMap[$id] = $record;
<a name="l01860"></a>01860             }
<a name="l01861"></a>01861             $this-&gt;_data = array();
<a name="l01862"></a>01862         } <span class="keywordflow">else</span> {
<a name="l01863"></a>01863             $recordName = $this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>();
<a name="l01864"></a>01864             $record = <span class="keyword">new</span> $recordName($this, <span class="keyword">true</span>);
<a name="l01865"></a>01865         }
<a name="l01866"></a>01866 
<a name="l01867"></a>01867         <span class="keywordflow">return</span> $record;
<a name="l01868"></a>01868     }
<a name="l01869"></a>01869 
<a name="l01884"></a><a class="code" href="classDoctrine__Table.html#a005652e8dd6e8bea28bb896b3e9eef7e">01884</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a005652e8dd6e8bea28bb896b3e9eef7e" title="Get the classname to return.">getClassnameToReturn</a>()
<a name="l01885"></a>01885     {
<a name="l01886"></a>01886         <span class="keywordflow">if</span> ( ! isset($this-&gt;_options[<span class="stringliteral">&#39;subclasses&#39;</span>])) {
<a name="l01887"></a>01887             <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01888"></a>01888         }
<a name="l01889"></a>01889         <span class="keywordflow">foreach</span> ($this-&gt;_options[<span class="stringliteral">&#39;subclasses&#39;</span>] as $subclass) {
<a name="l01890"></a>01890             $table = $this-&gt;_conn-&gt;getTable($subclass);
<a name="l01891"></a>01891             $inheritanceMap = $table-&gt;getOption(<span class="stringliteral">&#39;inheritanceMap&#39;</span>);
<a name="l01892"></a>01892             $nomatch = <span class="keyword">false</span>;
<a name="l01893"></a>01893             <span class="keywordflow">foreach</span> ($inheritanceMap as $key =&gt; $value) {
<a name="l01894"></a>01894                 <span class="keywordflow">if</span> ( ! isset($this-&gt;_data[$key]) || $this-&gt;_data[$key] != $value) {
<a name="l01895"></a>01895                     $nomatch = <span class="keyword">true</span>;
<a name="l01896"></a>01896                     <span class="keywordflow">break</span>;
<a name="l01897"></a>01897                 }
<a name="l01898"></a>01898             }
<a name="l01899"></a>01899             <span class="keywordflow">if</span> ( ! $nomatch) {
<a name="l01900"></a>01900                 <span class="keywordflow">return</span> $table-&gt;getComponentName();
<a name="l01901"></a>01901             }
<a name="l01902"></a>01902         }
<a name="l01903"></a>01903         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01904"></a>01904     }
<a name="l01905"></a>01905 
<a name="l01911"></a><a class="code" href="classDoctrine__Table.html#aa7fde5b4575edd5821894d5c95295ca4">01911</a>     <span class="keyword">final</span> <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aa7fde5b4575edd5821894d5c95295ca4">getProxy</a>($id = null)
<a name="l01912"></a>01912     {
<a name="l01913"></a>01913         <span class="keywordflow">if</span> ($id !== null) {
<a name="l01914"></a>01914             $identifierColumnNames = $this-&gt;<a class="code" href="classDoctrine__Table.html#a59985893a28b70d90d25558572399213" title="Returns an array with all the identifier column names.">getIdentifierColumnNames</a>();
<a name="l01915"></a>01915             $query = <span class="stringliteral">&#39;SELECT &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, (array) $identifierColumnNames)
<a name="l01916"></a>01916                 . <span class="stringliteral">&#39; FROM &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Table.html#ae8473c14e9ccaeb44e3cf037a8a93373" title="Gets the table name in the db.">getTableName</a>()
<a name="l01917"></a>01917                 . <span class="stringliteral">&#39; WHERE &#39;</span> . implode(<span class="stringliteral">&#39; = ? &amp;&amp; &#39;</span>, (array) $identifierColumnNames) . <span class="stringliteral">&#39; = ?&#39;</span>;
<a name="l01918"></a>01918             $query = $this-&gt;<a class="code" href="classDoctrine__Table.html#a72ee12bd9f1f18515eab4fe0f560a6f1" title="applyInheritance">applyInheritance</a>($query);
<a name="l01919"></a>01919 
<a name="l01920"></a>01920             $params = array_merge(array($id), array_values($this-&gt;_options[<span class="stringliteral">&#39;inheritanceMap&#39;</span>]));
<a name="l01921"></a>01921 
<a name="l01922"></a>01922             $this-&gt;_data = $this-&gt;_conn-&gt;execute($query, $params)-&gt;fetch(PDO::FETCH_ASSOC);
<a name="l01923"></a>01923 
<a name="l01924"></a>01924             <span class="keywordflow">if</span> ($this-&gt;_data === <span class="keyword">false</span>)
<a name="l01925"></a>01925                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01926"></a>01926         }
<a name="l01927"></a>01927         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a12eeb103abc3969ed37ce91fffcc39cb" title="Returns a new record.">getRecord</a>();
<a name="l01928"></a>01928     }
<a name="l01929"></a>01929 
<a name="l01935"></a><a class="code" href="classDoctrine__Table.html#a72ee12bd9f1f18515eab4fe0f560a6f1">01935</a>     <span class="keyword">final</span> <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a72ee12bd9f1f18515eab4fe0f560a6f1" title="applyInheritance">applyInheritance</a>($where)
<a name="l01936"></a>01936     {
<a name="l01937"></a>01937         <span class="keywordflow">if</span> ( ! empty($this-&gt;_options[<span class="stringliteral">&#39;inheritanceMap&#39;</span>])) {
<a name="l01938"></a>01938             $a = array();
<a name="l01939"></a>01939             <span class="keywordflow">foreach</span> ($this-&gt;_options[<span class="stringliteral">&#39;inheritanceMap&#39;</span>] as $field =&gt; $value) {
<a name="l01940"></a>01940                 $a[] = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($field) . <span class="stringliteral">&#39; = ?&#39;</span>;
<a name="l01941"></a>01941             }
<a name="l01942"></a>01942             $i = implode(<span class="stringliteral">&#39; AND &#39;</span>, $a);
<a name="l01943"></a>01943             $where .= <span class="stringliteral">&#39; AND &#39;</span> . $i;
<a name="l01944"></a>01944         }
<a name="l01945"></a>01945         <span class="keywordflow">return</span> $where;
<a name="l01946"></a>01946     }
<a name="l01947"></a>01947 
<a name="l01953"></a><a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1">01953</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>()
<a name="l01954"></a>01954     {
<a name="l01955"></a>01955         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>()-&gt;count();
<a name="l01956"></a>01956     }
<a name="l01957"></a>01957 
<a name="l01961"></a><a class="code" href="classDoctrine__Table.html#ad4aff833bac91e64058f6aefcff45680">01961</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ad4aff833bac91e64058f6aefcff45680">getQueryObject</a>()
<a name="l01962"></a>01962     {
<a name="l01963"></a>01963         $graph = $this-&gt;<a class="code" href="classDoctrine__Table.html#a3cbc2d3318189d4adc1be30516a33169" title="Creates a query on this table.">createQuery</a>();
<a name="l01964"></a>01964         $graph-&gt;load($this-&gt;<a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>());
<a name="l01965"></a>01965         <span class="keywordflow">return</span> $graph;
<a name="l01966"></a>01966     }
<a name="l01967"></a>01967 
<a name="l01974"></a><a class="code" href="classDoctrine__Table.html#a9f8d763575384fd77b42fb7dd93345fa">01974</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a9f8d763575384fd77b42fb7dd93345fa" title="Retrieves the enum values for a given field.">getEnumValues</a>($fieldName)
<a name="l01975"></a>01975     {
<a name="l01976"></a>01976         $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName);
<a name="l01977"></a>01977         <span class="keywordflow">if</span> (isset($this-&gt;_columns[$columnName][<span class="stringliteral">&#39;values&#39;</span>])) {
<a name="l01978"></a>01978             <span class="keywordflow">return</span> $this-&gt;_columns[$columnName][<span class="stringliteral">&#39;values&#39;</span>];
<a name="l01979"></a>01979         } <span class="keywordflow">else</span> {
<a name="l01980"></a>01980             <span class="keywordflow">return</span> array();
<a name="l01981"></a>01981         }
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983 
<a name="l01994"></a><a class="code" href="classDoctrine__Table.html#a81887765e8b73d2a704de0055aef15d2">01994</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a81887765e8b73d2a704de0055aef15d2" title="Retrieves an enum value.">enumValue</a>($fieldName, $index)
<a name="l01995"></a>01995     {
<a name="l01996"></a>01996         <span class="keywordflow">if</span> ($index instanceof <a class="code" href="classDoctrine__Null.html">Doctrine_Null</a>) {
<a name="l01997"></a>01997             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01998"></a>01998         }
<a name="l01999"></a>01999 
<a name="l02000"></a>02000         <span class="keywordflow">if</span> ($this-&gt;_conn-&gt;getAttribute(Doctrine_Core::ATTR_USE_NATIVE_ENUM)) {
<a name="l02001"></a>02001             <span class="keywordflow">return</span> $index;
<a name="l02002"></a>02002         }
<a name="l02003"></a>02003 
<a name="l02004"></a>02004         $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName);
<a name="l02005"></a>02005 
<a name="l02006"></a>02006         <span class="keywordflow">return</span> isset($this-&gt;_columns[$columnName][<span class="stringliteral">&#39;values&#39;</span>][$index]) ? $this-&gt;_columns[$columnName][<span class="stringliteral">&#39;values&#39;</span>][$index] : <span class="keyword">false</span>;
<a name="l02007"></a>02007     }
<a name="l02008"></a>02008 
<a name="l02017"></a><a class="code" href="classDoctrine__Table.html#abbc8c2a5b2f922ea6c3cd28cb4f75956">02017</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#abbc8c2a5b2f922ea6c3cd28cb4f75956" title="Retrieves an enum index.">enumIndex</a>($fieldName, $value)
<a name="l02018"></a>02018     {
<a name="l02019"></a>02019         $values = $this-&gt;<a class="code" href="classDoctrine__Table.html#a9f8d763575384fd77b42fb7dd93345fa" title="Retrieves the enum values for a given field.">getEnumValues</a>($fieldName);
<a name="l02020"></a>02020 
<a name="l02021"></a>02021         <span class="keywordflow">if</span> ($this-&gt;_conn-&gt;getAttribute(Doctrine_Core::ATTR_USE_NATIVE_ENUM)) {
<a name="l02022"></a>02022             <span class="keywordflow">return</span> $value;
<a name="l02023"></a>02023         }
<a name="l02024"></a>02024         <span class="keywordflow">return</span> array_search($value, $values);
<a name="l02025"></a>02025     }
<a name="l02026"></a>02026 
<a name="l02036"></a><a class="code" href="classDoctrine__Table.html#a8d3d6729fce7e74d78c256b4ac53ec72">02036</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a8d3d6729fce7e74d78c256b4ac53ec72" title="Validates a given field using table ATTR_VALIDATE rules.">validateField</a>($fieldName, $value, <a class="code" href="classDoctrine__Record.html">Doctrine_Record</a> $record = null)
<a name="l02037"></a>02037     {
<a name="l02038"></a>02038         <span class="keywordflow">if</span> ($record instanceof <a class="code" href="classDoctrine__Record.html">Doctrine_Record</a>) {
<a name="l02039"></a>02039             $errorStack = $record-&gt;getErrorStack();
<a name="l02040"></a>02040         } <span class="keywordflow">else</span> {
<a name="l02041"></a>02041             $record  = $this-&gt;<a class="code" href="classDoctrine__Table.html#a79a249541e1a69d6d9cb9328d6fc6d4f" title="Creates a new record.">create</a>();
<a name="l02042"></a>02042             $errorStack = <span class="keyword">new</span> Doctrine_Validator_ErrorStack($this-&gt;<a class="code" href="classDoctrine__Table.html#a98b834ff1ef11b76ba50747f2ff22607" title="Returns the value of a given option.">getOption</a>(<span class="stringliteral">&#39;name&#39;</span>));
<a name="l02043"></a>02043         }
<a name="l02044"></a>02044 
<a name="l02045"></a>02045         <span class="keywordflow">if</span> ($value === self::$_null) {
<a name="l02046"></a>02046             $value = null;
<a name="l02047"></a>02047         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($value instanceof Doctrine_Record &amp;&amp; $value-&gt;exists()) {
<a name="l02048"></a>02048             $value = $value-&gt;getIncremented();
<a name="l02049"></a>02049         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($value instanceof Doctrine_Record &amp;&amp; ! $value-&gt;exists()) {
<a name="l02050"></a>02050             <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="classDoctrine__Table.html#a6cd69530d1da1ee41a3f8a106d507c32" title="Retrieves all relation objects defined on this table.">getRelations</a>() as $relation) {
<a name="l02051"></a>02051                 <span class="keywordflow">if</span> ($fieldName == $relation-&gt;getLocalFieldName() &amp;&amp; (get_class($value) == $relation-&gt;getClass() || is_subclass_of($value, $relation-&gt;getClass()))) {
<a name="l02052"></a>02052                     <span class="keywordflow">return</span> $errorStack;
<a name="l02053"></a>02053                 }
<a name="l02054"></a>02054             }
<a name="l02055"></a>02055         }
<a name="l02056"></a>02056 
<a name="l02057"></a>02057         $dataType = $this-&gt;<a class="code" href="classDoctrine__Table.html#a69c22f3b4c477e408f318828dd519cab" title="Retrieves the type of a field.">getTypeOf</a>($fieldName);
<a name="l02058"></a>02058 
<a name="l02059"></a>02059         <span class="comment">// Validate field type, if type validation is enabled</span>
<a name="l02060"></a>02060         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_VALIDATE) &amp; <a class="code" href="classDoctrine__Core.html#adc4f5bd052ac4cca8200a8619bb79328" title="VALIDATE_TYPES.">Doctrine_Core::VALIDATE_TYPES</a>) {
<a name="l02061"></a>02061             <span class="keywordflow">if</span> ( ! Doctrine_Validator::isValidType($value, $dataType)) {
<a name="l02062"></a>02062                 $errorStack-&gt;add($fieldName, <span class="stringliteral">&#39;type&#39;</span>);
<a name="l02063"></a>02063             }
<a name="l02064"></a>02064             <span class="keywordflow">if</span> ($dataType == <span class="stringliteral">&#39;enum&#39;</span>) {
<a name="l02065"></a>02065                 $enumIndex = $this-&gt;<a class="code" href="classDoctrine__Table.html#abbc8c2a5b2f922ea6c3cd28cb4f75956" title="Retrieves an enum index.">enumIndex</a>($fieldName, $value);
<a name="l02066"></a>02066                 <span class="keywordflow">if</span> ($enumIndex === <span class="keyword">false</span> &amp;&amp; $value !== null) {
<a name="l02067"></a>02067                     $errorStack-&gt;add($fieldName, <span class="stringliteral">&#39;enum&#39;</span>);
<a name="l02068"></a>02068                 }
<a name="l02069"></a>02069             }
<a name="l02070"></a>02070             <span class="keywordflow">if</span> ($dataType == <span class="stringliteral">&#39;set&#39;</span>) {
<a name="l02071"></a>02071                 $values = $this-&gt;_columns[$fieldName][<span class="stringliteral">&#39;values&#39;</span>];
<a name="l02072"></a>02072                 <span class="comment">// Convert string to array</span>
<a name="l02073"></a>02073                 <span class="keywordflow">if</span> (is_string($value)) {
<a name="l02074"></a>02074                     $value = explode(<span class="charliteral">&#39;,&#39;</span>, $value);
<a name="l02075"></a>02075                     $value = array_map(<span class="stringliteral">&#39;trim&#39;</span>, $value);
<a name="l02076"></a>02076                     $record-&gt;set($fieldName, $value);
<a name="l02077"></a>02077                 }
<a name="l02078"></a>02078                 <span class="comment">// Make sure each set value is valid</span>
<a name="l02079"></a>02079                 <span class="keywordflow">foreach</span> ($value as $k =&gt; $v) {
<a name="l02080"></a>02080                     <span class="keywordflow">if</span> ( ! in_array($v, $values)) {
<a name="l02081"></a>02081                         $errorStack-&gt;add($fieldName, <span class="stringliteral">&#39;set&#39;</span>);
<a name="l02082"></a>02082                     }
<a name="l02083"></a>02083                 }
<a name="l02084"></a>02084             }
<a name="l02085"></a>02085         }
<a name="l02086"></a>02086 
<a name="l02087"></a>02087         <span class="comment">// Validate field length, if length validation is enabled</span>
<a name="l02088"></a>02088         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Configurable.html#a8ebc87a7700ab2126f5d9ced81671d7b" title="returns the value of an attribute">getAttribute</a>(Doctrine_Core::ATTR_VALIDATE) &amp; <a class="code" href="classDoctrine__Core.html#a3f76141e41d8bf31aa73acad6a182b4a" title="VALIDATE_LENGTHS.">Doctrine_Core::VALIDATE_LENGTHS</a>) {
<a name="l02089"></a>02089             <span class="keywordflow">if</span> ( ! Doctrine_Validator::validateLength($value, $dataType, $this-&gt;<a class="code" href="classDoctrine__Table.html#a56fe361d77f1153ac016342f5d42157d" title="Gets the maximum length of a field.">getFieldLength</a>($fieldName))) {
<a name="l02090"></a>02090                 $errorStack-&gt;add($fieldName, <span class="stringliteral">&#39;length&#39;</span>);
<a name="l02091"></a>02091             }
<a name="l02092"></a>02092         }
<a name="l02093"></a>02093 
<a name="l02094"></a>02094         <span class="comment">// Run all custom validators</span>
<a name="l02095"></a>02095         <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#a5e0e339f2d152cac54b26e52413413cb" title="Gets the names of all validators being applied on a field.">getFieldValidators</a>($fieldName) as $validatorName =&gt; $args) {
<a name="l02096"></a>02096             <span class="keywordflow">if</span> ( ! is_string($validatorName)) {
<a name="l02097"></a>02097                 $validatorName = $args;
<a name="l02098"></a>02098                 $args = array();
<a name="l02099"></a>02099             }
<a name="l02100"></a>02100 
<a name="l02101"></a>02101             $validator = Doctrine_Validator::getValidator($validatorName);
<a name="l02102"></a>02102             $validator-&gt;invoker = $record;
<a name="l02103"></a>02103             $validator-&gt;field = $fieldName;
<a name="l02104"></a>02104             $validator-&gt;args = $args;
<a name="l02105"></a>02105             <span class="keywordflow">if</span> ( ! $validator-&gt;validate($value)) {
<a name="l02106"></a>02106                 $errorStack-&gt;add($fieldName, $validator);
<a name="l02107"></a>02107             }
<a name="l02108"></a>02108         }
<a name="l02109"></a>02109 
<a name="l02110"></a>02110         <span class="keywordflow">return</span> $errorStack;
<a name="l02111"></a>02111     }
<a name="l02112"></a>02112 
<a name="l02121"></a><a class="code" href="classDoctrine__Table.html#a0dc7ed86f13dea2a47c146dc3427f770">02121</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a0dc7ed86f13dea2a47c146dc3427f770" title="Validates all the unique indexes.">validateUniques</a>(<a class="code" href="classDoctrine__Record.html">Doctrine_Record</a> $record)
<a name="l02122"></a>02122     {
<a name="l02123"></a>02123         $errorStack = $record-&gt;<a class="code" href="classDoctrine__Record.html#a75b39cd2b250e6b777ec5bc4f1cd7b1c" title="retrieves the ErrorStack.">getErrorStack</a>();
<a name="l02124"></a>02124         $validator = Doctrine_Validator::getValidator(<span class="stringliteral">&#39;unique&#39;</span>);
<a name="l02125"></a>02125         $validator-&gt;invoker = $record;
<a name="l02126"></a>02126 
<a name="l02127"></a>02127         <span class="keywordflow">foreach</span> ($this-&gt;_uniques as $unique)
<a name="l02128"></a>02128         {
<a name="l02129"></a>02129             list($fields, $options) = $unique;
<a name="l02130"></a>02130             $validator-&gt;args = $options;
<a name="l02131"></a>02131             $validator-&gt;field = $fields;
<a name="l02132"></a>02132             $values = array();
<a name="l02133"></a>02133             <span class="keywordflow">foreach</span> ($fields as $field) {
<a name="l02134"></a>02134                 $values[] = $record-&gt;$field;
<a name="l02135"></a>02135             }
<a name="l02136"></a>02136             <span class="keywordflow">if</span> ( ! $validator-&gt;validate($values)) {
<a name="l02137"></a>02137                 <span class="keywordflow">foreach</span> ($fields as $field) {
<a name="l02138"></a>02138                     $errorStack-&gt;<a class="code" href="classDoctrine__Access.html#a53b761ffb79d3be53dd6505405fd6c07" title="Add the value.">add</a>($field, $validator);
<a name="l02139"></a>02139                 }
<a name="l02140"></a>02140             }
<a name="l02141"></a>02141         }
<a name="l02142"></a>02142     }
<a name="l02143"></a>02143 
<a name="l02147"></a><a class="code" href="classDoctrine__Table.html#aff4c685c9b51d910c22e511545766782">02147</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aff4c685c9b51d910c22e511545766782">getColumnCount</a>()
<a name="l02148"></a>02148     {
<a name="l02149"></a>02149         <span class="keywordflow">return</span> $this-&gt;columnCount;
<a name="l02150"></a>02150     }
<a name="l02151"></a>02151 
<a name="l02158"></a><a class="code" href="classDoctrine__Table.html#aeba25b1d3e85cf8c5846310e73f7dc5d">02158</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aeba25b1d3e85cf8c5846310e73f7dc5d" title="Retrieves all columns of the table.">getColumns</a>()
<a name="l02159"></a>02159     {
<a name="l02160"></a>02160         <span class="keywordflow">return</span> $this-&gt;_columns;
<a name="l02161"></a>02161     }
<a name="l02162"></a>02162 
<a name="l02170"></a><a class="code" href="classDoctrine__Table.html#a361a4848c0854291466175781fc8d294">02170</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a361a4848c0854291466175781fc8d294" title="Removes a field name from the table schema information.">removeColumn</a>($fieldName)
<a name="l02171"></a>02171     {
<a name="l02172"></a>02172         <span class="keywordflow">if</span> ( ! $this-&gt;<a class="code" href="classDoctrine__Table.html#ab30b1e56e3e863cc96221ad57094e1ef" title="Finds out whether the table definition has a given field.">hasField</a>($fieldName)) {
<a name="l02173"></a>02173           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02174"></a>02174         }
<a name="l02175"></a>02175 
<a name="l02176"></a>02176         $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName);
<a name="l02177"></a>02177         unset($this-&gt;_columnNames[$fieldName], $this-&gt;_fieldNames[$columnName], $this-&gt;_columns[$columnName]);
<a name="l02178"></a>02178         $this-&gt;columnCount = <a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>($this-&gt;_columns);
<a name="l02179"></a>02179         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02180"></a>02180     }
<a name="l02181"></a>02181 
<a name="l02187"></a><a class="code" href="classDoctrine__Table.html#a20028074847b0c90e95aac15fd21ccdd">02187</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a20028074847b0c90e95aac15fd21ccdd" title="Returns an array containing all the column names.">getColumnNames</a>(array $fieldNames = null)
<a name="l02188"></a>02188     {
<a name="l02189"></a>02189         <span class="keywordflow">if</span> ($fieldNames === null) {
<a name="l02190"></a>02190             <span class="keywordflow">return</span> array_keys($this-&gt;_columns);
<a name="l02191"></a>02191         } <span class="keywordflow">else</span> {
<a name="l02192"></a>02192            $columnNames = array();
<a name="l02193"></a>02193            <span class="keywordflow">foreach</span> ($fieldNames as $fieldName) {
<a name="l02194"></a>02194                $columnNames[] = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName);
<a name="l02195"></a>02195            }
<a name="l02196"></a>02196            <span class="keywordflow">return</span> $columnNames;
<a name="l02197"></a>02197         }
<a name="l02198"></a>02198     }
<a name="l02199"></a>02199 
<a name="l02205"></a><a class="code" href="classDoctrine__Table.html#a59985893a28b70d90d25558572399213">02205</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a59985893a28b70d90d25558572399213" title="Returns an array with all the identifier column names.">getIdentifierColumnNames</a>()
<a name="l02206"></a>02206     {
<a name="l02207"></a>02207         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a20028074847b0c90e95aac15fd21ccdd" title="Returns an array containing all the column names.">getColumnNames</a>((array) $this-&gt;<a class="code" href="classDoctrine__Table.html#a237c5d8e62bd6f88f72fa94c88999a5a" title="Returns the definition of the identifier key.">getIdentifier</a>());
<a name="l02208"></a>02208     }
<a name="l02209"></a>02209 
<a name="l02216"></a><a class="code" href="classDoctrine__Table.html#a236218662f9e86612fc157cb56072dfc">02216</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a236218662f9e86612fc157cb56072dfc" title="Gets the array of unique fields sets.">getUniques</a>()
<a name="l02217"></a>02217     {
<a name="l02218"></a>02218         <span class="keywordflow">return</span> $this-&gt;_uniques;
<a name="l02219"></a>02219     }
<a name="l02220"></a>02220 
<a name="l02226"></a><a class="code" href="classDoctrine__Table.html#ac8eb6a0f53fd9065595fa88aaa56d3f8">02226</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ac8eb6a0f53fd9065595fa88aaa56d3f8" title="Returns an array containing all the field names.">getFieldNames</a>()
<a name="l02227"></a>02227     {
<a name="l02228"></a>02228         <span class="keywordflow">return</span> array_values($this-&gt;_fieldNames);
<a name="l02229"></a>02229     }
<a name="l02230"></a>02230 
<a name="l02240"></a><a class="code" href="classDoctrine__Table.html#ae797bc1921f7f405ea1b9ef88bb281c0">02240</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ae797bc1921f7f405ea1b9ef88bb281c0" title="Retrieves the definition of a field.">getDefinitionOf</a>($fieldName)
<a name="l02241"></a>02241     {
<a name="l02242"></a>02242         $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName);
<a name="l02243"></a>02243         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#a547ebe74ed9a4e0dc6cf3e051f4c9ba7" title="Retrieves a column definition from this table schema.">getColumnDefinition</a>($columnName);
<a name="l02244"></a>02244     }
<a name="l02245"></a>02245 
<a name="l02252"></a><a class="code" href="classDoctrine__Table.html#a69c22f3b4c477e408f318828dd519cab">02252</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a69c22f3b4c477e408f318828dd519cab" title="Retrieves the type of a field.">getTypeOf</a>($fieldName)
<a name="l02253"></a>02253     {
<a name="l02254"></a>02254         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#afc5ea40a195378a237ff2348e7e490f4" title="Retrieves the type of a column.">getTypeOfColumn</a>($this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName));
<a name="l02255"></a>02255     }
<a name="l02256"></a>02256 
<a name="l02263"></a><a class="code" href="classDoctrine__Table.html#afc5ea40a195378a237ff2348e7e490f4">02263</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#afc5ea40a195378a237ff2348e7e490f4" title="Retrieves the type of a column.">getTypeOfColumn</a>($columnName)
<a name="l02264"></a>02264     {
<a name="l02265"></a>02265         <span class="keywordflow">return</span> isset($this-&gt;_columns[$columnName]) ? $this-&gt;_columns[$columnName][<span class="stringliteral">&#39;type&#39;</span>] : <span class="keyword">false</span>;
<a name="l02266"></a>02266     }
<a name="l02267"></a>02267 
<a name="l02276"></a><a class="code" href="classDoctrine__Table.html#a7e8f4f9ce36fe38ce166ca1db0ab6466">02276</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a7e8f4f9ce36fe38ce166ca1db0ab6466" title="Doctrine uses this function internally.">setData</a>(array $data)
<a name="l02277"></a>02277     {
<a name="l02278"></a>02278         $this-&gt;_data = $data;
<a name="l02279"></a>02279     }
<a name="l02280"></a>02280 
<a name="l02289"></a><a class="code" href="classDoctrine__Table.html#a666e3df9aa0bbae734c919b6dc9a4d72">02289</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a666e3df9aa0bbae734c919b6dc9a4d72" title="Returns internal data.">getData</a>()
<a name="l02290"></a>02290     {
<a name="l02291"></a>02291         <span class="keywordflow">return</span> $this-&gt;_data;
<a name="l02292"></a>02292     }
<a name="l02293"></a>02293 
<a name="l02320"></a><a class="code" href="classDoctrine__Table.html#a9789e968af9cbbcc888e3d8332a5e476">02320</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a9789e968af9cbbcc888e3d8332a5e476" title="Performs special data preparation.">prepareValue</a>($fieldName, $value, $typeHint = null)
<a name="l02321"></a>02321     {
<a name="l02322"></a>02322         <span class="keywordflow">if</span> ($value === self::$_null) {
<a name="l02323"></a>02323             <span class="keywordflow">return</span> self::$_null;
<a name="l02324"></a>02324         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($value === null) {
<a name="l02325"></a>02325             <span class="keywordflow">return</span> null;
<a name="l02326"></a>02326         } <span class="keywordflow">else</span> {
<a name="l02327"></a>02327             $type = is_null($typeHint) ? $this-&gt;<a class="code" href="classDoctrine__Table.html#a69c22f3b4c477e408f318828dd519cab" title="Retrieves the type of a field.">getTypeOf</a>($fieldName) : $typeHint;
<a name="l02328"></a>02328 
<a name="l02329"></a>02329             <span class="keywordflow">switch</span> ($type) {
<a name="l02330"></a>02330                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;enum&#39;</span>:
<a name="l02331"></a>02331                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;integer&#39;</span>:
<a name="l02332"></a>02332                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;string&#39;</span>;
<a name="l02333"></a>02333                     <span class="comment">// don&#39;t do any casting here PHP INT_MAX is smaller than what the databases support</span>
<a name="l02334"></a>02334                 <span class="keywordflow">break</span>;
<a name="l02335"></a>02335                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;set&#39;</span>:
<a name="l02336"></a>02336                     <span class="keywordflow">return</span> explode(<span class="charliteral">&#39;,&#39;</span>, $value);
<a name="l02337"></a>02337                 <span class="keywordflow">break</span>;
<a name="l02338"></a>02338                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;boolean&#39;</span>:
<a name="l02339"></a>02339                     <span class="keywordflow">return</span> (<span class="keywordtype">boolean</span>) $value;
<a name="l02340"></a>02340                 <span class="keywordflow">break</span>;
<a name="l02341"></a>02341                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;array&#39;</span>:
<a name="l02342"></a>02342                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;object&#39;</span>:
<a name="l02343"></a>02343                     <span class="keywordflow">if</span> (is_string($value)) {
<a name="l02344"></a>02344                         $value = empty($value) ? null:unserialize($value);
<a name="l02345"></a>02345 
<a name="l02346"></a>02346                         <span class="keywordflow">if</span> ($value === <span class="keyword">false</span>) {
<a name="l02347"></a>02347                             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Unserialization of &#39;</span> . $fieldName . <span class="stringliteral">&#39; failed.&#39;</span>);
<a name="l02348"></a>02348                         }
<a name="l02349"></a>02349                         <span class="keywordflow">return</span> $value;
<a name="l02350"></a>02350                     }
<a name="l02351"></a>02351                 <span class="keywordflow">break</span>;
<a name="l02352"></a>02352                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;gzip&#39;</span>:
<a name="l02353"></a>02353                     $value = gzuncompress($value);
<a name="l02354"></a>02354 
<a name="l02355"></a>02355                     <span class="keywordflow">if</span> ($value === <span class="keyword">false</span>) {
<a name="l02356"></a>02356                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Uncompressing of &#39;</span> . $fieldName . <span class="stringliteral">&#39; failed.&#39;</span>);
<a name="l02357"></a>02357                     }
<a name="l02358"></a>02358                     <span class="keywordflow">return</span> $value;
<a name="l02359"></a>02359                 <span class="keywordflow">break</span>;
<a name="l02360"></a>02360             }
<a name="l02361"></a>02361         }
<a name="l02362"></a>02362         <span class="keywordflow">return</span> $value;
<a name="l02363"></a>02363     }
<a name="l02364"></a>02364 
<a name="l02372"></a><a class="code" href="classDoctrine__Table.html#abcf0a605a76e57ff65108be64d6f9894">02372</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#abcf0a605a76e57ff65108be64d6f9894" title="Gets associated tree.">getTree</a>()
<a name="l02373"></a>02373     {
<a name="l02374"></a>02374         <span class="keywordflow">if</span> (isset($this-&gt;_options[<span class="stringliteral">&#39;treeImpl&#39;</span>])) {
<a name="l02375"></a>02375             <span class="keywordflow">if</span> ( ! $this-&gt;_tree) {
<a name="l02376"></a>02376                 $options = isset($this-&gt;_options[<span class="stringliteral">&#39;treeOptions&#39;</span>]) ? $this-&gt;_options[<span class="stringliteral">&#39;treeOptions&#39;</span>] : array();
<a name="l02377"></a>02377                 $this-&gt;_tree = <a class="code" href="classDoctrine__Tree.html#a7254212d2878db315d034310bfd0c006" title="Factory method to create a Tree.">Doctrine_Tree::factory</a>($this,
<a name="l02378"></a>02378                     $this-&gt;_options[<span class="stringliteral">&#39;treeImpl&#39;</span>],
<a name="l02379"></a>02379                     $options
<a name="l02380"></a>02380                 );
<a name="l02381"></a>02381             }
<a name="l02382"></a>02382             <span class="keywordflow">return</span> $this-&gt;_tree;
<a name="l02383"></a>02383         }
<a name="l02384"></a>02384         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02385"></a>02385     }
<a name="l02386"></a>02386 
<a name="l02392"></a><a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf">02392</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aba287f95aa834e178099704f9a7d6ddf" title="Gets the subclass of Doctrine_Record that belongs to this table.">getComponentName</a>()
<a name="l02393"></a>02393     {
<a name="l02394"></a>02394         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l02395"></a>02395     }
<a name="l02396"></a>02396 
<a name="l02402"></a><a class="code" href="classDoctrine__Table.html#ae8473c14e9ccaeb44e3cf037a8a93373">02402</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ae8473c14e9ccaeb44e3cf037a8a93373" title="Gets the table name in the db.">getTableName</a>()
<a name="l02403"></a>02403     {
<a name="l02404"></a>02404         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;tableName&#39;</span>];
<a name="l02405"></a>02405     }
<a name="l02406"></a>02406 
<a name="l02413"></a><a class="code" href="classDoctrine__Table.html#a1f832433d9f3400dd13958a89a9c6c1c">02413</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a1f832433d9f3400dd13958a89a9c6c1c" title="sets the table name in the schema definition.">setTableName</a>($tableName)
<a name="l02414"></a>02414     {
<a name="l02415"></a>02415         $this-&gt;<a class="code" href="classDoctrine__Table.html#ab865b0ff2cfbc786d02a71ad1c6abc3d" title="Sets an option for the table.">setOption</a>(<span class="stringliteral">&#39;tableName&#39;</span>, $this-&gt;_conn-&gt;formatter-&gt;getTableName($tableName));
<a name="l02416"></a>02416     }
<a name="l02417"></a>02417 
<a name="l02423"></a><a class="code" href="classDoctrine__Table.html#a77db9a552fcbb2c9223a7944b14996bc">02423</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a77db9a552fcbb2c9223a7944b14996bc" title="Determines if table acts as tree.">isTree</a>()
<a name="l02424"></a>02424     {
<a name="l02425"></a>02425         <span class="keywordflow">return</span> ( ! is_null($this-&gt;_options[<span class="stringliteral">&#39;treeImpl&#39;</span>])) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l02426"></a>02426     }
<a name="l02427"></a>02427 
<a name="l02433"></a><a class="code" href="classDoctrine__Table.html#ac2265b0ed77f9fc1bb6451185813cc1f">02433</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ac2265b0ed77f9fc1bb6451185813cc1f" title="Retrieves all templates (behaviors) attached to this table.">getTemplates</a>()
<a name="l02434"></a>02434     {
<a name="l02435"></a>02435         <span class="keywordflow">return</span> $this-&gt;_templates;
<a name="l02436"></a>02436     }
<a name="l02437"></a>02437 
<a name="l02449"></a><a class="code" href="classDoctrine__Table.html#a2fd1146bf1a1c123276d06912896c3b5">02449</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a2fd1146bf1a1c123276d06912896c3b5" title="Retrieves a particular template by class name.">getTemplate</a>($template)
<a name="l02450"></a>02450     {
<a name="l02451"></a>02451         <span class="keywordflow">if</span> (isset($this-&gt;_templates[<span class="stringliteral">&#39;Doctrine_Template_&#39;</span> . $template])) {
<a name="l02452"></a>02452             <span class="keywordflow">return</span> $this-&gt;_templates[<span class="stringliteral">&#39;Doctrine_Template_&#39;</span> . $template];
<a name="l02453"></a>02453         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($this-&gt;_templates[$template])) {
<a name="l02454"></a>02454             <span class="keywordflow">return</span> $this-&gt;_templates[$template];
<a name="l02455"></a>02455         }
<a name="l02456"></a>02456 
<a name="l02457"></a>02457         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Template &#39;</span> . $template . <span class="stringliteral">&#39; not loaded&#39;</span>);
<a name="l02458"></a>02458     }
<a name="l02459"></a>02459 
<a name="l02466"></a><a class="code" href="classDoctrine__Table.html#a5634cbf176df22b5dddcee97591d8451">02466</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a5634cbf176df22b5dddcee97591d8451" title="Checks if the table has a given template.">hasTemplate</a>($template)
<a name="l02467"></a>02467     {
<a name="l02468"></a>02468         <span class="keywordflow">return</span> isset($this-&gt;_templates[$template]) || isset($this-&gt;_templates[<span class="stringliteral">&#39;Doctrine_Template_&#39;</span> . $template]);
<a name="l02469"></a>02469     }
<a name="l02470"></a>02470 
<a name="l02478"></a><a class="code" href="classDoctrine__Table.html#aa974fc016e5889ec30e019c72799f014">02478</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#aa974fc016e5889ec30e019c72799f014" title="Adds a template to this table.">addTemplate</a>($template, <a class="code" href="classDoctrine__Template.html">Doctrine_Template</a> $impl)
<a name="l02479"></a>02479     {
<a name="l02480"></a>02480         $this-&gt;_templates[$template] = $impl;
<a name="l02481"></a>02481 
<a name="l02482"></a>02482         <span class="keywordflow">return</span> $this;
<a name="l02483"></a>02483     }
<a name="l02484"></a>02484 
<a name="l02490"></a><a class="code" href="classDoctrine__Table.html#a23f1c0cb23f54d56211de7b9ccd62ec5">02490</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a23f1c0cb23f54d56211de7b9ccd62ec5" title="Gets all the generators for this table.">getGenerators</a>()
<a name="l02491"></a>02491     {
<a name="l02492"></a>02492         <span class="keywordflow">return</span> $this-&gt;_generators;
<a name="l02493"></a>02493     }
<a name="l02494"></a>02494 
<a name="l02501"></a><a class="code" href="classDoctrine__Table.html#a27c85333b2bfe6184829ddb1383425f4">02501</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a27c85333b2bfe6184829ddb1383425f4" title="Gets generator instance for a passed name.">getGenerator</a>($generator)
<a name="l02502"></a>02502     {
<a name="l02503"></a>02503         <span class="keywordflow">if</span> ( ! isset($this-&gt;_generators[$generator])) {
<a name="l02504"></a>02504             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Generator &#39;</span> . $generator . <span class="stringliteral">&#39; not loaded&#39;</span>);
<a name="l02505"></a>02505         }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507         <span class="keywordflow">return</span> $this-&gt;_generators[$generator];
<a name="l02508"></a>02508     }
<a name="l02509"></a>02509 
<a name="l02516"></a><a class="code" href="classDoctrine__Table.html#ab42caaacd933a3c14758b53bdb671fe5">02516</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#ab42caaacd933a3c14758b53bdb671fe5" title="Checks if a generator name exists.">hasGenerator</a>($generator)
<a name="l02517"></a>02517     {
<a name="l02518"></a>02518         <span class="keywordflow">return</span> isset($this-&gt;_generators[$generator]);
<a name="l02519"></a>02519     }
<a name="l02520"></a>02520 
<a name="l02528"></a><a class="code" href="classDoctrine__Table.html#a1932ae87a8ab2636d6271e1568af32ca">02528</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a1932ae87a8ab2636d6271e1568af32ca" title="Adds a generate to the table instance.">addGenerator</a>(<a class="code" href="classDoctrine__Record__Generator.html">Doctrine_Record_Generator</a> $generator, $name = null)
<a name="l02529"></a>02529     {
<a name="l02530"></a>02530         <span class="keywordflow">if</span> ($name === null) {
<a name="l02531"></a>02531             $this-&gt;_generators[] = $generator;
<a name="l02532"></a>02532         } <span class="keywordflow">else</span> {
<a name="l02533"></a>02533             $this-&gt;_generators[$name] = $generator;
<a name="l02534"></a>02534         }
<a name="l02535"></a>02535         <span class="keywordflow">return</span> $this;
<a name="l02536"></a>02536     }
<a name="l02537"></a>02537 
<a name="l02544"></a><a class="code" href="classDoctrine__Table.html#acaa5d3305ff53cbedcc659370b423384">02544</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#acaa5d3305ff53cbedcc659370b423384" title="Set the generator responsible for creating this table.">setGenerator</a>(<a class="code" href="classDoctrine__Record__Generator.html">Doctrine_Record_Generator</a> $generator)
<a name="l02545"></a>02545     {
<a name="l02546"></a>02546         $this-&gt;_generator = $generator;
<a name="l02547"></a>02547     }
<a name="l02548"></a>02548 
<a name="l02554"></a><a class="code" href="classDoctrine__Table.html#a6c95274315a9058d3bae692f456fdc11">02554</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a6c95274315a9058d3bae692f456fdc11" title="Check whether this table was created by a record generator or not.">isGenerator</a>()
<a name="l02555"></a>02555     {
<a name="l02556"></a>02556         <span class="keywordflow">return</span> isset($this-&gt;_generator) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l02557"></a>02557     }
<a name="l02558"></a>02558 
<a name="l02564"></a><a class="code" href="classDoctrine__Table.html#a9d0c50e0f1112489837415e0a6b86993">02564</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a9d0c50e0f1112489837415e0a6b86993" title="Get the parent generator responsible for this table instance.">getParentGenerator</a>()
<a name="l02565"></a>02565     {
<a name="l02566"></a>02566         <span class="keywordflow">return</span> $this-&gt;_generator;
<a name="l02567"></a>02567     }
<a name="l02568"></a>02568 
<a name="l02576"></a><a class="code" href="classDoctrine__Table.html#a2e92f2b976b67206733c8a7f8469d20d">02576</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a2e92f2b976b67206733c8a7f8469d20d" title="Binds query parts to this component.">bindQueryParts</a>(array $queryParts)
<a name="l02577"></a>02577     {
<a name="l02578"></a>02578         $this-&gt;_options[<span class="stringliteral">&#39;queryParts&#39;</span>] = $queryParts;
<a name="l02579"></a>02579 
<a name="l02580"></a>02580         <span class="keywordflow">return</span> $this;
<a name="l02581"></a>02581     }
<a name="l02582"></a>02582 
<a name="l02593"></a><a class="code" href="classDoctrine__Table.html#a0030e1fe3c94e9510f3f0e95980f60a1">02593</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a0030e1fe3c94e9510f3f0e95980f60a1" title="Adds default query parts to the selects executed on this table.">bindQueryPart</a>($queryPart, $value)
<a name="l02594"></a>02594     {
<a name="l02595"></a>02595         $this-&gt;_options[<span class="stringliteral">&#39;queryParts&#39;</span>][$queryPart] = $value;
<a name="l02596"></a>02596 
<a name="l02597"></a>02597         <span class="keywordflow">return</span> $this;
<a name="l02598"></a>02598     }
<a name="l02599"></a>02599 
<a name="l02606"></a><a class="code" href="classDoctrine__Table.html#a5e0e339f2d152cac54b26e52413413cb">02606</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a5e0e339f2d152cac54b26e52413413cb" title="Gets the names of all validators being applied on a field.">getFieldValidators</a>($fieldName)
<a name="l02607"></a>02607     {
<a name="l02608"></a>02608         $validators = array();
<a name="l02609"></a>02609         $columnName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName);
<a name="l02610"></a>02610         <span class="comment">// this loop is a dirty workaround to get the validators filtered out of</span>
<a name="l02611"></a>02611         <span class="comment">// the options, since everything is squeezed together currently</span>
<a name="l02612"></a>02612         <span class="keywordflow">foreach</span> ($this-&gt;_columns[$columnName] as $name =&gt; $args) {
<a name="l02613"></a>02613              <span class="keywordflow">if</span> (empty($name)
<a name="l02614"></a>02614                     || $name == <span class="stringliteral">&#39;primary&#39;</span>
<a name="l02615"></a>02615                     || $name == <span class="stringliteral">&#39;protected&#39;</span>
<a name="l02616"></a>02616                     || $name == <span class="stringliteral">&#39;autoincrement&#39;</span>
<a name="l02617"></a>02617                     || $name == <span class="stringliteral">&#39;default&#39;</span>
<a name="l02618"></a>02618                     || $name == <span class="stringliteral">&#39;values&#39;</span>
<a name="l02619"></a>02619                     || $name == <span class="stringliteral">&#39;sequence&#39;</span>
<a name="l02620"></a>02620                     || $name == <span class="stringliteral">&#39;zerofill&#39;</span>
<a name="l02621"></a>02621                     || $name == <span class="stringliteral">&#39;owner&#39;</span>
<a name="l02622"></a>02622                     || $name == <span class="stringliteral">&#39;scale&#39;</span>
<a name="l02623"></a>02623                     || $name == <span class="stringliteral">&#39;type&#39;</span>
<a name="l02624"></a>02624                     || $name == <span class="stringliteral">&#39;length&#39;</span>
<a name="l02625"></a>02625                     || $name == <span class="stringliteral">&#39;fixed&#39;</span>
<a name="l02626"></a>02626                     || $name == <span class="stringliteral">&#39;comment&#39;</span>
<a name="l02627"></a>02627                     || $name == <span class="stringliteral">&#39;alias&#39;</span>
<a name="l02628"></a>02628                     || $name == <span class="stringliteral">&#39;extra&#39;</span>) {
<a name="l02629"></a>02629                 <span class="keywordflow">continue</span>;
<a name="l02630"></a>02630             }
<a name="l02631"></a>02631             <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;notnull&#39;</span> &amp;&amp; isset($this-&gt;_columns[$columnName][<span class="stringliteral">&#39;autoincrement&#39;</span>])
<a name="l02632"></a>02632                     &amp;&amp; $this-&gt;_columns[$columnName][<span class="stringliteral">&#39;autoincrement&#39;</span>] === <span class="keyword">true</span>) {
<a name="l02633"></a>02633                 <span class="keywordflow">continue</span>;
<a name="l02634"></a>02634             }
<a name="l02635"></a>02635             <span class="comment">// skip it if it&#39;s explicitly set to FALSE (i.e. notnull =&gt; false)</span>
<a name="l02636"></a>02636             <span class="keywordflow">if</span> ($args === <span class="keyword">false</span>) {
<a name="l02637"></a>02637                 <span class="keywordflow">continue</span>;
<a name="l02638"></a>02638             }
<a name="l02639"></a>02639             $validators[$name] = $args;
<a name="l02640"></a>02640         }
<a name="l02641"></a>02641 
<a name="l02642"></a>02642         <span class="keywordflow">return</span> $validators;
<a name="l02643"></a>02643     }
<a name="l02644"></a>02644 
<a name="l02653"></a><a class="code" href="classDoctrine__Table.html#a56fe361d77f1153ac016342f5d42157d">02653</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a56fe361d77f1153ac016342f5d42157d" title="Gets the maximum length of a field.">getFieldLength</a>($fieldName)
<a name="l02654"></a>02654     {
<a name="l02655"></a>02655         <span class="keywordflow">return</span> $this-&gt;_columns[$this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName)][<span class="stringliteral">&#39;length&#39;</span>];
<a name="l02656"></a>02656     }
<a name="l02657"></a>02657 
<a name="l02665"></a><a class="code" href="classDoctrine__Table.html#af84c2f0f7c048c2ec4d1fa2f0ce2ff4d">02665</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#af84c2f0f7c048c2ec4d1fa2f0ce2ff4d" title="Retrieves a bound query part.">getBoundQueryPart</a>($queryPart)
<a name="l02666"></a>02666     {
<a name="l02667"></a>02667         <span class="keywordflow">if</span> ( ! isset($this-&gt;_options[<span class="stringliteral">&#39;queryParts&#39;</span>][$queryPart])) {
<a name="l02668"></a>02668             <span class="keywordflow">return</span> null;
<a name="l02669"></a>02669         }
<a name="l02670"></a>02670 
<a name="l02671"></a>02671         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;queryParts&#39;</span>][$queryPart];
<a name="l02672"></a>02672     }
<a name="l02673"></a>02673 
<a name="l02680"></a><a class="code" href="classDoctrine__Table.html#afffdc30c75bc6f1cc38ee508364375e3">02680</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#afffdc30c75bc6f1cc38ee508364375e3" title="unshiftFilter">unshiftFilter</a>(<a class="code" href="classDoctrine__Record__Filter.html">Doctrine_Record_Filter</a> $filter)
<a name="l02681"></a>02681     {
<a name="l02682"></a>02682         $filter-&gt;setTable($this);
<a name="l02683"></a>02683 
<a name="l02684"></a>02684         $filter-&gt;init();
<a name="l02685"></a>02685 
<a name="l02686"></a>02686         array_unshift($this-&gt;_filters, $filter);
<a name="l02687"></a>02687 
<a name="l02688"></a>02688         <span class="keywordflow">return</span> $this;
<a name="l02689"></a>02689     }
<a name="l02690"></a>02690 
<a name="l02696"></a><a class="code" href="classDoctrine__Table.html#a947ae52ec741274bb776ec569639ebc7">02696</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a947ae52ec741274bb776ec569639ebc7" title="getFilters">getFilters</a>()
<a name="l02697"></a>02697     {
<a name="l02698"></a>02698         <span class="keywordflow">return</span> $this-&gt;_filters;
<a name="l02699"></a>02699     }
<a name="l02700"></a>02700 
<a name="l02709"></a><a class="code" href="classDoctrine__Table.html#a2edd3cfa2cf34927ee6e3e8bdd63f072">02709</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#a2edd3cfa2cf34927ee6e3e8bdd63f072" title="Generates a string representation of this object.">__toString</a>()
<a name="l02710"></a>02710     {
<a name="l02711"></a>02711         <span class="keywordflow">return</span> <a class="code" href="classDoctrine__Lib.html#a64b62bf339ea7fc0643ad62ca8548433" title="Generates a string representation of a table.">Doctrine_Lib::getTableAsString</a>($this);
<a name="l02712"></a>02712     }
<a name="l02713"></a>02713 
<a name="l02720"></a>02720     <span class="keyword">private</span> function isGreaterThan($a, $b)
<a name="l02721"></a>02721     {
<a name="l02722"></a>02722         <span class="keywordflow">if</span> (strlen($a) == strlen($b)) <span class="keywordflow">return</span> 0;
<a name="l02723"></a>02723         <span class="keywordflow">return</span> (strlen($a) &gt; strlen($b)) ? 1 : -1;
<a name="l02724"></a>02724     }
<a name="l02725"></a>02725 
<a name="l02726"></a>02726     <span class="keyword">public</span> function buildFindByWhere($fieldName)
<a name="l02727"></a>02727     {
<a name="l02728"></a>02728         <span class="comment">// Get all variations of possible field names</span>
<a name="l02729"></a>02729         $fields = array_merge($this-&gt;<a class="code" href="classDoctrine__Table.html#ac8eb6a0f53fd9065595fa88aaa56d3f8" title="Returns an array containing all the field names.">getFieldNames</a>(), $this-&gt;<a class="code" href="classDoctrine__Table.html#a20028074847b0c90e95aac15fd21ccdd" title="Returns an array containing all the column names.">getColumnNames</a>());
<a name="l02730"></a>02730         $fields = array_merge($fields, array_map(array(<span class="stringliteral">&#39;Doctrine_Inflector&#39;</span>, <span class="stringliteral">&#39;classify&#39;</span>), $fields));
<a name="l02731"></a>02731         $fields = array_merge($fields, array_map(<span class="stringliteral">&#39;ucfirst&#39;</span>, $fields));
<a name="l02732"></a>02732 
<a name="l02733"></a>02733         <span class="comment">// Sort field names by length - smallest first</span>
<a name="l02734"></a>02734         <span class="comment">// and then reverse so that largest is first</span>
<a name="l02735"></a>02735         usort($fields, array($this, <span class="stringliteral">&#39;isGreaterThan&#39;</span>));
<a name="l02736"></a>02736         $fields = array_reverse(array_unique($fields));
<a name="l02737"></a>02737 
<a name="l02738"></a>02738         <span class="comment">// Identify fields and operators</span>
<a name="l02739"></a>02739         preg_match_all(<span class="stringliteral">&#39;/(&#39;</span> . implode(<span class="charliteral">&#39;|&#39;</span>, $fields) . <span class="stringliteral">&#39;)(Or|And)?/&#39;</span>, $fieldName, $matches);
<a name="l02740"></a>02740         $fieldsFound = $matches[1];
<a name="l02741"></a>02741         $operatorFound = array_map(<span class="stringliteral">&#39;strtoupper&#39;</span>, $matches[2]);
<a name="l02742"></a>02742 
<a name="l02743"></a>02743         <span class="comment">// Check if $fieldName has unidentified parts left </span>
<a name="l02744"></a>02744         <span class="keywordflow">if</span> (strlen(implode(<span class="stringliteral">&#39;&#39;</span>, $fieldsFound) . implode(<span class="stringliteral">&#39;&#39;</span>, $operatorFound)) !== strlen($fieldName)) {
<a name="l02745"></a>02745             $expression = preg_replace(<span class="stringliteral">&#39;/(&#39;</span> . implode(<span class="charliteral">&#39;|&#39;</span>, $fields) . <span class="stringliteral">&#39;)(Or|And)?/&#39;</span>, <span class="stringliteral">&#39;($1)$2&#39;</span>, $fieldName);
<a name="l02746"></a>02746             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Invalid expression found: &#39;</span> . $expression);    
<a name="l02747"></a>02747         }
<a name="l02748"></a>02748 
<a name="l02749"></a>02749         <span class="comment">// Build result</span>
<a name="l02750"></a>02750         $where = $lastOperator = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02751"></a>02751         $bracketOpen = <span class="keyword">false</span>;
<a name="l02752"></a>02752         <span class="keywordflow">foreach</span> ($fieldsFound as $index =&gt; $field) {
<a name="l02753"></a>02753             $field = $this-&gt;<a class="code" href="classDoctrine__Table.html#a3e441fe6bb3b62a7d36453d1f7ee5e7d" title="Resolves the passed find by field name inflecting the parameter.">_resolveFindByFieldName</a>($field);
<a name="l02754"></a>02754             <span class="keywordflow">if</span> (!$field) {
<a name="l02755"></a>02755                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Invalid field name to find by: &#39;</span> . $field);
<a name="l02756"></a>02756             }
<a name="l02757"></a>02757 
<a name="l02758"></a>02758             <span class="keywordflow">if</span> ($operatorFound[$index] == <span class="stringliteral">&#39;OR&#39;</span> &amp;&amp; !$bracketOpen) {
<a name="l02759"></a>02759                 $where .= <span class="charliteral">&#39;(&#39;</span>;
<a name="l02760"></a>02760                 $bracketOpen = <span class="keyword">true</span>;
<a name="l02761"></a>02761             }
<a name="l02762"></a>02762 
<a name="l02763"></a>02763             $where .= <span class="stringliteral">&#39;dctrn_find.&#39;</span> . $field . <span class="stringliteral">&#39; = ?&#39;</span>;
<a name="l02764"></a>02764 
<a name="l02765"></a>02765             <span class="keywordflow">if</span> ($operatorFound[$index] != <span class="stringliteral">&#39;OR&#39;</span> &amp;&amp; $lastOperator == <span class="stringliteral">&#39;OR&#39;</span>) {
<a name="l02766"></a>02766                 $where .= <span class="charliteral">&#39;)&#39;</span>;
<a name="l02767"></a>02767                 $bracketOpen = <span class="keyword">false</span>;
<a name="l02768"></a>02768             }
<a name="l02769"></a>02769 
<a name="l02770"></a>02770             $where .= <span class="charliteral">&#39; &#39;</span> . strtoupper($operatorFound[$index]) . <span class="charliteral">&#39; &#39;</span>;
<a name="l02771"></a>02771             
<a name="l02772"></a>02772             $lastOperator = $operatorFound[$index];
<a name="l02773"></a>02773         }
<a name="l02774"></a>02774 
<a name="l02775"></a>02775         <span class="keywordflow">return</span> trim($where);
<a name="l02776"></a>02776     }
<a name="l02777"></a>02777 
<a name="l02789"></a><a class="code" href="classDoctrine__Table.html#a3e441fe6bb3b62a7d36453d1f7ee5e7d">02789</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Table.html#a3e441fe6bb3b62a7d36453d1f7ee5e7d" title="Resolves the passed find by field name inflecting the parameter.">_resolveFindByFieldName</a>($name)
<a name="l02790"></a>02790     {
<a name="l02791"></a>02791         $fieldName = <a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($name);
<a name="l02792"></a>02792         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#a4af3b17b0687e6733fef86f50d6c35e9" title="Finds out whether the table definition contains a given column.">hasColumn</a>($name) || $this-&gt;<a class="code" href="classDoctrine__Table.html#ab30b1e56e3e863cc96221ad57094e1ef" title="Finds out whether the table definition has a given field.">hasField</a>($name)) {
<a name="l02793"></a>02793             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#adc179ffd646222b7b24b39c038c7edcb" title="Returns a column alias for a column name.">getFieldName</a>($this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($name));
<a name="l02794"></a>02794         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#a4af3b17b0687e6733fef86f50d6c35e9" title="Finds out whether the table definition contains a given column.">hasColumn</a>($fieldName) || $this-&gt;<a class="code" href="classDoctrine__Table.html#ab30b1e56e3e863cc96221ad57094e1ef" title="Finds out whether the table definition has a given field.">hasField</a>($fieldName)) {
<a name="l02795"></a>02795             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Table.html#adc179ffd646222b7b24b39c038c7edcb" title="Returns a column alias for a column name.">getFieldName</a>($this-&gt;<a class="code" href="classDoctrine__Table.html#a6f5ad2a3f6fa11d7b2c18b264e4d3e23" title="Returns a column name for a column alias.">getColumnName</a>($fieldName));
<a name="l02796"></a>02796         } <span class="keywordflow">else</span> {
<a name="l02797"></a>02797             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02798"></a>02798         }
<a name="l02799"></a>02799     }
<a name="l02800"></a>02800 
<a name="l02810"></a><a class="code" href="classDoctrine__Table.html#afd01ab607f8945fe5ef775f70cd6cbd6">02810</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Table.html#afd01ab607f8945fe5ef775f70cd6cbd6" title="Adds support for magic finders.">__call</a>($method, $arguments)
<a name="l02811"></a>02811     {
<a name="l02812"></a>02812         $lcMethod = strtolower($method);
<a name="l02813"></a>02813 
<a name="l02814"></a>02814         <span class="keywordflow">if</span> (substr($lcMethod, 0, 6) == <span class="stringliteral">&#39;findby&#39;</span>) {
<a name="l02815"></a>02815             $by = substr($method, 6, strlen($method));
<a name="l02816"></a>02816             $method = <span class="stringliteral">&#39;findBy&#39;</span>;
<a name="l02817"></a>02817         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (substr($lcMethod, 0, 9) == <span class="stringliteral">&#39;findoneby&#39;</span>) {
<a name="l02818"></a>02818             $by = substr($method, 9, strlen($method));
<a name="l02819"></a>02819             $method = <span class="stringliteral">&#39;findOneBy&#39;</span>;
<a name="l02820"></a>02820         }
<a name="l02821"></a>02821 
<a name="l02822"></a>02822         <span class="keywordflow">if</span> (isset($by)) {
<a name="l02823"></a>02823             <span class="keywordflow">if</span> ( ! isset($arguments[0])) {
<a name="l02824"></a>02824                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;You must specify the value to &#39;</span> . $method);
<a name="l02825"></a>02825             }
<a name="l02826"></a>02826 
<a name="l02827"></a>02827             $fieldName = $this-&gt;<a class="code" href="classDoctrine__Table.html#a3e441fe6bb3b62a7d36453d1f7ee5e7d" title="Resolves the passed find by field name inflecting the parameter.">_resolveFindByFieldName</a>($by);
<a name="l02828"></a>02828             $count = <a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>(explode(<span class="stringliteral">&#39;Or&#39;</span>, $by)) + (<a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>(explode(<span class="stringliteral">&#39;And&#39;</span>, $by)) - 1);
<a name="l02829"></a>02829             <span class="keywordflow">if</span> (<a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>($arguments) &gt; $count)
<a name="l02830"></a>02830             {
<a name="l02831"></a>02831                 $hydrationMode = end($arguments);
<a name="l02832"></a>02832                 unset($arguments[<a class="code" href="classDoctrine__Table.html#acbfdfe08dae2aaa270fb80e0ac02e4f1" title="Implements Countable interface.">count</a>($arguments) - 1]);
<a name="l02833"></a>02833             } <span class="keywordflow">else</span> {
<a name="l02834"></a>02834                 $hydrationMode = null;
<a name="l02835"></a>02835             }
<a name="l02836"></a>02836             <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#ab30b1e56e3e863cc96221ad57094e1ef" title="Finds out whether the table definition has a given field.">hasField</a>($fieldName)) {
<a name="l02837"></a>02837                 <span class="keywordflow">return</span> $this-&gt;$method($fieldName, $arguments[0], $hydrationMode);
<a name="l02838"></a>02838             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDoctrine__Table.html#a7aff385bdc2c2ef3f828ad0e32d90fc2" title="Tests if a relation exists.">hasRelation</a>($by)) {
<a name="l02839"></a>02839                 $relation = $this-&gt;<a class="code" href="classDoctrine__Table.html#a67a92d6dbdc6c57ca3b1f42d31200652" title="Retrieves a relation object for this component.">getRelation</a>($by);
<a name="l02840"></a>02840 
<a name="l02841"></a>02841                 <span class="keywordflow">if</span> ($relation[<span class="stringliteral">&#39;type&#39;</span>] === <a class="code" href="classDoctrine__Relation.html#a9cf5a7937bfa222693f99ce4b2b22864" title="constant for MANY_TO_MANY and ONE_TO_MANY relationships">Doctrine_Relation::MANY</a>) {
<a name="l02842"></a>02842                     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(<span class="stringliteral">&#39;Cannot findBy many relationship.&#39;</span>);
<a name="l02843"></a>02843                 }
<a name="l02844"></a>02844 
<a name="l02845"></a>02845                 <span class="keywordflow">return</span> $this-&gt;$method($relation[<span class="stringliteral">&#39;local&#39;</span>], $arguments[0], $hydrationMode);
<a name="l02846"></a>02846             } <span class="keywordflow">else</span> {
<a name="l02847"></a>02847                 <span class="keywordflow">return</span> $this-&gt;$method($by, $arguments, $hydrationMode);
<a name="l02848"></a>02848             }
<a name="l02849"></a>02849         }
<a name="l02850"></a>02850 
<a name="l02851"></a>02851         <span class="comment">// Forward the method on to the record instance and see if it has anything or one of its behaviors</span>
<a name="l02852"></a>02852         <span class="keywordflow">try</span> {
<a name="l02853"></a>02853             <span class="keywordflow">return</span> call_user_func_array(array($this-&gt;<a class="code" href="classDoctrine__Table.html#ad04a37eae8f3b0fb0299b101fe381c4f" title="Gets the record instance for this table.">getRecordInstance</a>(), $method . <span class="stringliteral">&#39;TableProxy&#39;</span>), $arguments);
<a name="l02854"></a>02854         } <span class="keywordflow">catch</span> (<a class="code" href="classDoctrine__Record__UnknownPropertyException.html">Doctrine_Record_UnknownPropertyException</a> $e) {}
<a name="l02855"></a>02855 
<a name="l02856"></a>02856         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Table__Exception.html">Doctrine_Table_Exception</a>(sprintf(<span class="stringliteral">&#39;Unknown method %s::%s&#39;</span>, get_class($this), $method));
<a name="l02857"></a>02857     }
<a name="l02858"></a>02858 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
