<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Export.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Export.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> *  $Id: Export.php 7653 2010-06-08 15:54:31Z jwage $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information, see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://www.doctrine-project.org&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00034"></a><a class="code" href="classDoctrine__Export.html">00034</a> <span class="keyword">class </span><a class="code" href="classDoctrine__Export.html">Doctrine_Export</a> <span class="keyword">extends</span> <a class="code" href="classDoctrine__Connection__Module.html">Doctrine_Connection_Module</a>
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036     <span class="keyword">protected</span> $valid_default_values = array(
<a name="l00037"></a>00037         <span class="stringliteral">&#39;text&#39;</span>      =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00038"></a>00038         <span class="stringliteral">&#39;boolean&#39;</span>   =&gt; <span class="keyword">true</span>,
<a name="l00039"></a>00039         <span class="stringliteral">&#39;integer&#39;</span>   =&gt; 0,
<a name="l00040"></a>00040         <span class="stringliteral">&#39;decimal&#39;</span>   =&gt; 0.0,
<a name="l00041"></a>00041         <span class="stringliteral">&#39;float&#39;</span>     =&gt; 0.0,
<a name="l00042"></a>00042         <span class="stringliteral">&#39;timestamp&#39;</span> =&gt; <span class="stringliteral">&#39;1970-01-01 00:00:00&#39;</span>,
<a name="l00043"></a>00043         <span class="stringliteral">&#39;time&#39;</span>      =&gt; <span class="stringliteral">&#39;00:00:00&#39;</span>,
<a name="l00044"></a>00044         <span class="stringliteral">&#39;date&#39;</span>      =&gt; <span class="stringliteral">&#39;1970-01-01&#39;</span>,
<a name="l00045"></a>00045         <span class="stringliteral">&#39;clob&#39;</span>      =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00046"></a>00046         <span class="stringliteral">&#39;blob&#39;</span>      =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00047"></a>00047         <span class="stringliteral">&#39;string&#39;</span>    =&gt; <span class="stringliteral">&#39;&#39;</span>
<a name="l00048"></a>00048     );
<a name="l00049"></a>00049 
<a name="l00057"></a><a class="code" href="classDoctrine__Export.html#a97a70db53d1f16203085617a201d8df8">00057</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a97a70db53d1f16203085617a201d8df8" title="drop an existing database (this method is implemented by the drivers)">dropDatabase</a>($database)
<a name="l00058"></a>00058     {
<a name="l00059"></a>00059         <span class="keywordflow">foreach</span> ((array) $this-&gt;<a class="code" href="classDoctrine__Export.html#aa9dbefe2c582bce75793efb62dbb22fe" title="drop an existing database (this method is implemented by the drivers)">dropDatabaseSql</a>($database) as $query) {
<a name="l00060"></a>00060             $this-&gt;conn-&gt;execute($query);
<a name="l00061"></a>00061         }
<a name="l00062"></a>00062     }
<a name="l00063"></a>00063 
<a name="l00071"></a><a class="code" href="classDoctrine__Export.html#aa9dbefe2c582bce75793efb62dbb22fe">00071</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#aa9dbefe2c582bce75793efb62dbb22fe" title="drop an existing database (this method is implemented by the drivers)">dropDatabaseSql</a>($database)
<a name="l00072"></a>00072     {
<a name="l00073"></a>00073         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;Drop database not supported by this driver.&#39;</span>);
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075 
<a name="l00083"></a><a class="code" href="classDoctrine__Export.html#af36e42456a3e18e8089bae69a34729a0">00083</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#af36e42456a3e18e8089bae69a34729a0" title="dropTableSql drop an existing table">dropTableSql</a>($table)
<a name="l00084"></a>00084     {
<a name="l00085"></a>00085         <span class="keywordflow">return</span> <span class="stringliteral">&#39;DROP TABLE &#39;</span> . $this-&gt;conn-&gt;quoteIdentifier($table);
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087 
<a name="l00095"></a><a class="code" href="classDoctrine__Export.html#ada44db69f655d08e1ad3edf2eb05f95c">00095</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#ada44db69f655d08e1ad3edf2eb05f95c" title="dropTable drop an existing table">dropTable</a>($table)
<a name="l00096"></a>00096     {
<a name="l00097"></a>00097         $this-&gt;conn-&gt;execute($this-&gt;<a class="code" href="classDoctrine__Export.html#af36e42456a3e18e8089bae69a34729a0" title="dropTableSql drop an existing table">dropTableSql</a>($table));
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099 
<a name="l00107"></a><a class="code" href="classDoctrine__Export.html#aae2fa10e09faab6f49a3fb4c06fc6207">00107</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#aae2fa10e09faab6f49a3fb4c06fc6207" title="drop existing index">dropIndex</a>($table, $name)
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109         <span class="keywordflow">return</span> $this-&gt;conn-&gt;exec($this-&gt;<a class="code" href="classDoctrine__Export.html#a1c1f75f8cf70d62fcdf4892faa7cbdd0" title="dropIndexSql">dropIndexSql</a>($table, $name));
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 
<a name="l00119"></a><a class="code" href="classDoctrine__Export.html#a1c1f75f8cf70d62fcdf4892faa7cbdd0">00119</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a1c1f75f8cf70d62fcdf4892faa7cbdd0" title="dropIndexSql">dropIndexSql</a>($table, $name)
<a name="l00120"></a>00120     {
<a name="l00121"></a>00121         $name = $this-&gt;conn-&gt;quoteIdentifier($this-&gt;conn-&gt;formatter-&gt;getIndexName($name));
<a name="l00122"></a>00122         
<a name="l00123"></a>00123         <span class="keywordflow">return</span> <span class="stringliteral">&#39;DROP INDEX &#39;</span> . $name;
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125 
<a name="l00134"></a><a class="code" href="classDoctrine__Export.html#acef912d1aff50f6cf2a88349634403bd">00134</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#acef912d1aff50f6cf2a88349634403bd" title="drop existing constraint">dropConstraint</a>($table, $name, $primary = <span class="keyword">false</span>)
<a name="l00135"></a>00135     {
<a name="l00136"></a>00136         $table = $this-&gt;conn-&gt;quoteIdentifier($table);
<a name="l00137"></a>00137         $name  = $this-&gt;conn-&gt;quoteIdentifier($name);
<a name="l00138"></a>00138         
<a name="l00139"></a>00139         <span class="keywordflow">return</span> $this-&gt;conn-&gt;exec(<span class="stringliteral">&#39;ALTER TABLE &#39;</span> . $table . <span class="stringliteral">&#39; DROP CONSTRAINT &#39;</span> . $name);
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141 
<a name="l00149"></a><a class="code" href="classDoctrine__Export.html#acad114a3967ed0316577a128d4ea5c59">00149</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#acad114a3967ed0316577a128d4ea5c59" title="drop existing foreign key">dropForeignKey</a>($table, $name)
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Export.html#acef912d1aff50f6cf2a88349634403bd" title="drop existing constraint">dropConstraint</a>($table, $this-&gt;conn-&gt;formatter-&gt;getForeignKeyName($name));
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153 
<a name="l00163"></a><a class="code" href="classDoctrine__Export.html#a85392126769dcfde754ebfde80344830">00163</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a85392126769dcfde754ebfde80344830" title="dropSequenceSql drop existing sequence (this method is implemented by the drivers)...">dropSequence</a>($sequenceName)
<a name="l00164"></a>00164     {
<a name="l00165"></a>00165         $this-&gt;conn-&gt;exec($this-&gt;<a class="code" href="classDoctrine__Export.html#a98b755c8c84cbae28be8ca52ceda52d9" title="dropSequenceSql drop existing sequence">dropSequenceSql</a>($sequenceName));
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 
<a name="l00176"></a><a class="code" href="classDoctrine__Export.html#a98b755c8c84cbae28be8ca52ceda52d9">00176</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a98b755c8c84cbae28be8ca52ceda52d9" title="dropSequenceSql drop existing sequence">dropSequenceSql</a>($sequenceName)
<a name="l00177"></a>00177     {
<a name="l00178"></a>00178         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;Drop sequence not supported by this driver.&#39;</span>);
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00188"></a><a class="code" href="classDoctrine__Export.html#aa6a66a7d906bfc94e57c57299f95ac53">00188</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#aa6a66a7d906bfc94e57c57299f95ac53" title="create a new database (this method is implemented by the drivers)">createDatabase</a>($database)
<a name="l00189"></a>00189     {
<a name="l00190"></a>00190         $this-&gt;conn-&gt;execute($this-&gt;<a class="code" href="classDoctrine__Export.html#a982d71370b919fd0531e6ddd15c4d579" title="create a new database (this method is implemented by the drivers)">createDatabaseSql</a>($database));
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00200"></a><a class="code" href="classDoctrine__Export.html#a982d71370b919fd0531e6ddd15c4d579">00200</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a982d71370b919fd0531e6ddd15c4d579" title="create a new database (this method is implemented by the drivers)">createDatabaseSql</a>($database)
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;Create database not supported by this driver.&#39;</span>);
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 
<a name="l00233"></a><a class="code" href="classDoctrine__Export.html#a0f99c8a22eae5d34a63f6d7cb530db78">00233</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a0f99c8a22eae5d34a63f6d7cb530db78" title="create a new table">createTableSql</a>($name, array $fields, array $options = array())
<a name="l00234"></a>00234     {
<a name="l00235"></a>00235         <span class="keywordflow">if</span> ( ! $name) {
<a name="l00236"></a>00236             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;no valid table name specified&#39;</span>);
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (empty($fields)) {
<a name="l00240"></a>00240             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;no fields specified for table &#39;</span> . $name);
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         $queryFields = $this-&gt;<a class="code" href="classDoctrine__Export.html#ae15e0ddf6a9d6e297c46fad8944fb52d" title="Get declaration of a number of field in bulk.">getFieldDeclarationList</a>($fields);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;primary&#39;</span>]) &amp;&amp; ! empty($options[<span class="stringliteral">&#39;primary&#39;</span>])) {
<a name="l00247"></a>00247             $primaryKeys = array_map(array($this-&gt;conn, <span class="stringliteral">&#39;quoteIdentifier&#39;</span>), array_values($options[<span class="stringliteral">&#39;primary&#39;</span>]));
<a name="l00248"></a>00248             $queryFields .= <span class="stringliteral">&#39;, PRIMARY KEY(&#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $primaryKeys) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;indexes&#39;</span>]) &amp;&amp; ! empty($options[<span class="stringliteral">&#39;indexes&#39;</span>])) {
<a name="l00252"></a>00252             <span class="keywordflow">foreach</span>($options[<span class="stringliteral">&#39;indexes&#39;</span>] as $index =&gt; $definition) {
<a name="l00253"></a>00253                 $indexDeclaration = $this-&gt;<a class="code" href="classDoctrine__Export.html#a5c27f111642f0697e7f3b7ab01ed46c6" title="Obtain DBMS specific SQL code portion needed to set an index declaration to be used...">getIndexDeclaration</a>($index, $definition);
<a name="l00254"></a>00254                 <span class="comment">// append only created index declarations</span>
<a name="l00255"></a>00255                 <span class="keywordflow">if</span> ( ! is_null($indexDeclaration)) {
<a name="l00256"></a>00256                     $queryFields .= <span class="stringliteral">&#39;, &#39;</span>.$indexDeclaration;
<a name="l00257"></a>00257                 } 
<a name="l00258"></a>00258             }
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         $query = <span class="stringliteral">&#39;CREATE TABLE &#39;</span> . $this-&gt;conn-&gt;quoteIdentifier($name, <span class="keyword">true</span>) . <span class="stringliteral">&#39; (&#39;</span> . $queryFields;
<a name="l00262"></a>00262         
<a name="l00263"></a>00263         $check = $this-&gt;<a class="code" href="classDoctrine__Export.html#a8f21e68c76623c450d33e37ab2a7bd35" title="Obtain DBMS specific SQL code portion needed to set a CHECK constraint declaration...">getCheckDeclaration</a>($fields);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">if</span> ( ! empty($check)) {
<a name="l00266"></a>00266             $query .= <span class="stringliteral">&#39;, &#39;</span> . $check;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         $query .= <span class="charliteral">&#39;)&#39;</span>;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         $sql[] = $query;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;foreignKeys&#39;</span>])) {
<a name="l00274"></a>00274 
<a name="l00275"></a>00275             <span class="keywordflow">foreach</span> ((array) $options[<span class="stringliteral">&#39;foreignKeys&#39;</span>] as $k =&gt; $definition) {
<a name="l00276"></a>00276                 <span class="keywordflow">if</span> (is_array($definition)) {
<a name="l00277"></a>00277                     $sql[] = $this-&gt;<a class="code" href="classDoctrine__Export.html#a1354224500138f0e1874c25ef59045e6" title="createForeignKeySql">createForeignKeySql</a>($name, $definition);
<a name="l00278"></a>00278                 }
<a name="l00279"></a>00279             }
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         <span class="keywordflow">return</span> $sql;
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00294"></a><a class="code" href="classDoctrine__Export.html#a5031a510a74499623317cbe03dd561b3">00294</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a5031a510a74499623317cbe03dd561b3" title="create a new table">createTable</a>($name, array $fields, array $options = array())
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296         <span class="comment">// Build array of the primary keys if any of the individual field definitions</span>
<a name="l00297"></a>00297         <span class="comment">// specify primary =&gt; true</span>
<a name="l00298"></a>00298         $count = 0;
<a name="l00299"></a>00299         <span class="keywordflow">foreach</span> ($fields as $fieldName =&gt; $field) {
<a name="l00300"></a>00300             <span class="keywordflow">if</span> (isset($field[<span class="stringliteral">&#39;primary&#39;</span>]) &amp;&amp; $field[<span class="stringliteral">&#39;primary&#39;</span>]) {
<a name="l00301"></a>00301                 <span class="keywordflow">if</span> ($count == 0) {
<a name="l00302"></a>00302                     $options[<span class="stringliteral">&#39;primary&#39;</span>] = array();
<a name="l00303"></a>00303                 }
<a name="l00304"></a>00304                 $count++;
<a name="l00305"></a>00305                 $options[<span class="stringliteral">&#39;primary&#39;</span>][] = $fieldName;
<a name="l00306"></a>00306             }
<a name="l00307"></a>00307         }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309         $sql = (array) $this-&gt;<a class="code" href="classDoctrine__Export.html#a0f99c8a22eae5d34a63f6d7cb530db78" title="create a new table">createTableSql</a>($name, $fields, $options);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="keywordflow">foreach</span> ($sql as $query) {
<a name="l00312"></a>00312             $this-&gt;conn-&gt;execute($query);
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 
<a name="l00330"></a><a class="code" href="classDoctrine__Export.html#a4e5b42b5a47b6adb071cf473a1672d6a">00330</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a4e5b42b5a47b6adb071cf473a1672d6a" title="create sequence">createSequence</a>($seqName, $start = 1, array $options = array())
<a name="l00331"></a>00331     {
<a name="l00332"></a>00332         <span class="keywordflow">return</span> $this-&gt;conn-&gt;execute($this-&gt;<a class="code" href="classDoctrine__Export.html#adc38a73754c79b47501a1e8ba6a97c71" title="return RDBMS specific create sequence statement (this method is implemented by the...">createSequenceSql</a>($seqName, $start = 1, $options));
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 
<a name="l00350"></a><a class="code" href="classDoctrine__Export.html#adc38a73754c79b47501a1e8ba6a97c71">00350</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#adc38a73754c79b47501a1e8ba6a97c71" title="return RDBMS specific create sequence statement (this method is implemented by the...">createSequenceSql</a>($seqName, $start = 1, array $options = array())
<a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;Create sequence not supported by this driver.&#39;</span>);
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 
<a name="l00376"></a><a class="code" href="classDoctrine__Export.html#a1b07ea787299563fac63f034b923f223">00376</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a1b07ea787299563fac63f034b923f223" title="create a constraint on a table">createConstraint</a>($table, $name, $definition)
<a name="l00377"></a>00377     {
<a name="l00378"></a>00378         $sql = $this-&gt;<a class="code" href="classDoctrine__Export.html#a82dcfeca68de620cdf6a422adf610a36" title="create a constraint on a table">createConstraintSql</a>($table, $name, $definition);
<a name="l00379"></a>00379         
<a name="l00380"></a>00380         <span class="keywordflow">return</span> $this-&gt;conn-&gt;exec($sql);
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00404"></a><a class="code" href="classDoctrine__Export.html#a82dcfeca68de620cdf6a422adf610a36">00404</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a82dcfeca68de620cdf6a422adf610a36" title="create a constraint on a table">createConstraintSql</a>($table, $name, $definition)
<a name="l00405"></a>00405     {
<a name="l00406"></a>00406         $table = $this-&gt;conn-&gt;quoteIdentifier($table);
<a name="l00407"></a>00407         $name  = $this-&gt;conn-&gt;quoteIdentifier($this-&gt;conn-&gt;formatter-&gt;getIndexName($name));
<a name="l00408"></a>00408         $query = <span class="stringliteral">&#39;ALTER TABLE &#39;</span> . $table . <span class="stringliteral">&#39; ADD CONSTRAINT &#39;</span> . $name;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;primary&#39;</span>]) &amp;&amp; $definition[<span class="stringliteral">&#39;primary&#39;</span>]) {
<a name="l00411"></a>00411             $query .= <span class="stringliteral">&#39; PRIMARY KEY&#39;</span>;
<a name="l00412"></a>00412         } elseif (isset($definition[<span class="stringliteral">&#39;unique&#39;</span>]) &amp;&amp; $definition[<span class="stringliteral">&#39;unique&#39;</span>]) {
<a name="l00413"></a>00413             $query .= <span class="stringliteral">&#39; UNIQUE&#39;</span>;
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         $fields = array();
<a name="l00417"></a>00417         <span class="keywordflow">foreach</span> (array_keys($definition[<span class="stringliteral">&#39;fields&#39;</span>]) as $field) {
<a name="l00418"></a>00418             $fields[] = $this-&gt;conn-&gt;quoteIdentifier($field, <span class="keyword">true</span>);
<a name="l00419"></a>00419         }
<a name="l00420"></a>00420         $query .= <span class="stringliteral">&#39; (&#39;</span>. implode(<span class="stringliteral">&#39;, &#39;</span>, $fields) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         <span class="keywordflow">return</span> $query;
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424 
<a name="l00456"></a><a class="code" href="classDoctrine__Export.html#addbf9e0b032051a3e2d9907a71378f40">00456</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#addbf9e0b032051a3e2d9907a71378f40" title="Get the stucture of a field into an array.">createIndex</a>($table, $name, array $definition)
<a name="l00457"></a>00457     {
<a name="l00458"></a>00458         <span class="keywordflow">return</span> $this-&gt;conn-&gt;execute($this-&gt;<a class="code" href="classDoctrine__Export.html#afb5f8a3436c0a389a5c167e53a59937e" title="Get the stucture of a field into an array.">createIndexSql</a>($table, $name, $definition));
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460 
<a name="l00470"></a><a class="code" href="classDoctrine__Export.html#afb5f8a3436c0a389a5c167e53a59937e">00470</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#afb5f8a3436c0a389a5c167e53a59937e" title="Get the stucture of a field into an array.">createIndexSql</a>($table, $name, array $definition)
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472         $table  = $this-&gt;conn-&gt;quoteIdentifier($table);
<a name="l00473"></a>00473         $name   = $this-&gt;conn-&gt;quoteIdentifier($name);
<a name="l00474"></a>00474         $type   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00475"></a>00475         
<a name="l00476"></a>00476         <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l00477"></a>00477             <span class="keywordflow">switch</span> (strtolower($definition[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l00478"></a>00478                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;unique&#39;</span>:
<a name="l00479"></a>00479                     $type = strtoupper($definition[<span class="stringliteral">&#39;type&#39;</span>]) . <span class="charliteral">&#39; &#39;</span>;
<a name="l00480"></a>00480                 <span class="keywordflow">break</span>;
<a name="l00481"></a>00481                 <span class="keywordflow">default</span>:
<a name="l00482"></a>00482                     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(
<a name="l00483"></a>00483                         <span class="stringliteral">&#39;Unknown type &#39;</span> . $definition[<span class="stringliteral">&#39;type&#39;</span>] . <span class="stringliteral">&#39; for index &#39;</span> . $name . <span class="stringliteral">&#39; in table &#39;</span> . $table
<a name="l00484"></a>00484                     );
<a name="l00485"></a>00485             }
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         $query = <span class="stringliteral">&#39;CREATE &#39;</span> . $type . <span class="stringliteral">&#39;INDEX &#39;</span> . $name . <span class="stringliteral">&#39; ON &#39;</span> . $table;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         $fields = array();
<a name="l00491"></a>00491         <span class="keywordflow">foreach</span> ($definition[<span class="stringliteral">&#39;fields&#39;</span>] as $field) {
<a name="l00492"></a>00492             $fields[] = $this-&gt;conn-&gt;quoteIdentifier($field);
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494         $query .= <span class="stringliteral">&#39; (&#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $fields) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="keywordflow">return</span> $query;
<a name="l00497"></a>00497     }    
<a name="l00505"></a><a class="code" href="classDoctrine__Export.html#a1354224500138f0e1874c25ef59045e6">00505</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a1354224500138f0e1874c25ef59045e6" title="createForeignKeySql">createForeignKeySql</a>($table, array $definition)
<a name="l00506"></a>00506     {
<a name="l00507"></a>00507         $table = $this-&gt;conn-&gt;quoteIdentifier($table);
<a name="l00508"></a>00508         $query = <span class="stringliteral">&#39;ALTER TABLE &#39;</span> . $table . <span class="stringliteral">&#39; ADD &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Export.html#a8eb7b5096e5d37a0540b80455660a7a2" title="getForeignKeyDeclaration Obtain DBMS specific SQL code portion needed to set the...">getForeignKeyDeclaration</a>($definition);
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordflow">return</span> $query;
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512 
<a name="l00520"></a><a class="code" href="classDoctrine__Export.html#a75d9ba1cb0cd1c7aaf73b6d572fa3852">00520</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a75d9ba1cb0cd1c7aaf73b6d572fa3852" title="createForeignKey">createForeignKey</a>($table, array $definition)
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522         $sql = $this-&gt;<a class="code" href="classDoctrine__Export.html#a1354224500138f0e1874c25ef59045e6" title="createForeignKeySql">createForeignKeySql</a>($table, $definition);
<a name="l00523"></a>00523         
<a name="l00524"></a>00524         <span class="keywordflow">return</span> $this-&gt;conn-&gt;execute($sql);
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00616"></a><a class="code" href="classDoctrine__Export.html#a5103976532f2c612187142c90cfee700">00616</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a5103976532f2c612187142c90cfee700" title="alter an existing table (this method is implemented by the drivers)">alterTable</a>($name, array $changes, $check = <span class="keyword">false</span>)
<a name="l00617"></a>00617     {
<a name="l00618"></a>00618         $sql = $this-&gt;<a class="code" href="classDoctrine__Export.html#a2a4c7cb5d21adac25fdcd6d4743711bb" title="generates the sql for altering an existing table (this method is implemented by the...">alterTableSql</a>($name, $changes, $check);
<a name="l00619"></a>00619         
<a name="l00620"></a>00620         <span class="keywordflow">if</span> (is_string($sql) &amp;&amp; $sql) {
<a name="l00621"></a>00621             $this-&gt;conn-&gt;execute($sql);
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624 
<a name="l00637"></a><a class="code" href="classDoctrine__Export.html#a2a4c7cb5d21adac25fdcd6d4743711bb">00637</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a2a4c7cb5d21adac25fdcd6d4743711bb" title="generates the sql for altering an existing table (this method is implemented by the...">alterTableSql</a>($name, array $changes, $check = <span class="keyword">false</span>)
<a name="l00638"></a>00638     {
<a name="l00639"></a>00639         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;Alter table not supported by this driver.&#39;</span>);
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641 
<a name="l00671"></a><a class="code" href="classDoctrine__Export.html#ae15e0ddf6a9d6e297c46fad8944fb52d">00671</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#ae15e0ddf6a9d6e297c46fad8944fb52d" title="Get declaration of a number of field in bulk.">getFieldDeclarationList</a>(array $fields)
<a name="l00672"></a>00672     {
<a name="l00673"></a>00673         <span class="keywordflow">foreach</span> ($fields as $fieldName =&gt; $field) {
<a name="l00674"></a>00674             $query = $this-&gt;<a class="code" href="classDoctrine__Export.html#a1693bf92cd94dea86068e279fc04201d" title="Obtain DBMS specific SQL code portion needed to declare a generic type field to be...">getDeclaration</a>($fieldName, $field);
<a name="l00675"></a>00675 
<a name="l00676"></a>00676             $queryFields[] = $query;
<a name="l00677"></a>00677         }
<a name="l00678"></a>00678         <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>, $queryFields);
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680 
<a name="l00717"></a><a class="code" href="classDoctrine__Export.html#a1693bf92cd94dea86068e279fc04201d">00717</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a1693bf92cd94dea86068e279fc04201d" title="Obtain DBMS specific SQL code portion needed to declare a generic type field to be...">getDeclaration</a>($name, array $field)
<a name="l00718"></a>00718     {
<a name="l00719"></a>00719 
<a name="l00720"></a>00720         $default   = $this-&gt;<a class="code" href="classDoctrine__Export.html#ae299d416d9bcc460cbb56fd7718e70e7" title="getDefaultDeclaration Obtain DBMS specific SQL code portion needed to set a default...">getDefaultFieldDeclaration</a>($field);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722         $charset   = (isset($field[<span class="stringliteral">&#39;charset&#39;</span>]) &amp;&amp; $field[<span class="stringliteral">&#39;charset&#39;</span>]) ?
<a name="l00723"></a>00723                     <span class="charliteral">&#39; &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Export.html#abf4f8e92f6e2abe539d25ceb2b5cc9dd" title="Obtain DBMS specific SQL code portion needed to set the CHARACTER SET of a field...">getCharsetFieldDeclaration</a>($field[<span class="stringliteral">&#39;charset&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         $collation = (isset($field[<span class="stringliteral">&#39;collation&#39;</span>]) &amp;&amp; $field[<span class="stringliteral">&#39;collation&#39;</span>]) ?
<a name="l00726"></a>00726                     <span class="charliteral">&#39; &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Export.html#aca286451e3a5d9ba76500320955cdae8" title="Obtain DBMS specific SQL code portion needed to set the COLLATION of a field declaration...">getCollationFieldDeclaration</a>($field[<span class="stringliteral">&#39;collation&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728         $notnull   = $this-&gt;<a class="code" href="classDoctrine__Export.html#ad1550d027d681b287eb86ac90fff32d0" title="getNotNullFieldDeclaration Obtain DBMS specific SQL code portion needed to set a...">getNotNullFieldDeclaration</a>($field);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         $unique    = (isset($field[<span class="stringliteral">&#39;unique&#39;</span>]) &amp;&amp; $field[<span class="stringliteral">&#39;unique&#39;</span>]) ?
<a name="l00731"></a>00731                     <span class="charliteral">&#39; &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Export.html#ab275af6463212853cf1f7e468f552779" title="Obtain DBMS specific SQL code portion needed to set the UNIQUE constraint of a field...">getUniqueFieldDeclaration</a>() : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733         $check     = (isset($field[<span class="stringliteral">&#39;check&#39;</span>]) &amp;&amp; $field[<span class="stringliteral">&#39;check&#39;</span>]) ?
<a name="l00734"></a>00734                     <span class="charliteral">&#39; &#39;</span> . $field[<span class="stringliteral">&#39;check&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         $method = <span class="stringliteral">&#39;get&#39;</span> . $field[<span class="stringliteral">&#39;type&#39;</span>] . <span class="stringliteral">&#39;Declaration&#39;</span>;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         <span class="keywordflow">try</span> {
<a name="l00739"></a>00739             <span class="keywordflow">if</span> (method_exists($this-&gt;conn-&gt;dataDict, $method)) {
<a name="l00740"></a>00740                 <span class="keywordflow">return</span> $this-&gt;conn-&gt;dataDict-&gt;$method($name, $field);
<a name="l00741"></a>00741             } <span class="keywordflow">else</span> {
<a name="l00742"></a>00742                 $dec = $this-&gt;conn-&gt;dataDict-&gt;getNativeDeclaration($field);
<a name="l00743"></a>00743             }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745             <span class="keywordflow">return</span> $this-&gt;conn-&gt;quoteIdentifier($name, <span class="keyword">true</span>)
<a name="l00746"></a>00746                  . <span class="charliteral">&#39; &#39;</span> . $dec . $charset . $default . $notnull . $unique . $check . $collation;
<a name="l00747"></a>00747         } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00748"></a>00748             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Exception.html">Doctrine_Exception</a>(<span class="stringliteral">&#39;Around field &#39;</span> . $name . <span class="stringliteral">&#39;: &#39;</span> . $e-&gt;getMessage());
<a name="l00749"></a>00749         }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     }
<a name="l00752"></a>00752 
<a name="l00761"></a><a class="code" href="classDoctrine__Export.html#ae299d416d9bcc460cbb56fd7718e70e7">00761</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#ae299d416d9bcc460cbb56fd7718e70e7" title="getDefaultDeclaration Obtain DBMS specific SQL code portion needed to set a default...">getDefaultFieldDeclaration</a>($field)
<a name="l00762"></a>00762     {
<a name="l00763"></a>00763         $default = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765         <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;default&#39;</span>, $field)) {
<a name="l00766"></a>00766             <span class="keywordflow">if</span> ($field[<span class="stringliteral">&#39;default&#39;</span>] === <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00767"></a>00767                 $field[<span class="stringliteral">&#39;default&#39;</span>] = empty($field[<span class="stringliteral">&#39;notnull&#39;</span>])
<a name="l00768"></a>00768                     ? null : $this-&gt;valid_default_values[$field[<span class="stringliteral">&#39;type&#39;</span>]];
<a name="l00769"></a>00769 
<a name="l00770"></a>00770                 <span class="keywordflow">if</span> ($field[<span class="stringliteral">&#39;default&#39;</span>] === <span class="stringliteral">&#39;&#39;</span> &amp;&amp;
<a name="l00771"></a>00771                    ($this-&gt;conn-&gt;getAttribute(Doctrine_Core::ATTR_PORTABILITY) &amp; <a class="code" href="classDoctrine__Core.html#a77b44584e283186b6ff6b69072f245cd" title="Portability: convert empty values to null strings in data output by query*() and...">Doctrine_Core::PORTABILITY_EMPTY_TO_NULL</a>)) {
<a name="l00772"></a>00772                     $field[<span class="stringliteral">&#39;default&#39;</span>] = null;
<a name="l00773"></a>00773                 }
<a name="l00774"></a>00774             }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776             <span class="keywordflow">if</span> ($field[<span class="stringliteral">&#39;type&#39;</span>] === <span class="stringliteral">&#39;boolean&#39;</span>) {
<a name="l00777"></a>00777                 $field[<span class="stringliteral">&#39;default&#39;</span>] = $this-&gt;conn-&gt;convertBooleans($field[<span class="stringliteral">&#39;default&#39;</span>]);
<a name="l00778"></a>00778             }
<a name="l00779"></a>00779             $default = <span class="stringliteral">&#39; DEFAULT &#39;</span> . (is_null($field[<span class="stringliteral">&#39;default&#39;</span>])
<a name="l00780"></a>00780                 ? <span class="stringliteral">&#39;NULL&#39;</span>
<a name="l00781"></a>00781                 : $this-&gt;conn-&gt;quote($field[<span class="stringliteral">&#39;default&#39;</span>], $field[<span class="stringliteral">&#39;type&#39;</span>]));
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784         <span class="keywordflow">return</span> $default;
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786     
<a name="l00787"></a>00787 
<a name="l00796"></a><a class="code" href="classDoctrine__Export.html#ad1550d027d681b287eb86ac90fff32d0">00796</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#ad1550d027d681b287eb86ac90fff32d0" title="getNotNullFieldDeclaration Obtain DBMS specific SQL code portion needed to set a...">getNotNullFieldDeclaration</a>(array $definition)
<a name="l00797"></a>00797     {
<a name="l00798"></a>00798         <span class="keywordflow">return</span> (isset($definition[<span class="stringliteral">&#39;notnull&#39;</span>]) &amp;&amp; $definition[<span class="stringliteral">&#39;notnull&#39;</span>]) ? <span class="stringliteral">&#39; NOT NULL&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800     
<a name="l00801"></a>00801 
<a name="l00809"></a><a class="code" href="classDoctrine__Export.html#a8f21e68c76623c450d33e37ab2a7bd35">00809</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a8f21e68c76623c450d33e37ab2a7bd35" title="Obtain DBMS specific SQL code portion needed to set a CHECK constraint declaration...">getCheckDeclaration</a>(array $definition)
<a name="l00810"></a>00810     {
<a name="l00811"></a>00811         $constraints = array();
<a name="l00812"></a>00812         <span class="keywordflow">foreach</span> ($definition as $field =&gt; $def) {
<a name="l00813"></a>00813             <span class="keywordflow">if</span> (is_string($def)) {
<a name="l00814"></a>00814                 $constraints[] = <span class="stringliteral">&#39;CHECK (&#39;</span> . $def . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00815"></a>00815             } <span class="keywordflow">else</span> {
<a name="l00816"></a>00816                 <span class="keywordflow">if</span> (isset($def[<span class="stringliteral">&#39;min&#39;</span>])) {
<a name="l00817"></a>00817                     $constraints[] = <span class="stringliteral">&#39;CHECK (&#39;</span> . $field . <span class="stringliteral">&#39; &gt;= &#39;</span> . $def[<span class="stringliteral">&#39;min&#39;</span>] . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00818"></a>00818                 }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820                 <span class="keywordflow">if</span> (isset($def[<span class="stringliteral">&#39;max&#39;</span>])) {
<a name="l00821"></a>00821                     $constraints[] = <span class="stringliteral">&#39;CHECK (&#39;</span> . $field . <span class="stringliteral">&#39; &lt;= &#39;</span> . $def[<span class="stringliteral">&#39;max&#39;</span>] . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00822"></a>00822                 }
<a name="l00823"></a>00823             }
<a name="l00824"></a>00824         }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>, $constraints);
<a name="l00827"></a>00827     }
<a name="l00828"></a>00828 
<a name="l00837"></a><a class="code" href="classDoctrine__Export.html#a5c27f111642f0697e7f3b7ab01ed46c6">00837</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a5c27f111642f0697e7f3b7ab01ed46c6" title="Obtain DBMS specific SQL code portion needed to set an index declaration to be used...">getIndexDeclaration</a>($name, array $definition)
<a name="l00838"></a>00838     {
<a name="l00839"></a>00839         $name   = $this-&gt;conn-&gt;quoteIdentifier($name);
<a name="l00840"></a>00840         $type   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842         <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l00843"></a>00843             <span class="keywordflow">if</span> (strtolower($definition[<span class="stringliteral">&#39;type&#39;</span>]) == <span class="stringliteral">&#39;unique&#39;</span>) {
<a name="l00844"></a>00844                 $type = strtoupper($definition[<span class="stringliteral">&#39;type&#39;</span>]) . <span class="charliteral">&#39; &#39;</span>;
<a name="l00845"></a>00845             } <span class="keywordflow">else</span> {
<a name="l00846"></a>00846                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(
<a name="l00847"></a>00847                     <span class="stringliteral">&#39;Unknown type &#39;</span> . $definition[<span class="stringliteral">&#39;type&#39;</span>] . <span class="stringliteral">&#39; for index &#39;</span> . $name
<a name="l00848"></a>00848                 );
<a name="l00849"></a>00849             }
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852         <span class="keywordflow">if</span> ( ! isset($definition[<span class="stringliteral">&#39;fields&#39;</span>]) || ! is_array($definition[<span class="stringliteral">&#39;fields&#39;</span>])) {
<a name="l00853"></a>00853             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;No columns given for index &#39;</span> . $name);
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856         $query = $type . <span class="stringliteral">&#39;INDEX &#39;</span> . $name;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         $query .= <span class="stringliteral">&#39; (&#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Export.html#abb06e6b5b12132060aef1d46b79c9187" title="getIndexFieldDeclarationList Obtain DBMS specific SQL code portion needed to set...">getIndexFieldDeclarationList</a>($definition[<span class="stringliteral">&#39;fields&#39;</span>]) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00859"></a>00859 
<a name="l00860"></a>00860         <span class="keywordflow">return</span> $query;
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862 
<a name="l00870"></a><a class="code" href="classDoctrine__Export.html#abb06e6b5b12132060aef1d46b79c9187">00870</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#abb06e6b5b12132060aef1d46b79c9187" title="getIndexFieldDeclarationList Obtain DBMS specific SQL code portion needed to set...">getIndexFieldDeclarationList</a>(array $fields)
<a name="l00871"></a>00871     {
<a name="l00872"></a>00872         $ret = array();
<a name="l00873"></a>00873         <span class="keywordflow">foreach</span> ($fields as $field =&gt; $definition) {
<a name="l00874"></a>00874             <span class="keywordflow">if</span> (is_array($definition)) {
<a name="l00875"></a>00875                 $ret[] = $this-&gt;conn-&gt;quoteIdentifier($field);
<a name="l00876"></a>00876             } <span class="keywordflow">else</span> {
<a name="l00877"></a>00877                 $ret[] = $this-&gt;conn-&gt;quoteIdentifier($definition);
<a name="l00878"></a>00878             }
<a name="l00879"></a>00879         }
<a name="l00880"></a>00880         <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>, $ret);
<a name="l00881"></a>00881     }
<a name="l00882"></a>00882 
<a name="l00897"></a><a class="code" href="classDoctrine__Export.html#a90b4ac50d3f8f254a81512bdb8a1231e">00897</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a90b4ac50d3f8f254a81512bdb8a1231e" title="A method to return the required SQL string that fits between CREATE .">getTemporaryTableQuery</a>()
<a name="l00898"></a>00898     {
<a name="l00899"></a>00899         <span class="keywordflow">return</span> <span class="stringliteral">&#39;TEMPORARY&#39;</span>;
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901 
<a name="l00944"></a><a class="code" href="classDoctrine__Export.html#a8eb7b5096e5d37a0540b80455660a7a2">00944</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a8eb7b5096e5d37a0540b80455660a7a2" title="getForeignKeyDeclaration Obtain DBMS specific SQL code portion needed to set the...">getForeignKeyDeclaration</a>(array $definition)
<a name="l00945"></a>00945     {
<a name="l00946"></a>00946         $sql  = $this-&gt;<a class="code" href="classDoctrine__Export.html#a1b44afa7c435891e1e90e49f0aedeaca" title="getForeignKeyBaseDeclaration Obtain DBMS specific SQL code portion needed to set...">getForeignKeyBaseDeclaration</a>($definition);
<a name="l00947"></a>00947         $sql .= $this-&gt;<a class="code" href="classDoctrine__Export.html#a9953a12eb91bbc0ef6a3cf9982d11f6e" title="getAdvancedForeignKeyOptions Return the FOREIGN KEY query section dealing with non-standard...">getAdvancedForeignKeyOptions</a>($definition);
<a name="l00948"></a>00948 
<a name="l00949"></a>00949         <span class="keywordflow">return</span> $sql;
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951 
<a name="l00960"></a><a class="code" href="classDoctrine__Export.html#a9953a12eb91bbc0ef6a3cf9982d11f6e">00960</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#a9953a12eb91bbc0ef6a3cf9982d11f6e" title="getAdvancedForeignKeyOptions Return the FOREIGN KEY query section dealing with non-standard...">getAdvancedForeignKeyOptions</a>(array $definition)
<a name="l00961"></a>00961     {
<a name="l00962"></a>00962         $query = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00963"></a>00963         <span class="keywordflow">if</span> ( ! empty($definition[<span class="stringliteral">&#39;onUpdate&#39;</span>])) {
<a name="l00964"></a>00964             $query .= <span class="stringliteral">&#39; ON UPDATE &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Export.html#acd1770683a14662d68064a2356a48d8e" title="getForeignKeyReferentialAction">getForeignKeyReferentialAction</a>($definition[<span class="stringliteral">&#39;onUpdate&#39;</span>]);
<a name="l00965"></a>00965         }
<a name="l00966"></a>00966         <span class="keywordflow">if</span> ( ! empty($definition[<span class="stringliteral">&#39;onDelete&#39;</span>])) {
<a name="l00967"></a>00967             $query .= <span class="stringliteral">&#39; ON DELETE &#39;</span> . $this-&gt;<a class="code" href="classDoctrine__Export.html#acd1770683a14662d68064a2356a48d8e" title="getForeignKeyReferentialAction">getForeignKeyReferentialAction</a>($definition[<span class="stringliteral">&#39;onDelete&#39;</span>]);
<a name="l00968"></a>00968         }
<a name="l00969"></a>00969         <span class="keywordflow">return</span> $query;
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971 
<a name="l00982"></a><a class="code" href="classDoctrine__Export.html#acd1770683a14662d68064a2356a48d8e">00982</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Export.html#acd1770683a14662d68064a2356a48d8e" title="getForeignKeyReferentialAction">getForeignKeyReferentialAction</a>($action)
<a name="l00983"></a>00983     {
<a name="l00984"></a>00984         $upper = strtoupper($action);
<a name="l00985"></a>00985         <span class="keywordflow">switch</span> ($upper) {
<a name="l00986"></a>00986             <span class="keywordflow">case</span> <span class="stringliteral">&#39;CASCADE&#39;</span>:
<a name="l00987"></a>00987             <span class="keywordflow">case</span> <span class="stringliteral">&#39;SET NULL&#39;</span>:
<a name="l00988"></a>00988             <span class="keywordflow">case</span> <span class="stringliteral">&#39;NO ACTION&#39;</span>:
<a name="l00989"></a>00989             <span class="keywordflow">case</span> <span class="stringliteral">&#39;RESTRICT&#39;</span>:
<a name="l00990"></a>00990             <span class="keywordflow">case</span> <span class="stringliteral">&#39;SET DEFAULT&#39;</span>:
<a name="l00991"></a>00991                 <span class="keywordflow">return</span> $upper;
<a name="l00992"></a>00992             <span class="keywordflow">break</span>;
<a name="l00993"></a>00993             <span class="keywordflow">default</span>:
<a name="l00994"></a>00994                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Export__Exception.html">Doctrine_Export_Exception</a>(<span class="stringliteral">&#39;Unknown foreign key referential action \&#39;&#39;</span> . $upper . <span class="charliteral">&#39;\&#39;</span> given.<span class="stringliteral">&#39;);</span>
<a name="l00995"></a>00995 <span class="stringliteral">        }</span>
<a name="l00996"></a>00996 <span class="stringliteral">    }</span>
<a name="l00997"></a>00997 <span class="stringliteral"></span>
<a name="l01006"></a><a class="code" href="classDoctrine__Export.html#a1b44afa7c435891e1e90e49f0aedeaca">01006</a> <span class="stringliteral">    public function getForeignKeyBaseDeclaration(array $definition)</span>
<a name="l01007"></a>01007 <span class="stringliteral">    {</span>
<a name="l01008"></a>01008 <span class="stringliteral">        $sql = &#39;</span><span class="stringliteral">&#39;;</span>
<a name="l01009"></a>01009 <span class="stringliteral">        if (isset($definition[&#39;</span>name<span class="stringliteral">&#39;])) {</span>
<a name="l01010"></a>01010 <span class="stringliteral">            $sql .= &#39;</span>CONSTRAINT <span class="stringliteral">&#39; . $this-&gt;conn-&gt;quoteIdentifier($this-&gt;conn-&gt;formatter-&gt;getForeignKeyName($definition[&#39;</span>name<span class="stringliteral">&#39;])) . &#39;</span> <span class="stringliteral">&#39;;</span>
<a name="l01011"></a>01011 <span class="stringliteral">        }</span>
<a name="l01012"></a>01012 <span class="stringliteral">        $sql .= &#39;</span>FOREIGN KEY (<span class="stringliteral">&#39;;</span>
<a name="l01013"></a>01013 <span class="stringliteral"></span>
<a name="l01014"></a>01014 <span class="stringliteral">        if ( ! isset($definition[&#39;</span>local<span class="stringliteral">&#39;])) {</span>
<a name="l01015"></a>01015 <span class="stringliteral">            throw new Doctrine_Export_Exception(&#39;</span>Local reference field missing from definition.<span class="stringliteral">&#39;);</span>
<a name="l01016"></a>01016 <span class="stringliteral">        }</span>
<a name="l01017"></a>01017 <span class="stringliteral">        if ( ! isset($definition[&#39;</span>foreign<span class="stringliteral">&#39;])) {</span>
<a name="l01018"></a>01018 <span class="stringliteral">            throw new Doctrine_Export_Exception(&#39;</span>Foreign reference field missing from definition.<span class="stringliteral">&#39;);</span>
<a name="l01019"></a>01019 <span class="stringliteral">        }</span>
<a name="l01020"></a>01020 <span class="stringliteral">        if ( ! isset($definition[&#39;</span>foreignTable<span class="stringliteral">&#39;])) {</span>
<a name="l01021"></a>01021 <span class="stringliteral">            throw new Doctrine_Export_Exception(&#39;</span>Foreign reference table missing from definition.<span class="stringliteral">&#39;);</span>
<a name="l01022"></a>01022 <span class="stringliteral">        }</span>
<a name="l01023"></a>01023 <span class="stringliteral"></span>
<a name="l01024"></a>01024 <span class="stringliteral">        if ( ! is_array($definition[&#39;</span>local<span class="stringliteral">&#39;])) {</span>
<a name="l01025"></a>01025 <span class="stringliteral">            $definition[&#39;</span>local<span class="stringliteral">&#39;] = array($definition[&#39;</span>local<span class="stringliteral">&#39;]);</span>
<a name="l01026"></a>01026 <span class="stringliteral">        }</span>
<a name="l01027"></a>01027 <span class="stringliteral">        if ( ! is_array($definition[&#39;</span>foreign<span class="stringliteral">&#39;])) {</span>
<a name="l01028"></a>01028 <span class="stringliteral">            $definition[&#39;</span>foreign<span class="stringliteral">&#39;] = array($definition[&#39;</span>foreign<span class="stringliteral">&#39;]);</span>
<a name="l01029"></a>01029 <span class="stringliteral">        }</span>
<a name="l01030"></a>01030 <span class="stringliteral"></span>
<a name="l01031"></a>01031 <span class="stringliteral">        $sql .= implode(&#39;</span>, <span class="stringliteral">&#39;, array_map(array($this-&gt;conn, &#39;</span>quoteIdentifier<span class="stringliteral">&#39;), $definition[&#39;</span>local<span class="stringliteral">&#39;]))</span>
<a name="l01032"></a>01032 <span class="stringliteral">              . &#39;</span>) REFERENCES <span class="stringliteral">&#39;</span>
<a name="l01033"></a>01033 <span class="stringliteral">              . $this-&gt;conn-&gt;quoteIdentifier($definition[&#39;</span>foreignTable<span class="stringliteral">&#39;]) . &#39;</span>(<span class="stringliteral">&#39;</span>
<a name="l01034"></a>01034 <span class="stringliteral">              . implode(&#39;</span>, <span class="stringliteral">&#39;, array_map(array($this-&gt;conn, &#39;</span>quoteIdentifier<span class="stringliteral">&#39;), $definition[&#39;</span>foreign<span class="stringliteral">&#39;])) . &#39;</span>)<span class="stringliteral">&#39;;</span>
<a name="l01035"></a>01035 <span class="stringliteral"></span>
<a name="l01036"></a>01036 <span class="stringliteral">        return $sql;</span>
<a name="l01037"></a>01037 <span class="stringliteral">    }</span>
<a name="l01038"></a>01038 <span class="stringliteral"></span>
<a name="l01046"></a><a class="code" href="classDoctrine__Export.html#ab275af6463212853cf1f7e468f552779">01046</a> <span class="stringliteral">    public function getUniqueFieldDeclaration()</span>
<a name="l01047"></a>01047 <span class="stringliteral">    {</span>
<a name="l01048"></a>01048 <span class="stringliteral">        return &#39;</span>UNIQUE<span class="stringliteral">&#39;;</span>
<a name="l01049"></a>01049 <span class="stringliteral">    }</span>
<a name="l01050"></a>01050 <span class="stringliteral"></span>
<a name="l01059"></a><a class="code" href="classDoctrine__Export.html#abf4f8e92f6e2abe539d25ceb2b5cc9dd">01059</a> <span class="stringliteral">    public function getCharsetFieldDeclaration($charset)</span>
<a name="l01060"></a>01060 <span class="stringliteral">    {</span>
<a name="l01061"></a>01061 <span class="stringliteral">        return &#39;</span><span class="stringliteral">&#39;;</span>
<a name="l01062"></a>01062 <span class="stringliteral">    }</span>
<a name="l01063"></a>01063 <span class="stringliteral"></span>
<a name="l01072"></a><a class="code" href="classDoctrine__Export.html#aca286451e3a5d9ba76500320955cdae8">01072</a> <span class="stringliteral">    public function getCollationFieldDeclaration($collation)</span>
<a name="l01073"></a>01073 <span class="stringliteral">    {</span>
<a name="l01074"></a>01074 <span class="stringliteral">        return &#39;</span><span class="stringliteral">&#39;;</span>
<a name="l01075"></a>01075 <span class="stringliteral">    }</span>
<a name="l01076"></a>01076 <span class="stringliteral"></span>
<a name="l01092"></a><a class="code" href="classDoctrine__Export.html#add6b8163022a428957dbbe47472c3e7d">01092</a> <span class="stringliteral">    public function exportSchema($directory = null)</span>
<a name="l01093"></a>01093 <span class="stringliteral">    {</span>
<a name="l01094"></a>01094 <span class="stringliteral">        if ($directory !== null) {</span>
<a name="l01095"></a>01095 <span class="stringliteral">            $models = Doctrine_Core::filterInvalidModels(Doctrine_Core::loadModels($directory));</span>
<a name="l01096"></a>01096 <span class="stringliteral">        } else {</span>
<a name="l01097"></a>01097 <span class="stringliteral">            $models = Doctrine_Core::getLoadedModels();</span>
<a name="l01098"></a>01098 <span class="stringliteral">        }</span>
<a name="l01099"></a>01099 <span class="stringliteral"></span>
<a name="l01100"></a>01100 <span class="stringliteral">        $this-&gt;exportClasses($models);</span>
<a name="l01101"></a>01101 <span class="stringliteral">    }</span>
<a name="l01102"></a>01102 <span class="stringliteral"></span>
<a name="l01103"></a>01103 <span class="stringliteral">    public function exportSortedClassesSql($classes, $groupByConnection = true)</span>
<a name="l01104"></a>01104 <span class="stringliteral">    {</span>
<a name="l01105"></a>01105 <span class="stringliteral">         $connections = array();</span>
<a name="l01106"></a>01106 <span class="stringliteral">         foreach ($classes as $class) {</span>
<a name="l01107"></a>01107 <span class="stringliteral">             $connection = Doctrine_Manager::getInstance()-&gt;getConnectionForComponent($class);</span>
<a name="l01108"></a>01108 <span class="stringliteral">             $connectionName = $connection-&gt;getName();</span>
<a name="l01109"></a>01109 <span class="stringliteral"></span>
<a name="l01110"></a>01110 <span class="stringliteral">             if ( ! isset($connections[$connectionName])) {</span>
<a name="l01111"></a>01111 <span class="stringliteral">                 $connections[$connectionName] = array(</span>
<a name="l01112"></a>01112 <span class="stringliteral">                     &#39;</span>create_tables<span class="stringliteral">&#39;    =&gt; array(),</span>
<a name="l01113"></a>01113 <span class="stringliteral">                     &#39;</span>create_sequences<span class="stringliteral">&#39; =&gt; array(),</span>
<a name="l01114"></a>01114 <span class="stringliteral">                     &#39;</span>create_indexes<span class="stringliteral">&#39;   =&gt; array(),</span>
<a name="l01115"></a>01115 <span class="stringliteral">                     &#39;</span>alters<span class="stringliteral">&#39;           =&gt; array(),</span>
<a name="l01116"></a>01116 <span class="stringliteral">                     &#39;</span>create_triggers<span class="stringliteral">&#39;  =&gt; array(),</span>
<a name="l01117"></a>01117 <span class="stringliteral">                 );</span>
<a name="l01118"></a>01118 <span class="stringliteral">             }</span>
<a name="l01119"></a>01119 <span class="stringliteral"></span>
<a name="l01120"></a>01120 <span class="stringliteral">             $sql = $connection-&gt;export-&gt;exportClassesSql(array($class));</span>
<a name="l01121"></a>01121 <span class="stringliteral"></span>
<a name="l01122"></a>01122 <span class="stringliteral">             // Build array of all the creates</span>
<a name="l01123"></a>01123 <span class="stringliteral">             // We need these to happen first</span>
<a name="l01124"></a>01124 <span class="stringliteral">             foreach ($sql as $key =&gt; $query) {</span>
<a name="l01125"></a>01125 <span class="stringliteral">                 // If create table statement</span>
<a name="l01126"></a>01126 <span class="stringliteral">                 if (substr($query, 0, strlen(&#39;</span>CREATE TABLE<span class="stringliteral">&#39;)) == &#39;</span>CREATE TABLE<span class="stringliteral">&#39;) {</span>
<a name="l01127"></a>01127 <span class="stringliteral">                     $connections[$connectionName][&#39;</span>create_tables<span class="stringliteral">&#39;][] = $query;</span>
<a name="l01128"></a>01128 <span class="stringliteral"></span>
<a name="l01129"></a>01129 <span class="stringliteral">                     unset($sql[$key]);</span>
<a name="l01130"></a>01130 <span class="stringliteral">                     continue;</span>
<a name="l01131"></a>01131 <span class="stringliteral">                 }</span>
<a name="l01132"></a>01132 <span class="stringliteral"></span>
<a name="l01133"></a>01133 <span class="stringliteral">                 // If create sequence statement</span>
<a name="l01134"></a>01134 <span class="stringliteral">                 if (substr($query, 0, strlen(&#39;</span>CREATE SEQUENCE<span class="stringliteral">&#39;)) == &#39;</span>CREATE SEQUENCE<span class="stringliteral">&#39;) {</span>
<a name="l01135"></a>01135 <span class="stringliteral">                     $connections[$connectionName][&#39;</span>create_sequences<span class="stringliteral">&#39;][] = $query;</span>
<a name="l01136"></a>01136 <span class="stringliteral"></span>
<a name="l01137"></a>01137 <span class="stringliteral">                     unset($sql[$key]);</span>
<a name="l01138"></a>01138 <span class="stringliteral">                     continue;</span>
<a name="l01139"></a>01139 <span class="stringliteral">                 }</span>
<a name="l01140"></a>01140 <span class="stringliteral"></span>
<a name="l01141"></a>01141 <span class="stringliteral">                 // If create index statement</span>
<a name="l01142"></a>01142 <span class="stringliteral">                 if (preg_grep(&quot;/CREATE ([^ ]* )?INDEX/&quot;, array($query))) {</span>
<a name="l01143"></a>01143 <span class="stringliteral">                     $connections[$connectionName][&#39;</span>create_indexes<span class="stringliteral">&#39;][] =  $query;</span>
<a name="l01144"></a>01144 <span class="stringliteral"></span>
<a name="l01145"></a>01145 <span class="stringliteral">                     unset($sql[$key]);</span>
<a name="l01146"></a>01146 <span class="stringliteral">                     continue;</span>
<a name="l01147"></a>01147 <span class="stringliteral">                 }</span>
<a name="l01148"></a>01148 <span class="stringliteral"></span>
<a name="l01149"></a>01149 <span class="stringliteral">                 // If alter table statement or oracle anonymous block enclosing alter</span>
<a name="l01150"></a>01150 <span class="stringliteral">                 if (substr($query, 0, strlen(&#39;</span>ALTER TABLE<span class="stringliteral">&#39;)) == &#39;</span>ALTER TABLE<span class="stringliteral">&#39;</span>
<a name="l01151"></a>01151 <span class="stringliteral">                       || substr($query, 0, strlen(&#39;</span>DECLARE<span class="stringliteral">&#39;)) == &#39;</span>DECLARE<span class="stringliteral">&#39;) {</span>
<a name="l01152"></a>01152 <span class="stringliteral">                     $connections[$connectionName][&#39;</span>alters<span class="stringliteral">&#39;][] = $query;</span>
<a name="l01153"></a>01153 <span class="stringliteral"></span>
<a name="l01154"></a>01154 <span class="stringliteral">                     unset($sql[$key]);</span>
<a name="l01155"></a>01155 <span class="stringliteral">                     continue;</span>
<a name="l01156"></a>01156 <span class="stringliteral">                 }</span>
<a name="l01157"></a>01157 <span class="stringliteral"></span>
<a name="l01158"></a>01158 <span class="stringliteral">                 // If create trgger statement</span>
<a name="l01159"></a>01159 <span class="stringliteral">                 if (substr($query, 0, strlen(&#39;</span>CREATE TRIGGER<span class="stringliteral">&#39;)) == &#39;</span>CREATE TRIGGER<span class="stringliteral">&#39;) {</span>
<a name="l01160"></a>01160 <span class="stringliteral">                     $connections[$connectionName][&#39;</span>create_triggers<span class="stringliteral">&#39;][] = $query;</span>
<a name="l01161"></a>01161 <span class="stringliteral"></span>
<a name="l01162"></a>01162 <span class="stringliteral">                   unset($sql[$key]);</span>
<a name="l01163"></a>01163 <span class="stringliteral">                     continue;</span>
<a name="l01164"></a>01164 <span class="stringliteral">                 }</span>
<a name="l01165"></a>01165 <span class="stringliteral"></span>
<a name="l01166"></a>01166 <span class="stringliteral">                 // If comment statement</span>
<a name="l01167"></a>01167 <span class="stringliteral">                 if (substr($query, 0, strlen(&#39;</span>COMMENT ON<span class="stringliteral">&#39;)) == &#39;</span>COMMENT ON<span class="stringliteral">&#39;) {</span>
<a name="l01168"></a>01168 <span class="stringliteral">                     $connections[$connectionName][&#39;</span>comments<span class="stringliteral">&#39;][] = $query;</span>
<a name="l01169"></a>01169 <span class="stringliteral"></span>
<a name="l01170"></a>01170 <span class="stringliteral">                     unset($sql[$key]);</span>
<a name="l01171"></a>01171 <span class="stringliteral">                     continue;</span>
<a name="l01172"></a>01172 <span class="stringliteral">                 }</span>
<a name="l01173"></a>01173 <span class="stringliteral">             }</span>
<a name="l01174"></a>01174 <span class="stringliteral">         }</span>
<a name="l01175"></a>01175 <span class="stringliteral"></span>
<a name="l01176"></a>01176 <span class="stringliteral">         // Loop over all the sql again to merge everything together so it is in the correct order</span>
<a name="l01177"></a>01177 <span class="stringliteral">         $build = array();</span>
<a name="l01178"></a>01178 <span class="stringliteral">         foreach ($connections as $connectionName =&gt; $sql) {</span>
<a name="l01179"></a>01179 <span class="stringliteral">             $build[$connectionName] = array_unique(array_merge($sql[&#39;</span>create_tables<span class="stringliteral">&#39;], $sql[&#39;</span>create_sequences<span class="stringliteral">&#39;], $sql[&#39;</span>create_indexes<span class="stringliteral">&#39;], $sql[&#39;</span>alters<span class="stringliteral">&#39;], $sql[&#39;</span>create_triggers<span class="stringliteral">&#39;]));</span>
<a name="l01180"></a>01180 <span class="stringliteral">         }</span>
<a name="l01181"></a>01181 <span class="stringliteral"></span>
<a name="l01182"></a>01182 <span class="stringliteral">         if ( ! $groupByConnection) {</span>
<a name="l01183"></a>01183 <span class="stringliteral">             $new = array();</span>
<a name="l01184"></a>01184 <span class="stringliteral">             foreach($build as $connectionname =&gt; $sql) {</span>
<a name="l01185"></a>01185 <span class="stringliteral">                 $new = array_unique(array_merge($new, $sql));</span>
<a name="l01186"></a>01186 <span class="stringliteral">             }</span>
<a name="l01187"></a>01187 <span class="stringliteral">             $build = $new;</span>
<a name="l01188"></a>01188 <span class="stringliteral">         }</span>
<a name="l01189"></a>01189 <span class="stringliteral">         return $build;</span>
<a name="l01190"></a>01190 <span class="stringliteral">    }</span>
<a name="l01191"></a>01191 <span class="stringliteral"></span>
<a name="l01203"></a><a class="code" href="classDoctrine__Export.html#a0ea4780c38fb5f9036d1a58c8e793552">01203</a> <span class="stringliteral">     public function exportClasses(array $classes)</span>
<a name="l01204"></a>01204 <span class="stringliteral">     {</span>
<a name="l01205"></a>01205 <span class="stringliteral">         $queries = $this-&gt;exportSortedClassesSql($classes);</span>
<a name="l01206"></a>01206 <span class="stringliteral"></span>
<a name="l01207"></a>01207 <span class="stringliteral">         foreach ($queries as $connectionName =&gt; $sql) {</span>
<a name="l01208"></a>01208 <span class="stringliteral">             $connection = Doctrine_Manager::getInstance()-&gt;getConnection($connectionName);</span>
<a name="l01209"></a>01209 <span class="stringliteral"></span>
<a name="l01210"></a>01210 <span class="stringliteral">             $connection-&gt;beginTransaction();</span>
<a name="l01211"></a>01211 <span class="stringliteral"></span>
<a name="l01212"></a>01212 <span class="stringliteral">             foreach ($sql as $query) {</span>
<a name="l01213"></a>01213 <span class="stringliteral">                 try {</span>
<a name="l01214"></a>01214 <span class="stringliteral">                     $connection-&gt;exec($query);</span>
<a name="l01215"></a>01215 <span class="stringliteral">                 } catch (Doctrine_Connection_Exception $e) {</span>
<a name="l01216"></a>01216 <span class="stringliteral">                     // we only want to silence table already exists errors</span>
<a name="l01217"></a>01217 <span class="stringliteral">                     if ($e-&gt;getPortableCode() !== Doctrine_Core::ERR_ALREADY_EXISTS) {</span>
<a name="l01218"></a>01218 <span class="stringliteral">                         $connection-&gt;rollback();</span>
<a name="l01219"></a>01219 <span class="stringliteral">                         throw new Doctrine_Export_Exception($e-&gt;getMessage() . &#39;</span>. Failing Query: <span class="stringliteral">&#39; . $query);</span>
<a name="l01220"></a>01220 <span class="stringliteral">                     }</span>
<a name="l01221"></a>01221 <span class="stringliteral">                 }</span>
<a name="l01222"></a>01222 <span class="stringliteral">             }</span>
<a name="l01223"></a>01223 <span class="stringliteral"></span>
<a name="l01224"></a>01224 <span class="stringliteral">             $connection-&gt;commit();</span>
<a name="l01225"></a>01225 <span class="stringliteral">         }</span>
<a name="l01226"></a>01226 <span class="stringliteral">     }</span>
<a name="l01227"></a>01227 <span class="stringliteral"></span>
<a name="l01237"></a><a class="code" href="classDoctrine__Export.html#a7480bf5dbe253f426646b7c1190fe23c">01237</a> <span class="stringliteral">    public function exportClassesSql(array $classes)</span>
<a name="l01238"></a>01238 <span class="stringliteral">    {</span>
<a name="l01239"></a>01239 <span class="stringliteral">        $models = Doctrine_Core::filterInvalidModels($classes);</span>
<a name="l01240"></a>01240 <span class="stringliteral">        </span>
<a name="l01241"></a>01241 <span class="stringliteral">        $sql = array();</span>
<a name="l01242"></a>01242 <span class="stringliteral">        </span>
<a name="l01243"></a>01243 <span class="stringliteral">        foreach ($models as $name) {</span>
<a name="l01244"></a>01244 <span class="stringliteral">            $record = new $name();</span>
<a name="l01245"></a>01245 <span class="stringliteral">            $table = $record-&gt;getTable();</span>
<a name="l01246"></a>01246 <span class="stringliteral">            $parents = $table-&gt;getOption(&#39;</span>joinedParents<span class="stringliteral">&#39;);</span>
<a name="l01247"></a>01247 <span class="stringliteral"></span>
<a name="l01248"></a>01248 <span class="stringliteral">            foreach ($parents as $parent) {</span>
<a name="l01249"></a>01249 <span class="stringliteral">                $data  = $table-&gt;getConnection()-&gt;getTable($parent)-&gt;getExportableFormat();</span>
<a name="l01250"></a>01250 <span class="stringliteral"></span>
<a name="l01251"></a>01251 <span class="stringliteral">                $query = $this-&gt;conn-&gt;export-&gt;createTableSql($data[&#39;</span>tableName<span class="stringliteral">&#39;], $data[&#39;</span>columns<span class="stringliteral">&#39;], $data[&#39;</span>options<span class="stringliteral">&#39;]);</span>
<a name="l01252"></a>01252 <span class="stringliteral"></span>
<a name="l01253"></a>01253 <span class="stringliteral">                $sql = array_merge($sql, (array) $query);</span>
<a name="l01254"></a>01254 <span class="stringliteral">            }</span>
<a name="l01255"></a>01255 <span class="stringliteral"></span>
<a name="l01256"></a>01256 <span class="stringliteral">            // Don&#39;</span>t export the tables with attribute EXPORT_NONE<span class="stringliteral">&#39;</span>
<a name="l01257"></a>01257 <span class="stringliteral">            if ($table-&gt;getAttribute(Doctrine_Core::ATTR_EXPORT) === Doctrine_Core::EXPORT_NONE) {</span>
<a name="l01258"></a>01258 <span class="stringliteral">                continue;</span>
<a name="l01259"></a>01259 <span class="stringliteral">            }</span>
<a name="l01260"></a>01260 <span class="stringliteral"></span>
<a name="l01261"></a>01261 <span class="stringliteral">            $data = $table-&gt;getExportableFormat();</span>
<a name="l01262"></a>01262 <span class="stringliteral"></span>
<a name="l01263"></a>01263 <span class="stringliteral">            $query = $this-&gt;conn-&gt;export-&gt;createTableSql($data[&#39;</span>tableName<span class="stringliteral">&#39;], $data[&#39;</span>columns<span class="stringliteral">&#39;], $data[&#39;</span>options<span class="stringliteral">&#39;]);</span>
<a name="l01264"></a>01264 <span class="stringliteral"></span>
<a name="l01265"></a>01265 <span class="stringliteral">            if (is_array($query)) {</span>
<a name="l01266"></a>01266 <span class="stringliteral">                $sql = array_merge($sql, $query);</span>
<a name="l01267"></a>01267 <span class="stringliteral">            } else {</span>
<a name="l01268"></a>01268 <span class="stringliteral">                $sql[] = $query;</span>
<a name="l01269"></a>01269 <span class="stringliteral">            }</span>
<a name="l01270"></a>01270 <span class="stringliteral"></span>
<a name="l01271"></a>01271 <span class="stringliteral">            if ($table-&gt;getAttribute(Doctrine_Core::ATTR_EXPORT) &amp; Doctrine_Core::EXPORT_PLUGINS) {</span>
<a name="l01272"></a>01272 <span class="stringliteral">                $sql = array_merge($sql, $this-&gt;exportGeneratorsSql($table));</span>
<a name="l01273"></a>01273 <span class="stringliteral">            }</span>
<a name="l01274"></a>01274 <span class="stringliteral">            </span>
<a name="l01275"></a>01275 <span class="stringliteral">            // DC-474: Remove dummy $record from repository to not pollute it during export</span>
<a name="l01276"></a>01276 <span class="stringliteral">            $table-&gt;getRepository()-&gt;evict($record-&gt;getOid());</span>
<a name="l01277"></a>01277 <span class="stringliteral">            unset($record);</span>
<a name="l01278"></a>01278 <span class="stringliteral">        }</span>
<a name="l01279"></a>01279 <span class="stringliteral">        </span>
<a name="l01280"></a>01280 <span class="stringliteral">        $sql = array_unique($sql);</span>
<a name="l01281"></a>01281 <span class="stringliteral">        </span>
<a name="l01282"></a>01282 <span class="stringliteral">        rsort($sql);</span>
<a name="l01283"></a>01283 <span class="stringliteral"></span>
<a name="l01284"></a>01284 <span class="stringliteral">        return $sql;</span>
<a name="l01285"></a>01285 <span class="stringliteral">    }</span>
<a name="l01286"></a>01286 <span class="stringliteral"></span>
<a name="l01293"></a><a class="code" href="classDoctrine__Export.html#aad2571b8d5a9868f46b0e293cd0fcd90">01293</a> <span class="stringliteral">    public function getAllGenerators(Doctrine_Table $table)</span>
<a name="l01294"></a>01294 <span class="stringliteral">    {</span>
<a name="l01295"></a>01295 <span class="stringliteral">        $generators = array();</span>
<a name="l01296"></a>01296 <span class="stringliteral"></span>
<a name="l01297"></a>01297 <span class="stringliteral">        foreach ($table-&gt;getGenerators() as $name =&gt; $generator) {</span>
<a name="l01298"></a>01298 <span class="stringliteral">            if ($generator === null) {</span>
<a name="l01299"></a>01299 <span class="stringliteral">                continue;                       </span>
<a name="l01300"></a>01300 <span class="stringliteral">            }</span>
<a name="l01301"></a>01301 <span class="stringliteral"></span>
<a name="l01302"></a>01302 <span class="stringliteral">            $generators[] = $generator;</span>
<a name="l01303"></a>01303 <span class="stringliteral"></span>
<a name="l01304"></a>01304 <span class="stringliteral">            $generatorTable = $generator-&gt;getTable();</span>
<a name="l01305"></a>01305 <span class="stringliteral">            </span>
<a name="l01306"></a>01306 <span class="stringliteral">            if ($generatorTable instanceof Doctrine_Table) {</span>
<a name="l01307"></a>01307 <span class="stringliteral">                $generators = array_merge($generators, $this-&gt;getAllGenerators($generatorTable));</span>
<a name="l01308"></a>01308 <span class="stringliteral">            }</span>
<a name="l01309"></a>01309 <span class="stringliteral">        }</span>
<a name="l01310"></a>01310 <span class="stringliteral"></span>
<a name="l01311"></a>01311 <span class="stringliteral">        return $generators;</span>
<a name="l01312"></a>01312 <span class="stringliteral">    }</span>
<a name="l01313"></a>01313 <span class="stringliteral"></span>
<a name="l01321"></a><a class="code" href="classDoctrine__Export.html#ab5a64eae6de77d4e03f74f42ca524e0d">01321</a> <span class="stringliteral">    public function exportGeneratorsSql(Doctrine_Table $table)</span>
<a name="l01322"></a>01322 <span class="stringliteral">    {</span>
<a name="l01323"></a>01323 <span class="stringliteral">      $sql = array();</span>
<a name="l01324"></a>01324 <span class="stringliteral"></span>
<a name="l01325"></a>01325 <span class="stringliteral">        foreach ($this-&gt;getAllGenerators($table) as $name =&gt; $generator) {</span>
<a name="l01326"></a>01326 <span class="stringliteral">            $table = $generator-&gt;getTable();</span>
<a name="l01327"></a>01327 <span class="stringliteral">            </span>
<a name="l01328"></a>01328 <span class="stringliteral">            // Make sure plugin has a valid table</span>
<a name="l01329"></a>01329 <span class="stringliteral">            if ($table instanceof Doctrine_Table) {</span>
<a name="l01330"></a>01330 <span class="stringliteral">                $data = $table-&gt;getExportableFormat();</span>
<a name="l01331"></a>01331 <span class="stringliteral"></span>
<a name="l01332"></a>01332 <span class="stringliteral">                $query = $this-&gt;conn-&gt;export-&gt;createTableSql($data[&#39;</span>tableName<span class="stringliteral">&#39;], $data[&#39;</span>columns<span class="stringliteral">&#39;], $data[&#39;</span>options<span class="stringliteral">&#39;]);</span>
<a name="l01333"></a>01333 <span class="stringliteral"></span>
<a name="l01334"></a>01334 <span class="stringliteral">                $sql = array_merge($sql, (array) $query);</span>
<a name="l01335"></a>01335 <span class="stringliteral">            }</span>
<a name="l01336"></a>01336 <span class="stringliteral">        }</span>
<a name="l01337"></a>01337 <span class="stringliteral"></span>
<a name="l01338"></a>01338 <span class="stringliteral">        return $sql;</span>
<a name="l01339"></a>01339 <span class="stringliteral">    }</span>
<a name="l01340"></a>01340 <span class="stringliteral"></span>
<a name="l01356"></a><a class="code" href="classDoctrine__Export.html#a77048c5d887d9cc4c4847fb9b7326548">01356</a> <span class="stringliteral">    public function exportSql($directory = null)</span>
<a name="l01357"></a>01357 <span class="stringliteral">    {</span>
<a name="l01358"></a>01358 <span class="stringliteral">        if ($directory !== null) {</span>
<a name="l01359"></a>01359 <span class="stringliteral">            $models = Doctrine_Core::filterInvalidModels(Doctrine_Core::loadModels($directory));</span>
<a name="l01360"></a>01360 <span class="stringliteral">        } else {</span>
<a name="l01361"></a>01361 <span class="stringliteral">            $models = Doctrine_Core::getLoadedModels();</span>
<a name="l01362"></a>01362 <span class="stringliteral">        }</span>
<a name="l01363"></a>01363 <span class="stringliteral">        </span>
<a name="l01364"></a>01364 <span class="stringliteral">        return $this-&gt;exportSortedClassesSql($models, false);</span>
<a name="l01365"></a>01365 <span class="stringliteral">    }</span>
<a name="l01366"></a>01366 <span class="stringliteral"></span>
<a name="l01376"></a><a class="code" href="classDoctrine__Export.html#a3a343d99ad1623777bd09a109ec5b197">01376</a> <span class="stringliteral">    public function exportTable(Doctrine_Table $table)</span>
<a name="l01377"></a>01377 <span class="stringliteral">    {</span>
<a name="l01378"></a>01378 <span class="stringliteral">        try {</span>
<a name="l01379"></a>01379 <span class="stringliteral">            $data = $table-&gt;getExportableFormat();</span>
<a name="l01380"></a>01380 <span class="stringliteral"></span>
<a name="l01381"></a>01381 <span class="stringliteral">            $this-&gt;conn-&gt;export-&gt;createTable($data[&#39;</span>tableName<span class="stringliteral">&#39;], $data[&#39;</span>columns<span class="stringliteral">&#39;], $data[&#39;</span>options<span class="stringliteral">&#39;]);</span>
<a name="l01382"></a>01382 <span class="stringliteral">        } catch(Doctrine_Connection_Exception $e) {</span>
<a name="l01383"></a>01383 <span class="stringliteral">            // we only want to silence table already exists errors</span>
<a name="l01384"></a>01384 <span class="stringliteral">            if ($e-&gt;getPortableCode() !== Doctrine_Core::ERR_ALREADY_EXISTS) {</span>
<a name="l01385"></a>01385 <span class="stringliteral">                throw $e;</span>
<a name="l01386"></a>01386 <span class="stringliteral">            }</span>
<a name="l01387"></a>01387 <span class="stringliteral">        }</span>
<a name="l01388"></a>01388 <span class="stringliteral">    }</span>
<a name="l01389"></a>01389 <span class="stringliteral">}</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
