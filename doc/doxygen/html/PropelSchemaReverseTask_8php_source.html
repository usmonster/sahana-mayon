<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/propel-generator/classes/propel/phing/PropelSchemaReverseTask.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/propel-generator/classes/propel/phing/PropelSchemaReverseTask.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> *  $Id: PropelSchemaReverseTask.php 945 2008-01-30 02:14:46Z hans $</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00007"></a>00007 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00008"></a>00008 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00009"></a>00009 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00010"></a>00010 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00011"></a>00011 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00012"></a>00012 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00013"></a>00013 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00014"></a>00014 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00015"></a>00015 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00016"></a>00016 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00019"></a>00019 <span class="comment"> * and is licensed under the LGPL. For more information please see</span>
<a name="l00020"></a>00020 <span class="comment"> * &lt;http://propel.phpdb.org&gt;.</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 require_once <span class="stringliteral">&#39;phing/tasks/ext/pdo/PDOTask.php&#39;</span>;
<a name="l00024"></a>00024 include_once <span class="stringliteral">&#39;propel/engine/GeneratorConfig.php&#39;</span>;
<a name="l00025"></a>00025 include_once <span class="stringliteral">&#39;propel/engine/database/model/PropelTypes.php&#39;</span>;
<a name="l00026"></a>00026 
<a name="l00035"></a><a class="code" href="classPropelSchemaReverseTask.html">00035</a> <span class="keyword">class </span><a class="code" href="classPropelSchemaReverseTask.html">PropelSchemaReverseTask</a> <span class="keyword">extends</span> <a class="code" href="classPDOTask.html">PDOTask</a> {
<a name="l00036"></a>00036 
<a name="l00040"></a><a class="code" href="classPropelSchemaReverseTask.html#a317db6b830ba293a5149c92f69c40584">00040</a>   <span class="keyword">const</span> <a class="code" href="classPropelSchemaReverseTask.html#a317db6b830ba293a5149c92f69c40584" title="Zero bit for no validators.">VALIDATORS_NONE</a> = 0;
<a name="l00041"></a>00041 
<a name="l00045"></a><a class="code" href="classPropelSchemaReverseTask.html#acb3c854c8ac74fe729a4e99d8dab74a3">00045</a>   <span class="keyword">const</span> <a class="code" href="classPropelSchemaReverseTask.html#acb3c854c8ac74fe729a4e99d8dab74a3" title="Bit for maxLength validator.">VALIDATORS_MAXLENGTH</a> = 1;
<a name="l00046"></a>00046 
<a name="l00050"></a><a class="code" href="classPropelSchemaReverseTask.html#a056a37085261ed08ac1f795484c9abda">00050</a>   <span class="keyword">const</span> <a class="code" href="classPropelSchemaReverseTask.html#a056a37085261ed08ac1f795484c9abda" title="Bit for maxValue validator.">VALIDATORS_MAXVALUE</a> = 2;
<a name="l00051"></a>00051 
<a name="l00055"></a><a class="code" href="classPropelSchemaReverseTask.html#ad0b99dcb5cdc9c9c7988d3a27ff1d4f1">00055</a>   <span class="keyword">const</span> <a class="code" href="classPropelSchemaReverseTask.html#ad0b99dcb5cdc9c9c7988d3a27ff1d4f1" title="Bit for type validator.">VALIDATORS_TYPE</a> = 4;
<a name="l00056"></a>00056 
<a name="l00060"></a><a class="code" href="classPropelSchemaReverseTask.html#a6f16f5350a7c48a9cad098a903bb334e">00060</a>   <span class="keyword">const</span> <a class="code" href="classPropelSchemaReverseTask.html#a6f16f5350a7c48a9cad098a903bb334e" title="Bit for required validator.">VALIDATORS_REQUIRED</a> = 8;
<a name="l00061"></a>00061 
<a name="l00065"></a><a class="code" href="classPropelSchemaReverseTask.html#a50ff9283a0a9a44022c87793c8b8f2ac">00065</a>   <span class="keyword">const</span> <a class="code" href="classPropelSchemaReverseTask.html#a50ff9283a0a9a44022c87793c8b8f2ac" title="Bit for unique validator.">VALIDATORS_UNIQUE</a> = 16;
<a name="l00066"></a>00066 
<a name="l00070"></a><a class="code" href="classPropelSchemaReverseTask.html#aacab0863e37095071e1e79985d54b196">00070</a>   <span class="keyword">const</span> <a class="code" href="classPropelSchemaReverseTask.html#aacab0863e37095071e1e79985d54b196" title="Bit for all validators.">VALIDATORS_ALL</a> = 255;
<a name="l00071"></a>00071 
<a name="l00076"></a>00076   <span class="keyword">protected</span> $xmlSchema;
<a name="l00077"></a>00077 
<a name="l00082"></a>00082   <span class="keyword">protected</span> $dbEncoding = <span class="stringliteral">&#39;iso-8859-1&#39;</span>;
<a name="l00083"></a>00083 
<a name="l00088"></a>00088   <span class="keyword">protected</span> $dbSchema;
<a name="l00089"></a>00089 
<a name="l00095"></a>00095   <span class="keyword">protected</span> $databaseName;
<a name="l00096"></a>00096 
<a name="l00101"></a>00101   <span class="keyword">protected</span> $doc;
<a name="l00102"></a>00102 
<a name="l00107"></a>00107   <span class="keyword">protected</span> $databaseNode;
<a name="l00108"></a>00108 
<a name="l00113"></a>00113   <span class="keyword">protected</span> $primaryKeys;
<a name="l00114"></a>00114 
<a name="l00119"></a>00119   <span class="keyword">protected</span> $samePhpName;
<a name="l00120"></a>00120 
<a name="l00125"></a>00125   <span class="keyword">protected</span> $addVendorInfo;
<a name="l00126"></a>00126 
<a name="l00132"></a>00132   <span class="keyword">protected</span> $validatorBits = <a class="code" href="classPropelSchemaReverseTask.html#a317db6b830ba293a5149c92f69c40584" title="Zero bit for no validators.">PropelSchemaReverseTask::VALIDATORS_NONE</a>;
<a name="l00133"></a>00133 
<a name="l00139"></a>00139   <span class="keyword">protected</span> $validatorInfos;
<a name="l00140"></a>00140 
<a name="l00146"></a>00146   <span class="keyword">private</span> $generatorConfig;
<a name="l00147"></a>00147 
<a name="l00156"></a>00156   <span class="keyword">static</span> <span class="keyword">protected</span> $validatorBitMap = array (
<a name="l00157"></a>00157     <span class="stringliteral">&#39;none&#39;</span> =&gt; <a class="code" href="classPropelSchemaReverseTask.html#a317db6b830ba293a5149c92f69c40584" title="Zero bit for no validators.">PropelSchemaReverseTask::VALIDATORS_NONE</a>,
<a name="l00158"></a>00158     <span class="stringliteral">&#39;maxlength&#39;</span> =&gt; <a class="code" href="classPropelSchemaReverseTask.html#acb3c854c8ac74fe729a4e99d8dab74a3" title="Bit for maxLength validator.">PropelSchemaReverseTask::VALIDATORS_MAXLENGTH</a>,
<a name="l00159"></a>00159     <span class="stringliteral">&#39;maxvalue&#39;</span> =&gt; <a class="code" href="classPropelSchemaReverseTask.html#a056a37085261ed08ac1f795484c9abda" title="Bit for maxValue validator.">PropelSchemaReverseTask::VALIDATORS_MAXVALUE</a>,
<a name="l00160"></a>00160     <span class="stringliteral">&#39;type&#39;</span> =&gt; <a class="code" href="classPropelSchemaReverseTask.html#ad0b99dcb5cdc9c9c7988d3a27ff1d4f1" title="Bit for type validator.">PropelSchemaReverseTask::VALIDATORS_TYPE</a>,
<a name="l00161"></a>00161     <span class="stringliteral">&#39;required&#39;</span> =&gt; <a class="code" href="classPropelSchemaReverseTask.html#a6f16f5350a7c48a9cad098a903bb334e" title="Bit for required validator.">PropelSchemaReverseTask::VALIDATORS_REQUIRED</a>,
<a name="l00162"></a>00162     <span class="stringliteral">&#39;unique&#39;</span> =&gt; <a class="code" href="classPropelSchemaReverseTask.html#a50ff9283a0a9a44022c87793c8b8f2ac" title="Bit for unique validator.">PropelSchemaReverseTask::VALIDATORS_UNIQUE</a>,
<a name="l00163"></a>00163     <span class="stringliteral">&#39;all&#39;</span> =&gt; <a class="code" href="classPropelSchemaReverseTask.html#aacab0863e37095071e1e79985d54b196" title="Bit for all validators.">PropelSchemaReverseTask::VALIDATORS_ALL</a>,
<a name="l00164"></a>00164   );
<a name="l00165"></a>00165 
<a name="l00171"></a>00171   <span class="keyword">static</span> <span class="keyword">protected</span> $validatorMessages = array (
<a name="l00172"></a>00172     <span class="stringliteral">&#39;maxlength&#39;</span> =&gt; array (
<a name="l00173"></a>00173       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The field %s must be not longer than %s characters.&#39;</span>,
<a name="l00174"></a>00174       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>, <span class="stringliteral">&#39;value&#39;</span>)
<a name="l00175"></a>00175   ),
<a name="l00176"></a>00176     <span class="stringliteral">&#39;maxvalue&#39;</span> =&gt; array (
<a name="l00177"></a>00177       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The field %s must be not greater than %s.&#39;</span>,
<a name="l00178"></a>00178       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>, <span class="stringliteral">&#39;value&#39;</span>)
<a name="l00179"></a>00179   ),
<a name="l00180"></a>00180     <span class="stringliteral">&#39;type&#39;</span> =&gt; array (
<a name="l00181"></a>00181       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The column %s must be an %s value.&#39;</span>,
<a name="l00182"></a>00182       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>, <span class="stringliteral">&#39;value&#39;</span>)
<a name="l00183"></a>00183   ),
<a name="l00184"></a>00184     <span class="stringliteral">&#39;required&#39;</span> =&gt; array (
<a name="l00185"></a>00185       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The field %s is required.&#39;</span>,
<a name="l00186"></a>00186       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>)
<a name="l00187"></a>00187   ),
<a name="l00188"></a>00188     <span class="stringliteral">&#39;unique&#39;</span> =&gt; array (
<a name="l00189"></a>00189       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;This %s already exists in table %s.&#39;</span>,
<a name="l00190"></a>00190       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>, <span class="stringliteral">&#39;tableName&#39;</span>)
<a name="l00191"></a>00191   ),
<a name="l00192"></a>00192   );
<a name="l00193"></a>00193 
<a name="l00199"></a><a class="code" href="classPropelSchemaReverseTask.html#a5e5a4d235fc4dcec5ce4812f0d7dc4a1">00199</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a5e5a4d235fc4dcec5ce4812f0d7dc4a1" title="Gets the (optional) schema name to use.">getDbSchema</a>()
<a name="l00200"></a>00200   {
<a name="l00201"></a>00201     <span class="keywordflow">return</span> $this-&gt;dbSchema;
<a name="l00202"></a>00202   }
<a name="l00203"></a>00203 
<a name="l00209"></a><a class="code" href="classPropelSchemaReverseTask.html#a0d33028cbeb327380fab6838799ede14">00209</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a0d33028cbeb327380fab6838799ede14" title="Sets the name of a database schema to use (optional).">setDbSchema</a>($dbSchema)
<a name="l00210"></a>00210   {
<a name="l00211"></a>00211     $this-&gt;dbSchema = $dbSchema;
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213 
<a name="l00219"></a><a class="code" href="classPropelSchemaReverseTask.html#aad5451d31220da045f69c648536e2b3d">00219</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#aad5451d31220da045f69c648536e2b3d" title="Gets the database encoding.">getDbEncoding</a>($v)
<a name="l00220"></a>00220   {
<a name="l00221"></a>00221     <span class="keywordflow">return</span> $this-&gt;dbEncoding;
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223 
<a name="l00229"></a><a class="code" href="classPropelSchemaReverseTask.html#aa7e5155f03014e069029b5d385b425fe">00229</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#aa7e5155f03014e069029b5d385b425fe" title="Sets the database encoding.">setDbEncoding</a>($v)
<a name="l00230"></a>00230   {
<a name="l00231"></a>00231     $this-&gt;dbEncoding = $v;
<a name="l00232"></a>00232   }
<a name="l00233"></a>00233 
<a name="l00239"></a><a class="code" href="classPropelSchemaReverseTask.html#a887dd1125708d8518c1c069f166e8f2b">00239</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a887dd1125708d8518c1c069f166e8f2b" title="Gets the datasource name.">getDatabaseName</a>()
<a name="l00240"></a>00240   {
<a name="l00241"></a>00241     <span class="keywordflow">return</span> $this-&gt;databaseName;
<a name="l00242"></a>00242   }
<a name="l00243"></a>00243 
<a name="l00251"></a><a class="code" href="classPropelSchemaReverseTask.html#a804ac7f93605e6ddfc5f4959406d3b09">00251</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a804ac7f93605e6ddfc5f4959406d3b09" title="Sets the datasource name.">setDatabaseName</a>($v)
<a name="l00252"></a>00252   {
<a name="l00253"></a>00253     $this-&gt;databaseName = $v;
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255 
<a name="l00261"></a><a class="code" href="classPropelSchemaReverseTask.html#a028e6b186d2499410deac82d3ae68fd6">00261</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a028e6b186d2499410deac82d3ae68fd6" title="Sets the output name for the XML file.">setOutputFile</a>(<a class="code" href="classPhingFile.html">PhingFile</a> $v)
<a name="l00262"></a>00262   {
<a name="l00263"></a>00263     $this-&gt;xmlSchema = $v;
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265 
<a name="l00271"></a><a class="code" href="classPropelSchemaReverseTask.html#a99aacbdb47a449e3fc7dd0d45ec88dcf">00271</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a99aacbdb47a449e3fc7dd0d45ec88dcf" title="Set whether to use the column name as phpName without any translation.">setSamePhpName</a>($v)
<a name="l00272"></a>00272   {
<a name="l00273"></a>00273     $this-&gt;samePhpName = $v;
<a name="l00274"></a>00274   }
<a name="l00275"></a>00275 
<a name="l00281"></a><a class="code" href="classPropelSchemaReverseTask.html#a5faaddc2de70edc8c679d333293b73c8">00281</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a5faaddc2de70edc8c679d333293b73c8" title="Set whether to add vendor info to the schema.">setAddVendorInfo</a>($v)
<a name="l00282"></a>00282   {
<a name="l00283"></a>00283     $this-&gt;addVendorInfo = (boolean) $v;
<a name="l00284"></a>00284   }
<a name="l00285"></a>00285 
<a name="l00292"></a><a class="code" href="classPropelSchemaReverseTask.html#af385fdd95a69c77d2be5d208fac3ae9d">00292</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#af385fdd95a69c77d2be5d208fac3ae9d" title="Sets set validator bitfield from a comma-separated list of &amp;quot;validator bit&amp;quot;...">setAddValidators</a>($v)
<a name="l00293"></a>00293   {
<a name="l00294"></a>00294     $validKeys = array_keys(self::$validatorBitMap);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="comment">// lowercase input</span>
<a name="l00297"></a>00297     $v = strtolower($v);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     $bits = self::VALIDATORS_NONE;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     $exprs = explode(<span class="charliteral">&#39;,&#39;</span>, $v);
<a name="l00302"></a>00302     <span class="keywordflow">foreach</span> ($exprs as $expr) {
<a name="l00303"></a>00303       $expr = trim($expr);
<a name="l00304"></a>00304       <span class="keywordflow">if</span>(!empty($expr)) {
<a name="l00305"></a>00305         <span class="keywordflow">if</span> (!isset(self::$validatorBitMap[$expr])) {
<a name="l00306"></a>00306           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classBuildException.html">BuildException</a>(<span class="stringliteral">&quot;Unable to interpret validator in expression (&#39;$v&#39;): &quot;</span> . $expr);
<a name="l00307"></a>00307         }
<a name="l00308"></a>00308         $bits |= self::$validatorBitMap[$expr];
<a name="l00309"></a>00309       }
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     $this-&gt;validatorBits = $bits;
<a name="l00313"></a>00313   }
<a name="l00314"></a>00314 
<a name="l00321"></a><a class="code" href="classPropelSchemaReverseTask.html#a508ae2a5a570a536daeca7f62a0b5d30">00321</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelSchemaReverseTask.html#a508ae2a5a570a536daeca7f62a0b5d30" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>($type)
<a name="l00322"></a>00322   {
<a name="l00323"></a>00323     <span class="keywordflow">return</span> (($this-&gt;validatorBits &amp; $type) === $type);
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00331"></a><a class="code" href="classPropelSchemaReverseTask.html#a25d8ccd99ba591b27ead7721eba018d6">00331</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a25d8ccd99ba591b27ead7721eba018d6" title="Whether to use the column name as phpName without any translation.">isSamePhpName</a>()
<a name="l00332"></a>00332   {
<a name="l00333"></a>00333     <span class="keywordflow">return</span> $this-&gt;samePhpName;
<a name="l00334"></a>00334   }
<a name="l00335"></a>00335 
<a name="l00339"></a><a class="code" href="classPropelSchemaReverseTask.html#a7d0b640c4b4996c3f81128744069a9c9">00339</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverseTask.html#a7d0b640c4b4996c3f81128744069a9c9">main</a>()
<a name="l00340"></a>00340   {
<a name="l00341"></a>00341     <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a887dd1125708d8518c1c069f166e8f2b" title="Gets the datasource name.">getDatabaseName</a>()) {
<a name="l00342"></a>00342       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classBuildException.html">BuildException</a>(<span class="stringliteral">&quot;databaseName attribute is required for schema reverse engineering&quot;</span>, $this-&gt;<a class="code" href="classTask.html#af1c5497c347a5047b82ee8abc7168bf1" title="Returns the location within the buildfile this task occurs.">getLocation</a>());
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="comment">//(not yet supported) $this-&gt;log(&quot;schema : &quot; . $this-&gt;dbSchema);</span>
<a name="l00346"></a>00346     <span class="comment">//DocumentTypeImpl docType = new DocumentTypeImpl(null, &quot;database&quot;, null,</span>
<a name="l00347"></a>00347     <span class="comment">//     &quot;http://jakarta.apache.org/turbine/dtd/database.dtd&quot;);</span>
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     $this-&gt;doc = <span class="keyword">new</span> DOMDocument(<span class="stringliteral">&#39;1.0&#39;</span>, <span class="stringliteral">&#39;utf-8&#39;</span>);
<a name="l00350"></a>00350     $this-&gt;doc-&gt;formatOutput = <span class="keyword">true</span>; <span class="comment">// pretty printing</span>
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     $this-&gt;doc-&gt;appendChild($this-&gt;doc-&gt;createComment(<span class="stringliteral">&quot;Autogenerated by &quot;</span>.get_class($this).<span class="stringliteral">&quot; class.&quot;</span>));
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="keywordflow">try</span> {
<a name="l00355"></a>00355 
<a name="l00356"></a>00356       $database = $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a1c216c4dc104305ba1d6564b7fb9e089" title="Builds the model classes from the database schema.">buildModel</a>();
<a name="l00357"></a>00357 
<a name="l00358"></a>00358       <span class="keywordflow">if</span> ($this-&gt;validatorBits !== self::VALIDATORS_NONE) {
<a name="l00359"></a>00359         $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a5e1487fb701a967433cb9a09c91bb6c0" title="Adds any requested validators to the data model.">addValidators</a>($database);
<a name="l00360"></a>00360       }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362       $database-&gt;appendXml($this-&gt;doc);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364       $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Writing XML to file: &quot;</span> . $this-&gt;xmlSchema-&gt;getPath());
<a name="l00365"></a>00365       $out = <span class="keyword">new</span> <a class="code" href="classFileWriter.html">FileWriter</a>($this-&gt;xmlSchema);
<a name="l00366"></a>00366       $xmlstr = $this-&gt;doc-&gt;saveXML();
<a name="l00367"></a>00367       $out-&gt;write($xmlstr);
<a name="l00368"></a>00368       $out-&gt;close();
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00371"></a>00371       $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;There was an error building XML from metadata: &quot;</span> . $e-&gt;getMessage(), Project::MSG_ERR);
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Schema reverse engineering finished&quot;</span>);
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376 
<a name="l00381"></a><a class="code" href="classPropelSchemaReverseTask.html#a5144290e5a7911dae1b65011dea8b7c7">00381</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelSchemaReverseTask.html#a5144290e5a7911dae1b65011dea8b7c7" title="Gets the GeneratorConfig object for this task or creates it on-demand.">getGeneratorConfig</a>()
<a name="l00382"></a>00382   {
<a name="l00383"></a>00383     <span class="keywordflow">if</span> ($this-&gt;generatorConfig === null) {
<a name="l00384"></a>00384       $this-&gt;generatorConfig = <span class="keyword">new</span> <a class="code" href="classGeneratorConfig.html">GeneratorConfig</a>();
<a name="l00385"></a>00385       $this-&gt;generatorConfig-&gt;setBuildProperties($this-&gt;<a class="code" href="classProjectComponent.html#a934ca32b0e25b2b5fef647cb7bd558e8" title="Returns a reference to current project.">getProject</a>()-&gt;getProperties());
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387     <span class="keywordflow">return</span> $this-&gt;generatorConfig;
<a name="l00388"></a>00388   }
<a name="l00389"></a>00389 
<a name="l00394"></a><a class="code" href="classPropelSchemaReverseTask.html#a1c216c4dc104305ba1d6564b7fb9e089">00394</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelSchemaReverseTask.html#a1c216c4dc104305ba1d6564b7fb9e089" title="Builds the model classes from the database schema.">buildModel</a>()
<a name="l00395"></a>00395   {
<a name="l00396"></a>00396     $config = $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a5144290e5a7911dae1b65011dea8b7c7" title="Gets the GeneratorConfig object for this task or creates it on-demand.">getGeneratorConfig</a>();
<a name="l00397"></a>00397     $con = $this-&gt;<a class="code" href="classPDOTask.html#abc9c6b9f8cf8335c49e06e0983b1e3b1" title="Creates a new Connection as using the driver, url, userid and password specified...">getConnection</a>();
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     $database = <span class="keyword">new</span> <a class="code" href="classDatabase.html">Database</a>($this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a887dd1125708d8518c1c069f166e8f2b" title="Gets the datasource name.">getDatabaseName</a>());
<a name="l00400"></a>00400     $database-&gt;setPlatform($config-&gt;getConfiguredPlatform($con));
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     <span class="comment">// Some defaults ...</span>
<a name="l00403"></a>00403     $database-&gt;setDefaultIdMethod(<a class="code" href="interfaceIDMethod.html#ad84108d90b3b83a82ca6f1665a9ff3e3" title="Key generation via database-specific ID method (i.e.">IDMethod::NATIVE</a>);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     $parser = $config-&gt;getConfiguredSchemaParser($con);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     $parser-&gt;parse($database);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keywordflow">return</span> $database;
<a name="l00410"></a>00410   }
<a name="l00411"></a>00411 
<a name="l00429"></a><a class="code" href="classPropelSchemaReverseTask.html#a5e1487fb701a967433cb9a09c91bb6c0">00429</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelSchemaReverseTask.html#a5e1487fb701a967433cb9a09c91bb6c0" title="Adds any requested validators to the data model.">addValidators</a>(<a class="code" href="classDatabase.html">Database</a> $database)
<a name="l00430"></a>00430   {
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     $platform = $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a5144290e5a7911dae1b65011dea8b7c7" title="Gets the GeneratorConfig object for this task or creates it on-demand.">getGeneratorConfig</a>()-&gt;getConfiguredPlatform();
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <span class="keywordflow">foreach</span> ($database-&gt;<a class="code" href="classDatabase.html#af8352073fbe478880e55095f4af06c0c" title="Return an array of all tables.">getTables</a>() as $table) {
<a name="l00435"></a>00435 
<a name="l00436"></a>00436       $set = <span class="keyword">new</span> <a class="code" href="classPropelSchemaReverse__ValidatorSet.html">PropelSchemaReverse_ValidatorSet</a>();
<a name="l00437"></a>00437 
<a name="l00438"></a>00438       <span class="keywordflow">foreach</span> ($table-&gt;getColumns() as $col) {
<a name="l00439"></a>00439 
<a name="l00440"></a>00440         <span class="keywordflow">if</span> ($col-&gt;isNotNull() &amp;&amp; $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a508ae2a5a570a536daeca7f62a0b5d30" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_REQUIRED)) {
<a name="l00441"></a>00441           $validator = $set-&gt;getValidator($col);
<a name="l00442"></a>00442           $validator-&gt;addRule($this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a944bffa9119923dd9829baa77d925c6b" title="Gets validator rule for specified type (string).">getValidatorRule</a>($col, <span class="stringliteral">&#39;required&#39;</span>));
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         <span class="keywordflow">if</span> (in_array($col-&gt;getType(), array(PropelTypes::CHAR, PropelTypes::VARCHAR, PropelTypes::LONGVARCHAR))
<a name="l00446"></a>00446             &amp;&amp; $col-&gt;getSize() &amp;&amp; $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a508ae2a5a570a536daeca7f62a0b5d30" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_MAXLENGTH)) {
<a name="l00447"></a>00447           $validator = $set-&gt;getValidator($col);
<a name="l00448"></a>00448           $validator-&gt;addRule($this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a944bffa9119923dd9829baa77d925c6b" title="Gets validator rule for specified type (string).">getValidatorRule</a>($col, <span class="stringliteral">&#39;maxLength&#39;</span>, $col-&gt;getSize()));
<a name="l00449"></a>00449         }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="keywordflow">if</span> ($col-&gt;isNumericType() &amp;&amp; $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a508ae2a5a570a536daeca7f62a0b5d30" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_MAXVALUE)) {
<a name="l00452"></a>00452           $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;WARNING: maxValue validator added for column &quot;</span>.$col-&gt;getName().<span class="stringliteral">&quot;. You will have to adjust the size value manually.&quot;</span>, Project::MSG_WARN);
<a name="l00453"></a>00453           $validator = $set-&gt;getValidator($col);
<a name="l00454"></a>00454           $validator-&gt;addRule($this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a944bffa9119923dd9829baa77d925c6b" title="Gets validator rule for specified type (string).">getValidatorRule</a>($col, <span class="stringliteral">&#39;maxSize&#39;</span>, <span class="stringliteral">&#39;REPLACEME&#39;</span>));
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         <span class="keywordflow">if</span> ($col-&gt;isPhpPrimitiveType() &amp;&amp; $this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a508ae2a5a570a536daeca7f62a0b5d30" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_TYPE)) {
<a name="l00458"></a>00458           $validator = $set-&gt;getValidator($col);
<a name="l00459"></a>00459           $validator-&gt;addRule($this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a944bffa9119923dd9829baa77d925c6b" title="Gets validator rule for specified type (string).">getValidatorRule</a>($col, <span class="stringliteral">&#39;type&#39;</span>, $col-&gt;getPhpType()));
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462       }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464       <span class="keywordflow">foreach</span> ($table-&gt;getUnices() as $unique) {
<a name="l00465"></a>00465         $colnames = $unique-&gt;getColumns();
<a name="l00466"></a>00466         <span class="keywordflow">if</span> (count($colnames) == 1) { <span class="comment">// currently &#39;unique&#39; validator only works w/ single columns.</span>
<a name="l00467"></a>00467           $col = $table-&gt;getColumn($colnames[0]);
<a name="l00468"></a>00468           $validator = $set-&gt;getValidator($col);
<a name="l00469"></a>00469           $validator-&gt;addRule($this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#a944bffa9119923dd9829baa77d925c6b" title="Gets validator rule for specified type (string).">getValidatorRule</a>($col, <span class="stringliteral">&#39;unique&#39;</span>));
<a name="l00470"></a>00470         }
<a name="l00471"></a>00471       }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473       <span class="keywordflow">foreach</span> ($set-&gt;getValidators() as $validator) {
<a name="l00474"></a>00474         $table-&gt;addValidator($validator);
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     } <span class="comment">// foreach table</span>
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 
<a name="l00488"></a><a class="code" href="classPropelSchemaReverseTask.html#a944bffa9119923dd9829baa77d925c6b">00488</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelSchemaReverseTask.html#a944bffa9119923dd9829baa77d925c6b" title="Gets validator rule for specified type (string).">getValidatorRule</a>(<a class="code" href="classColumn.html">Column</a> $column, $type, $value = null)
<a name="l00489"></a>00489   {
<a name="l00490"></a>00490     $rule = <span class="keyword">new</span> <a class="code" href="classRule.html">Rule</a>();
<a name="l00491"></a>00491     $rule-&gt;setName($type);
<a name="l00492"></a>00492     <span class="keywordflow">if</span> ($value !== null) {
<a name="l00493"></a>00493       $rule-&gt;setValue($value);
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495     $rule-&gt;setMessage($this-&gt;<a class="code" href="classPropelSchemaReverseTask.html#ac9bae30205379d87c7a890a0538b2b45" title="Gets the message for a specified rule.">getRuleMessage</a>($column, $type, $value));
<a name="l00496"></a>00496     <span class="keywordflow">return</span> $rule;
<a name="l00497"></a>00497   }
<a name="l00498"></a>00498 
<a name="l00506"></a><a class="code" href="classPropelSchemaReverseTask.html#ac9bae30205379d87c7a890a0538b2b45">00506</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelSchemaReverseTask.html#ac9bae30205379d87c7a890a0538b2b45" title="Gets the message for a specified rule.">getRuleMessage</a>(<a class="code" href="classColumn.html">Column</a> $column, $type, $value)
<a name="l00507"></a>00507   {
<a name="l00508"></a>00508     <span class="comment">// create message</span>
<a name="l00509"></a>00509     $colName = $column-&gt;<a class="code" href="classColumn.html#a7597ddc8053de91682a8481d104c747a" title="Get the name of the column.">getName</a>();
<a name="l00510"></a>00510     $tableName = $column-&gt;<a class="code" href="classColumn.html#ac1c1c667f1c9e5b93ef8f245cf2c7eb5" title="Get the parent Table of the column.">getTable</a>()-&gt;getName();
<a name="l00511"></a>00511     $msg = self::$validatorMessages[strtolower($type)];
<a name="l00512"></a>00512     $tmp = compact($msg[<span class="stringliteral">&#39;var&#39;</span>]);
<a name="l00513"></a>00513     array_unshift($tmp, $msg[<span class="stringliteral">&#39;msg&#39;</span>]);
<a name="l00514"></a>00514     $msg = call_user_func_array(<span class="stringliteral">&#39;sprintf&#39;</span>, $tmp);
<a name="l00515"></a>00515     <span class="keywordflow">return</span> $msg;
<a name="l00516"></a>00516   }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00524"></a><a class="code" href="classPropelSchemaReverse__ValidatorSet.html">00524</a> <span class="keyword">class </span><a class="code" href="classPropelSchemaReverse__ValidatorSet.html">PropelSchemaReverse_ValidatorSet</a> {
<a name="l00525"></a>00525 
<a name="l00531"></a>00531   <span class="keyword">private</span> $validators = array();
<a name="l00532"></a>00532 
<a name="l00538"></a><a class="code" href="classPropelSchemaReverse__ValidatorSet.html#a2933781c3e553231e67baf659c132104">00538</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverse__ValidatorSet.html#a2933781c3e553231e67baf659c132104" title="Gets a single validator for specified column name.">getValidator</a>(<a class="code" href="classColumn.html">Column</a> $column)
<a name="l00539"></a>00539   {
<a name="l00540"></a>00540     $key = $column-&gt;<a class="code" href="classColumn.html#a7597ddc8053de91682a8481d104c747a" title="Get the name of the column.">getName</a>();
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (!isset($this-&gt;validators[$key])) {
<a name="l00542"></a>00542       $this-&gt;validators[$key] = <span class="keyword">new</span> <a class="code" href="classValidator.html">Validator</a>();
<a name="l00543"></a>00543       $this-&gt;validators[$key]-&gt;setColumn($column);
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     <span class="keywordflow">return</span> $this-&gt;validators[$key];
<a name="l00546"></a>00546   }
<a name="l00547"></a>00547 
<a name="l00552"></a><a class="code" href="classPropelSchemaReverse__ValidatorSet.html#a052aeb6ca806ddd0bbf5b595f3de0464">00552</a>   <span class="keyword">public</span> function <a class="code" href="classPropelSchemaReverse__ValidatorSet.html#a052aeb6ca806ddd0bbf5b595f3de0464" title="Gets all validators.">getValidators</a>()
<a name="l00553"></a>00553   {
<a name="l00554"></a>00554     <span class="keywordflow">return</span> $this-&gt;validators;
<a name="l00555"></a>00555   }
<a name="l00556"></a>00556 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
