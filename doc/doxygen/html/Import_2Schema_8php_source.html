<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Import/Schema.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfDoctrinePlugin/lib/vendor/doctrine/Doctrine/Import/Schema.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * $Id: Schema.php 1838 2007-06-26 00:58:21Z nicobn $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information, see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://www.doctrine-project.org&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00035"></a><a class="code" href="classDoctrine__Import__Schema.html">00035</a> <span class="keyword">class </span><a class="code" href="classDoctrine__Import__Schema.html">Doctrine_Import_Schema</a>
<a name="l00036"></a>00036 {
<a name="l00042"></a>00042     <span class="keyword">protected</span> <span class="keyword">static</span> $_globalDefinitionKeys = array(
<a name="l00043"></a>00043         <span class="stringliteral">&#39;connection&#39;</span>,
<a name="l00044"></a>00044         <span class="stringliteral">&#39;attributes&#39;</span>,
<a name="l00045"></a>00045         <span class="stringliteral">&#39;templates&#39;</span>,
<a name="l00046"></a>00046         <span class="stringliteral">&#39;actAs&#39;</span>,
<a name="l00047"></a>00047         <span class="stringliteral">&#39;options&#39;</span>,
<a name="l00048"></a>00048         <span class="stringliteral">&#39;package&#39;</span>,
<a name="l00049"></a>00049         <span class="stringliteral">&#39;package_custom_path&#39;</span>,
<a name="l00050"></a>00050         <span class="stringliteral">&#39;inheritance&#39;</span>,
<a name="l00051"></a>00051         <span class="stringliteral">&#39;detect_relations&#39;</span>);
<a name="l00052"></a>00052 
<a name="l00060"></a>00060     <span class="keyword">protected</span> $_relations = array();
<a name="l00061"></a>00061 
<a name="l00070"></a>00070     <span class="keyword">protected</span> $_options = array(<span class="stringliteral">&#39;packagesPrefix&#39;</span>        =&gt;  <span class="stringliteral">&#39;Package&#39;</span>,
<a name="l00071"></a>00071                                 <span class="stringliteral">&#39;packagesPath&#39;</span>          =&gt;  <span class="stringliteral">&#39;&#39;</span>,
<a name="l00072"></a>00072                                 <span class="stringliteral">&#39;packagesFolderName&#39;</span>    =&gt;  <span class="stringliteral">&#39;packages&#39;</span>,
<a name="l00073"></a>00073                                 <span class="stringliteral">&#39;suffix&#39;</span>                =&gt;  <span class="stringliteral">&#39;.php&#39;</span>,
<a name="l00074"></a>00074                                 <span class="stringliteral">&#39;generateBaseClasses&#39;</span>   =&gt;  <span class="keyword">true</span>,
<a name="l00075"></a>00075                                 <span class="stringliteral">&#39;generateTableClasses&#39;</span>  =&gt;  <span class="keyword">false</span>,
<a name="l00076"></a>00076                                 <span class="stringliteral">&#39;generateAccessors&#39;</span>     =&gt;  <span class="keyword">false</span>,
<a name="l00077"></a>00077                                 <span class="stringliteral">&#39;baseClassPrefix&#39;</span>       =&gt;  <span class="stringliteral">&#39;Base&#39;</span>,
<a name="l00078"></a>00078                                 <span class="stringliteral">&#39;baseClassesDirectory&#39;</span>  =&gt;  <span class="stringliteral">&#39;generated&#39;</span>,
<a name="l00079"></a>00079                                 <span class="stringliteral">&#39;baseClassName&#39;</span>         =&gt;  <span class="stringliteral">&#39;Doctrine_Record&#39;</span>);
<a name="l00080"></a>00080 
<a name="l00089"></a>00089     <span class="keyword">protected</span> $_validation = array(<span class="stringliteral">&#39;root&#39;</span>       =&gt;  array(<span class="stringliteral">&#39;abstract&#39;</span>,
<a name="l00090"></a>00090                                                           <span class="stringliteral">&#39;connection&#39;</span>,
<a name="l00091"></a>00091                                                           <span class="stringliteral">&#39;className&#39;</span>,
<a name="l00092"></a>00092                                                           <span class="stringliteral">&#39;tableName&#39;</span>,
<a name="l00093"></a>00093                                                           <span class="stringliteral">&#39;connection&#39;</span>,
<a name="l00094"></a>00094                                                           <span class="stringliteral">&#39;relations&#39;</span>,
<a name="l00095"></a>00095                                                           <span class="stringliteral">&#39;columns&#39;</span>,
<a name="l00096"></a>00096                                                           <span class="stringliteral">&#39;indexes&#39;</span>,
<a name="l00097"></a>00097                                                           <span class="stringliteral">&#39;attributes&#39;</span>,
<a name="l00098"></a>00098                                                           <span class="stringliteral">&#39;templates&#39;</span>,
<a name="l00099"></a>00099                                                           <span class="stringliteral">&#39;actAs&#39;</span>,
<a name="l00100"></a>00100                                                           <span class="stringliteral">&#39;options&#39;</span>,
<a name="l00101"></a>00101                                                           <span class="stringliteral">&#39;package&#39;</span>,
<a name="l00102"></a>00102                                                           <span class="stringliteral">&#39;package_custom_path&#39;</span>,
<a name="l00103"></a>00103                                                           <span class="stringliteral">&#39;inheritance&#39;</span>,
<a name="l00104"></a>00104                                                           <span class="stringliteral">&#39;detect_relations&#39;</span>,
<a name="l00105"></a>00105                                                           <span class="stringliteral">&#39;listeners&#39;</span>,
<a name="l00106"></a>00106                                                           <span class="stringliteral">&#39;checks&#39;</span>,
<a name="l00107"></a>00107                                                           <span class="stringliteral">&#39;comment&#39;</span>),
<a name="l00108"></a>00108 
<a name="l00109"></a>00109                                    <span class="stringliteral">&#39;column&#39;</span>     =&gt;  array(<span class="stringliteral">&#39;name&#39;</span>,
<a name="l00110"></a>00110                                                           <span class="stringliteral">&#39;format&#39;</span>,
<a name="l00111"></a>00111                                                           <span class="stringliteral">&#39;fixed&#39;</span>,
<a name="l00112"></a>00112                                                           <span class="stringliteral">&#39;primary&#39;</span>,
<a name="l00113"></a>00113                                                           <span class="stringliteral">&#39;autoincrement&#39;</span>,
<a name="l00114"></a>00114                                                           <span class="stringliteral">&#39;type&#39;</span>,
<a name="l00115"></a>00115                                                           <span class="stringliteral">&#39;length&#39;</span>,
<a name="l00116"></a>00116                                                           <span class="stringliteral">&#39;size&#39;</span>,
<a name="l00117"></a>00117                                                           <span class="stringliteral">&#39;default&#39;</span>,
<a name="l00118"></a>00118                                                           <span class="stringliteral">&#39;scale&#39;</span>,
<a name="l00119"></a>00119                                                           <span class="stringliteral">&#39;values&#39;</span>,
<a name="l00120"></a>00120                                                           <span class="stringliteral">&#39;comment&#39;</span>,
<a name="l00121"></a>00121                                                           <span class="stringliteral">&#39;sequence&#39;</span>,
<a name="l00122"></a>00122                                                           <span class="stringliteral">&#39;protected&#39;</span>,
<a name="l00123"></a>00123                                                           <span class="stringliteral">&#39;zerofill&#39;</span>,
<a name="l00124"></a>00124                                                           <span class="stringliteral">&#39;owner&#39;</span>,
<a name="l00125"></a>00125                                                           <span class="stringliteral">&#39;extra&#39;</span>,
<a name="l00126"></a>00126                                                           <span class="stringliteral">&#39;comment&#39;</span>,
<a name="l00127"></a>00127                                                           <span class="stringliteral">&#39;charset&#39;</span>,
<a name="l00128"></a>00128                                                           <span class="stringliteral">&#39;collation&#39;</span>),
<a name="l00129"></a>00129 
<a name="l00130"></a>00130                                    <span class="stringliteral">&#39;relation&#39;</span>   =&gt;  array(<span class="stringliteral">&#39;key&#39;</span>,
<a name="l00131"></a>00131                                                           <span class="stringliteral">&#39;class&#39;</span>,
<a name="l00132"></a>00132                                                           <span class="stringliteral">&#39;alias&#39;</span>,
<a name="l00133"></a>00133                                                           <span class="stringliteral">&#39;type&#39;</span>,
<a name="l00134"></a>00134                                                           <span class="stringliteral">&#39;refClass&#39;</span>,
<a name="l00135"></a>00135                                                           <span class="stringliteral">&#39;local&#39;</span>,
<a name="l00136"></a>00136                                                           <span class="stringliteral">&#39;foreign&#39;</span>,
<a name="l00137"></a>00137                                                           <span class="stringliteral">&#39;foreignClass&#39;</span>,
<a name="l00138"></a>00138                                                           <span class="stringliteral">&#39;foreignAlias&#39;</span>,
<a name="l00139"></a>00139                                                           <span class="stringliteral">&#39;foreignType&#39;</span>,
<a name="l00140"></a>00140                                                           <span class="stringliteral">&#39;autoComplete&#39;</span>,
<a name="l00141"></a>00141                                                           <span class="stringliteral">&#39;cascade&#39;</span>,
<a name="l00142"></a>00142                                                           <span class="stringliteral">&#39;onDelete&#39;</span>,
<a name="l00143"></a>00143                                                           <span class="stringliteral">&#39;onUpdate&#39;</span>,
<a name="l00144"></a>00144                                                           <span class="stringliteral">&#39;equal&#39;</span>,
<a name="l00145"></a>00145                                                           <span class="stringliteral">&#39;owningSide&#39;</span>,
<a name="l00146"></a>00146                                                           <span class="stringliteral">&#39;refClassRelationAlias&#39;</span>,
<a name="l00147"></a>00147                                                           <span class="stringliteral">&#39;foreignKeyName&#39;</span>,
<a name="l00148"></a>00148                                                           <span class="stringliteral">&#39;orderBy&#39;</span>),
<a name="l00149"></a>00149 
<a name="l00150"></a>00150                                    <span class="stringliteral">&#39;inheritance&#39;</span>=&gt;  array(<span class="stringliteral">&#39;type&#39;</span>,
<a name="l00151"></a>00151                                                           <span class="stringliteral">&#39;extends&#39;</span>,
<a name="l00152"></a>00152                                                           <span class="stringliteral">&#39;keyField&#39;</span>,
<a name="l00153"></a>00153                                                           <span class="stringliteral">&#39;keyValue&#39;</span>));
<a name="l00154"></a>00154 
<a name="l00160"></a><a class="code" href="classDoctrine__Import__Schema.html#a9c00b3fdcfee6f5f09de7a11638532aa">00160</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classDoctrine__Import__Schema.html#a9c00b3fdcfee6f5f09de7a11638532aa" title="Returns an array of definition keys that can be applied at the global level.">getGlobalDefinitionKeys</a>()
<a name="l00161"></a>00161     {
<a name="l00162"></a>00162         <span class="keywordflow">return</span> self::$_globalDefinitionKeys;
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 
<a name="l00171"></a><a class="code" href="classDoctrine__Import__Schema.html#adb57b1fce9911030b07c6dc94726e123">00171</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Import__Schema.html#adb57b1fce9911030b07c6dc94726e123" title="getOption">getOption</a>($name)
<a name="l00172"></a>00172     {
<a name="l00173"></a>00173         <span class="keywordflow">if</span> (isset($this-&gt;_options[$name]))   {
<a name="l00174"></a>00174             <span class="keywordflow">return</span> $this-&gt;_options[$name];
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177 
<a name="l00183"></a><a class="code" href="classDoctrine__Import__Schema.html#a08bf2d2a88e78a78b0ff0f839107e608">00183</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Import__Schema.html#a08bf2d2a88e78a78b0ff0f839107e608" title="getOptions">getOptions</a>()
<a name="l00184"></a>00184     {
<a name="l00185"></a>00185         <span class="keywordflow">return</span> $this-&gt;_options;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00195"></a><a class="code" href="classDoctrine__Import__Schema.html#a6c09e32e5f6ea09593880a9c1c6db0ba">00195</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Import__Schema.html#a6c09e32e5f6ea09593880a9c1c6db0ba" title="setOption">setOption</a>($name, $value)
<a name="l00196"></a>00196     {
<a name="l00197"></a>00197         <span class="keywordflow">if</span> (isset($this-&gt;_options[$name])) {
<a name="l00198"></a>00198             $this-&gt;_options[$name] = $value;
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201     
<a name="l00208"></a><a class="code" href="classDoctrine__Import__Schema.html#a5a2b445b67d3eb7737422a383b6e2374">00208</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Import__Schema.html#a5a2b445b67d3eb7737422a383b6e2374" title="setOptions">setOptions</a>($options)
<a name="l00209"></a>00209     {
<a name="l00210"></a>00210         <span class="keywordflow">if</span> ( ! empty($options)) {
<a name="l00211"></a>00211           $this-&gt;_options = $options;
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00224"></a><a class="code" href="classDoctrine__Import__Schema.html#acf20a48e1f5f96ac8fa380aae6e813c7">00224</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Import__Schema.html#acf20a48e1f5f96ac8fa380aae6e813c7" title="buildSchema">buildSchema</a>($schema, $format)
<a name="l00225"></a>00225     {
<a name="l00226"></a>00226         $array = array();
<a name="l00227"></a>00227 
<a name="l00228"></a>00228         <span class="keywordflow">foreach</span> ((array) $schema AS $s) {
<a name="l00229"></a>00229             <span class="keywordflow">if</span> (is_file($s)) {
<a name="l00230"></a>00230                 $e = explode(<span class="charliteral">&#39;.&#39;</span>, $s);
<a name="l00231"></a>00231                 <span class="keywordflow">if</span> (end($e) === $format) {
<a name="l00232"></a>00232                     $array = array_merge($array, $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#af099bed32838b520e9a56cc25f74d4e1" title="parseSchema">parseSchema</a>($s, $format));
<a name="l00233"></a>00233                 }          
<a name="l00234"></a>00234             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_dir($s)) {
<a name="l00235"></a>00235                 $it = <span class="keyword">new</span> RecursiveIteratorIterator(<span class="keyword">new</span> RecursiveDirectoryIterator($s),
<a name="l00236"></a>00236                                                       RecursiveIteratorIterator::LEAVES_ONLY);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                 <span class="keywordflow">foreach</span> ($it as $file) {
<a name="l00239"></a>00239                     $e = explode(<span class="charliteral">&#39;.&#39;</span>, $file-&gt;getFileName());
<a name="l00240"></a>00240                     <span class="keywordflow">if</span> (end($e) === $format) {
<a name="l00241"></a>00241                         $array = array_merge($array, $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#af099bed32838b520e9a56cc25f74d4e1" title="parseSchema">parseSchema</a>($file-&gt;getPathName(), $format));
<a name="l00242"></a>00242                     }
<a name="l00243"></a>00243                 }
<a name="l00244"></a>00244             } <span class="keywordflow">else</span> {
<a name="l00245"></a>00245               $array = array_merge($array, $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#af099bed32838b520e9a56cc25f74d4e1" title="parseSchema">parseSchema</a>($s, $format));
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247         }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249         $array = $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a3736e12e4a16b0588e9cd42fb164ffd0" title="buildRelationships">_buildRelationships</a>($array);
<a name="l00250"></a>00250         $array = $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a2c9bd0c1aa24c435b485eeef5c83acd4" title="_processInheritance">_processInheritance</a>($array);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <span class="keywordflow">return</span> $array;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 
<a name="l00267"></a><a class="code" href="classDoctrine__Import__Schema.html#a754246d21fd3a7d059e1edaa5282f419">00267</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Import__Schema.html#a754246d21fd3a7d059e1edaa5282f419" title="importSchema">importSchema</a>($schema, $format = <span class="stringliteral">&#39;yml&#39;</span>, $directory = null, $models = array())
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269         $schema = (array) $schema;
<a name="l00270"></a>00270         $builder = <span class="keyword">new</span> <a class="code" href="classDoctrine__Import__Builder.html">Doctrine_Import_Builder</a>();
<a name="l00271"></a>00271         $builder-&gt;setTargetPath($directory);
<a name="l00272"></a>00272         $builder-&gt;setOptions($this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a08bf2d2a88e78a78b0ff0f839107e608" title="getOptions">getOptions</a>());
<a name="l00273"></a>00273         
<a name="l00274"></a>00274         $array = $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#acf20a48e1f5f96ac8fa380aae6e813c7" title="buildSchema">buildSchema</a>($schema, $format);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="keywordflow">if</span> (count($array) == 0) { 
<a name="l00277"></a>00277             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Import__Exception.html">Doctrine_Import_Exception</a>(
<a name="l00278"></a>00278                 sprintf(<span class="stringliteral">&#39;No &#39;</span> . $format . <span class="stringliteral">&#39; schema found in &#39;</span> . implode(<span class="stringliteral">&quot;, &quot;</span>, $schema))
<a name="l00279"></a>00279             ); 
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         <span class="keywordflow">foreach</span> ($array as $name =&gt; $definition) {
<a name="l00283"></a>00283             <span class="keywordflow">if</span> ( ! empty($models) &amp;&amp; !in_array($definition[<span class="stringliteral">&#39;className&#39;</span>], $models)) {
<a name="l00284"></a>00284                 <span class="keywordflow">continue</span>;
<a name="l00285"></a>00285             }
<a name="l00286"></a>00286             
<a name="l00287"></a>00287             $builder-&gt;buildRecord($definition);
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00301"></a><a class="code" href="classDoctrine__Import__Schema.html#af099bed32838b520e9a56cc25f74d4e1">00301</a>     <span class="keyword">public</span> function <a class="code" href="classDoctrine__Import__Schema.html#af099bed32838b520e9a56cc25f74d4e1" title="parseSchema">parseSchema</a>($schema, $type)
<a name="l00302"></a>00302     {
<a name="l00303"></a>00303         $defaults = array(<span class="stringliteral">&#39;abstract&#39;</span>            =&gt;  <span class="keyword">false</span>,
<a name="l00304"></a>00304                           <span class="stringliteral">&#39;className&#39;</span>           =&gt;  null,
<a name="l00305"></a>00305                           <span class="stringliteral">&#39;tableName&#39;</span>           =&gt;  null,
<a name="l00306"></a>00306                           <span class="stringliteral">&#39;connection&#39;</span>          =&gt;  null,
<a name="l00307"></a>00307                           <span class="stringliteral">&#39;relations&#39;</span>           =&gt;  array(),
<a name="l00308"></a>00308                           <span class="stringliteral">&#39;indexes&#39;</span>             =&gt;  array(),
<a name="l00309"></a>00309                           <span class="stringliteral">&#39;attributes&#39;</span>          =&gt;  array(),
<a name="l00310"></a>00310                           <span class="stringliteral">&#39;templates&#39;</span>           =&gt;  array(),
<a name="l00311"></a>00311                           <span class="stringliteral">&#39;actAs&#39;</span>               =&gt;  array(),
<a name="l00312"></a>00312                           <span class="stringliteral">&#39;options&#39;</span>             =&gt;  array(),
<a name="l00313"></a>00313                           <span class="stringliteral">&#39;package&#39;</span>             =&gt;  null,
<a name="l00314"></a>00314                           <span class="stringliteral">&#39;inheritance&#39;</span>         =&gt;  array(),
<a name="l00315"></a>00315                           <span class="stringliteral">&#39;detect_relations&#39;</span>    =&gt;  <span class="keyword">false</span>);
<a name="l00316"></a>00316         
<a name="l00317"></a>00317         $array = <a class="code" href="classDoctrine__Parser.html#abe5530b6fb249ecd63cb237da642ed65" title="load">Doctrine_Parser::load</a>($schema, $type);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         <span class="comment">// Loop over and build up all the global values and remove them from the array</span>
<a name="l00320"></a>00320         $globals = array();
<a name="l00321"></a>00321         <span class="keywordflow">foreach</span> ($array as $key =&gt; $value) {
<a name="l00322"></a>00322             <span class="keywordflow">if</span> (in_array($key, self::$_globalDefinitionKeys)) {
<a name="l00323"></a>00323                 unset($array[$key]);
<a name="l00324"></a>00324                 $globals[$key] = $value;
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <span class="comment">// Merge the globals that aren&#39;t specifically set to each class</span>
<a name="l00329"></a>00329         <span class="keywordflow">foreach</span> ($array as $className =&gt; $table) {
<a name="l00330"></a>00330             $array[$className] = Doctrine_Lib::arrayDeepMerge($globals, $array[$className]);
<a name="l00331"></a>00331         }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         $build = array();
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="keywordflow">foreach</span> ($array as $className =&gt; $table) {
<a name="l00336"></a>00336             $table = (array) $table;
<a name="l00337"></a>00337             $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a9a4e5c3ba90655b7ce9392f8c39d9805" title="_validateSchemaElement">_validateSchemaElement</a>(<span class="stringliteral">&#39;root&#39;</span>, array_keys($table), $className);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339             $columns = array();
<a name="l00340"></a>00340 
<a name="l00341"></a>00341             $className = isset($table[<span class="stringliteral">&#39;className&#39;</span>]) ? (string) $table[<span class="stringliteral">&#39;className&#39;</span>]:(<span class="keywordtype">string</span>) $className;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343             <span class="keywordflow">if</span> (isset($table[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>]) || isset($table[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyValue&#39;</span>])) {
<a name="l00344"></a>00344                 $table[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;column_aggregation&#39;</span>;
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347             <span class="keywordflow">if</span> (isset($table[<span class="stringliteral">&#39;tableName&#39;</span>]) &amp;&amp; $table[<span class="stringliteral">&#39;tableName&#39;</span>]) {
<a name="l00348"></a>00348                 $tableName = $table[<span class="stringliteral">&#39;tableName&#39;</span>];
<a name="l00349"></a>00349             } <span class="keywordflow">else</span> {
<a name="l00350"></a>00350                 <span class="keywordflow">if</span> (isset($table[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($table[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;column_aggregation&#39;</span>)) {
<a name="l00351"></a>00351                     $tableName = null;
<a name="l00352"></a>00352                 } <span class="keywordflow">else</span> {
<a name="l00353"></a>00353                     $tableName = <a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($className);
<a name="l00354"></a>00354                 }
<a name="l00355"></a>00355             }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357             $connection = isset($table[<span class="stringliteral">&#39;connection&#39;</span>]) ? $table[<span class="stringliteral">&#39;connection&#39;</span>]:<span class="stringliteral">&#39;current&#39;</span>;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359             $columns = isset($table[<span class="stringliteral">&#39;columns&#39;</span>]) ? $table[<span class="stringliteral">&#39;columns&#39;</span>]:array();
<a name="l00360"></a>00360 
<a name="l00361"></a>00361             <span class="keywordflow">if</span> ( ! empty($columns)) {
<a name="l00362"></a>00362                 <span class="keywordflow">foreach</span> ($columns as $columnName =&gt; $field) {
<a name="l00363"></a>00363 
<a name="l00364"></a>00364                     <span class="comment">// Support short syntax: my_column: integer(4)</span>
<a name="l00365"></a>00365                     <span class="keywordflow">if</span> ( ! is_array($field)) {
<a name="l00366"></a>00366                         $original = $field;
<a name="l00367"></a>00367                         $field = array();
<a name="l00368"></a>00368                         $field[<span class="stringliteral">&#39;type&#39;</span>] = $original;
<a name="l00369"></a>00369                     }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371                     $colDesc = array();
<a name="l00372"></a>00372                     <span class="keywordflow">if</span> (isset($field[<span class="stringliteral">&#39;name&#39;</span>])) {
<a name="l00373"></a>00373                         $colDesc[<span class="stringliteral">&#39;name&#39;</span>] = $field[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00374"></a>00374                     } <span class="keywordflow">else</span> {
<a name="l00375"></a>00375                         $colDesc[<span class="stringliteral">&#39;name&#39;</span>] = $columnName;
<a name="l00376"></a>00376                     }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378                     $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a9a4e5c3ba90655b7ce9392f8c39d9805" title="_validateSchemaElement">_validateSchemaElement</a>(<span class="stringliteral">&#39;column&#39;</span>, array_keys($field), $className . <span class="stringliteral">&#39;-&gt;columns-&gt;&#39;</span> . $colDesc[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380                     <span class="comment">// Support short type(length) syntax: my_column: { type: integer(4) }</span>
<a name="l00381"></a>00381                     $e = explode(<span class="charliteral">&#39;(&#39;</span>, $field[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l00382"></a>00382                     <span class="keywordflow">if</span> (isset($e[0]) &amp;&amp; isset($e[1])) {
<a name="l00383"></a>00383                         $colDesc[<span class="stringliteral">&#39;type&#39;</span>] = $e[0];
<a name="l00384"></a>00384                         $value = substr($e[1], 0, strlen($e[1]) - 1);
<a name="l00385"></a>00385                         $e = explode(<span class="charliteral">&#39;,&#39;</span>, $value);
<a name="l00386"></a>00386                         $colDesc[<span class="stringliteral">&#39;length&#39;</span>] = $e[0];
<a name="l00387"></a>00387                         <span class="keywordflow">if</span> (isset($e[1]) &amp;&amp; $e[1]) {
<a name="l00388"></a>00388                             $colDesc[<span class="stringliteral">&#39;scale&#39;</span>] = $e[1];
<a name="l00389"></a>00389                         }
<a name="l00390"></a>00390                     } <span class="keywordflow">else</span> {
<a name="l00391"></a>00391                         $colDesc[<span class="stringliteral">&#39;type&#39;</span>] = isset($field[<span class="stringliteral">&#39;type&#39;</span>]) ? (string) $field[<span class="stringliteral">&#39;type&#39;</span>]:null;
<a name="l00392"></a>00392                         $colDesc[<span class="stringliteral">&#39;length&#39;</span>] = isset($field[<span class="stringliteral">&#39;length&#39;</span>]) ? (int) $field[<span class="stringliteral">&#39;length&#39;</span>]:null;
<a name="l00393"></a>00393                         $colDesc[<span class="stringliteral">&#39;length&#39;</span>] = isset($field[<span class="stringliteral">&#39;size&#39;</span>]) ? (int) $field[<span class="stringliteral">&#39;size&#39;</span>]:$colDesc[<span class="stringliteral">&#39;length&#39;</span>];
<a name="l00394"></a>00394                     }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396                     $colDesc[<span class="stringliteral">&#39;fixed&#39;</span>] = isset($field[<span class="stringliteral">&#39;fixed&#39;</span>]) ? (int) $field[<span class="stringliteral">&#39;fixed&#39;</span>]:null;
<a name="l00397"></a>00397                     $colDesc[<span class="stringliteral">&#39;primary&#39;</span>] = isset($field[<span class="stringliteral">&#39;primary&#39;</span>]) ? (bool) (isset($field[<span class="stringliteral">&#39;primary&#39;</span>]) &amp;&amp; $field[<span class="stringliteral">&#39;primary&#39;</span>]):null;
<a name="l00398"></a>00398                     $colDesc[<span class="stringliteral">&#39;default&#39;</span>] = isset($field[<span class="stringliteral">&#39;default&#39;</span>]) ? $field[<span class="stringliteral">&#39;default&#39;</span>]:null;
<a name="l00399"></a>00399                     $colDesc[<span class="stringliteral">&#39;autoincrement&#39;</span>] = isset($field[<span class="stringliteral">&#39;autoincrement&#39;</span>]) ? (bool) (isset($field[<span class="stringliteral">&#39;autoincrement&#39;</span>]) &amp;&amp; $field[<span class="stringliteral">&#39;autoincrement&#39;</span>]):null;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401                     <span class="keywordflow">if</span> (isset($field[<span class="stringliteral">&#39;sequence&#39;</span>])) {
<a name="l00402"></a>00402                         <span class="keywordflow">if</span> (<span class="keyword">true</span> === $field[<span class="stringliteral">&#39;sequence&#39;</span>]) {
<a name="l00403"></a>00403                             $colDesc[<span class="stringliteral">&#39;sequence&#39;</span>] = $tableName;
<a name="l00404"></a>00404                         } <span class="keywordflow">else</span> {
<a name="l00405"></a>00405                             $colDesc[<span class="stringliteral">&#39;sequence&#39;</span>] = (string) $field[<span class="stringliteral">&#39;sequence&#39;</span>];
<a name="l00406"></a>00406                         }
<a name="l00407"></a>00407                     } <span class="keywordflow">else</span> {
<a name="l00408"></a>00408                         $colDesc[<span class="stringliteral">&#39;sequence&#39;</span>] = null;
<a name="l00409"></a>00409                     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411                     $colDesc[<span class="stringliteral">&#39;values&#39;</span>] = isset($field[<span class="stringliteral">&#39;values&#39;</span>]) ? (array) $field[<span class="stringliteral">&#39;values&#39;</span>]:null;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413                     <span class="comment">// Include all the specified and valid validators in the colDesc</span>
<a name="l00414"></a>00414                     $validators = <a class="code" href="classDoctrine__Manager.html#a0f1f11c9be78468eed7768f4130aac2e" title="Returns an instance of this class (this class uses the singleton pattern).">Doctrine_Manager::getInstance</a>()-&gt;getValidators();
<a name="l00415"></a>00415 
<a name="l00416"></a>00416                     <span class="keywordflow">foreach</span> ($validators as $validator) {
<a name="l00417"></a>00417                         <span class="keywordflow">if</span> (isset($field[$validator])) {
<a name="l00418"></a>00418                             $colDesc[$validator] = $field[$validator];
<a name="l00419"></a>00419                         }
<a name="l00420"></a>00420                     }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422                     $columns[(string) $columnName] = $colDesc;
<a name="l00423"></a>00423                 }
<a name="l00424"></a>00424             }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426             <span class="comment">// Apply the default values</span>
<a name="l00427"></a>00427             <span class="keywordflow">foreach</span> ($defaults as $key =&gt; $defaultValue) {
<a name="l00428"></a>00428                 <span class="keywordflow">if</span> (isset($table[$key]) &amp;&amp; ! isset($build[$className][$key])) {
<a name="l00429"></a>00429                     $build[$className][$key] = $table[$key];
<a name="l00430"></a>00430                 } <span class="keywordflow">else</span> {
<a name="l00431"></a>00431                     $build[$className][$key] = isset($build[$className][$key]) ? $build[$className][$key]:$defaultValue;
<a name="l00432"></a>00432                 }
<a name="l00433"></a>00433             }
<a name="l00434"></a>00434             
<a name="l00435"></a>00435             $build[$className][<span class="stringliteral">&#39;className&#39;</span>] = $className;
<a name="l00436"></a>00436             $build[$className][<span class="stringliteral">&#39;tableName&#39;</span>] = $tableName;
<a name="l00437"></a>00437             $build[$className][<span class="stringliteral">&#39;columns&#39;</span>] = $columns;
<a name="l00438"></a>00438             
<a name="l00439"></a>00439             <span class="comment">// Make sure that anything else that is specified in the schema makes it to the final array</span>
<a name="l00440"></a>00440             $build[$className] = Doctrine_Lib::arrayDeepMerge($table, $build[$className]);
<a name="l00441"></a>00441             
<a name="l00442"></a>00442             <span class="comment">// We need to keep track of the className for the connection</span>
<a name="l00443"></a>00443             $build[$className][<span class="stringliteral">&#39;connectionClassName&#39;</span>] = $build[$className][<span class="stringliteral">&#39;className&#39;</span>];
<a name="l00444"></a>00444         }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         <span class="keywordflow">return</span> $build;
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448 
<a name="l00458"></a><a class="code" href="classDoctrine__Import__Schema.html#a2c9bd0c1aa24c435b485eeef5c83acd4">00458</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Import__Schema.html#a2c9bd0c1aa24c435b485eeef5c83acd4" title="_processInheritance">_processInheritance</a>($array)
<a name="l00459"></a>00459     {
<a name="l00460"></a>00460         <span class="comment">// Apply default inheritance configuration</span>
<a name="l00461"></a>00461         <span class="keywordflow">foreach</span> ($array as $className =&gt; $definition) {
<a name="l00462"></a>00462             <span class="keywordflow">if</span> ( ! empty($array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>])) {
<a name="l00463"></a>00463                 $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a9a4e5c3ba90655b7ce9392f8c39d9805" title="_validateSchemaElement">_validateSchemaElement</a>(<span class="stringliteral">&#39;inheritance&#39;</span>, array_keys($definition[<span class="stringliteral">&#39;inheritance&#39;</span>]), $className . <span class="stringliteral">&#39;-&gt;inheritance&#39;</span>);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465                 <span class="comment">// Default inheritance to concrete inheritance</span>
<a name="l00466"></a>00466                 <span class="keywordflow">if</span> ( ! isset($array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l00467"></a>00467                     $array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;concrete&#39;</span>;
<a name="l00468"></a>00468                 }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                 <span class="comment">// Some magic for setting up the keyField and keyValue column aggregation options</span>
<a name="l00471"></a>00471                 <span class="comment">// Adds keyField to the parent class automatically</span>
<a name="l00472"></a>00472                 <span class="keywordflow">if</span> ($array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;column_aggregation&#39;</span>) {
<a name="l00473"></a>00473                     <span class="comment">// Set the keyField to &#39;type&#39; by default</span>
<a name="l00474"></a>00474                     <span class="keywordflow">if</span> ( ! isset($array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>])) {
<a name="l00475"></a>00475                         $array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>] = <span class="stringliteral">&#39;type&#39;</span>;                        
<a name="l00476"></a>00476                     }
<a name="l00477"></a>00477                     
<a name="l00478"></a>00478                     <span class="comment">// Set the keyValue to the name of the child class if it does not exist</span>
<a name="l00479"></a>00479                     <span class="keywordflow">if</span> ( ! isset($array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyValue&#39;</span>])) {
<a name="l00480"></a>00480                         $array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyValue&#39;</span>] = $className;
<a name="l00481"></a>00481                     }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483                     $parent = $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a15057ad4084849da744e2aff17c74816" title="Find the base super class for this inheritance child.">_findBaseSuperClass</a>($array, $definition[<span class="stringliteral">&#39;className&#39;</span>]);
<a name="l00484"></a>00484                     <span class="comment">// Add the keyType column to the parent if a definition does not already exist</span>
<a name="l00485"></a>00485                     <span class="keywordflow">if</span> ( ! isset($array[$parent][<span class="stringliteral">&#39;columns&#39;</span>][$array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>]])) {
<a name="l00486"></a>00486                         $array[$parent][<span class="stringliteral">&#39;columns&#39;</span>][$array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>]] = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $array[$className][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>], <span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>, <span class="stringliteral">&#39;length&#39;</span> =&gt; 255);
<a name="l00487"></a>00487                     }
<a name="l00488"></a>00488                 }
<a name="l00489"></a>00489             }
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492         <span class="comment">// Array of the array keys to move to the parent, and the value to default the child definition to</span>
<a name="l00493"></a>00493         <span class="comment">// after moving it. Will also populate the subclasses array for the inheritance parent</span>
<a name="l00494"></a>00494         $moves = array(<span class="stringliteral">&#39;columns&#39;</span> =&gt; array(),
<a name="l00495"></a>00495                        <span class="stringliteral">&#39;indexes&#39;</span> =&gt; array(),
<a name="l00496"></a>00496                        <span class="stringliteral">&#39;attributes&#39;</span> =&gt; array(),
<a name="l00497"></a>00497                        <span class="stringliteral">&#39;options&#39;</span> =&gt; array(),
<a name="l00498"></a>00498                        <span class="stringliteral">&#39;checks&#39;</span> =&gt; array());
<a name="l00499"></a>00499 
<a name="l00500"></a>00500         <span class="keywordflow">foreach</span> ($array as $className =&gt; $definition) {
<a name="l00501"></a>00501             <span class="comment">// Move any definitions on the schema to the parent</span>
<a name="l00502"></a>00502             <span class="keywordflow">if</span> (isset($definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;extends&#39;</span>]) &amp;&amp; isset($definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;simple&#39;</span> || $definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;column_aggregation&#39;</span>)) {
<a name="l00503"></a>00503                 $parent = $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a15057ad4084849da744e2aff17c74816" title="Find the base super class for this inheritance child.">_findBaseSuperClass</a>($array, $definition[<span class="stringliteral">&#39;className&#39;</span>]);
<a name="l00504"></a>00504                 <span class="keywordflow">foreach</span> ($moves as $move =&gt; $resetValue) {
<a name="l00505"></a>00505                     <span class="keywordflow">if</span> (isset($array[$parent][$move]) &amp;&amp; isset($definition[$move])) {
<a name="l00506"></a>00506                         $array[$parent][$move] = Doctrine_Lib::arrayDeepMerge($array[$parent][$move], $definition[$move]);
<a name="l00507"></a>00507                         $array[$definition[<span class="stringliteral">&#39;className&#39;</span>]][$move] = $resetValue;
<a name="l00508"></a>00508                     }
<a name="l00509"></a>00509                 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511                 <span class="comment">// Populate the parents subclasses</span>
<a name="l00512"></a>00512                 <span class="keywordflow">if</span> ($definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;column_aggregation&#39;</span>) {
<a name="l00513"></a>00513                     <span class="comment">// Fix for 2015: loop through superclasses&#39; inheritance to the base-superclass to  </span>
<a name="l00514"></a>00514                     <span class="comment">// make sure we collect all keyFields needed (and not only the first) </span>
<a name="l00515"></a>00515                     $inheritanceFields = array($definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>] =&gt; $definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyValue&#39;</span>]); 
<a name="l00516"></a>00516 
<a name="l00517"></a>00517                     $superClass = $definition[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;extends&#39;</span>]; 
<a name="l00518"></a>00518                     $multiInheritanceDef = $array[$superClass]; 
<a name="l00519"></a>00519 
<a name="l00520"></a>00520                     <span class="keywordflow">while</span> (count($multiInheritanceDef[<span class="stringliteral">&#39;inheritance&#39;</span>]) &gt; 0 &amp;&amp; array_key_exists(<span class="stringliteral">&#39;extends&#39;</span>, $multiInheritanceDef[<span class="stringliteral">&#39;inheritance&#39;</span>]) &amp;&amp; $multiInheritanceDef[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;column_aggregation&#39;</span>) { 
<a name="l00521"></a>00521                         $superClass = $multiInheritanceDef[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;extends&#39;</span>];
<a name="l00522"></a>00522                         
<a name="l00523"></a>00523                         <span class="comment">// keep original keyField with it&#39;s keyValue</span>
<a name="l00524"></a>00524                         <span class="keywordflow">if</span> ( ! isset($inheritanceFields[$multiInheritanceDef[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>]])) { 
<a name="l00525"></a>00525                             $inheritanceFields[$multiInheritanceDef[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyField&#39;</span>]] = $multiInheritanceDef[<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;keyValue&#39;</span>];
<a name="l00526"></a>00526                         } 
<a name="l00527"></a>00527                         $multiInheritanceDef = $array[$superClass]; 
<a name="l00528"></a>00528                     } 
<a name="l00529"></a>00529 
<a name="l00530"></a>00530                     $array[$parent][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;subclasses&#39;</span>][$definition[<span class="stringliteral">&#39;className&#39;</span>]] = $inheritanceFields;
<a name="l00531"></a>00531                 }
<a name="l00532"></a>00532             }
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         <span class="keywordflow">return</span> $array;
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537 
<a name="l00545"></a><a class="code" href="classDoctrine__Import__Schema.html#a15057ad4084849da744e2aff17c74816">00545</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Import__Schema.html#a15057ad4084849da744e2aff17c74816" title="Find the base super class for this inheritance child.">_findBaseSuperClass</a>($array, $class)
<a name="l00546"></a>00546     {
<a name="l00547"></a>00547         <span class="keywordflow">if</span> (isset($array[$class][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;extends&#39;</span>]) &amp;&amp; isset($array[$class][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($array[$class][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;simple&#39;</span> || $array[$class][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;column_aggregation&#39;</span>)) {
<a name="l00548"></a>00548             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a15057ad4084849da744e2aff17c74816" title="Find the base super class for this inheritance child.">_findBaseSuperClass</a>($array, $array[$class][<span class="stringliteral">&#39;inheritance&#39;</span>][<span class="stringliteral">&#39;extends&#39;</span>]);
<a name="l00549"></a>00549         } <span class="keywordflow">else</span> {
<a name="l00550"></a>00550             <span class="keywordflow">return</span> $class;
<a name="l00551"></a>00551         }
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 
<a name="l00564"></a><a class="code" href="classDoctrine__Import__Schema.html#a3736e12e4a16b0588e9cd42fb164ffd0">00564</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Import__Schema.html#a3736e12e4a16b0588e9cd42fb164ffd0" title="buildRelationships">_buildRelationships</a>($array)
<a name="l00565"></a>00565     {
<a name="l00566"></a>00566         <span class="comment">// Handle auto detecting relations by the names of columns</span>
<a name="l00567"></a>00567         <span class="comment">// User.contact_id will automatically create User hasOne Contact local =&gt; contact_id, foreign =&gt; id</span>
<a name="l00568"></a>00568         <span class="keywordflow">foreach</span> ($array as $className =&gt; $properties) {
<a name="l00569"></a>00569             <span class="keywordflow">if</span> (isset($properties[<span class="stringliteral">&#39;columns&#39;</span>]) &amp;&amp; ! empty($properties[<span class="stringliteral">&#39;columns&#39;</span>]) &amp;&amp; isset($properties[<span class="stringliteral">&#39;detect_relations&#39;</span>]) &amp;&amp; $properties[<span class="stringliteral">&#39;detect_relations&#39;</span>]) {
<a name="l00570"></a>00570                 <span class="keywordflow">foreach</span> ($properties[<span class="stringliteral">&#39;columns&#39;</span>] as $column) {
<a name="l00571"></a>00571                     <span class="comment">// Check if the column we are inflecting has a _id on the end of it before trying to inflect it and find</span>
<a name="l00572"></a>00572                     <span class="comment">// the class name for the column</span>
<a name="l00573"></a>00573                     <span class="keywordflow">if</span> (strpos($column[<span class="stringliteral">&#39;name&#39;</span>], <span class="stringliteral">&#39;_id&#39;</span>)) {
<a name="l00574"></a>00574                         $columnClassName = <a class="code" href="classDoctrine__Inflector.html#a6de81894754d68756b8e413cf6ee35fb" title="Convert a word in to the format for a Doctrine class name.">Doctrine_Inflector::classify</a>(str_replace(<span class="stringliteral">&#39;_id&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $column[<span class="stringliteral">&#39;name&#39;</span>]));
<a name="l00575"></a>00575                         <span class="keywordflow">if</span> (isset($array[$columnClassName]) &amp;&amp; !isset($array[$className][<span class="stringliteral">&#39;relations&#39;</span>][$columnClassName])) {
<a name="l00576"></a>00576                             $array[$className][<span class="stringliteral">&#39;relations&#39;</span>][$columnClassName] = array();
<a name="l00577"></a>00577 
<a name="l00578"></a>00578                             <span class="comment">// Set the detected foreign key type and length to the same as the primary key</span>
<a name="l00579"></a>00579                             <span class="comment">// of the related table</span>
<a name="l00580"></a>00580                             $type = isset($array[$columnClassName][<span class="stringliteral">&#39;columns&#39;</span>][<span class="stringliteral">&#39;id&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]) ? $array[$columnClassName][<span class="stringliteral">&#39;columns&#39;</span>][<span class="stringliteral">&#39;id&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]:<span class="stringliteral">&#39;integer&#39;</span>;
<a name="l00581"></a>00581                             $length = isset($array[$columnClassName][<span class="stringliteral">&#39;columns&#39;</span>][<span class="stringliteral">&#39;id&#39;</span>][<span class="stringliteral">&#39;length&#39;</span>]) ? $array[$columnClassName][<span class="stringliteral">&#39;columns&#39;</span>][<span class="stringliteral">&#39;id&#39;</span>][<span class="stringliteral">&#39;length&#39;</span>]:8;
<a name="l00582"></a>00582                             $array[$className][<span class="stringliteral">&#39;columns&#39;</span>][$column[<span class="stringliteral">&#39;name&#39;</span>]][<span class="stringliteral">&#39;type&#39;</span>] = $type;
<a name="l00583"></a>00583                             $array[$className][<span class="stringliteral">&#39;columns&#39;</span>][$column[<span class="stringliteral">&#39;name&#39;</span>]][<span class="stringliteral">&#39;length&#39;</span>] = $length;
<a name="l00584"></a>00584                         }
<a name="l00585"></a>00585                     }
<a name="l00586"></a>00586                 }
<a name="l00587"></a>00587             }
<a name="l00588"></a>00588         }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590         <span class="keywordflow">foreach</span> ($array as $name =&gt; $properties) {
<a name="l00591"></a>00591             <span class="keywordflow">if</span> ( ! isset($properties[<span class="stringliteral">&#39;relations&#39;</span>])) {
<a name="l00592"></a>00592                 <span class="keywordflow">continue</span>;
<a name="l00593"></a>00593             }
<a name="l00594"></a>00594             
<a name="l00595"></a>00595             $className = $properties[<span class="stringliteral">&#39;className&#39;</span>];
<a name="l00596"></a>00596             $relations = $properties[<span class="stringliteral">&#39;relations&#39;</span>];
<a name="l00597"></a>00597             
<a name="l00598"></a>00598             <span class="keywordflow">foreach</span> ($relations as $alias =&gt; $relation) {
<a name="l00599"></a>00599                 $class = isset($relation[<span class="stringliteral">&#39;class&#39;</span>]) ? $relation[<span class="stringliteral">&#39;class&#39;</span>]:$alias;
<a name="l00600"></a>00600                 <span class="keywordflow">if</span> ( ! isset($array[$class])) {
<a name="l00601"></a>00601                     <span class="keywordflow">continue</span>;
<a name="l00602"></a>00602                 }
<a name="l00603"></a>00603                 $relation[<span class="stringliteral">&#39;class&#39;</span>] = $class;
<a name="l00604"></a>00604                 $relation[<span class="stringliteral">&#39;alias&#39;</span>] = isset($relation[<span class="stringliteral">&#39;alias&#39;</span>]) ? $relation[<span class="stringliteral">&#39;alias&#39;</span>] : $alias;
<a name="l00605"></a>00605                 
<a name="l00606"></a>00606                 <span class="comment">// Attempt to guess the local and foreign</span>
<a name="l00607"></a>00607                 <span class="keywordflow">if</span> (isset($relation[<span class="stringliteral">&#39;refClass&#39;</span>])) {
<a name="l00608"></a>00608                     $relation[<span class="stringliteral">&#39;local&#39;</span>] = isset($relation[<span class="stringliteral">&#39;local&#39;</span>]) ? $relation[<span class="stringliteral">&#39;local&#39;</span>]:<a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($name) . <span class="stringliteral">&#39;_id&#39;</span>;
<a name="l00609"></a>00609                     $relation[<span class="stringliteral">&#39;foreign&#39;</span>] = isset($relation[<span class="stringliteral">&#39;foreign&#39;</span>]) ? $relation[<span class="stringliteral">&#39;foreign&#39;</span>]:<a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($class) . <span class="stringliteral">&#39;_id&#39;</span>;
<a name="l00610"></a>00610                 } <span class="keywordflow">else</span> {
<a name="l00611"></a>00611                     $relation[<span class="stringliteral">&#39;local&#39;</span>] = isset($relation[<span class="stringliteral">&#39;local&#39;</span>]) ? $relation[<span class="stringliteral">&#39;local&#39;</span>]:<a class="code" href="classDoctrine__Inflector.html#a7dfbf475eb6e0db51072791298af6468" title="Convert word in to the format for a Doctrine table name.">Doctrine_Inflector::tableize</a>($relation[<span class="stringliteral">&#39;class&#39;</span>]) . <span class="stringliteral">&#39;_id&#39;</span>;
<a name="l00612"></a>00612                     $relation[<span class="stringliteral">&#39;foreign&#39;</span>] = isset($relation[<span class="stringliteral">&#39;foreign&#39;</span>]) ? $relation[<span class="stringliteral">&#39;foreign&#39;</span>]:<span class="stringliteral">&#39;id&#39;</span>;
<a name="l00613"></a>00613                 }
<a name="l00614"></a>00614                 
<a name="l00615"></a>00615                 <span class="keywordflow">if</span> (isset($relation[<span class="stringliteral">&#39;refClass&#39;</span>])) {
<a name="l00616"></a>00616                     $relation[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;many&#39;</span>;
<a name="l00617"></a>00617                 }
<a name="l00618"></a>00618                 
<a name="l00619"></a>00619                 <span class="keywordflow">if</span> (isset($relation[<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; $relation[<span class="stringliteral">&#39;type&#39;</span>]) {
<a name="l00620"></a>00620                     $relation[<span class="stringliteral">&#39;type&#39;</span>] = $relation[<span class="stringliteral">&#39;type&#39;</span>] === <span class="stringliteral">&#39;one&#39;</span> ? <a class="code" href="classDoctrine__Relation.html#ad1d58e954205119e9796bec18d516970" title="RELATION CONSTANTS.">Doctrine_Relation::ONE</a>:<a class="code" href="classDoctrine__Relation.html#a9cf5a7937bfa222693f99ce4b2b22864" title="constant for MANY_TO_MANY and ONE_TO_MANY relationships">Doctrine_Relation::MANY</a>;
<a name="l00621"></a>00621                 } <span class="keywordflow">else</span> {
<a name="l00622"></a>00622                     $relation[<span class="stringliteral">&#39;type&#39;</span>] = <a class="code" href="classDoctrine__Relation.html#ad1d58e954205119e9796bec18d516970" title="RELATION CONSTANTS.">Doctrine_Relation::ONE</a>;
<a name="l00623"></a>00623                 }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625                 <span class="keywordflow">if</span> (isset($relation[<span class="stringliteral">&#39;foreignType&#39;</span>]) &amp;&amp; $relation[<span class="stringliteral">&#39;foreignType&#39;</span>]) {
<a name="l00626"></a>00626                     $relation[<span class="stringliteral">&#39;foreignType&#39;</span>] = $relation[<span class="stringliteral">&#39;foreignType&#39;</span>] === <span class="stringliteral">&#39;one&#39;</span> ? <a class="code" href="classDoctrine__Relation.html#ad1d58e954205119e9796bec18d516970" title="RELATION CONSTANTS.">Doctrine_Relation::ONE</a>:<a class="code" href="classDoctrine__Relation.html#a9cf5a7937bfa222693f99ce4b2b22864" title="constant for MANY_TO_MANY and ONE_TO_MANY relationships">Doctrine_Relation::MANY</a>;
<a name="l00627"></a>00627                 }
<a name="l00628"></a>00628                 
<a name="l00629"></a>00629                 $relation[<span class="stringliteral">&#39;key&#39;</span>] = $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a38302161c9c4044a427a338f06b3c6b9" title="_buildUniqueRelationKey">_buildUniqueRelationKey</a>($relation);
<a name="l00630"></a>00630                 
<a name="l00631"></a>00631                 $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a9a4e5c3ba90655b7ce9392f8c39d9805" title="_validateSchemaElement">_validateSchemaElement</a>(<span class="stringliteral">&#39;relation&#39;</span>, array_keys($relation), $className . <span class="stringliteral">&#39;-&gt;relation-&gt;&#39;</span> . $relation[<span class="stringliteral">&#39;alias&#39;</span>]);
<a name="l00632"></a>00632                 
<a name="l00633"></a>00633                 $this-&gt;_relations[$className][$alias] = $relation;
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636         
<a name="l00637"></a>00637         <span class="comment">// Now we auto-complete opposite ends of relationships</span>
<a name="l00638"></a>00638         $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#aa2f1e61c6732b5cd180d72bea31fdbbc" title="fixRelationships">_autoCompleteOppositeRelations</a>();
<a name="l00639"></a>00639         
<a name="l00640"></a>00640         <span class="comment">// Make sure we do not have any duplicate relations</span>
<a name="l00641"></a>00641         $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a154ac773448045c2dd2ffcfcf0a84380" title="_fixDuplicateRelations">_fixDuplicateRelations</a>();
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="comment">// Set the full array of relationships for each class to the final array</span>
<a name="l00644"></a>00644         <span class="keywordflow">foreach</span> ($this-&gt;_relations as $className =&gt; $relations) {
<a name="l00645"></a>00645             $array[$className][<span class="stringliteral">&#39;relations&#39;</span>] = $relations;
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647         
<a name="l00648"></a>00648         <span class="keywordflow">return</span> $array;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 
<a name="l00659"></a><a class="code" href="classDoctrine__Import__Schema.html#aa2f1e61c6732b5cd180d72bea31fdbbc">00659</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Import__Schema.html#aa2f1e61c6732b5cd180d72bea31fdbbc" title="fixRelationships">_autoCompleteOppositeRelations</a>()
<a name="l00660"></a>00660     {
<a name="l00661"></a>00661         <span class="keywordflow">foreach</span>($this-&gt;_relations as $className =&gt; $relations) {
<a name="l00662"></a>00662             <span class="keywordflow">foreach</span> ($relations AS $alias =&gt; $relation) {
<a name="l00663"></a>00663                 <span class="keywordflow">if</span> ((isset($relation[<span class="stringliteral">&#39;equal&#39;</span>]) &amp;&amp; $relation[<span class="stringliteral">&#39;equal&#39;</span>]) || (isset($relation[<span class="stringliteral">&#39;autoComplete&#39;</span>]) &amp;&amp; $relation[<span class="stringliteral">&#39;autoComplete&#39;</span>] === <span class="keyword">false</span>)) {
<a name="l00664"></a>00664                     <span class="keywordflow">continue</span>;
<a name="l00665"></a>00665                 }
<a name="l00666"></a>00666                 
<a name="l00667"></a>00667                 $newRelation = array();
<a name="l00668"></a>00668                 $newRelation[<span class="stringliteral">&#39;foreign&#39;</span>] = $relation[<span class="stringliteral">&#39;local&#39;</span>];
<a name="l00669"></a>00669                 $newRelation[<span class="stringliteral">&#39;local&#39;</span>] = $relation[<span class="stringliteral">&#39;foreign&#39;</span>];
<a name="l00670"></a>00670                 $newRelation[<span class="stringliteral">&#39;class&#39;</span>] = isset($relation[<span class="stringliteral">&#39;foreignClass&#39;</span>]) ? $relation[<span class="stringliteral">&#39;foreignClass&#39;</span>]:$className;
<a name="l00671"></a>00671                 $newRelation[<span class="stringliteral">&#39;alias&#39;</span>] = isset($relation[<span class="stringliteral">&#39;foreignAlias&#39;</span>]) ? $relation[<span class="stringliteral">&#39;foreignAlias&#39;</span>]:$className;
<a name="l00672"></a>00672                 $newRelation[<span class="stringliteral">&#39;foreignAlias&#39;</span>] = $alias;
<a name="l00673"></a>00673                 
<a name="l00674"></a>00674                 <span class="comment">// this is so that we know that this relation was autogenerated and</span>
<a name="l00675"></a>00675                 <span class="comment">// that we do not need to include it if it is explicitly declared in the schema by the users.</span>
<a name="l00676"></a>00676                 $newRelation[<span class="stringliteral">&#39;autogenerated&#39;</span>] = <span class="keyword">true</span>; 
<a name="l00677"></a>00677                 
<a name="l00678"></a>00678                 <span class="keywordflow">if</span> (isset($relation[<span class="stringliteral">&#39;refClass&#39;</span>])) {
<a name="l00679"></a>00679                     $newRelation[<span class="stringliteral">&#39;refClass&#39;</span>] = $relation[<span class="stringliteral">&#39;refClass&#39;</span>];
<a name="l00680"></a>00680                     $newRelation[<span class="stringliteral">&#39;type&#39;</span>] = isset($relation[<span class="stringliteral">&#39;foreignType&#39;</span>]) ? $relation[<span class="stringliteral">&#39;foreignType&#39;</span>]:$relation[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l00681"></a>00681                 } <span class="keywordflow">else</span> {                
<a name="l00682"></a>00682                     <span class="keywordflow">if</span> (isset($relation[<span class="stringliteral">&#39;foreignType&#39;</span>])) {
<a name="l00683"></a>00683                         $newRelation[<span class="stringliteral">&#39;type&#39;</span>] = $relation[<span class="stringliteral">&#39;foreignType&#39;</span>];
<a name="l00684"></a>00684                     } <span class="keywordflow">else</span> {
<a name="l00685"></a>00685                         $newRelation[<span class="stringliteral">&#39;type&#39;</span>] = $relation[<span class="stringliteral">&#39;type&#39;</span>] === <a class="code" href="classDoctrine__Relation.html#ad1d58e954205119e9796bec18d516970" title="RELATION CONSTANTS.">Doctrine_Relation::ONE</a> ? <a class="code" href="classDoctrine__Relation.html#a9cf5a7937bfa222693f99ce4b2b22864" title="constant for MANY_TO_MANY and ONE_TO_MANY relationships">Doctrine_Relation::MANY</a>:<a class="code" href="classDoctrine__Relation.html#ad1d58e954205119e9796bec18d516970" title="RELATION CONSTANTS.">Doctrine_Relation::ONE</a>;
<a name="l00686"></a>00686                     }
<a name="l00687"></a>00687                 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689                 <span class="comment">// Make sure it doesn&#39;t already exist</span>
<a name="l00690"></a>00690                 <span class="keywordflow">if</span> ( ! isset($this-&gt;_relations[$relation[<span class="stringliteral">&#39;class&#39;</span>]][$newRelation[<span class="stringliteral">&#39;alias&#39;</span>]])) {
<a name="l00691"></a>00691                     $newRelation[<span class="stringliteral">&#39;key&#39;</span>] = $this-&gt;<a class="code" href="classDoctrine__Import__Schema.html#a38302161c9c4044a427a338f06b3c6b9" title="_buildUniqueRelationKey">_buildUniqueRelationKey</a>($newRelation);
<a name="l00692"></a>00692                     $this-&gt;_relations[$relation[<span class="stringliteral">&#39;class&#39;</span>]][$newRelation[<span class="stringliteral">&#39;alias&#39;</span>]] = $newRelation;
<a name="l00693"></a>00693                 }
<a name="l00694"></a>00694             }
<a name="l00695"></a>00695         }
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697 
<a name="l00706"></a><a class="code" href="classDoctrine__Import__Schema.html#a154ac773448045c2dd2ffcfcf0a84380">00706</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Import__Schema.html#a154ac773448045c2dd2ffcfcf0a84380" title="_fixDuplicateRelations">_fixDuplicateRelations</a>()
<a name="l00707"></a>00707     {
<a name="l00708"></a>00708         <span class="keywordflow">foreach</span>($this-&gt;_relations as $className =&gt; $relations) {
<a name="l00709"></a>00709             <span class="comment">// This is for checking for duplicates between alias-relations and a auto-generated relations to ensure the result set of unique relations</span>
<a name="l00710"></a>00710             $existingRelations = array();
<a name="l00711"></a>00711             $uniqueRelations = array();
<a name="l00712"></a>00712             <span class="keywordflow">foreach</span> ($relations as $relation) {
<a name="l00713"></a>00713                 <span class="keywordflow">if</span> ( ! in_array($relation[<span class="stringliteral">&#39;key&#39;</span>], $existingRelations)) {
<a name="l00714"></a>00714                     $existingRelations[] = $relation[<span class="stringliteral">&#39;key&#39;</span>];
<a name="l00715"></a>00715                     $uniqueRelations = array_merge($uniqueRelations, array($relation[<span class="stringliteral">&#39;alias&#39;</span>] =&gt; $relation));
<a name="l00716"></a>00716                 } <span class="keywordflow">else</span> {
<a name="l00717"></a>00717                     <span class="comment">// check to see if this relationship is not autogenerated, if it&#39;s not, then the user must have explicitly declared it</span>
<a name="l00718"></a>00718                     <span class="keywordflow">if</span> ( ! isset($relation[<span class="stringliteral">&#39;autogenerated&#39;</span>]) || $relation[<span class="stringliteral">&#39;autogenerated&#39;</span>] != <span class="keyword">true</span>) {
<a name="l00719"></a>00719                         $uniqueRelations = array_merge($uniqueRelations, array($relation[<span class="stringliteral">&#39;alias&#39;</span>] =&gt; $relation));
<a name="l00720"></a>00720                     }
<a name="l00721"></a>00721                 }
<a name="l00722"></a>00722             }
<a name="l00723"></a>00723             
<a name="l00724"></a>00724             $this-&gt;_relations[$className] = $uniqueRelations;
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727 
<a name="l00737"></a><a class="code" href="classDoctrine__Import__Schema.html#a38302161c9c4044a427a338f06b3c6b9">00737</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Import__Schema.html#a38302161c9c4044a427a338f06b3c6b9" title="_buildUniqueRelationKey">_buildUniqueRelationKey</a>($relation)
<a name="l00738"></a>00738     {
<a name="l00739"></a>00739         <span class="keywordflow">return</span> md5($relation[<span class="stringliteral">&#39;local&#39;</span>].$relation[<span class="stringliteral">&#39;foreign&#39;</span>].$relation[<span class="stringliteral">&#39;class&#39;</span>].(isset($relation[<span class="stringliteral">&#39;refClass&#39;</span>]) ? $relation[<span class="stringliteral">&#39;refClass&#39;</span>]:null));
<a name="l00740"></a>00740     }
<a name="l00741"></a>00741 
<a name="l00749"></a><a class="code" href="classDoctrine__Import__Schema.html#a9a4e5c3ba90655b7ce9392f8c39d9805">00749</a>     <span class="keyword">protected</span> function <a class="code" href="classDoctrine__Import__Schema.html#a9a4e5c3ba90655b7ce9392f8c39d9805" title="_validateSchemaElement">_validateSchemaElement</a>($name, $element, $path)
<a name="l00750"></a>00750     {
<a name="l00751"></a>00751         $element = (array) $element;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         $validation = $this-&gt;_validation[$name];
<a name="l00754"></a>00754 
<a name="l00755"></a>00755         <span class="comment">// Validators are a part of the column validation</span>
<a name="l00756"></a>00756         <span class="comment">// This should be fixed, made cleaner</span>
<a name="l00757"></a>00757         <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;column&#39;</span>) {
<a name="l00758"></a>00758             $validators = <a class="code" href="classDoctrine__Manager.html#a0f1f11c9be78468eed7768f4130aac2e" title="Returns an instance of this class (this class uses the singleton pattern).">Doctrine_Manager::getInstance</a>()-&gt;getValidators();
<a name="l00759"></a>00759             $validation = array_merge($validation, $validators);
<a name="l00760"></a>00760         }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762         $validation = array_flip($validation);
<a name="l00763"></a>00763         <span class="keywordflow">foreach</span> ($element as $key =&gt; $value) {
<a name="l00764"></a>00764             <span class="keywordflow">if</span> ( ! isset($validation[$value])) {
<a name="l00765"></a>00765                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDoctrine__Import__Exception.html">Doctrine_Import_Exception</a>(
<a name="l00766"></a>00766                     sprintf(<span class="stringliteral">&#39;Invalid schema element named &quot;&#39;</span> . $value . <span class="stringliteral">&#39;&quot; at path &quot;&#39;</span> . $path . <span class="charliteral">&#39;&quot;&#39;</span>)
<a name="l00767"></a>00767                 );
<a name="l00768"></a>00768             }
<a name="l00769"></a>00769         }
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
