<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: apps/frontend/lib/util/agPersonLanguageHelper.class.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>apps/frontend/lib/util/agPersonLanguageHelper.class.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00018"></a><a class="code" href="classagPersonLanguageHelper.html">00018</a> <span class="keyword">class </span><a class="code" href="classagPersonLanguageHelper.html" title="Provides person language helper functions and inherits several methods and properties...">agPersonLanguageHelper</a> <span class="keyword">extends</span> <a class="code" href="classagLanguageHelper.html" title="Provides language and it&amp;#39;s coorelating format and competency helper functions...">agLanguageHelper</a>
<a name="l00019"></a>00019 {
<a name="l00025"></a><a class="code" href="classagPersonLanguageHelper.html#a815aef33a3df88218fa2ad68d61b2c1f">00025</a>   <span class="keyword">public</span> function <a class="code" href="classagPersonLanguageHelper.html#a815aef33a3df88218fa2ad68d61b2c1f" title="This is the classes&amp;#39; constructor and is used to set up class properties, where...">__construct</a>(array $personIds = NULL)
<a name="l00026"></a>00026   {
<a name="l00027"></a>00027     <span class="comment">// set our person ids if passed any at construction</span>
<a name="l00028"></a>00028     <a class="code" href="classagPersonLanguageHelper.html#a815aef33a3df88218fa2ad68d61b2c1f" title="This is the classes&amp;#39; constructor and is used to set up class properties, where...">parent::__construct</a>($personIds) ;
<a name="l00029"></a>00029   }
<a name="l00030"></a>00030 
<a name="l00039"></a><a class="code" href="classagPersonLanguageHelper.html#a72a48152f27ce698408b3124345dfd92">00039</a>   <span class="keyword">protected</span> function <a class="code" href="classagPersonLanguageHelper.html#a72a48152f27ce698408b3124345dfd92" title="Method to construct and return a basic language query object.">_getLanguageComponents</a>(array $personIds = NULL, $primary = TRUE)
<a name="l00040"></a>00040   {
<a name="l00041"></a>00041     $personIds = $this-&gt;<a class="code" href="classagBulkRecordHelper.html#ab63cfeadb98c6f9c6dfad1cb7406c41f" title="Helper method to retrieve the $_recordId property in the event that it is passed...">getRecordIds</a>($personIds) ;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043     $q = <a class="code" href="classDoctrine__Query.html#a7420e7e1f1224c195cc56419fd733d14" title="create returns a new Doctrine_Query object">agDoctrineQuery::create</a>()
<a name="l00044"></a>00044       -&gt;select(<span class="stringliteral">&#39;pml.person_id&#39;</span>)
<a name="l00045"></a>00045           -&gt;addSelect(<span class="stringliteral">&#39;pml.priority&#39;</span>)
<a name="l00046"></a>00046           -&gt;addSelect(<span class="stringliteral">&#39;pml.language_id&#39;</span>)
<a name="l00047"></a>00047           -&gt;addSelect(<span class="stringliteral">&#39;plc.language_format_id&#39;</span>)
<a name="l00048"></a>00048           -&gt;addSelect(<span class="stringliteral">&#39;plc.language_competency_id&#39;</span>)
<a name="l00049"></a>00049         -&gt;from(<span class="stringliteral">&#39;agPersonMjAglanguage pml&#39;</span>)
<a name="l00050"></a>00050           -&gt;leftJoin(<span class="stringliteral">&#39;pml.agPersonLanguageCompetency plc&#39;</span>)
<a name="l00051"></a>00051         -&gt;whereIn(<span class="stringliteral">&#39;pml.person_id&#39;</span>, $personIds)
<a name="l00052"></a>00052         -&gt;orderBy(<span class="stringliteral">&#39;pml.priority ASC&#39;</span>) ;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="keywordflow">if</span> ($primary)
<a name="l00055"></a>00055     {
<a name="l00056"></a>00056       $q-&gt;andwhere(<span class="stringliteral">&#39; EXISTS (</span>
<a name="l00057"></a>00057 <span class="stringliteral">        SELECT p.id</span>
<a name="l00058"></a>00058 <span class="stringliteral">        FROM agPersonMjAgLanguage p</span>
<a name="l00059"></a>00059 <span class="stringliteral">        WHERE p.person_id = pml.person_id</span>
<a name="l00060"></a>00060 <span class="stringliteral">        HAVING MIN(p.priority) = pml.priority)&#39;</span>) ;
<a name="l00061"></a>00061     }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <span class="keywordflow">return</span> $q ;
<a name="l00064"></a>00064   }
<a name="l00065"></a>00065   
<a name="l00084"></a><a class="code" href="classagPersonLanguageHelper.html#aff60e20e648d0673923718393db94cbd">00084</a>   <span class="keyword">public</span> function <a class="code" href="classagPersonLanguageHelper.html#aff60e20e648d0673923718393db94cbd" title="Method to retrieve person&amp;#39;s language, format, and competency information by ids...">getPersonLanguageById</a>(array $personIds = NULL, $primary = TRUE)
<a name="l00085"></a>00085   {
<a name="l00086"></a>00086     $results = array();
<a name="l00087"></a>00087     $q = $this-&gt;<a class="code" href="classagPersonLanguageHelper.html#a72a48152f27ce698408b3124345dfd92" title="Method to construct and return a basic language query object.">_getLanguageComponents</a>($personIds, $primary);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     $rows = $q-&gt;execute(array(), <a class="code" href="classDoctrine__Core.html#a36531882557012215d8b9024373239fa" title="HYDRATE_NONE.">Doctrine_Core::HYDRATE_NONE</a>) ;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="keywordflow">foreach</span> ($rows AS $row)
<a name="l00092"></a>00092     {
<a name="l00093"></a>00093       $personId = $row[0];
<a name="l00094"></a>00094       $idx = $row[1];
<a name="l00095"></a>00095       $languageId = $row[2];
<a name="l00096"></a>00096       $formatId = $row[3];
<a name="l00097"></a>00097       $competencyId = $row[4];
<a name="l00098"></a>00098       <span class="keywordflow">if</span> (is_null($formatId))
<a name="l00099"></a>00099       {
<a name="l00100"></a>00100         $results[$personId][$idx] = array($languageId, array());
<a name="l00101"></a>00101       }
<a name="l00102"></a>00102       <span class="keywordflow">else</span>
<a name="l00103"></a>00103       {
<a name="l00104"></a>00104         <span class="keywordflow">if</span> (isset($results[$personId][$idx]))
<a name="l00105"></a>00105         {
<a name="l00106"></a>00106           $results[$personId][$idx][1][$formatId] = $competencyId;
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108         <span class="keywordflow">else</span>
<a name="l00109"></a>00109         {
<a name="l00110"></a>00110           $results[$personId][$idx] = array($languageId, array($formatId =&gt; $competencyId));
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112       }
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="keywordflow">return</span> $results;
<a name="l00116"></a>00116   }
<a name="l00117"></a>00117 
<a name="l00136"></a><a class="code" href="classagPersonLanguageHelper.html#a6ffdd059bcc575957edab6d0cdcdf361">00136</a>   <span class="keyword">public</span> function <a class="code" href="classagPersonLanguageHelper.html#a6ffdd059bcc575957edab6d0cdcdf361" title="Method to retrieve person&amp;#39;s language, format, and competency information.">getPersonLanguage</a>(array $personIds = NULL, $primary = TRUE)
<a name="l00137"></a>00137   {
<a name="l00138"></a>00138     $results = array();
<a name="l00139"></a>00139     $q = $this-&gt;<a class="code" href="classagPersonLanguageHelper.html#a72a48152f27ce698408b3124345dfd92" title="Method to construct and return a basic language query object.">_getLanguageComponents</a>($personIds, $primary);
<a name="l00140"></a>00140     $q-&gt;addSelect(<span class="stringliteral">&#39;l.language&#39;</span>)
<a name="l00141"></a>00141       -&gt;addSelect(<span class="stringliteral">&#39;lf.language_format&#39;</span>)
<a name="l00142"></a>00142       -&gt;addSelect(<span class="stringliteral">&#39;lc.language_competency&#39;</span>)
<a name="l00143"></a>00143       -&gt;innerJoin(<span class="stringliteral">&#39;pml.agLanguage l&#39;</span>)
<a name="l00144"></a>00144       -&gt;leftJoin(<span class="stringliteral">&#39;plc.agLanguageFormat lf&#39;</span>)
<a name="l00145"></a>00145       -&gt;leftJoin(<span class="stringliteral">&#39;plc.agLanguageCompetency lc&#39;</span>);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     $rows = $q-&gt;execute(array(), <a class="code" href="classDoctrine__Core.html#a36531882557012215d8b9024373239fa" title="HYDRATE_NONE.">Doctrine_Core::HYDRATE_NONE</a>) ;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="keywordflow">foreach</span> ($rows AS $row)
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151       $personId = $row[0];
<a name="l00152"></a>00152       $idx = $row[1];
<a name="l00153"></a>00153       $language = $row[5];
<a name="l00154"></a>00154       $format = $row[6];
<a name="l00155"></a>00155       $competency = $row[7];
<a name="l00156"></a>00156       <span class="keywordflow">if</span> (is_null($format))
<a name="l00157"></a>00157       {
<a name="l00158"></a>00158         $results[$personId][$idx] = array($language, array());
<a name="l00159"></a>00159       }
<a name="l00160"></a>00160       <span class="keywordflow">else</span>
<a name="l00161"></a>00161       {
<a name="l00162"></a>00162         <span class="keywordflow">if</span> (isset($results[$personId][$idx]))
<a name="l00163"></a>00163         {
<a name="l00164"></a>00164           $results[$personId][$idx][1][$format] = $competency;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166         <span class="keywordflow">else</span>
<a name="l00167"></a>00167         {
<a name="l00168"></a>00168           $results[$personId][$idx] = array($language, array($format =&gt; $competency));
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="keywordflow">return</span> $results;
<a name="l00174"></a>00174   }
<a name="l00182"></a>00182   <span class="keyword">private</span> function diffArrays(array $compareFrom, array $keyArray)
<a name="l00183"></a>00183   {
<a name="l00184"></a>00184     <span class="comment">// Sort array to speed up comparisons.</span>
<a name="l00185"></a>00185     array_walk($compareFrom, function(&amp;$language) { $language = strtolower($language); });
<a name="l00186"></a>00186     sort($compareFrom);
<a name="l00187"></a>00187     $compareTo = array_keys($keyArray);
<a name="l00188"></a>00188     sort($compareTo);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="comment">// diff, then release the two component arrays -- all we care about is the diff</span>
<a name="l00191"></a>00191     $diffArray = array_diff($compareFrom, $compareTo);
<a name="l00192"></a>00192     unset($compareFrom);
<a name="l00193"></a>00193     unset($compareTo);
<a name="l00194"></a>00194     <span class="keywordflow">return</span> $diffArray;
<a name="l00195"></a>00195   }
<a name="l00196"></a>00196 
<a name="l00221"></a><a class="code" href="classagPersonLanguageHelper.html#a94f5926568a36fcd95c76f9d844f833a">00221</a>   <span class="keyword">public</span> function <a class="code" href="classagPersonLanguageHelper.html#a94f5926568a36fcd95c76f9d844f833a" title="Method to set person languages and automatically prioritize them accordingly.">setPersonLanguages</a>(array $personLanguages,
<a name="l00222"></a>00222                                      $keepHistory = NULL,
<a name="l00223"></a>00223                                      $createEdgeTableValues = NULL,
<a name="l00224"></a>00224                                      $throwOnError = NULL,
<a name="l00225"></a>00225                                      <a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $conn = NULL)
<a name="l00226"></a>00226   {
<a name="l00227"></a>00227     <span class="comment">// explicit declarations are nice</span>
<a name="l00228"></a>00228     $results = array();
<a name="l00229"></a>00229     $invalidLanguages = array();
<a name="l00230"></a>00230     $uniqLanguages = array();
<a name="l00231"></a>00231     $uniqFormats = array();
<a name="l00232"></a>00232     $uniqCompetencies = array();
<a name="l00233"></a>00233     $err = NULL;
<a name="l00234"></a>00234     $deletePersonlanguages = array();
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">// pick up some defaults if not passed anything</span>
<a name="l00237"></a>00237     <span class="keywordflow">if</span> (is_null($conn)) { $conn = <a class="code" href="classDoctrine__Manager.html#a4a265fc048ee4080e26779f3ba36681c" title="Open a new connection.">Doctrine_Manager::connection</a>(); }
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (is_null($createEdgeTableValues)) { $createEdgeTableValues = $this-&gt;createEdgeTableValues; }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     <span class="comment">// reduce our person language to just the uniques</span>
<a name="l00241"></a>00241     <span class="keywordflow">foreach</span> ($personLanguages AS $personId =&gt; &amp;$languageComponents)
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243       <span class="keywordflow">foreach</span> ($languageComponents AS $priority =&gt; &amp;$langComps)
<a name="l00244"></a>00244       {
<a name="l00245"></a>00245         <span class="comment">// we do this at this early stage so we&#39;re always dealing with a post-trimmed value</span>
<a name="l00246"></a>00246         $langComps[0] = trim($langComps[0]);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <span class="comment">// add it to our unique array</span>
<a name="l00249"></a>00249         $uniqLanguages[] = $langComps[0];
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <span class="keywordflow">if</span> (isset($langComps[1]))
<a name="l00252"></a>00252         {
<a name="l00253"></a>00253           <span class="keywordflow">foreach</span>($langComps[1] AS $format =&gt; &amp;$competency)
<a name="l00254"></a>00254           {
<a name="l00255"></a>00255             <span class="comment">// Always trim value</span>
<a name="l00256"></a>00256             $competency = trim($competency);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258             <span class="comment">// Add to unique arrays</span>
<a name="l00259"></a>00259             $uniqFormats[] = $format;
<a name="l00260"></a>00260             $uniqCompetencies[] = $competency;
<a name="l00261"></a>00261           }
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263         <span class="keywordflow">else</span>
<a name="l00264"></a>00264         {
<a name="l00265"></a>00265           <span class="comment">// Add empty array so we can eliminate the step of checking later on when processing</span>
<a name="l00266"></a>00266           <span class="comment">// person languages.</span>
<a name="l00267"></a>00267           $langComps[1] = array();
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269       }
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271     <span class="comment">// Unset all variables used in foreach loops that are no longer needed to release memory and</span>
<a name="l00272"></a>00272     <span class="comment">// prevent any potential hidden issues.</span>
<a name="l00273"></a>00273     unset($personId, $languageComponents, $priority, $langComps, $format, $competency);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="comment">// actually make these unqiue arrays unique</span>
<a name="l00276"></a>00276     $uniqLanguages = array_unique($uniqLanguages);
<a name="l00277"></a>00277     $uniqFormats = array_unique($uniqFormats);
<a name="l00278"></a>00278     $uniqCompetencies = array_unique($uniqCompetencies);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <span class="comment">// get key mapping</span>
<a name="l00281"></a>00281     $languageIds = array_change_key_case($this-&gt;<a class="code" href="classagLanguageHelper.html#a55c2a9b37a8f693cd3e97d172680109f" title="A quick helper method to take in an array language and return an array of language...">getLanguageIds</a>($uniqLanguages), CASE_LOWER);
<a name="l00282"></a>00282     $formatIds = array_change_key_case($this-&gt;<a class="code" href="classagLanguageHelper.html#acb6cbcb57bffa9bfe8c3d447936a66c3" title="Method to return language format ids from language format values.">getLanguageFormatIds</a>($uniqFormats));
<a name="l00283"></a>00283     $competencyIds = array_change_key_case($this-&gt;<a class="code" href="classagLanguageHelper.html#ab9c57a0eeffb2148a9c47e30ad555864" title="Method to return language competency ids from language competency values.">getLanguageCompetencyIds</a>($uniqCompetencies));
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="comment">// Find new languages by diffing the arrays.</span>
<a name="l00286"></a>00286     $newLanguages = $this-&gt;diffArrays($uniqLanguages, $languageIds);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="comment">// Unset the unqiue arrays after final usage.</span>
<a name="l00289"></a>00289     unset($uniqLanguages, $uniqFormats, $uniqCompetencies);
<a name="l00290"></a>00290     
<a name="l00291"></a>00291     <span class="comment">// here we check our current transaction scope and create a transaction or savepoint</span>
<a name="l00292"></a>00292     $useSavepoint = ($conn-&gt;getTransactionLevel() &gt; 0) ? TRUE : FALSE ;
<a name="l00293"></a>00293     <span class="keywordflow">if</span> ($useSavepoint)
<a name="l00294"></a>00294     {
<a name="l00295"></a>00295       $conn-&gt;beginTransaction(__FUNCTION__) ;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     <span class="keywordflow">else</span>
<a name="l00298"></a>00298     {
<a name="l00299"></a>00299       $conn-&gt;beginTransaction() ;
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">// Create new edge values if $createNewEdgeValues is TRUE</span>
<a name="l00303"></a>00303     <span class="keywordflow">if</span> ($createEdgeTableValues)
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305       <span class="keywordflow">try</span>
<a name="l00306"></a>00306       {
<a name="l00307"></a>00307         <span class="comment">// set new languagess / return their ids</span>
<a name="l00308"></a>00308         $languageIds = ($languageIds + ($this-&gt;<a class="code" href="classagLanguageHelper.html#a711aab977009700cf21c61cc514986a7" title="Method to create new person language.">setNewLanguages</a>($newLanguages, $throwOnError, $conn)));
<a name="l00309"></a>00309         unset($newLanguages);
<a name="l00310"></a>00310       }
<a name="l00311"></a>00311       <span class="keywordflow">catch</span>(Exception $e)
<a name="l00312"></a>00312       {
<a name="l00313"></a>00313         <span class="comment">// log our error</span>
<a name="l00314"></a>00314         $errMsg = sprintf(<span class="stringliteral">&#39;%s failed to execute. (%s).&#39;</span>, __FUNCTION__, $e-&gt;getMessage());
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="comment">// capture the error for comparison later</span>
<a name="l00317"></a>00317         $err = $e;
<a name="l00318"></a>00318       }
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320     <span class="keywordflow">else</span>
<a name="l00321"></a>00321     {
<a name="l00322"></a>00322       <span class="comment">// if $createNewEdgeValues not true and a new language is passed in, capture the new language</span>
<a name="l00323"></a>00323       <span class="comment">// as error.</span>
<a name="l00324"></a>00324       $errMsg = NULL;
<a name="l00325"></a>00325       <span class="keywordflow">if</span> (count($newLanguages) &gt; 0)
<a name="l00326"></a>00326       {
<a name="l00327"></a>00327         $errMsg = sprintf(<span class="stringliteral">&#39;Invalid languages (%s)&#39;</span>, implode(<span class="stringliteral">&#39;, &#39;</span>, $newLanguages));
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         <span class="comment">// log whichever error we received</span>
<a name="l00330"></a>00330         sfContext::getInstance()-&gt;getLogger()-&gt;err($errMsg);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="comment">// throw the exception we promised in our boolean</span>
<a name="l00333"></a>00333         <span class="keywordflow">if</span> ($throwOnError) { <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception($errMsg); }
<a name="l00334"></a>00334       }
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="comment">// set languages, formats, and competencies.</span>
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (is_null($err))
<a name="l00339"></a>00339     {
<a name="l00340"></a>00340       <span class="comment">// recombine all language components and their person owners</span>
<a name="l00341"></a>00341       <span class="keywordflow">foreach</span> ($personLanguages AS $personId =&gt; $languageComponents)
<a name="l00342"></a>00342       {
<a name="l00343"></a>00343         <span class="keywordflow">foreach</span> ($languageComponents AS $priority =&gt; $langComps)
<a name="l00344"></a>00344         {
<a name="l00345"></a>00345           $lowerLanguage = strtolower($langComps[0]);
<a name="l00346"></a>00346           <span class="keywordflow">if</span> (array_key_exists($lowerLanguage, $languageIds))
<a name="l00347"></a>00347           {
<a name="l00348"></a>00348             $personLanguages[$personId][$priority][0] = $languageIds[$lowerLanguage];
<a name="l00349"></a>00349             <span class="keywordflow">foreach</span> ($langComps[1] AS $format =&gt; $competency)
<a name="l00350"></a>00350             {
<a name="l00351"></a>00351               $lowerFormat = strtolower($format);
<a name="l00352"></a>00352               $lowerCompetency = strtolower($competency);
<a name="l00353"></a>00353               <span class="keywordflow">if</span> (array_key_exists($lowerFormat, $formatIds)
<a name="l00354"></a>00354                   &amp;&amp; array_key_exists($lowerCompetency, $competencyIds))
<a name="l00355"></a>00355               {
<a name="l00356"></a>00356                 $personLanguages[$personId][$priority][1][$formatIds[$lowerFormat]] = $competencyIds[$lowerCompetency];
<a name="l00357"></a>00357               }
<a name="l00358"></a>00358               <span class="keywordflow">else</span>
<a name="l00359"></a>00359               {
<a name="l00360"></a>00360                 <span class="comment">// Capture invalid format/competency records.</span>
<a name="l00361"></a>00361                 <span class="keywordflow">if</span> (isset($invalidLanguages[$personId][$priority]))
<a name="l00362"></a>00362                 {
<a name="l00363"></a>00363                   $invalidLanguages[$personId][$priority][1][$format] = $competency;
<a name="l00364"></a>00364                 }
<a name="l00365"></a>00365                 <span class="keywordflow">else</span>
<a name="l00366"></a>00366                 {
<a name="l00367"></a>00367                   $invalidLanguages[$personId][$priority] = array($langComps[0], array($format =&gt; $competency));
<a name="l00368"></a>00368                 }
<a name="l00369"></a>00369               }
<a name="l00370"></a>00370               unset($personLanguages[$personId][$priority][1][$format]);
<a name="l00371"></a>00371             } <span class="comment">// end of language format/competency loop</span>
<a name="l00372"></a>00372           }
<a name="l00373"></a>00373           <span class="keywordflow">else</span>
<a name="l00374"></a>00374           {
<a name="l00375"></a>00375             <span class="comment">// Invalid language.</span>
<a name="l00376"></a>00376             $invalidLanguages[$personId][$priority] = $langComps;
<a name="l00377"></a>00377             unset($personLanguages[$personId][$priority]);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379             <span class="comment">// @TODO May need to add $enforceStrict logic here for invalid languages.</span>
<a name="l00380"></a>00380           }
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382       }
<a name="l00383"></a>00383       <span class="comment">// Unset all variables used in foreach loops that are no longer needed to release memory and</span>
<a name="l00384"></a>00384       <span class="comment">// prevent any potential hidden issues.</span>
<a name="l00385"></a>00385       unset($personId, $languageComponents, $priority, $langComps, $format, $competency);
<a name="l00386"></a>00386       unset($lowerLanguage, $lowerFormat, $lowerCompetency);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388       <span class="comment">// At this point $personLanguages only consist of valid languages and language components.</span>
<a name="l00389"></a>00389 
<a name="l00390"></a>00390       <span class="keywordflow">try</span>
<a name="l00391"></a>00391       {
<a name="l00392"></a>00392         <span class="comment">// connect languages to their owners</span>
<a name="l00393"></a>00393         $results = $this-&gt;<a class="code" href="classagPersonLanguageHelper.html#a7e9b51a1a17b8ad5cb856b94158dff97" title="Protected method that creates new person language entries in the many-to-many person...">_setPersonLanguage</a>($personLanguages, $keepHistory, $throwOnError, $conn);
<a name="l00394"></a>00394       }
<a name="l00395"></a>00395       <span class="keywordflow">catch</span>(Exception $e)
<a name="l00396"></a>00396       {
<a name="l00397"></a>00397         <span class="comment">// log our error</span>
<a name="l00398"></a>00398         $errMsg = sprintf(<span class="stringliteral">&#39;%s failed to execute. (%s).&#39;</span>, <span class="stringliteral">&#39;_setPersonNames&#39;</span>, $e-&gt;getMessage());
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         <span class="comment">// capture the exception for later</span>
<a name="l00401"></a>00401         $err = $e;
<a name="l00402"></a>00402       }
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (is_null($err))
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407       <span class="comment">// yay, no problems, now we commit</span>
<a name="l00408"></a>00408       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;commit(__FUNCTION__) ; } <span class="keywordflow">else</span> { $conn-&gt;commit(); }
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410     <span class="keywordflow">else</span>
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412       <span class="comment">// log whichever error we received</span>
<a name="l00413"></a>00413       sfContext::getInstance()-&gt;getLogger()-&gt;err($errMsg);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415       <span class="comment">// rollback</span>
<a name="l00416"></a>00416       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;rollback(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;rollback(); }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       <span class="comment">// ALWAYS throw an error, it&#39;s like stepping on a crack if you don&#39;t</span>
<a name="l00419"></a>00419       <span class="keywordflow">if</span> ($throwOnError) { <span class="keywordflow">throw</span> $e; }
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="keywordflow">return</span> $results;
<a name="l00423"></a>00423   }
<a name="l00424"></a>00424 
<a name="l00447"></a><a class="code" href="classagPersonLanguageHelper.html#a7e9b51a1a17b8ad5cb856b94158dff97">00447</a>   <span class="keyword">protected</span> function <a class="code" href="classagPersonLanguageHelper.html#a7e9b51a1a17b8ad5cb856b94158dff97" title="Protected method that creates new person language entries in the many-to-many person...">_setPersonLanguage</a> (array $personLanguages,
<a name="l00448"></a>00448                                          $keepHistory = NULL,
<a name="l00449"></a>00449                                          $throwOnError = NULL,
<a name="l00450"></a>00450                                          <a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $conn = NULL)
<a name="l00451"></a>00451   {
<a name="l00452"></a>00452     <span class="comment">// explicit results declaration</span>
<a name="l00453"></a>00453     $results = array(<span class="stringliteral">&#39;upserted&#39;</span>=&gt;0, <span class="stringliteral">&#39;removed&#39;</span>=&gt;0, <span class="stringliteral">&#39;failures&#39;</span>=&gt;array());
<a name="l00454"></a>00454     $currLanguages = array();
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="comment">// get some defaults if not explicitly passed</span>
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (is_null($keepHistory)) { $keepHistory = $this-&gt;keepHistory; }
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (is_null($throwOnError)) { $throwOnError = $this-&gt;throwOnError; }
<a name="l00459"></a>00459     <span class="keywordflow">if</span> (is_null($conn)) { $conn = <a class="code" href="classDoctrine__Manager.html#a4a265fc048ee4080e26779f3ba36681c" title="Open a new connection.">Doctrine_Manager::connection</a>(); }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <span class="keywordflow">if</span> ($keepHistory)
<a name="l00462"></a>00462     {
<a name="l00463"></a>00463       <span class="comment">// if we&#39;re going to process existing languages and keep them, then hold on</span>
<a name="l00464"></a>00464       $currLanguages = $this-&gt;<a class="code" href="classagPersonLanguageHelper.html#aff60e20e648d0673923718393db94cbd" title="Method to retrieve person&amp;#39;s language, format, and competency information by ids...">getPersonLanguageById</a>(array_keys($personLanguages), FALSE);
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="comment">// execute the reprioritization helper and pass it our current languages as found in the db</span>
<a name="l00468"></a>00468     $personLanguages = $this-&gt;<a class="code" href="classagPersonLanguageHelper.html#a9c5bd355d9fb56ca1f1cebefcdf2b2f9" title="Method to prioritize person languages.">reprioritizePersonLanguages</a>($personLanguages, $currLanguages);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="comment">// Unset $currLanguages</span>
<a name="l00471"></a>00471     unset($currLanguages);
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="comment">// Build a simpler $personLanguages array for a more efficient use of searches later on.</span>
<a name="l00474"></a>00474     $simplifiedNewLanguages = array();
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="keywordflow">foreach</span> ($personLanguages AS $personId =&gt; $pLangs)
<a name="l00477"></a>00477     {
<a name="l00478"></a>00478       <span class="keywordflow">foreach</span> ($pLangs as $priority =&gt; $lang)
<a name="l00479"></a>00479       {
<a name="l00480"></a>00480         $simplifiedNewLanguages[$personId][$lang[0]] = $priority;
<a name="l00481"></a>00481       }
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     <span class="comment">// Release memories.</span>
<a name="l00484"></a>00484     unset($personId, $pLangs, $priority, $lang);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="comment">// here we set up our collection of ag_person_mj_ag_language records, selecting only those with</span>
<a name="l00487"></a>00487     <span class="comment">// the personIds we&#39;re affecting. Note: INDEXBY is very important if we intend to access this</span>
<a name="l00488"></a>00488     <span class="comment">// collection via array access as we do later.</span>
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     $deletePersonLanguageIds = array();
<a name="l00491"></a>00491     $updateLanguageComponents = array();
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     $q = <a class="code" href="classDoctrine__Query.html#a7420e7e1f1224c195cc56419fd733d14" title="create returns a new Doctrine_Query object">agDoctrineQuery::create</a>($conn)
<a name="l00494"></a>00494       -&gt;select(<span class="stringliteral">&#39;mpl.*&#39;</span>)
<a name="l00495"></a>00495         -&gt;from(<span class="stringliteral">&#39;agPersonMjAgLanguage mpl INDEXBY mpl.id&#39;</span>)
<a name="l00496"></a>00496         -&gt;whereIn(<span class="stringliteral">&#39;mpl.person_id&#39;</span>, array_keys($personLanguages));
<a name="l00497"></a>00497     $personLanguageCollection = $q-&gt;execute() ;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="comment">// Determine records whether to be updated and/or deleted.</span>
<a name="l00500"></a>00500     <span class="keywordflow">foreach</span>($personLanguageCollection AS $collId =&gt; $pLang)
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502       $collPId = $pLang[<span class="stringliteral">&#39;person_id&#39;</span>];
<a name="l00503"></a>00503       $collLId = $pLang[<span class="stringliteral">&#39;language_id&#39;</span>];
<a name="l00504"></a>00504 
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (isset($simplifiedNewLanguages[$collPId])
<a name="l00506"></a>00506           &amp;&amp; array_key_exists($collLId, $simplifiedNewLanguages[$collPId]))
<a name="l00507"></a>00507       {
<a name="l00508"></a>00508         $personLanguagePriority = $simplifiedNewLanguages[$collPId][$collLId];
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordflow">if</span> ($personLanguageCollection[$collId][<span class="stringliteral">&#39;priority&#39;</span>] == $personLanguagePriority)
<a name="l00511"></a>00511         {
<a name="l00512"></a>00512           <span class="comment">// No update to person language record necessary.  Should still add to </span>
<a name="l00513"></a>00513           <span class="comment">// $updateLanguageComponent to determine if child needs update later on.  Unset it from</span>
<a name="l00514"></a>00514           <span class="comment">// $simplifiedNewLanguage.</span>
<a name="l00515"></a>00515           $updateLanguageComponents[$collId] = $personLanguages[$collPId][$personLanguagePriority][1];
<a name="l00516"></a>00516           unset($simplifiedNewLanguages[$collPId][$collLId]);
<a name="l00517"></a>00517         }
<a name="l00518"></a>00518         <span class="keywordflow">else</span>
<a name="l00519"></a>00519         {
<a name="l00520"></a>00520           <span class="comment">// Easier to completely remove record than to perform update and possibly run into</span>
<a name="l00521"></a>00521           <span class="comment">// priority constraint violation issues.</span>
<a name="l00522"></a>00522           $deletePersonLanguageIds[] = $collId;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524       }
<a name="l00525"></a>00525       <span class="keywordflow">else</span>
<a name="l00526"></a>00526       {
<a name="l00527"></a>00527         <span class="comment">// Remove from collection.</span>
<a name="l00528"></a>00528         $deletePersonLanguageIds[] = $collId;
<a name="l00529"></a>00529         $results[<span class="stringliteral">&#39;removed&#39;</span>]++;
<a name="l00530"></a>00530       }
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532     <span class="comment">// Unset variables to release memories.</span>
<a name="l00533"></a>00533     unset($collId, $pLang, $collPId, $collLId, $personLanguagePriority, $personLanguageCollection);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="comment">// Remove all delete records, leaving only records for new inserts and updates.</span>
<a name="l00536"></a>00536     $this-&gt;<a class="code" href="classagPersonLanguageHelper.html#a7c07feacb3b82413715520a6af394ca4" title="Method to remove person language entries from a person.">deletePersonLanguages</a>($deletePersonLanguageIds, $throwOnError, $conn);
<a name="l00537"></a>00537     unset($deletePersonLanguageIds);
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="comment">// Now all deletes are done on the manay-to-many person language table and it&#39;s cooresponding </span>
<a name="l00540"></a>00540     <span class="comment">// person language competency child table at this point.  Only thing left to do on the person</span>
<a name="l00541"></a>00541     <span class="comment">// language joining table is to add new person language records.</span>
<a name="l00542"></a>00542 
<a name="l00543"></a>00543    <span class="comment">// here we check our current transaction scope and create a transaction or savepoint</span>
<a name="l00544"></a>00544     $useSavepoint = ($conn-&gt;getTransactionLevel() &gt; 0) ? TRUE : FALSE;
<a name="l00545"></a>00545     <span class="keywordflow">if</span> ($useSavepoint)
<a name="l00546"></a>00546     {
<a name="l00547"></a>00547       $conn-&gt;beginTransaction(__FUNCTION__);
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549     <span class="keywordflow">else</span>
<a name="l00550"></a>00550     {
<a name="l00551"></a>00551       $conn-&gt;beginTransaction();
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     <span class="keywordflow">try</span>
<a name="l00555"></a>00555     {
<a name="l00556"></a>00556       <span class="comment">// Add new records and records with updated priority values in the person language</span>
<a name="l00557"></a>00557       <span class="comment">// many-to-many table.</span>
<a name="l00558"></a>00558       <span class="keywordflow">foreach</span> ($simplifiedNewLanguages AS $personId =&gt; $component)
<a name="l00559"></a>00559       {
<a name="l00560"></a>00560         <span class="keywordflow">foreach</span> ($component AS $languageId =&gt; $priority)
<a name="l00561"></a>00561         {
<a name="l00562"></a>00562           <span class="comment">// Create new person language records.</span>
<a name="l00563"></a>00563           $personMjLanguageTbl = $conn-&gt;getTable(<span class="stringliteral">&#39;agPersonMjAgLanguage&#39;</span>);
<a name="l00564"></a>00564           $personLanguage = <span class="keyword">new</span> <a class="code" href="classagPersonMjAgLanguage.html">agPersonMjAgLanguage</a>($personMjLanguageTbl, TRUE);
<a name="l00565"></a>00565           $personLanguage[<span class="stringliteral">&#39;person_id&#39;</span>] = $personId;
<a name="l00566"></a>00566           $personLanguage[<span class="stringliteral">&#39;language_id&#39;</span>] = $languageId;
<a name="l00567"></a>00567           $personLanguage[<span class="stringliteral">&#39;priority&#39;</span>] = $priority;
<a name="l00568"></a>00568           $personLanguage-&gt;save($conn);
<a name="l00569"></a>00569           $personLanguageId = $personLanguage-&gt;id;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571           <span class="comment">// Since we&#39;re creating new person language records, might as well create their</span>
<a name="l00572"></a>00572           <span class="comment">// cooresponding format and competency records.</span>
<a name="l00573"></a>00573 
<a name="l00574"></a>00574           $languageComponents = $personLanguages[$personId][$priority][1];
<a name="l00575"></a>00575 
<a name="l00576"></a>00576           <span class="keywordflow">if</span> (count($languageComponents) &gt; 0)
<a name="l00577"></a>00577           {
<a name="l00578"></a>00578             <span class="keywordflow">foreach</span> ($languageComponents AS $formatId =&gt; $competencyId)
<a name="l00579"></a>00579             {
<a name="l00580"></a>00580               <span class="comment">// Create new person&#39;s language component records.</span>
<a name="l00581"></a>00581               $personLanguageCompTbl = $conn-&gt;getTable(<span class="stringliteral">&#39;agPersonLanguageCompetency&#39;</span>);
<a name="l00582"></a>00582               $personLanguageCompetency = <span class="keyword">new</span> <a class="code" href="classagPersonLanguageCompetency.html">agPersonLanguageCompetency</a>($personLanguageCompTbl, TRUE);
<a name="l00583"></a>00583               $personLanguageCompetency[<span class="stringliteral">&#39;person_language_id&#39;</span>] = $personLanguageId;
<a name="l00584"></a>00584               $personLanguageCompetency[<span class="stringliteral">&#39;language_format_id&#39;</span>] = $formatId;
<a name="l00585"></a>00585               $personLanguageCompetency[<span class="stringliteral">&#39;language_competency_id&#39;</span>] = $competencyId;
<a name="l00586"></a>00586               $personLanguageCompetency-&gt;save($conn);
<a name="l00587"></a>00587             }
<a name="l00588"></a>00588           }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590           <span class="comment">// Unset all new person language records.</span>
<a name="l00591"></a>00591           <span class="keywordflow">if</span> (count($personLanguages[$personId]) == 1)
<a name="l00592"></a>00592           {
<a name="l00593"></a>00593             unset($personLanguages[$personId]);
<a name="l00594"></a>00594           }
<a name="l00595"></a>00595           <span class="keywordflow">else</span>
<a name="l00596"></a>00596           {
<a name="l00597"></a>00597             unset($personLanguages[$personId][$priority]);
<a name="l00598"></a>00598           }
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600         $results[<span class="stringliteral">&#39;upserted&#39;</span>]++;
<a name="l00601"></a>00601       }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603       <span class="comment">// Unset array to release memory.</span>
<a name="l00604"></a>00604       unset($personLanguage, $personLanguageCompetency);
<a name="l00605"></a>00605       unset($personId, $component, $languageId, $priority, $languageComponents, $formatId, $competencyId);
<a name="l00606"></a>00606       unset($simplifiedNewLanguages);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608       <span class="comment">// commit, being sensitive to our nesting</span>
<a name="l00609"></a>00609       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;commit(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;commit(); }
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611     <span class="keywordflow">catch</span>(Exception $e)
<a name="l00612"></a>00612     {
<a name="l00613"></a>00613       <span class="comment">// log our error</span>
<a name="l00614"></a>00614       $errMsg = sprintf(<span class="stringliteral">&#39;%s failed at: %s&#39;</span>, __FUNCTION__, $e-&gt;getMessage());
<a name="l00615"></a>00615       sfContext::getInstance()-&gt;getLogger()-&gt;err($errMsg);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617       <span class="comment">// rollback</span>
<a name="l00618"></a>00618       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;rollback(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;rollback(); }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620       <span class="comment">// ALWAYS throw an error, it&#39;s like stepping on a crack if you don&#39;t</span>
<a name="l00621"></a>00621       <span class="keywordflow">if</span> ($throwOnError) { <span class="keywordflow">throw</span> $e; }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       $results[<span class="stringliteral">&#39;failures&#39;</span>] = array_keys($personLanguages);
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="comment">// At this point, we still have to update, delete, and add new person language records.</span>
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     <span class="comment">// Query for all existing person language competency records.</span>
<a name="l00629"></a>00629     $q = <a class="code" href="classDoctrine__Query.html#a7420e7e1f1224c195cc56419fd733d14" title="create returns a new Doctrine_Query object">agDoctrineQuery::create</a>($conn)
<a name="l00630"></a>00630       -&gt;select(<span class="stringliteral">&#39;plc.*&#39;</span>)
<a name="l00631"></a>00631         -&gt;from(<span class="stringliteral">&#39;agPersonLanguageCompetency plc INDEXBY plc.id&#39;</span>)
<a name="l00632"></a>00632         -&gt;whereIn(<span class="stringliteral">&#39;plc.person_language_id&#39;</span>, array_keys($updateLanguageComponents));
<a name="l00633"></a>00633     $personLanguageComponentColl = $q-&gt;execute() ;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     $isUpdated = 0;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637     <span class="comment">// Update/delete person language competency records.</span>
<a name="l00638"></a>00638     <span class="keywordflow">foreach</span>($personLanguageComponentColl AS $collId =&gt; $components)
<a name="l00639"></a>00639     {
<a name="l00640"></a>00640       $collPersonLanguageId = $components[<span class="stringliteral">&#39;person_language_id&#39;</span>];
<a name="l00641"></a>00641       $collFormatId = $components[<span class="stringliteral">&#39;language_format_id&#39;</span>];
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (isset($updateLanguageComponents[$collPersonLanguageId])
<a name="l00643"></a>00643           &amp;&amp; array_key_exists($collFormatId, $updateLanguageComponents[$collPersonLanguageId]))
<a name="l00644"></a>00644       {
<a name="l00645"></a>00645         $personCompetencyId = $updateLanguageComponents[$collPersonLanguageId][$collFormatId];
<a name="l00646"></a>00646         <span class="keywordflow">if</span> ($personLanguageComponentColl[$collId][<span class="stringliteral">&#39;language_competency_id&#39;</span>] != $personCompetencyId)
<a name="l00647"></a>00647         {
<a name="l00648"></a>00648           $personLanguageComponentColl[$collId][<span class="stringliteral">&#39;language_competency_id&#39;</span>] = $personCompetencyId;
<a name="l00649"></a>00649         }
<a name="l00650"></a>00650       }
<a name="l00651"></a>00651       <span class="keywordflow">else</span>
<a name="l00652"></a>00652       {
<a name="l00653"></a>00653         $personLanguageComponentColl-&gt;remove($collId);
<a name="l00654"></a>00654       }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656       <span class="keywordflow">if</span> (isset($updateLanguageComponents[$collPersonLanguageId][$collFormatId]))
<a name="l00657"></a>00657       {
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (count($updateLanguageComponents[$collPersonLanguageId]) == 1)
<a name="l00659"></a>00659         {
<a name="l00660"></a>00660           unset($updateLanguageComponents[$collPersonLanguageId]);
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662         <span class="keywordflow">else</span>
<a name="l00663"></a>00663         {
<a name="l00664"></a>00664           unset($updateLanguageComponents[$collPersonLanguageId][$collFormatId]);
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666       }
<a name="l00667"></a>00667       $isUpdated = 1;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     <span class="keywordflow">if</span> ($isUpdated)
<a name="l00670"></a>00670     {
<a name="l00671"></a>00671       $results[<span class="stringliteral">&#39;upserted&#39;</span>]++;
<a name="l00672"></a>00672     }
<a name="l00673"></a>00673     unset($collId, $components, $collPersonLanguageId, $collFormatId, $personCompetencyId);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="comment">// here we check our current transaction scope and create a transaction or savepoint</span>
<a name="l00676"></a>00676     $useSavepoint = ($conn-&gt;getTransactionLevel() &gt; 0) ? TRUE : FALSE;
<a name="l00677"></a>00677     <span class="keywordflow">if</span> ($useSavepoint)
<a name="l00678"></a>00678     {
<a name="l00679"></a>00679       $conn-&gt;beginTransaction(__FUNCTION__);
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681     <span class="keywordflow">else</span>
<a name="l00682"></a>00682     {
<a name="l00683"></a>00683       $conn-&gt;beginTransaction();
<a name="l00684"></a>00684     }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     <span class="keywordflow">try</span>
<a name="l00687"></a>00687     {
<a name="l00688"></a>00688       $personLanguageComponentColl-&gt;save($conn);
<a name="l00689"></a>00689 
<a name="l00690"></a>00690       <span class="comment">// commit, being sensitive to our nesting</span>
<a name="l00691"></a>00691       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;commit(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;commit(); }
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693     <span class="keywordflow">catch</span>(Exception $e)
<a name="l00694"></a>00694     {
<a name="l00695"></a>00695       <span class="comment">// log our error</span>
<a name="l00696"></a>00696       $errMsg = sprintf(<span class="stringliteral">&#39;%s failed at: %s&#39;</span>, __FUNCTION__, $e-&gt;getMessage());
<a name="l00697"></a>00697       sfContext::getInstance()-&gt;getLogger()-&gt;err($errMsg);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699       <span class="comment">// rollback</span>
<a name="l00700"></a>00700       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;rollback(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;rollback(); }
<a name="l00701"></a>00701 
<a name="l00702"></a>00702       <span class="comment">// ALWAYS throw an error, it&#39;s like stepping on a crack if you don&#39;t</span>
<a name="l00703"></a>00703       <span class="keywordflow">if</span> ($throwOnError) { <span class="keywordflow">throw</span> $e; }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705       $results[<span class="stringliteral">&#39;failures&#39;</span>] = array_keys($personLanguages);
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="comment">// Last final step is to add new person language competency records.</span>
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <span class="comment">// here we check our current transaction scope and create a transaction or savepoint</span>
<a name="l00711"></a>00711     $useSavepoint = ($conn-&gt;getTransactionLevel() &gt; 0) ? TRUE : FALSE;
<a name="l00712"></a>00712     <span class="keywordflow">if</span> ($useSavepoint)
<a name="l00713"></a>00713     {
<a name="l00714"></a>00714       $conn-&gt;beginTransaction(__FUNCTION__);
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716     <span class="keywordflow">else</span>
<a name="l00717"></a>00717     {
<a name="l00718"></a>00718       $conn-&gt;beginTransaction();
<a name="l00719"></a>00719     }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721     <span class="keywordflow">try</span>
<a name="l00722"></a>00722     {
<a name="l00723"></a>00723       <span class="keywordflow">foreach</span>($updateLanguageComponents AS $personLanguageId =&gt; $pLangs)
<a name="l00724"></a>00724       {
<a name="l00725"></a>00725         <span class="keywordflow">foreach</span>($pLangs as $formatId =&gt; $competencyId)
<a name="l00726"></a>00726         {
<a name="l00727"></a>00727           <span class="comment">// Create new person&#39;s language component records.</span>
<a name="l00728"></a>00728           $personLangCompTbl = $conn-&gt;getTable(<span class="stringliteral">&#39;agPersonLanguageCompetency&#39;</span>);
<a name="l00729"></a>00729           $personLanguageCompetency = <span class="keyword">new</span> <a class="code" href="classagPersonLanguageCompetency.html">agPersonLanguageCompetency</a>($personLangCompTbl, TRUE);
<a name="l00730"></a>00730           $personLanguageCompetency[<span class="stringliteral">&#39;person_language_id&#39;</span>] = $personLanguageId;
<a name="l00731"></a>00731           $personLanguageCompetency[<span class="stringliteral">&#39;language_format_id&#39;</span>] = $formatId;
<a name="l00732"></a>00732           $personLanguageCompetency[<span class="stringliteral">&#39;language_competency_id&#39;</span>] = $competencyId;
<a name="l00733"></a>00733           $personLanguageCompetency-&gt;save($conn);
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735       }
<a name="l00736"></a>00736       <span class="comment">// commit, being sensitive to our nesting</span>
<a name="l00737"></a>00737       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;commit(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;commit(); }
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739     <span class="keywordflow">catch</span>(Exception $e)
<a name="l00740"></a>00740     {
<a name="l00741"></a>00741       <span class="comment">// log our error</span>
<a name="l00742"></a>00742       $errMsg = sprintf(<span class="stringliteral">&#39;%s failed at: %s&#39;</span>, __FUNCTION__, $e-&gt;getMessage());
<a name="l00743"></a>00743       sfContext::getInstance()-&gt;getLogger()-&gt;err($errMsg);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745       <span class="comment">// rollback</span>
<a name="l00746"></a>00746       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;rollback(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;rollback(); }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748       <span class="comment">// ALWAYS throw an error, it&#39;s like stepping on a crack if you don&#39;t</span>
<a name="l00749"></a>00749       <span class="keywordflow">if</span> ($throwOnError) { <span class="keywordflow">throw</span> $e; }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751       $results[<span class="stringliteral">&#39;failures&#39;</span>] = array_keys($personLanguages);
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     unset($updateLanguageComponents, $personLanguageId, $pLangs, $formatId, $competencyId);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="keywordflow">return</span> $results ;
<a name="l00757"></a>00757   }
<a name="l00758"></a>00758 
<a name="l00796"></a><a class="code" href="classagPersonLanguageHelper.html#a9c5bd355d9fb56ca1f1cebefcdf2b2f9">00796</a>   <span class="keyword">protected</span> function <a class="code" href="classagPersonLanguageHelper.html#a9c5bd355d9fb56ca1f1cebefcdf2b2f9" title="Method to prioritize person languages.">reprioritizePersonLanguages</a>(array $newLanguages, array $currLanguages)
<a name="l00797"></a>00797   {
<a name="l00798"></a>00798     $simplifiedNewLanguages = array();
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="keywordflow">foreach</span> ($newLanguages AS $personId =&gt; $pLangs)
<a name="l00801"></a>00801     {
<a name="l00802"></a>00802       <span class="keywordflow">if</span> (count($pLangs) == 0) {
<a name="l00803"></a>00803         $simplifiedNewLanguages[$personId] = array();
<a name="l00804"></a>00804       }
<a name="l00805"></a>00805       <span class="keywordflow">else</span>
<a name="l00806"></a>00806       {
<a name="l00807"></a>00807         <span class="keywordflow">foreach</span> ($pLangs as $priority =&gt; $lang)
<a name="l00808"></a>00808         {
<a name="l00809"></a>00809           $simplifiedNewLanguages[$personId][$lang[0]] = $priority;
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811       }
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813     <span class="comment">// Unset foreach loop variables that are no longer in needed.</span>
<a name="l00814"></a>00814     unset($personId, $pLangs, $priority, $lang);
<a name="l00815"></a>00815 
<a name="l00816"></a>00816     <span class="comment">// loop through and do an inner array diff</span>
<a name="l00817"></a>00817     <span class="keywordflow">foreach</span>($currLanguages AS $personId =&gt; $pLangs)
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819       <span class="comment">// Compare personId and languageId between $newLanguages and $currLanguages.</span>
<a name="l00820"></a>00820       <span class="keywordflow">foreach</span> ($pLangs AS $index =&gt; $lang)
<a name="l00821"></a>00821       {
<a name="l00822"></a>00822         <span class="comment">// Append person&#39;s current language that&#39;s not found in the new language array to the </span>
<a name="l00823"></a>00823         <span class="comment">// new language array for further processing.</span>
<a name="l00824"></a>00824         <span class="keywordflow">if</span> (!array_key_exists($lang[0], $simplifiedNewLanguages[$personId]))
<a name="l00825"></a>00825         {
<a name="l00826"></a>00826           $priority = count($newLanguages[$personId]) + 1;
<a name="l00827"></a>00827           $newLanguages[$personId][$priority] = $lang;
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829         <span class="comment">// Unset to release memory</span>
<a name="l00830"></a>00830         unset($currLanguages[$personId][$index]);
<a name="l00831"></a>00831       }
<a name="l00832"></a>00832       <span class="comment">// Unset to release memory</span>
<a name="l00833"></a>00833       unset($currLanguages[$personId]);
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835     <span class="comment">// Release memories.</span>
<a name="l00836"></a>00836     unset($personId, $pLangs, $index, $lang);
<a name="l00837"></a>00837     unset($currLanguages, $simplifiedNewLanguages);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="keywordflow">return</span> $newLanguages;
<a name="l00840"></a>00840   }
<a name="l00841"></a>00841 
<a name="l00850"></a><a class="code" href="classagPersonLanguageHelper.html#a207f5d60b8a1d58a0922cae5b77525aa">00850</a>   <span class="keyword">protected</span> function <a class="code" href="classagPersonLanguageHelper.html#a207f5d60b8a1d58a0922cae5b77525aa" title="Method to remove person language competency entries from a person.">deletePersonLanguageCompetencies</a>(array $personLanguageIds,
<a name="l00851"></a>00851                                                       $throwOnError = NULL,
<a name="l00852"></a>00852                                                       <a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $conn = NULL)
<a name="l00853"></a>00853   {
<a name="l00854"></a>00854     <span class="comment">// explicit declarations are good!</span>
<a name="l00855"></a>00855     $results = 0;
<a name="l00856"></a>00856     $err = NULL;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     <span class="comment">// pick up some defaults if not passed anything</span>
<a name="l00859"></a>00859     <span class="keywordflow">if</span> (is_null($throwOnError)) { $throwOnError = $this-&gt;throwOnError; }
<a name="l00860"></a>00860     <span class="keywordflow">if</span> (is_null($conn)) { $conn = <a class="code" href="classDoctrine__Manager.html#a4a265fc048ee4080e26779f3ba36681c" title="Open a new connection.">Doctrine_Manager::connection</a>(); }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     <span class="comment">// build our query object</span>
<a name="l00863"></a>00863     $q = <a class="code" href="classDoctrine__Query.html#a7420e7e1f1224c195cc56419fd733d14" title="create returns a new Doctrine_Query object">agDoctrineQuery::create</a>($conn)
<a name="l00864"></a>00864                  -&gt;delete(<span class="stringliteral">&#39;agPersonLanguageCompetency&#39;</span>)
<a name="l00865"></a>00865                  -&gt;whereIn(<span class="stringliteral">&#39;person_language_id&#39;</span>, $personLanguageIds);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="comment">// here we check our current transaction scope and create a transaction or savepoint</span>
<a name="l00868"></a>00868     $useSavepoint = ($conn-&gt;getTransactionLevel() &gt; 0) ? TRUE : FALSE;
<a name="l00869"></a>00869     <span class="keywordflow">if</span> ($useSavepoint)
<a name="l00870"></a>00870     {
<a name="l00871"></a>00871       $conn-&gt;beginTransaction(__FUNCTION__);
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873     <span class="keywordflow">else</span>
<a name="l00874"></a>00874     {
<a name="l00875"></a>00875       $conn-&gt;beginTransaction();
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     <span class="keywordflow">try</span>
<a name="l00879"></a>00879     {
<a name="l00880"></a>00880       <span class="comment">// execute our person language competency mapping join purge</span>
<a name="l00881"></a>00881       $results = $q-&gt;execute();
<a name="l00882"></a>00882 
<a name="l00883"></a>00883       <span class="comment">// most excellent! no errors at all, so we commit... finally!</span>
<a name="l00884"></a>00884       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;commit(__FUNCTION__) ; } <span class="keywordflow">else</span> { $conn-&gt;commit(); }
<a name="l00885"></a>00885     }
<a name="l00886"></a>00886     <span class="keywordflow">catch</span>(Exception $e)
<a name="l00887"></a>00887     {
<a name="l00888"></a>00888       <span class="comment">// log our error</span>
<a name="l00889"></a>00889       $errMsg = sprintf(<span class="stringliteral">&#39;Failed to purge person language competency for persons %s. Rolled back changes!&#39;</span>,
<a name="l00890"></a>00890         json_encode($personLanguageIds)) ;
<a name="l00891"></a>00891       sfContext::getInstance()-&gt;getLogger()-&gt;err($errMsg);
<a name="l00892"></a>00892 
<a name="l00893"></a>00893       <span class="comment">// rollback</span>
<a name="l00894"></a>00894       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;rollback(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;rollback(); }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896       <span class="comment">// ALWAYS throw an error, it&#39;s like stepping on a crack if you don&#39;t</span>
<a name="l00897"></a>00897       <span class="keywordflow">if</span> ($throwOnError) { <span class="keywordflow">throw</span> $e; }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899       $results[<span class="stringliteral">&#39;failures&#39;</span>] = array_keys($personLanguages);
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901 
<a name="l00902"></a>00902     <span class="keywordflow">return</span> $results;
<a name="l00903"></a>00903   }
<a name="l00904"></a>00904 
<a name="l00913"></a><a class="code" href="classagPersonLanguageHelper.html#a7c07feacb3b82413715520a6af394ca4">00913</a>   <span class="keyword">protected</span> function <a class="code" href="classagPersonLanguageHelper.html#a7c07feacb3b82413715520a6af394ca4" title="Method to remove person language entries from a person.">deletePersonLanguages</a>(array $personLanguageIds,
<a name="l00914"></a>00914                                                  $throwOnError = NULL,
<a name="l00915"></a>00915                                                  <a class="code" href="classDoctrine__Connection.html">Doctrine_Connection</a> $conn = NULL)
<a name="l00916"></a>00916   {
<a name="l00917"></a>00917     <span class="comment">// explicit declarations are good!</span>
<a name="l00918"></a>00918     $results = 0;
<a name="l00919"></a>00919     $err = NULL;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <span class="comment">// pick up some defaults if not passed anything</span>
<a name="l00922"></a>00922     <span class="keywordflow">if</span> (is_null($throwOnError)) { $throwOnError = $this-&gt;throwOnError; }
<a name="l00923"></a>00923     <span class="keywordflow">if</span> (is_null($conn)) { $conn = <a class="code" href="classDoctrine__Manager.html#a4a265fc048ee4080e26779f3ba36681c" title="Open a new connection.">Doctrine_Manager::connection</a>(); }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <span class="comment">// Delete from child table.</span>
<a name="l00926"></a>00926     $this-&gt;<a class="code" href="classagPersonLanguageHelper.html#a207f5d60b8a1d58a0922cae5b77525aa" title="Method to remove person language competency entries from a person.">deletePersonLanguageCompetencies</a>($personLanguageIds, $throwOnError, $conn);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <span class="comment">// build our query object</span>
<a name="l00930"></a>00930     $q = <a class="code" href="classDoctrine__Query.html#a7420e7e1f1224c195cc56419fd733d14" title="create returns a new Doctrine_Query object">agDoctrineQuery::create</a>($conn)
<a name="l00931"></a>00931                  -&gt;delete(<span class="stringliteral">&#39;agPersonMjAgLanguage&#39;</span>)
<a name="l00932"></a>00932                  -&gt;whereIn(<span class="stringliteral">&#39;id&#39;</span>, $personLanguageIds);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934     <span class="comment">// here we check our current transaction scope and create a transaction or savepoint</span>
<a name="l00935"></a>00935     $useSavepoint = ($conn-&gt;getTransactionLevel() &gt; 0) ? TRUE : FALSE;
<a name="l00936"></a>00936     <span class="keywordflow">if</span> ($useSavepoint)
<a name="l00937"></a>00937     {
<a name="l00938"></a>00938       $conn-&gt;beginTransaction(__FUNCTION__);
<a name="l00939"></a>00939     }
<a name="l00940"></a>00940     <span class="keywordflow">else</span>
<a name="l00941"></a>00941     {
<a name="l00942"></a>00942       $conn-&gt;beginTransaction();
<a name="l00943"></a>00943     }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="keywordflow">try</span>
<a name="l00946"></a>00946     {
<a name="l00947"></a>00947       <span class="comment">// execute our person language competency mapping join purge</span>
<a name="l00948"></a>00948       $results = $q-&gt;execute();
<a name="l00949"></a>00949 
<a name="l00950"></a>00950       <span class="comment">// most excellent! no errors at all, so we commit... finally!</span>
<a name="l00951"></a>00951       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;commit(__FUNCTION__) ; } <span class="keywordflow">else</span> { $conn-&gt;commit(); }
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953     <span class="keywordflow">catch</span>(Exception $e)
<a name="l00954"></a>00954     {
<a name="l00955"></a>00955       <span class="comment">// log our error</span>
<a name="l00956"></a>00956       $errMsg = sprintf(<span class="stringliteral">&#39;Failed to purge person\&#39;s languages for persons %s. Rolled back changes!&#39;</span>,
<a name="l00957"></a>00957         json_encode($personLanguageIds)) ;
<a name="l00958"></a>00958       sfContext::getInstance()-&gt;getLogger()-&gt;err($errMsg);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960       <span class="comment">// rollback</span>
<a name="l00961"></a>00961       <span class="keywordflow">if</span> ($useSavepoint) { $conn-&gt;rollback(__FUNCTION__); } <span class="keywordflow">else</span> { $conn-&gt;rollback(); }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963       <span class="comment">// ALWAYS throw an error, it&#39;s like stepping on a crack if you don&#39;t</span>
<a name="l00964"></a>00964       <span class="keywordflow">if</span> ($throwOnError) { <span class="keywordflow">throw</span> $e; }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966       $results[<span class="stringliteral">&#39;failures&#39;</span>] = array_keys($personLanguages);
<a name="l00967"></a>00967     }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     <span class="keywordflow">return</span> $results;
<a name="l00970"></a>00970   }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
