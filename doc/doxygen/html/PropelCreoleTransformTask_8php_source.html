<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Sahana Agasti: lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/propel-generator/classes/propel/phing/PropelCreoleTransformTask.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>lib/vendor/symfony/lib/plugins/sfPropelPlugin/lib/vendor/propel-generator/classes/propel/phing/PropelCreoleTransformTask.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> *  $Id: PropelCreoleTransformTask.php 1262 2009-10-26 20:54:39Z francois $</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00007"></a>00007 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00008"></a>00008 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00009"></a>00009 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00010"></a>00010 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00011"></a>00011 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00012"></a>00012 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00013"></a>00013 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00014"></a>00014 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00015"></a>00015 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00016"></a>00016 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00019"></a>00019 <span class="comment"> * and is licensed under the LGPL. For more information please see</span>
<a name="l00020"></a>00020 <span class="comment"> * &lt;http://propel.phpdb.org&gt;.</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 require_once <span class="stringliteral">&#39;phing/Task.php&#39;</span>;
<a name="l00024"></a>00024 include_once <span class="stringliteral">&#39;propel/engine/database/model/PropelTypes.php&#39;</span>;
<a name="l00025"></a>00025 
<a name="l00036"></a><a class="code" href="classPropelCreoleTransformTask.html">00036</a> <span class="keyword">class </span><a class="code" href="classPropelCreoleTransformTask.html">PropelCreoleTransformTask</a> <span class="keyword">extends</span> <a class="code" href="classTask.html">Task</a> {
<a name="l00037"></a>00037 
<a name="l00039"></a><a class="code" href="classPropelCreoleTransformTask.html#a8d874f60ca9aa8d6602981787fc1ffc3">00039</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a8d874f60ca9aa8d6602981787fc1ffc3" title="Name of XML database schema produced.">$xmlSchema</a>;
<a name="l00040"></a>00040 
<a name="l00042"></a><a class="code" href="classPropelCreoleTransformTask.html#a2f232fb95d19be77ffa3a44cf3bc6732">00042</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a2f232fb95d19be77ffa3a44cf3bc6732" title="Creole URL.">$dbUrl</a>;
<a name="l00043"></a>00043 
<a name="l00045"></a><a class="code" href="classPropelCreoleTransformTask.html#aa643d13018e931670a1407a757c3257a">00045</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#aa643d13018e931670a1407a757c3257a" title="Creole driver.">$dbDriver</a>;
<a name="l00046"></a>00046 
<a name="l00048"></a><a class="code" href="classPropelCreoleTransformTask.html#a3546f2a6fa582536d439bb156c36a144">00048</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a3546f2a6fa582536d439bb156c36a144" title="Creole user name.">$dbUser</a>;
<a name="l00049"></a>00049 
<a name="l00051"></a><a class="code" href="classPropelCreoleTransformTask.html#a30dba3b784f1467c83e5d5db757a29e4">00051</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a30dba3b784f1467c83e5d5db757a29e4" title="Creole password.">$dbPassword</a>;
<a name="l00052"></a>00052 
<a name="l00054"></a><a class="code" href="classPropelCreoleTransformTask.html#a63c648fc307ef56f04e758fd9db8f3f9">00054</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a63c648fc307ef56f04e758fd9db8f3f9" title="DB encoding to use.">$dbEncoding</a> = <span class="stringliteral">&#39;iso-8859-1&#39;</span>;
<a name="l00055"></a>00055 
<a name="l00057"></a><a class="code" href="classPropelCreoleTransformTask.html#acbd5b95a26660e149aa42088fed37cfe">00057</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#acbd5b95a26660e149aa42088fed37cfe" title="DB schema to use.">$dbSchema</a>;
<a name="l00058"></a>00058 
<a name="l00060"></a><a class="code" href="classPropelCreoleTransformTask.html#aab3c0343b091278a29d0c1cc5e648189">00060</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#aab3c0343b091278a29d0c1cc5e648189" title="parsed DB DSN">$dsn</a>;
<a name="l00061"></a>00061 
<a name="l00063"></a><a class="code" href="classPropelCreoleTransformTask.html#a1f7badba56d80920da0e6b3c7cacb28b">00063</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a1f7badba56d80920da0e6b3c7cacb28b" title="DOM document produced.">$doc</a>;
<a name="l00064"></a>00064 
<a name="l00066"></a><a class="code" href="classPropelCreoleTransformTask.html#a5e67e56933f26b770c9a5a651c321387">00066</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a5e67e56933f26b770c9a5a651c321387" title="The document root element.">$databaseNode</a>;
<a name="l00067"></a>00067 
<a name="l00069"></a><a class="code" href="classPropelCreoleTransformTask.html#aac48ed21436073bbc55e8b02c608c60e">00069</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#aac48ed21436073bbc55e8b02c608c60e" title="Hashtable of columns that have primary keys.">$primaryKeys</a>;
<a name="l00070"></a>00070 
<a name="l00072"></a>00072   <span class="comment">// doesn&#39;t seem to be used</span>
<a name="l00073"></a>00073   <span class="comment">// protected $columnTableMap;</span>
<a name="l00074"></a>00074 
<a name="l00076"></a><a class="code" href="classPropelCreoleTransformTask.html#a0d7734bd4357329f0f53bcb9ecfa3aab">00076</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a0d7734bd4357329f0f53bcb9ecfa3aab" title="Hashtable to track what table a column belongs to.">$samePhpName</a>;
<a name="l00077"></a>00077 
<a name="l00079"></a><a class="code" href="classPropelCreoleTransformTask.html#a144cd23f523693548b1c9148d9f2d291">00079</a>   <span class="keyword">protected</span> <a class="code" href="classPropelCreoleTransformTask.html#a144cd23f523693548b1c9148d9f2d291" title="whether to add vendor info or not">$addVendorInfo</a>;
<a name="l00080"></a>00080 
<a name="l00086"></a>00086   <span class="keyword">protected</span> $validatorBits;
<a name="l00087"></a>00087 
<a name="l00093"></a>00093   <span class="keyword">protected</span> $validatorInfos;
<a name="l00094"></a>00094 
<a name="l00098"></a><a class="code" href="classPropelCreoleTransformTask.html#ae27f7be34b07ae0a60a6ac99232af901">00098</a>   <span class="keyword">const</span> <a class="code" href="classPropelCreoleTransformTask.html#ae27f7be34b07ae0a60a6ac99232af901" title="Zero bit for no validators.">VALIDATORS_NONE</a> = 0;
<a name="l00099"></a>00099 
<a name="l00103"></a><a class="code" href="classPropelCreoleTransformTask.html#ace619550f367102330336ea5234ed9af">00103</a>   <span class="keyword">const</span> <a class="code" href="classPropelCreoleTransformTask.html#ace619550f367102330336ea5234ed9af" title="Bit for maxLength validator.">VALIDATORS_MAXLENGTH</a> = 1;
<a name="l00104"></a>00104 
<a name="l00108"></a><a class="code" href="classPropelCreoleTransformTask.html#ab1959e9e37eb564f1573242f1316c9e2">00108</a>   <span class="keyword">const</span> <a class="code" href="classPropelCreoleTransformTask.html#ab1959e9e37eb564f1573242f1316c9e2" title="Bit for maxValue validator.">VALIDATORS_MAXVALUE</a> = 2;
<a name="l00109"></a>00109 
<a name="l00113"></a><a class="code" href="classPropelCreoleTransformTask.html#a8b3f251c555b6fc819cf6ac84d3d364d">00113</a>   <span class="keyword">const</span> <a class="code" href="classPropelCreoleTransformTask.html#a8b3f251c555b6fc819cf6ac84d3d364d" title="Bit for type validator.">VALIDATORS_TYPE</a> = 4;
<a name="l00114"></a>00114 
<a name="l00118"></a><a class="code" href="classPropelCreoleTransformTask.html#a6015f2cbce1ab589655e57d7d99ab7be">00118</a>   <span class="keyword">const</span> <a class="code" href="classPropelCreoleTransformTask.html#a6015f2cbce1ab589655e57d7d99ab7be" title="Bit for required validator.">VALIDATORS_REQUIRED</a> = 8;
<a name="l00119"></a>00119 
<a name="l00123"></a><a class="code" href="classPropelCreoleTransformTask.html#ac430ef613af3054bfacaa45573ebe407">00123</a>   <span class="keyword">const</span> <a class="code" href="classPropelCreoleTransformTask.html#ac430ef613af3054bfacaa45573ebe407" title="Bit for unique validator.">VALIDATORS_UNIQUE</a> = 16;
<a name="l00124"></a>00124 
<a name="l00128"></a><a class="code" href="classPropelCreoleTransformTask.html#a27c97487e2517d4ca64e3b4f8f560518">00128</a>   <span class="keyword">const</span> <a class="code" href="classPropelCreoleTransformTask.html#a27c97487e2517d4ca64e3b4f8f560518" title="Bit for all validators.">VALIDATORS_ALL</a> = 255;
<a name="l00129"></a>00129 
<a name="l00139"></a>00139   <span class="keyword">static</span> <span class="keyword">protected</span> $validatorBitMap = array (
<a name="l00140"></a>00140     <span class="stringliteral">&#39;none&#39;</span> =&gt; <a class="code" href="classPropelCreoleTransformTask.html#ae27f7be34b07ae0a60a6ac99232af901" title="Zero bit for no validators.">PropelCreoleTransformTask::VALIDATORS_NONE</a>,
<a name="l00141"></a>00141     <span class="stringliteral">&#39;maxlength&#39;</span> =&gt; <a class="code" href="classPropelCreoleTransformTask.html#ace619550f367102330336ea5234ed9af" title="Bit for maxLength validator.">PropelCreoleTransformTask::VALIDATORS_MAXLENGTH</a>,
<a name="l00142"></a>00142     <span class="stringliteral">&#39;maxvalue&#39;</span> =&gt; <a class="code" href="classPropelCreoleTransformTask.html#ab1959e9e37eb564f1573242f1316c9e2" title="Bit for maxValue validator.">PropelCreoleTransformTask::VALIDATORS_MAXVALUE</a>,
<a name="l00143"></a>00143     <span class="stringliteral">&#39;type&#39;</span> =&gt; <a class="code" href="classPropelCreoleTransformTask.html#a8b3f251c555b6fc819cf6ac84d3d364d" title="Bit for type validator.">PropelCreoleTransformTask::VALIDATORS_TYPE</a>,
<a name="l00144"></a>00144     <span class="stringliteral">&#39;required&#39;</span> =&gt; <a class="code" href="classPropelCreoleTransformTask.html#a6015f2cbce1ab589655e57d7d99ab7be" title="Bit for required validator.">PropelCreoleTransformTask::VALIDATORS_REQUIRED</a>,
<a name="l00145"></a>00145     <span class="stringliteral">&#39;unique&#39;</span> =&gt; <a class="code" href="classPropelCreoleTransformTask.html#ac430ef613af3054bfacaa45573ebe407" title="Bit for unique validator.">PropelCreoleTransformTask::VALIDATORS_UNIQUE</a>,
<a name="l00146"></a>00146     <span class="stringliteral">&#39;all&#39;</span> =&gt; <a class="code" href="classPropelCreoleTransformTask.html#a27c97487e2517d4ca64e3b4f8f560518" title="Bit for all validators.">PropelCreoleTransformTask::VALIDATORS_ALL</a>,
<a name="l00147"></a>00147   );
<a name="l00148"></a>00148 
<a name="l00155"></a>00155   <span class="keyword">static</span> <span class="keyword">protected</span> $validatorMessages = array (
<a name="l00156"></a>00156     <span class="stringliteral">&#39;maxlength&#39;</span> =&gt; array (
<a name="l00157"></a>00157       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The field %s must be not longer than %s characters.&#39;</span>,
<a name="l00158"></a>00158       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>, <span class="stringliteral">&#39;value&#39;</span>)
<a name="l00159"></a>00159   ),
<a name="l00160"></a>00160     <span class="stringliteral">&#39;maxvalue&#39;</span> =&gt; array (
<a name="l00161"></a>00161       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The field %s must be not greater than %s.&#39;</span>,
<a name="l00162"></a>00162       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>, <span class="stringliteral">&#39;value&#39;</span>)
<a name="l00163"></a>00163   ),
<a name="l00164"></a>00164     <span class="stringliteral">&#39;type&#39;</span> =&gt; array (
<a name="l00165"></a>00165       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The field %s is not a valid value.&#39;</span>,
<a name="l00166"></a>00166       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>)
<a name="l00167"></a>00167   ),
<a name="l00168"></a>00168     <span class="stringliteral">&#39;required&#39;</span> =&gt; array (
<a name="l00169"></a>00169       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;The field %s is required.&#39;</span>,
<a name="l00170"></a>00170       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>)
<a name="l00171"></a>00171   ),
<a name="l00172"></a>00172     <span class="stringliteral">&#39;unique&#39;</span> =&gt; array (
<a name="l00173"></a>00173       <span class="stringliteral">&#39;msg&#39;</span> =&gt; <span class="stringliteral">&#39;This %s already exists in table %s.&#39;</span>,
<a name="l00174"></a>00174       <span class="stringliteral">&#39;var&#39;</span> =&gt; array(<span class="stringliteral">&#39;colName&#39;</span>, <span class="stringliteral">&#39;tableName&#39;</span>)
<a name="l00175"></a>00175   ),
<a name="l00176"></a>00176   );
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <span class="keyword">public</span> function getDbSchema()
<a name="l00179"></a>00179   {
<a name="l00180"></a>00180     <span class="keywordflow">return</span> $this-&gt;dbSchema;
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keyword">public</span> function setDbSchema(<a class="code" href="classPropelCreoleTransformTask.html#acbd5b95a26660e149aa42088fed37cfe" title="DB schema to use.">$dbSchema</a>)
<a name="l00184"></a>00184   {
<a name="l00185"></a>00185     $this-&gt;dbSchema = <a class="code" href="classPropelCreoleTransformTask.html#acbd5b95a26660e149aa42088fed37cfe" title="DB schema to use.">$dbSchema</a>;
<a name="l00186"></a>00186   }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   <span class="keyword">public</span> function setDbUrl($v)
<a name="l00189"></a>00189   {
<a name="l00190"></a>00190     $this-&gt;dbUrl = $v;
<a name="l00191"></a>00191   }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keyword">public</span> function setDbDriver($v)
<a name="l00194"></a>00194   {
<a name="l00195"></a>00195     $this-&gt;dbDriver = $v;
<a name="l00196"></a>00196   }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="keyword">public</span> function setDbUser($v)
<a name="l00199"></a>00199   {
<a name="l00200"></a>00200     $this-&gt;dbUser = $v;
<a name="l00201"></a>00201   }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   <span class="keyword">public</span> function setDbPassword($v)
<a name="l00204"></a>00204   {
<a name="l00205"></a>00205     $this-&gt;dbPassword = $v;
<a name="l00206"></a>00206   }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208   <span class="keyword">public</span> function setDbEncoding($v)
<a name="l00209"></a>00209   {
<a name="l00210"></a>00210     $this-&gt;dbEncoding = $v;
<a name="l00211"></a>00211   }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   <span class="keyword">public</span> function setOutputFile($v)
<a name="l00214"></a>00214   {
<a name="l00215"></a>00215     $this-&gt;xmlSchema = $v;
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   <span class="keyword">public</span> function setSamePhpName($v)
<a name="l00219"></a>00219   {
<a name="l00220"></a>00220     $this-&gt;samePhpName = $v;
<a name="l00221"></a>00221   }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <span class="keyword">public</span> function setAddVendorInfo($v)
<a name="l00224"></a>00224   {
<a name="l00225"></a>00225     $this-&gt;addVendorInfo = (boolean) $v;
<a name="l00226"></a>00226   }
<a name="l00227"></a>00227 
<a name="l00234"></a><a class="code" href="classPropelCreoleTransformTask.html#ae6474a5eed5b63aa969a0e6a99c3cadc">00234</a>   <span class="keyword">public</span> function <a class="code" href="classPropelCreoleTransformTask.html#ae6474a5eed5b63aa969a0e6a99c3cadc" title="Sets set validator bitfield from a comma-separated list of &amp;quot;validator bit&amp;quot;...">setAddValidators</a>($v)
<a name="l00235"></a>00235   {
<a name="l00236"></a>00236     $validKeys = array_keys(self::$validatorBitMap);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="comment">// lowercase input</span>
<a name="l00239"></a>00239     $v = strtolower($v);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     $bits = self::VALIDATORS_NONE;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     $exprs = explode(<span class="charliteral">&#39;,&#39;</span>, $v);
<a name="l00244"></a>00244     <span class="keywordflow">foreach</span> ($exprs as $expr) {
<a name="l00245"></a>00245       $expr = trim($expr);
<a name="l00246"></a>00246       <span class="keywordflow">if</span> (!isset(self::$validatorBitMap[$expr])) {
<a name="l00247"></a>00247         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classBuildException.html">BuildException</a>(<span class="stringliteral">&quot;Unable to interpret validator in expression (&#39;$v&#39;): &quot;</span> . $expr);
<a name="l00248"></a>00248       }
<a name="l00249"></a>00249       $bits |= self::$validatorBitMap[$expr];
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     $this-&gt;validatorBits = $bits;
<a name="l00253"></a>00253   }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   <span class="keyword">public</span> function isSamePhpName()
<a name="l00256"></a>00256   {
<a name="l00257"></a>00257     <span class="keywordflow">return</span> $this-&gt;samePhpName;
<a name="l00258"></a>00258   }
<a name="l00259"></a>00259 
<a name="l00265"></a><a class="code" href="classPropelCreoleTransformTask.html#aa975bad6cea2317e78147dc8b13c2d17">00265</a>   <span class="keyword">public</span> function <a class="code" href="classPropelCreoleTransformTask.html#aa975bad6cea2317e78147dc8b13c2d17" title="Default constructor.">main</a>()
<a name="l00266"></a>00266   {
<a name="l00267"></a>00267     include_once <span class="stringliteral">&#39;creole/Creole.php&#39;</span>;
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (!class_exists(<span class="stringliteral">&#39;Creole&#39;</span>)) {
<a name="l00269"></a>00269       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classBuildException.html">BuildException</a>( get_class($this) . <span class="stringliteral">&quot; task depends on Creole classes being on include_path. (i.e. include of &#39;creole/Creole.php&#39; failed.)&quot;</span>, $this-&gt;<a class="code" href="classTask.html#af1c5497c347a5047b82ee8abc7168bf1" title="Returns the location within the buildfile this task occurs.">getLocation</a>());
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Propel - CreoleToXMLSchema starting&quot;</span>);
<a name="l00273"></a>00273     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Your DB settings are:&quot;</span>);
<a name="l00274"></a>00274     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;driver : &quot;</span> . ($this-&gt;dbDriver ? $this-&gt;dbDriver : <span class="stringliteral">&quot;(default)&quot;</span>));
<a name="l00275"></a>00275     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;URL : &quot;</span> . $this-&gt;dbUrl);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     <span class="comment">//(not yet supported) $this-&gt;log(&quot;schema : &quot; . $this-&gt;dbSchema);</span>
<a name="l00278"></a>00278     <span class="comment">//DocumentTypeImpl docType = new DocumentTypeImpl(null, &quot;database&quot;, null,</span>
<a name="l00279"></a>00279     <span class="comment">//     &quot;http://jakarta.apache.org/turbine/dtd/database.dtd&quot;);</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     $this-&gt;doc = <span class="keyword">new</span> DOMDocument(<span class="stringliteral">&#39;1.0&#39;</span>, <span class="stringliteral">&#39;utf-8&#39;</span>);
<a name="l00282"></a>00282     $this-&gt;doc-&gt;formatOutput = <span class="keyword">true</span>; <span class="comment">// pretty printing</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     $this-&gt;doc-&gt;appendChild($this-&gt;doc-&gt;createComment(<span class="stringliteral">&quot;Autogenerated by CreoleToXMLSchema!&quot;</span>));
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="keywordflow">try</span> {
<a name="l00287"></a>00287       $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aafcc81f131c19d66f7942c248d6b03df" title="Generates an XML database schema from Creole metadata.">generateXML</a>();
<a name="l00288"></a>00288       $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Writing XML to file: &quot;</span> . $this-&gt;xmlSchema);
<a name="l00289"></a>00289       $outFile = <span class="keyword">new</span> <a class="code" href="classPhingFile.html">PhingFile</a>($this-&gt;xmlSchema);
<a name="l00290"></a>00290       $out = <span class="keyword">new</span> <a class="code" href="classFileWriter.html">FileWriter</a>($outFile);
<a name="l00291"></a>00291       $xmlstr = $this-&gt;doc-&gt;saveXML();
<a name="l00292"></a>00292       $out-&gt;write($xmlstr);
<a name="l00293"></a>00293       $out-&gt;close();
<a name="l00294"></a>00294     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00295"></a>00295       $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;There was an error building XML from metadata: &quot;</span> . $e-&gt;getMessage(), Project::MSG_ERR);
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Propel - CreoleToXMLSchema finished&quot;</span>);
<a name="l00298"></a>00298   }
<a name="l00299"></a>00299 
<a name="l00306"></a><a class="code" href="classPropelCreoleTransformTask.html#aafcc81f131c19d66f7942c248d6b03df">00306</a>   <span class="keyword">public</span> function <a class="code" href="classPropelCreoleTransformTask.html#aafcc81f131c19d66f7942c248d6b03df" title="Generates an XML database schema from Creole metadata.">generateXML</a>()
<a name="l00307"></a>00307   {
<a name="l00308"></a>00308     <span class="comment">// Establish db connection</span>
<a name="l00309"></a>00309     $con = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#a96b01a893364fab55449e372e69fb34b" title="Establishes a Creole database connection.">getConnection</a>();
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="comment">// Get the database Metadata.</span>
<a name="l00312"></a>00312     $dbInfo = $con-&gt;getDatabaseInfo();
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="comment">// create and add the database node</span>
<a name="l00315"></a>00315     <a class="code" href="classPropelCreoleTransformTask.html#a5e67e56933f26b770c9a5a651c321387" title="The document root element.">$databaseNode</a> = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#ab9d0db3d3a6b3de24b198f8924510de9" title="Creates a database node.">createDatabaseNode</a>($dbInfo);
<a name="l00316"></a>00316     $this-&gt;doc-&gt;appendChild(<a class="code" href="classPropelCreoleTransformTask.html#a5e67e56933f26b770c9a5a651c321387" title="The document root element.">$databaseNode</a>);
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318 
<a name="l00324"></a><a class="code" href="classPropelCreoleTransformTask.html#a96b01a893364fab55449e372e69fb34b">00324</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#a96b01a893364fab55449e372e69fb34b" title="Establishes a Creole database connection.">getConnection</a>() {
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <span class="comment">// Attemtp to connect to a database.</span>
<a name="l00327"></a>00327     $this-&gt;dsn = Creole::parseDSN($this-&gt;dbUrl);
<a name="l00328"></a>00328     <span class="keywordflow">if</span> ($this-&gt;dbUser) {
<a name="l00329"></a>00329       $this-&gt;dsn[<span class="stringliteral">&quot;username&quot;</span>] = $this-&gt;dbUser;
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331     <span class="keywordflow">if</span> ($this-&gt;dbPassword) {
<a name="l00332"></a>00332       $this-&gt;dsn[<span class="stringliteral">&quot;password&quot;</span>] = $this-&gt;dbPassword;
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     <span class="keywordflow">if</span> ($this-&gt;dbDriver) {
<a name="l00335"></a>00335       Creole::registerDriver($this-&gt;dsn[<span class="stringliteral">&#39;phptype&#39;</span>], $this-&gt;dbDriver);
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337     $con = <a class="code" href="classPropelCreoleTransformTask.html#a96b01a893364fab55449e372e69fb34b" title="Establishes a Creole database connection.">Creole::getConnection</a>($this-&gt;dsn);
<a name="l00338"></a>00338     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;DB connection established&quot;</span>);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordflow">return</span> $con;
<a name="l00341"></a>00341   }
<a name="l00342"></a>00342 
<a name="l00349"></a><a class="code" href="classPropelCreoleTransformTask.html#ab9d0db3d3a6b3de24b198f8924510de9">00349</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#ab9d0db3d3a6b3de24b198f8924510de9" title="Creates a database node.">createDatabaseNode</a>($dbInfo) {
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Processing database&quot;</span>);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     $node = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;database&quot;</span>);
<a name="l00354"></a>00354     $node-&gt;setAttribute(<span class="stringliteral">&quot;name&quot;</span>, $dbInfo-&gt;getName());
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <span class="keywordflow">if</span> ($vendorNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca2a6eab1d0cc8f7e0ddae70964f0c45" title="Creates a vendor info node.">createVendorInfoNode</a>($dbInfo-&gt;getVendorSpecificInfo())) {
<a name="l00357"></a>00357       $node-&gt;appendChild($vendorNode);
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="comment">// create and add table nodes</span>
<a name="l00361"></a>00361     <span class="keywordflow">foreach</span> ($dbInfo-&gt;getTables() as $table) {
<a name="l00362"></a>00362       $tableNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#a0cc106f6cd691d611958b8416e54e84a" title="Creates a table node.">createTableNode</a>($table);
<a name="l00363"></a>00363       $node-&gt;appendChild($tableNode);
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="keywordflow">return</span> $node;
<a name="l00367"></a>00367   }
<a name="l00368"></a>00368 
<a name="l00375"></a><a class="code" href="classPropelCreoleTransformTask.html#a0cc106f6cd691d611958b8416e54e84a">00375</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#a0cc106f6cd691d611958b8416e54e84a" title="Creates a table node.">createTableNode</a>($table) {
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Processing table: &quot;</span> . $table-&gt;toString());
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     $node = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;table&quot;</span>);
<a name="l00380"></a>00380     $node-&gt;setAttribute(<span class="stringliteral">&quot;name&quot;</span>, $table-&gt;getName());
<a name="l00381"></a>00381     <span class="keywordflow">if</span> ($this-&gt;isSamePhpName()) {
<a name="l00382"></a>00382       $node-&gt;setAttribute(<span class="stringliteral">&quot;phpName&quot;</span>, $table-&gt;getName());
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384     <span class="keywordflow">if</span> ($vendorNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca2a6eab1d0cc8f7e0ddae70964f0c45" title="Creates a vendor info node.">createVendorInfoNode</a>($table-&gt;getVendorSpecificInfo())) {
<a name="l00385"></a>00385       $node-&gt;appendChild($vendorNode);
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="comment">// Create and add column nodes, register column validators</span>
<a name="l00389"></a>00389     $columns = $table-&gt;getColumns();
<a name="l00390"></a>00390     <span class="keywordflow">foreach</span> ($columns as $column) {
<a name="l00391"></a>00391       $columnNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#a66deab8a3b0e72a1d45672cb25a1c73e" title="Creates an column node.">createColumnNode</a>($column);
<a name="l00392"></a>00392       $node-&gt;appendChild($columnNode);
<a name="l00393"></a>00393       $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#a85faed9e0b7b59b4f410b8191e46c6fa" title="Registers column type specific validators if necessary.">registerValidatorsForColumn</a>($column);
<a name="l00394"></a>00394       <span class="keywordflow">if</span> ($column-&gt;isAutoIncrement()) {
<a name="l00395"></a>00395         $idMethod = <span class="stringliteral">&#39;native&#39;</span>;
<a name="l00396"></a>00396       }
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (isset($idMethod)) {
<a name="l00399"></a>00399       $node-&gt;setAttribute(<span class="stringliteral">&quot;idMethod&quot;</span>, $idMethod);
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     <span class="comment">// Create and add foreign key nodes.</span>
<a name="l00403"></a>00403     $foreignKeys = $table-&gt;getForeignKeys();
<a name="l00404"></a>00404     <span class="keywordflow">foreach</span> ($foreignKeys as $foreignKey) {
<a name="l00405"></a>00405       $foreignKeyNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aa092a765ea8292de33adce010ffd1ec7" title="Creates an foreign key node.">createForeignKeyNode</a>($foreignKey);
<a name="l00406"></a>00406       $node-&gt;appendChild($foreignKeyNode);
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">// Create and add index nodes.</span>
<a name="l00410"></a>00410     $indices =  $table-&gt;getIndices();
<a name="l00411"></a>00411     <span class="keywordflow">foreach</span> ($indices as $index) {
<a name="l00412"></a>00412       $indexNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#a0a125a9005ab50752db8da8ed2f1239b" title="Creates an index node.">createIndexNode</a>($index);
<a name="l00413"></a>00413       $node-&gt;appendChild($indexNode);
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="comment">// add an id-method-parameter if we have a sequence that matches table_colname_seq</span>
<a name="l00417"></a>00417     <span class="comment">//</span>
<a name="l00418"></a>00418     <span class="comment">//</span>
<a name="l00419"></a>00419     $pkey = $table-&gt;getPrimaryKey();
<a name="l00420"></a>00420     <span class="keywordflow">if</span> ($pkey) {
<a name="l00421"></a>00421       $cols = $pkey-&gt;getColumns();
<a name="l00422"></a>00422       <span class="keywordflow">if</span> (count($cols) === 1) {
<a name="l00423"></a>00423         $col = array_shift($cols);
<a name="l00424"></a>00424         <span class="keywordflow">if</span> ($col-&gt;isAutoIncrement()) {
<a name="l00425"></a>00425           $seq_name = $table-&gt;getName().<span class="charliteral">&#39;_&#39;</span>.$col-&gt;getName().<span class="stringliteral">&#39;_seq&#39;</span>;
<a name="l00426"></a>00426           <span class="keywordflow">if</span> ($table-&gt;getDatabase()-&gt;isSequence($seq_name)) {
<a name="l00427"></a>00427             $idMethodParameterNode = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;id-method-parameter&quot;</span>);
<a name="l00428"></a>00428             $idMethodParameterNode-&gt;setAttribute(<span class="stringliteral">&quot;value&quot;</span>, $seq_name);
<a name="l00429"></a>00429             $node-&gt;appendChild($idMethodParameterNode);
<a name="l00430"></a>00430           }
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432       }
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="comment">// Create and add validator and rule nodes.</span>
<a name="l00437"></a>00437     $nodes = array();
<a name="l00438"></a>00438     $tableName = $table-&gt;getName();
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (isset($this-&gt;validatorInfos[$tableName])) {
<a name="l00440"></a>00440       <span class="keywordflow">foreach</span> ($this-&gt;validatorInfos[$tableName] as $colName =&gt; $rules) {
<a name="l00441"></a>00441         $column = $table-&gt;getColumn($colName);
<a name="l00442"></a>00442         $colName = $column-&gt;getName();
<a name="l00443"></a>00443         <span class="keywordflow">foreach</span> ($rules as $rule) {
<a name="l00444"></a>00444           <span class="keywordflow">if</span> (!isset($nodes[$colName])) {
<a name="l00445"></a>00445             $nodes[$colName] = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#a01c87ac247c836be8ed7b6a60de5e1f1" title="Creates a validator node.">createValidator</a>($column, $rule[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l00446"></a>00446             $node-&gt;appendChild($nodes[$colName]);
<a name="l00447"></a>00447           }
<a name="l00448"></a>00448           $ruleNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#a36fb5fc62bb39219525588ca29833148" title="Creates a rule node.">createRuleNode</a>($column, $rule);
<a name="l00449"></a>00449           $nodes[$colName]-&gt;appendChild($ruleNode);
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451       }
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <span class="keywordflow">return</span> $node;
<a name="l00455"></a>00455   }
<a name="l00456"></a>00456 
<a name="l00467"></a><a class="code" href="classPropelCreoleTransformTask.html#ab791576889622109569a9014510d9cb6">00467</a>   <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classPropelCreoleTransformTask.html#ab791576889622109569a9014510d9cb6" title="Returns the Propel type for given Creole type.">getMappedPropelType</a>($creoleType)
<a name="l00468"></a>00468   {
<a name="l00469"></a>00469     <span class="keyword">static</span> $creoleToPropelTypeMap;
<a name="l00470"></a>00470     <span class="keywordflow">if</span> ($creoleToPropelTypeMap === null) {
<a name="l00471"></a>00471       $creoleToPropelTypeMap = array();
<a name="l00472"></a>00472       $creoleToPropelTypeMap[CreoleTypes::CHAR] = PropelTypes::CHAR;
<a name="l00473"></a>00473       $creoleToPropelTypeMap[CreoleTypes::VARCHAR] = PropelTypes::VARCHAR;
<a name="l00474"></a>00474       $creoleToPropelTypeMap[CreoleTypes::LONGVARCHAR] = PropelTypes::LONGVARCHAR;
<a name="l00475"></a>00475       $creoleToPropelTypeMap[CreoleTypes::CLOB] = PropelTypes::CLOB;
<a name="l00476"></a>00476       $creoleToPropelTypeMap[CreoleTypes::NUMERIC] = PropelTypes::NUMERIC;
<a name="l00477"></a>00477       $creoleToPropelTypeMap[CreoleTypes::DECIMAL] = PropelTypes::DECIMAL;
<a name="l00478"></a>00478       $creoleToPropelTypeMap[CreoleTypes::TINYINT] = PropelTypes::TINYINT;
<a name="l00479"></a>00479       $creoleToPropelTypeMap[CreoleTypes::SMALLINT] = PropelTypes::SMALLINT;
<a name="l00480"></a>00480       $creoleToPropelTypeMap[CreoleTypes::INTEGER] = PropelTypes::INTEGER;
<a name="l00481"></a>00481       $creoleToPropelTypeMap[CreoleTypes::BIGINT] = PropelTypes::BIGINT;
<a name="l00482"></a>00482       $creoleToPropelTypeMap[CreoleTypes::REAL] = PropelTypes::REAL;
<a name="l00483"></a>00483       $creoleToPropelTypeMap[CreoleTypes::FLOAT] = PropelTypes::FLOAT;
<a name="l00484"></a>00484       $creoleToPropelTypeMap[CreoleTypes::DOUBLE] = PropelTypes::DOUBLE;
<a name="l00485"></a>00485       $creoleToPropelTypeMap[CreoleTypes::BINARY] = PropelTypes::BINARY;
<a name="l00486"></a>00486       $creoleToPropelTypeMap[CreoleTypes::VARBINARY] = PropelTypes::VARBINARY;
<a name="l00487"></a>00487       $creoleToPropelTypeMap[CreoleTypes::LONGVARBINARY] = PropelTypes::LONGVARBINARY;
<a name="l00488"></a>00488       $creoleToPropelTypeMap[CreoleTypes::BLOB] = PropelTypes::BLOB;
<a name="l00489"></a>00489       $creoleToPropelTypeMap[CreoleTypes::DATE] = PropelTypes::DATE;
<a name="l00490"></a>00490       $creoleToPropelTypeMap[CreoleTypes::TIME] = PropelTypes::TIME;
<a name="l00491"></a>00491       $creoleToPropelTypeMap[CreoleTypes::TIMESTAMP] = PropelTypes::TIMESTAMP;
<a name="l00492"></a>00492       $creoleToPropelTypeMap[CreoleTypes::BOOLEAN] = PropelTypes::BOOLEAN;
<a name="l00493"></a>00493       $creoleToPropelTypeMap[CreoleTypes::YEAR] = PropelTypes::INTEGER;
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     <span class="keywordflow">if</span> (isset($creoleToPropelTypeMap[$creoleType])) {
<a name="l00497"></a>00497       <span class="keywordflow">return</span> $creoleToPropelTypeMap[$creoleType];
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499   }
<a name="l00500"></a>00500 
<a name="l00507"></a><a class="code" href="classPropelCreoleTransformTask.html#a66deab8a3b0e72a1d45672cb25a1c73e">00507</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#a66deab8a3b0e72a1d45672cb25a1c73e" title="Creates an column node.">createColumnNode</a>($column) {
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     $node = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;column&quot;</span>);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     $table = $column-&gt;getTable();
<a name="l00512"></a>00512     $colName = $column-&gt;getName();
<a name="l00513"></a>00513     $colType = $column-&gt;getType();
<a name="l00514"></a>00514     $colSize = $column-&gt;getSize();
<a name="l00515"></a>00515     $colScale = $column-&gt;getScale();
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="keywordflow">if</span> ($colType === CreoleTypes::OTHER) {
<a name="l00518"></a>00518       $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;Column [&quot;</span> . $table-&gt;getName() . <span class="stringliteral">&quot;.&quot;</span> . $colName . <span class="stringliteral">&quot;] has a column type (&quot;</span>.$column-&gt;getNativeType().<span class="stringliteral">&quot;) that Propel does not support.&quot;</span>, Project::MSG_WARN);
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     $node-&gt;setAttribute(<span class="stringliteral">&quot;name&quot;</span>, $colName);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="keywordflow">if</span> ($this-&gt;isSamePhpName()) {
<a name="l00524"></a>00524       $node-&gt;setAttribute(<span class="stringliteral">&quot;phpName&quot;</span>, $colName);
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     $node-&gt;setAttribute(<span class="stringliteral">&quot;type&quot;</span>, self::getMappedPropelType($colType));
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <span class="keywordflow">if</span> ($colSize &gt; 0 &amp;&amp; (
<a name="l00530"></a>00530     $colType == CreoleTypes::CHAR
<a name="l00531"></a>00531     || $colType == CreoleTypes::VARCHAR
<a name="l00532"></a>00532     || $colType == CreoleTypes::LONGVARCHAR
<a name="l00533"></a>00533     || $colType == CreoleTypes::DECIMAL
<a name="l00534"></a>00534     || $colType == CreoleTypes::FLOAT
<a name="l00535"></a>00535     || $colType == CreoleTypes::NUMERIC)) {
<a name="l00536"></a>00536       $node-&gt;setAttribute(<span class="stringliteral">&quot;size&quot;</span>, (<span class="keywordtype">string</span>) $colSize);
<a name="l00537"></a>00537     }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="keywordflow">if</span> ($colScale &gt; 0 &amp;&amp; (
<a name="l00540"></a>00540     $colType == CreoleTypes::DECIMAL
<a name="l00541"></a>00541     || $colType == CreoleTypes::FLOAT
<a name="l00542"></a>00542     || $colType == CreoleTypes::NUMERIC)) {
<a name="l00543"></a>00543       $node-&gt;setAttribute(<span class="stringliteral">&quot;scale&quot;</span>, (<span class="keywordtype">string</span>) $colScale);
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (!$column-&gt;isNullable()) {
<a name="l00547"></a>00547       $node-&gt;setAttribute(<span class="stringliteral">&quot;required&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="keywordflow">if</span> ($column-&gt;isAutoIncrement()) {
<a name="l00551"></a>00551       $node-&gt;setAttribute(<span class="stringliteral">&quot;autoIncrement&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     <span class="keywordflow">if</span> (in_array($colName, $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aa901a4a0fc728d2bb7e08c09b3ae35f4" title="Returns the primary key columns for a table.">getTablePkCols</a>($table))) {
<a name="l00555"></a>00555       $node-&gt;setAttribute(<span class="stringliteral">&quot;primaryKey&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (($defValue = $column-&gt;getDefaultValue()) !== null) {
<a name="l00559"></a>00559       $node-&gt;setAttribute(<span class="stringliteral">&quot;default&quot;</span>, iconv($this-&gt;dbEncoding, <span class="stringliteral">&#39;utf-8&#39;</span>, $defValue));
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="keywordflow">if</span> ($vendorNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca2a6eab1d0cc8f7e0ddae70964f0c45" title="Creates a vendor info node.">createVendorInfoNode</a>($column-&gt;getVendorSpecificInfo())) {
<a name="l00563"></a>00563       $node-&gt;appendChild($vendorNode);
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="keywordflow">return</span> $node;
<a name="l00567"></a>00567   }
<a name="l00568"></a>00568 
<a name="l00575"></a><a class="code" href="classPropelCreoleTransformTask.html#aa901a4a0fc728d2bb7e08c09b3ae35f4">00575</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#aa901a4a0fc728d2bb7e08c09b3ae35f4" title="Returns the primary key columns for a table.">getTablePkCols</a>($table) {
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     <span class="keyword">static</span> $columns = array();
<a name="l00578"></a>00578 
<a name="l00579"></a>00579     $tableName = $table-&gt;getName();
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (!isset($columns[$tableName])) {
<a name="l00581"></a>00581       $columns[$tableName] = array();
<a name="l00582"></a>00582       $primaryKey = $table-&gt;getPrimaryKey();
<a name="l00583"></a>00583       <span class="keywordflow">if</span> ($primaryKey) {
<a name="l00584"></a>00584         <span class="keywordflow">foreach</span> ($primaryKey-&gt;getColumns() as $colObject) {
<a name="l00585"></a>00585           $columns[$tableName][] = $colObject-&gt;getName();
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587       }
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589     <span class="keywordflow">return</span> $columns[$tableName];
<a name="l00590"></a>00590   }
<a name="l00591"></a>00591 
<a name="l00598"></a><a class="code" href="classPropelCreoleTransformTask.html#aa092a765ea8292de33adce010ffd1ec7">00598</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#aa092a765ea8292de33adce010ffd1ec7" title="Creates an foreign key node.">createForeignKeyNode</a>($foreignKey) {
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     $node = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;foreign-key&quot;</span>);
<a name="l00601"></a>00601     <span class="keywordflow">if</span> ($vendorNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca2a6eab1d0cc8f7e0ddae70964f0c45" title="Creates a vendor info node.">createVendorInfoNode</a>($foreignKey-&gt;getVendorSpecificInfo())) {
<a name="l00602"></a>00602       $node-&gt;appendChild($vendorNode);
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     $refs = $foreignKey-&gt;getReferences();
<a name="l00606"></a>00606     <span class="comment">// all references must be to same table, so we can grab table from the first, foreign column</span>
<a name="l00607"></a>00607     $node-&gt;setAttribute(<span class="stringliteral">&quot;foreignTable&quot;</span>, $refs[0][1]-&gt;getTable()-&gt;getName());
<a name="l00608"></a>00608     $node-&gt;setAttribute(<span class="stringliteral">&quot;onDelete&quot;</span>, $refs[0][2]);
<a name="l00609"></a>00609     $node-&gt;setAttribute(<span class="stringliteral">&quot;onUpdate&quot;</span>, $refs[0][3]);
<a name="l00610"></a>00610     <span class="keywordflow">for</span> ($m = 0, $size = count($refs); $m &lt; $size; $m++) {
<a name="l00611"></a>00611       $refNode = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;reference&quot;</span>);
<a name="l00612"></a>00612       $refData = $refs[$m];
<a name="l00613"></a>00613       $refNode-&gt;setAttribute(<span class="stringliteral">&quot;local&quot;</span>, $refData[0]-&gt;getName());
<a name="l00614"></a>00614       $refNode-&gt;setAttribute(<span class="stringliteral">&quot;foreign&quot;</span>, $refData[1]-&gt;getName());
<a name="l00615"></a>00615       $node-&gt;appendChild($refNode);
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     <span class="keywordflow">return</span> $node;
<a name="l00619"></a>00619   }
<a name="l00620"></a>00620 
<a name="l00627"></a><a class="code" href="classPropelCreoleTransformTask.html#a0a125a9005ab50752db8da8ed2f1239b">00627</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#a0a125a9005ab50752db8da8ed2f1239b" title="Creates an index node.">createIndexNode</a>($index) {
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     $indexType = $index-&gt;isUnique() ?  <span class="stringliteral">&#39;unique&#39;</span> : <span class="stringliteral">&#39;index&#39;</span>;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     $node = $this-&gt;doc-&gt;createElement($indexType);
<a name="l00632"></a>00632     $node-&gt;setAttribute(<span class="stringliteral">&quot;name&quot;</span>, $index-&gt;getName());
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     $columns = $index-&gt;getColumns();
<a name="l00635"></a>00635     <span class="keywordflow">foreach</span> ($columns as $column) {
<a name="l00636"></a>00636       $tableName = $column-&gt;getTable()-&gt;getName();
<a name="l00637"></a>00637       $colName = $column-&gt;getName();
<a name="l00638"></a>00638       $columnNode = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;{$indexType}-column&quot;</span>);
<a name="l00639"></a>00639       $columnNode-&gt;setAttribute(<span class="stringliteral">&quot;name&quot;</span>, $colName);
<a name="l00640"></a>00640       $node-&gt;appendChild($columnNode);
<a name="l00641"></a>00641       <span class="keywordflow">if</span> ($indexType == <span class="stringliteral">&#39;unique&#39;</span> &amp;&amp; $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(<span class="stringliteral">&#39;unique&#39;</span>)) {
<a name="l00642"></a>00642         $this-&gt;validatorInfos[$tableName][$colName][] = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;unique&#39;</span>);
<a name="l00643"></a>00643       }
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="keywordflow">if</span> ($vendorNode = $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca2a6eab1d0cc8f7e0ddae70964f0c45" title="Creates a vendor info node.">createVendorInfoNode</a>($index-&gt;getVendorSpecificInfo())) {
<a name="l00647"></a>00647       $node-&gt;appendChild($vendorNode);
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keywordflow">return</span> $node;
<a name="l00651"></a>00651   }
<a name="l00652"></a>00652 
<a name="l00659"></a><a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093">00659</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>($type) {
<a name="l00660"></a>00660     <span class="keywordflow">return</span> (($this-&gt;validatorBits &amp; $type) === $type);
<a name="l00661"></a>00661   }
<a name="l00662"></a>00662 
<a name="l00694"></a><a class="code" href="classPropelCreoleTransformTask.html#a85faed9e0b7b59b4f410b8191e46c6fa">00694</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#a85faed9e0b7b59b4f410b8191e46c6fa" title="Registers column type specific validators if necessary.">registerValidatorsForColumn</a>($column) {
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     $table = $column-&gt;getTable();
<a name="l00697"></a>00697     $tableName = $table-&gt;getName();
<a name="l00698"></a>00698 
<a name="l00699"></a>00699     $colName = $column-&gt;getName();
<a name="l00700"></a>00700     $colType = $column-&gt;getType();
<a name="l00701"></a>00701     $colSize = $column-&gt;getSize();
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_REQUIRED)) {
<a name="l00704"></a>00704       $ruleInfo = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;required&#39;</span>);
<a name="l00705"></a>00705       $this-&gt;validatorInfos[$tableName][$colName][] = $ruleInfo;
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707     $isPrimarykeyCol = in_array($colName, $this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aa901a4a0fc728d2bb7e08c09b3ae35f4" title="Returns the primary key columns for a table.">getTablePkCols</a>($table));
<a name="l00708"></a>00708     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_UNIQUE) &amp;&amp; $isPrimarykeyCol) {
<a name="l00709"></a>00709       $ruleInfo = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;unique&#39;</span>);
<a name="l00710"></a>00710       $this-&gt;validatorInfos[$tableName][$colName][] = $ruleInfo;
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_MAXLENGTH) &amp;&amp;
<a name="l00713"></a>00713     $colSize &gt; 0 &amp;&amp; in_array($colType, array(
<a name="l00714"></a>00714     CreoleTypes::CHAR,
<a name="l00715"></a>00715     CreoleTypes::VARCHAR,
<a name="l00716"></a>00716     CreoleTypes::LONGVARCHAR))) {
<a name="l00717"></a>00717       $ruleInfo = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;maxLength&#39;</span>, <span class="stringliteral">&#39;value&#39;</span> =&gt; $colSize);
<a name="l00718"></a>00718       $this-&gt;validatorInfos[$tableName][$colName][] = $ruleInfo;
<a name="l00719"></a>00719     }
<a name="l00720"></a>00720     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_MAXVALUE) &amp;&amp;
<a name="l00721"></a>00721     $colSize &gt; 0 &amp;&amp; in_array($colType, array(
<a name="l00722"></a>00722     CreoleTypes::SMALLINT,
<a name="l00723"></a>00723     CreoleTypes::TINYINT,
<a name="l00724"></a>00724     CreoleTypes::INTEGER,
<a name="l00725"></a>00725     CreoleTypes::BIGINT,
<a name="l00726"></a>00726     CreoleTypes::FLOAT,
<a name="l00727"></a>00727     CreoleTypes::DOUBLE,
<a name="l00728"></a>00728     CreoleTypes::NUMERIC,
<a name="l00729"></a>00729     CreoleTypes::DECIMAL,
<a name="l00730"></a>00730     CreoleTypes::REAL))) {
<a name="l00731"></a>00731 
<a name="l00732"></a>00732       <span class="comment">// TODO: how to evaluate the appropriate size??</span>
<a name="l00733"></a>00733       $this-&gt;<a class="code" href="classTask.html#aa94acfaf11f66109c9abac6ff028f92d" title="Provides a project level log event to the task.">log</a>(<span class="stringliteral">&quot;WARNING: maxValue validator added for column $colName. You will have to adjust the size value manually.&quot;</span>, Project::MSG_WARN);
<a name="l00734"></a>00734       $ruleInfo = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;maxValue&#39;</span>, <span class="stringliteral">&#39;value&#39;</span> =&gt; $colSize);
<a name="l00735"></a>00735       $this-&gt;validatorInfos[$tableName][$colName][] = $ruleInfo;
<a name="l00736"></a>00736     }
<a name="l00737"></a>00737     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_TYPE) &amp;&amp;
<a name="l00738"></a>00738     $colSize &gt; 0 &amp;&amp; in_array($colType, array(
<a name="l00739"></a>00739     CreoleTypes::SMALLINT,
<a name="l00740"></a>00740     CreoleTypes::TINYINT,
<a name="l00741"></a>00741     CreoleTypes::INTEGER,
<a name="l00742"></a>00742     CreoleTypes::TIMESTAMP))) {
<a name="l00743"></a>00743       $ruleInfo = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;value&#39;</span> =&gt; <span class="stringliteral">&#39;[^\d]+&#39;</span>);
<a name="l00744"></a>00744       $this-&gt;validatorInfos[$tableName][$colName][] = $ruleInfo;
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classPropelCreoleTransformTask.html#aca1fca5ecdf5907dd076823b6ecda093" title="Checks whether to add validators of specified type or not.">isValidatorRequired</a>(self::VALIDATORS_TYPE) &amp;&amp;
<a name="l00747"></a>00747     $colSize &gt; 0 &amp;&amp; in_array($colType, array(
<a name="l00748"></a>00748     CreoleTypes::FLOAT,
<a name="l00749"></a>00749     CreoleTypes::DOUBLE,
<a name="l00750"></a>00750     CreoleTypes::NUMERIC,
<a name="l00751"></a>00751     CreoleTypes::DECIMAL,
<a name="l00752"></a>00752     CreoleTypes::REAL))) {
<a name="l00753"></a>00753       <span class="comment">// TODO: is this always true??</span>
<a name="l00754"></a>00754       $ruleInfo = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;value&#39;</span> =&gt; <span class="stringliteral">&#39;[^\d\.]+&#39;</span>);
<a name="l00755"></a>00755       $this-&gt;validatorInfos[$tableName][$colName][] = $ruleInfo;
<a name="l00756"></a>00756     }
<a name="l00757"></a>00757   }
<a name="l00758"></a>00758 
<a name="l00766"></a><a class="code" href="classPropelCreoleTransformTask.html#a01c87ac247c836be8ed7b6a60de5e1f1">00766</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#a01c87ac247c836be8ed7b6a60de5e1f1" title="Creates a validator node.">createValidator</a>($column, $type) {
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     $node = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&#39;validator&#39;</span>);
<a name="l00769"></a>00769     $node-&gt;setAttribute(<span class="stringliteral">&#39;column&#39;</span>, $column-&gt;getName());
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     <span class="keywordflow">return</span> $node;
<a name="l00772"></a>00772   }
<a name="l00773"></a>00773 
<a name="l00781"></a><a class="code" href="classPropelCreoleTransformTask.html#a36fb5fc62bb39219525588ca29833148">00781</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#a36fb5fc62bb39219525588ca29833148" title="Creates a rule node.">createRuleNode</a>($column, $rule) {
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     extract($rule);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     <span class="comment">// create message</span>
<a name="l00786"></a>00786     $colName = $column-&gt;getName();
<a name="l00787"></a>00787     $tableName = $column-&gt;getTable()-&gt;getName();
<a name="l00788"></a>00788     $msg = self::$validatorMessages[strtolower($type)];
<a name="l00789"></a>00789     $tmp = compact($msg[<span class="stringliteral">&#39;var&#39;</span>]);
<a name="l00790"></a>00790     array_unshift($tmp, $msg[<span class="stringliteral">&#39;msg&#39;</span>]);
<a name="l00791"></a>00791     $msg = call_user_func_array(<span class="stringliteral">&#39;sprintf&#39;</span>, $tmp);
<a name="l00792"></a>00792 
<a name="l00793"></a>00793     <span class="comment">// add node</span>
<a name="l00794"></a>00794     $node = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&#39;rule&#39;</span>);
<a name="l00795"></a>00795     $node-&gt;setAttribute(<span class="stringliteral">&#39;name&#39;</span>, $type == <span class="stringliteral">&#39;type&#39;</span> ? <span class="stringliteral">&#39;notMatch&#39;</span> : $type);
<a name="l00796"></a>00796     $node-&gt;setAttribute(<span class="stringliteral">&#39;message&#39;</span>, $msg);
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <span class="keywordflow">return</span> $node;
<a name="l00799"></a>00799   }
<a name="l00800"></a>00800 
<a name="l00809"></a><a class="code" href="classPropelCreoleTransformTask.html#aca2a6eab1d0cc8f7e0ddae70964f0c45">00809</a>   <span class="keyword">protected</span> function <a class="code" href="classPropelCreoleTransformTask.html#aca2a6eab1d0cc8f7e0ddae70964f0c45" title="Creates a vendor info node.">createVendorInfoNode</a>($vendorInfo)
<a name="l00810"></a>00810   {
<a name="l00811"></a>00811     <span class="keywordflow">if</span> (!$vendorInfo OR !$this-&gt;addVendorInfo) {
<a name="l00812"></a>00812       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     $vendorNode = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;vendor&quot;</span>);
<a name="l00816"></a>00816     $vendorNode-&gt;setAttribute(<span class="stringliteral">&quot;type&quot;</span>, $this-&gt;dsn[<span class="stringliteral">&quot;phptype&quot;</span>]);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818     <span class="keywordflow">foreach</span> ($vendorInfo as $key =&gt; $value) {
<a name="l00819"></a>00819       $parameterNode = $this-&gt;doc-&gt;createElement(<span class="stringliteral">&quot;parameter&quot;</span>);
<a name="l00820"></a>00820       $value = iconv($this-&gt;dbEncoding, <span class="stringliteral">&quot;utf-8&quot;</span>, $value);
<a name="l00821"></a>00821       $parameterNode-&gt;setAttribute(<span class="stringliteral">&quot;name&quot;</span>, $key);
<a name="l00822"></a>00822       $parameterNode-&gt;setAttribute(<span class="stringliteral">&quot;value&quot;</span>, $value);
<a name="l00823"></a>00823       $vendorNode-&gt;appendChild($parameterNode);
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826     <span class="keywordflow">return</span> $vendorNode;
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
